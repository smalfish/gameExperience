System.register([],(function(e,t){"use strict";return{execute:async function(){e({A:void 0,B:void 0,E:void 0,F:void 0,G:void 0,K:void 0,L:void 0,S:void 0,T:void 0,_:$,a2:void 0,a8:Fs,a9:La,aB:he,aC:le,aD:function(){},aJ:ie,aK:ee,aO:re,aP:void 0,aQ:es,aU:function(e,t,n,i,r){void 0===n&&(n=Ko.R32F),void 0===i&&(i=0),void 0===r&&(r=0);var o=Ma[n];r||(r=o.size);for(var a="set"+MA(o),s=o.size/o.count,c=Math.floor(t.length/o.count),l=wv.isLittleEndian,u=0;u<c;++u)for(var h=i+r*u,_=0;_<o.count;++_){var f=h+s*_;e[a](f,t[o.count*u+_],l)}},aV:void 0,aW:lb,aX:DA,aZ:vt,a_:function(e){return gh(Eh({formerlySerializedAs:e}))},ac:void 0,ad:ne,ag:void 0,ai:void 0,al:void 0,an:Ba,ao:I,ap:g,at:void 0,au:function(e,t,n,i,r,o){void 0===t&&(t=Ko.R32F),void 0===n&&(n=0),void 0===i&&(i=e.byteLength-n),void 0===r&&(r=0),void 0===o&&(o=[]);var a=Ma[t];r||(r=a.size);for(var s="get"+MA(a),c=a.size/a.count,l=Math.floor(i/r),u=wv.isLittleEndian,h=0;h<l;++h)for(var _=n+r*h,f=0;f<a.count;++f){var m=_+c*f;o[a.count*h+f]=e[s](m,u)}return o},av:function(){},b:XN,b$:void 0,b0:Vh,b2:void 0,bA:GM,bB:UM,bD:void 0,bF:void 0,bL:void 0,bM:void 0,bT:Ue,bV:H,bW:Qe,bd:void 0,be:void 0,bh:void 0,bs:xn,bt:ef,bu:void 0,bw:function(e,t,n){for(Zn.identity(n);e!==t;)Zn.fromRTS(YM,e.rotation,e.position,e.scale),Zn.multiply(n,YM,n),e=e.parent;return n},bz:HM,c$:Tn,c1:void 0,c2:void 0,c3:xt,c4:void 0,cE:yn,cH:Ot,cM:gn,cT:En,cX:void 0,cY:Rn,cZ:Cn,cb:vn,cj:void 0,cp:void 0,cs:Dt,ct:Ke,cu:C,cw:void 0,cz:void 0,d0:An,d1:ce,d3:On,d5:UE,d7:dn,d9:N_,dB:ri,dC:Un,dD:ai,dE:Kn,dH:li,dI:hi,dJ:Ln,dL:pn,dM:wn,dN:In,dO:bn,dP:Nn,dQ:Pn,dR:pt,dX:function(e){e>0&&(ye=e)},dY:void 0,dZ:IT,d_:bT,dc:Mn,dd:Ae,df:Lt,dg:Ft,dh:M,dj:q,dk:v,dl:iR,dm:ei,dr:void 0,ds:ln,dv:ct,e:iP,e1:T_,e2:Mf,eB:void 0,eC:void 0,eD:void 0,eE:void 0,eF:void 0,eG:void 0,eH:void 0,eI:void 0,ej:x,ek:P,el:D,em:L,en:void 0,ez:void 0,fA:TP,fB:OP,fF:MP,fG:DP,fJ:function(e,t){for(var n=e,i="";null!==n&&n!==t;)i=n.name+"/"+i,n=n.parent;return i.slice(0,-1)},fL:cD,fx:JM,fy:$M,fz:eD,i:YN,l:Z,o:void 0,q:void 0,r:R,t:Da,u:void 0,v:void 0,w:y,x:void 0,y:void 0,z:void 0});const n=e("af",!1),i=e("cW",!1),r=e("cL",!1),o=e("cJ",!1),a=e("cK",!1);var s="undefined"==typeof window?global:window,c=e("as",{_global:s});c.internal={},s.CC_BUILD=!0,s.CC_TEST=!1,s.CC_EDITOR=i,s.CC_PREVIEW=!1,s.CC_DEV=!1,s.CC_DEBUG=!1,s.CC_JSB=a,s.CC_BYTEDANCE=!1,s.CC_WECHAT=n,s.CC_ALIPAY=!1,s.CC_XIAOMI=!1,s.CC_BAIDU=!1,s.CC_COCOSPLAY=!1,s.CC_HUAWEI=!1,s.CC_OPPO=!1,s.CC_VIVO=!1,s.CC_MINIGAME=o,s.CC_RUNTIME_BASED=r,s.CC_SUPPORT_JIT=!0;var l=e("dq","3.0.0");s.CocosEngine=c.ENGINE_VERSION=l,s.cc=c;var u="https://github.com/cocos-creator/engine/blob/3d/EngineErrorMap.md",h=null,_=console.log.bind(console),f=_,m=_,d=function(e,t){if(!e){for(var n=arguments.length,i=new Array(n>2?n-2:0),r=2;r<n;r++)i[r-2]=arguments[r];console.log("ASSERT: "+p.apply(void 0,[t].concat(i)))}};function p(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];return c.js.formatStr.apply(null,[e].concat(n))}function v(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];return _.apply(void 0,[e].concat(n))}function g(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];return f.apply(void 0,[e].concat(n))}function y(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];return m.apply(void 0,[e].concat(n))}function x(e,t){for(var n=arguments.length,i=new Array(n>2?n-2:0),r=2;r<n;r++)i[r-2]=arguments[r];return d.apply(void 0,[e,t].concat(i))}function E(e){if(_=f=m=d=function(){},e!==O.NONE){if(e>O.ERROR){var t=function(e){if(c.game.canvas){if(!h){var t=document.createElement("Div");t.setAttribute("id","logInfoDiv"),t.setAttribute("width","200"),t.setAttribute("height",c.game.canvas.height);var n=t.style;n.zIndex="99999",n.position="absolute",n.top=n.left="0",(h=document.createElement("textarea")).setAttribute("rows","20"),h.setAttribute("cols","30"),h.setAttribute("disabled","true");var i=h.style;i.backgroundColor="transparent",i.borderBottom="1px solid #cccccc",i.borderTopWidth=i.borderLeftWidth=i.borderRightWidth="0px",i.borderTopStyle=i.borderLeftStyle=i.borderRightStyle="none",i.padding="0px",i.margin="0px",t.appendChild(h),c.game.canvas.parentNode.appendChild(t)}h.value=h.value+e+"\r\n",h.scrollTop=h.scrollHeight}};m=function(e){for(var n=arguments.length,i=new Array(n>1?n-1:0),r=1;r<n;r++)i[r-1]=arguments[r];t("ERROR :  "+p.apply(void 0,[e].concat(i)))},d=function(e,n){if(!e){for(var i=arguments.length,r=new Array(i>2?i-2:0),o=2;o<i;o++)r[o-2]=arguments[o];t("ASSERT: "+p.apply(void 0,[n].concat(r)))}},e!==O.ERROR_FOR_WEB_PAGE&&(f=function(e){for(var n=arguments.length,i=new Array(n>1?n-1:0),r=1;r<n;r++)i[r-1]=arguments[r];t("WARN :  "+p.apply(void 0,[e].concat(i)))}),e===O.INFO_FOR_WEB_PAGE&&(_=function(e){for(var n=arguments.length,i=new Array(n>1?n-1:0),r=1;r<n;r++)i[r-1]=arguments[r];t(p.apply(void 0,[e].concat(i)))})}else console&&console.log.apply&&(console.error||(console.error=console.log),console.warn||(console.warn=console.log),m=console.error.bind?console.error.bind(console):function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];return console.error.apply(console,[e].concat(n))},d=function(e,t){if(!e){for(var n=arguments.length,i=new Array(n>2?n-2:0),r=2;r<n;r++)i[r-2]=arguments[r];var o=p.apply(void 0,[t].concat(i));throw new Error(o)}});e!==O.ERROR&&(f=console.warn.bind?console.warn.bind(console):function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];return console.warn.apply(console,[e].concat(n))}),e===O.INFO&&(_=console.log.bind?console.log.bind(console):function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];return console.log.apply(console,[e].concat(n))})}}function S(e){y(e.stack||e)}function T(e){return function(t){for(var n=e+" "+t+", please go to "+u+"#"+t+" to see details.",i=arguments.length,r=new Array(i>1?i-1:0),o=1;o<i;o++)r[o-1]=arguments[o];return 0===r.length?n:n+" Arguments: "+r.join(", ")}}var A=T("Log");function C(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];v(A.apply(void 0,[e].concat(n)))}var w=T("Warning");function I(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];g(w.apply(void 0,[e].concat(n)))}var b=T("Error");function R(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];y(b.apply(void 0,[e].concat(n)))}var O,N=T("Assert");function P(e,t){if(!e){for(var n=arguments.length,i=new Array(n>2?n-2:0),r=2;r<n;r++)i[r-2]=arguments[r];x(!1,N.apply(void 0,[t].concat(i)))}}function M(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];return b.apply(void 0,[e].concat(n))}function D(){return!!c.profiler&&c.profiler.isShowingStats()}function L(e){c.profiler&&(e?c.profiler.showStats():c.profiler.hideStats(),c.game.config.showFPS=!!e)}!function(e){e[e.NONE=0]="NONE",e[e.INFO=1]="INFO",e[e.WARN=2]="WARN",e[e.ERROR=3]="ERROR",e[e.INFO_FOR_WEB_PAGE=4]="INFO_FOR_WEB_PAGE",e[e.WARN_FOR_WEB_PAGE=5]="WARN_FOR_WEB_PAGE",e[e.ERROR_FOR_WEB_PAGE=6]="ERROR_FOR_WEB_PAGE"}(O||(O=e("en",{})));var F=Object.freeze({__proto__:null,log:v,warn:g,error:y,assert:x,_resetDebugSetting:E,_throw:S,logID:C,warnID:I,errorID:R,assertID:P,get DebugMode(){return O},getError:M,isDisplayStats:D,setDisplayStats:L}),z=/(\.[^\.\/\?\\]*)(\?.*)?$/,B=/((.*)(\/|\\|\\\\))?(.*?\..*$)?/,U=/[^\.\/]+\/\.\.\//;function G(){for(var e="",t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];for(var r=0,o=n;r<o.length;r++){var a=o[r];e=(e+(""===e?"":"/")+a).replace(/(\/|\\\\)$/,"")}return e}function H(e){var t=z.exec(e);return t?t[1]:""}function k(e){if(e){var t=e.lastIndexOf(".");if(-1!==t)return e.substring(0,t)}return e}function V(e,t){var n=e.indexOf("?");n>0&&(e=e.substring(0,n));var i=/(\/|\\)([^\/\\]+)$/g.exec(e.replace(/(\/|\\)$/,""));if(!i)return e;var r=i[2];return t&&e.substring(e.length-t.length).toLowerCase()===t.toLowerCase()?r.substring(0,r.length-t.length):r}function j(e){var t=B.exec(e);return t?t[2]:""}function W(e,t){t=t||"";var n=e.indexOf("?"),i="";return n>0&&(i=e.substring(n),e=e.substring(0,n)),(n=e.lastIndexOf("."))<0?e+t+i:e.substring(0,n)+t+i}function q(e,t,n){if(0===t.indexOf("."))return W(e,t);var i=e.indexOf("?"),r="",o=n?H(e):"";return i>0&&(r=e.substring(i),e=e.substring(0,i)),i=(i=e.lastIndexOf("/"))<=0?0:i+1,e.substring(0,i)+t+o+r}function Y(e){var t=e=String(e);do{t=e,e=e.replace(U,"")}while(t.length!==e.length);return e}function X(e){return e.replace(/[\/\\]$/,"")}function K(){return c.sys.os===c.sys.OS_WINDOWS?"\\":"/"}function Q(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function Z(e,t,n){return t&&Q(e.prototype,t),n&&Q(e,n),e}function J(){return(J=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e}).apply(this,arguments)}function $(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,e.__proto__=t}function ee(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function te(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i}function ne(e,t){var n;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(n=function(e){if(e){if("string"==typeof e)return te(e,void 0);var t=Object.prototype.toString.call(e).slice(8,-1);return"Object"===t&&e.constructor&&(t=e.constructor.name),"Map"===t||"Set"===t?Array.from(e):"Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?te(e,void 0):void 0}}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var i=0;return function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}return(n=e[Symbol.iterator]()).next.bind(n)}function ie(e,t,n,i){n&&Object.defineProperty(e,t,{enumerable:n.enumerable,configurable:n.configurable,writable:n.writable,value:n.initializer?n.initializer.call(i):void 0})}function re(e,t,n,i,r){var o={};return Object.keys(i).forEach((function(e){o[e]=i[e]})),o.enumerable=!!o.enumerable,o.configurable=!!o.configurable,("value"in o||o.initializer)&&(o.writable=!0),o=n.slice().reverse().reduce((function(n,i){return i(e,t,n)||n}),o),r&&void 0!==o.initializer&&(o.value=o.initializer?o.initializer.call(r):void 0,o.initializer=void 0),void 0===o.initializer&&(Object.defineProperty(e,t,o),o=null),o}e("dV",Object.freeze({__proto__:null,join:G,extname:H,mainFileName:k,basename:V,dirname:j,changeExtname:W,changeBasename:q,_normalize:Y,stripSep:X,getSeperator:K})),c.log=v,c.warn=g,c.error=y,c.assert=x,c._throw=S,c.logID=C,c.warnID=I,c.errorID=R,c.assertID=P,c.debug=F,c.path={join:G,extname:H,mainFileName:k,basename:V,dirname:j,changeExtname:W,changeBasename:q,_normalize:Y,stripSep:X,get sep(){return K()}};var oe=0,ae={},se=e("d4",2147483647);function ce(e){return(e>0)-(e<0)}function le(e){var t,n;return t=(e>65535)<<4,t|=n=((e>>>=t)>255)<<3,t|=n=((e>>>=n)>15)<<2,(t|=n=((e>>>=n)>3)<<1)|(e>>>=n)>>1}function ue(e){var t=32;return(e&=-e)&&t--,65535&e&&(t-=16),16711935&e&&(t-=8),252645135&e&&(t-=4),858993459&e&&(t-=2),1431655765&e&&(t-=1),t}function he(e){return e+=0===e,--e,e|=e>>>1,e|=e>>>2,e|=e>>>4,e|=e>>>8,1+(e|=e>>>16)}var _e=new Array(256);!function(e){for(var t=0;t<256;++t){var n=t,i=t,r=7;for(n>>>=1;n;n>>>=1)i<<=1,i|=1&n,--r;e[t]=i<<r&255}}(_e);var fe=Object.freeze({__proto__:null,INT_BITS:32,INT_MAX:se,INT_MIN:-1<<31,sign:ce,abs:function(e){var t=e>>31;return(e^t)-t},min:function(e,t){return t^(e^t)&-(e<t)},max:function(e,t){return e^(e^t)&-(e<t)},isPow2:function(e){return!(e&e-1||!e)},log2:le,log10:function(e){return e>=1e9?9:e>=1e8?8:e>=1e7?7:e>=1e6?6:e>=1e5?5:e>=1e4?4:e>=1e3?3:e>=100?2:e>=10?1:0},popCount:function(e){return 16843009*((e=(858993459&(e-=e>>>1&1431655765))+(e>>>2&858993459))+(e>>>4)&252645135)>>>24},countTrailingZeros:ue,nextPow2:he,prevPow2:function(e){return e|=e>>>1,e|=e>>>2,e|=e>>>4,e|=e>>>8,(e|=e>>>16)-(e>>>1)},parity:function(e){return e^=e>>>16,e^=e>>>8,e^=e>>>4,27030>>>(e&=15)&1},reverse:function(e){return _e[255&e]<<24|_e[e>>>8&255]<<16|_e[e>>>16&255]<<8|_e[e>>>24&255]},interleave2:function(e,t){return(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e&=65535)|e<<8))|e<<4))|e<<2))|e<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t&=65535)|t<<8))|t<<4))|t<<2))|t<<1))<<1},deinterleave2:function(e,t){return(e=65535&((e=16711935&((e=252645135&((e=858993459&((e=e>>>t&1431655765)|e>>>1))|e>>>2))|e>>>4))|e>>>16))<<16>>16},interleave3:function(e,t,n){return e=1227133513&((e=3272356035&((e=251719695&((e=4278190335&((e&=1023)|e<<16))|e<<8))|e<<4))|e<<2),(e|=(t=1227133513&((t=3272356035&((t=251719695&((t=4278190335&((t&=1023)|t<<16))|t<<8))|t<<4))|t<<2))<<1)|(n=1227133513&((n=3272356035&((n=251719695&((n=4278190335&((n&=1023)|n<<16))|n<<8))|n<<4))|n<<2))<<2},deinterleave3:function(e,t){return(e=1023&((e=4278190335&((e=251719695&((e=3272356035&((e=e>>>t&1227133513)|e>>>2))|e>>>4))|e>>>8))|e>>>16))<<22>>22},nextCombination:function(e){var t=e|e-1;return t+1|(~t&-~t)-1>>>ue(e)+1}});e("dA",fe);var me,de,pe,ve,ge,ye=10,xe=0,Ee=new Map;pe=function(e,t,n,i,r,o){var a=Ee.get(o);a&&a.logTimes>a.count&&(r("'%s' is deprecated, please use '%s' instead.",e+"."+t,n+"."+i),a.count++)},me=e("bd",(function(e,t,n){null!=e&&n.forEach((function(n){var i=xe++;Ee.set(i,{id:i,count:0,logTimes:void 0!==n.logTimes?n.logTimes:ye});var r=null!=n.target?n.target:e,o=null!=n.newName?n.newName:n.name,a=null!=n.targetName?n.targetName:t,s=r==e;if(null!=n.customFunction)e[n.name]=function(){var e;return pe(t,n.name,a,o,g,i),(e=n.customFunction).call.apply(e,[this].concat(Array.prototype.slice.call(arguments)))};else if(null!=n.customSetter||null!=n.customGetter){var c=null!=n.customSetter,l=null!=n.customGetter;c&&l?Object.defineProperty(e,n.name,{get:function(){return pe(t,n.name,a,o,g,i),n.customGetter.call(this)},set:function(e){pe(t,n.name,a,o,g,i),n.customSetter.call(this,e)},enumerable:!1}):c?Object.defineProperty(e,n.name,{set:function(e){pe(t,n.name,a,o,g,i),n.customSetter.call(this,e)},enumerable:!1}):l&&Object.defineProperty(e,n.name,{get:function(){return pe(t,n.name,a,o,g,i),n.customGetter.call(this)},enumerable:!1})}else Object.defineProperty(e,n.name,{get:function(){return pe(t,n.name,a,o,g,i),s?this[o]:r[o]},set:function(e){pe(t,n.name,a,o,g,i),s?this[o]=e:r[o]=e},enumerable:!1})}))})),ge=function(e,t,n,i,r){var o=Ee.get(i),a=void 0===r?"":"("+r+")";o&&o.logTimes>o.count&&(n("'%s' has been removed. "+a,e+"."+t),o.count++)},de=e("be",(function(e,t,n){null!=e&&n.forEach((function(n){var i=xe++;Ee.set(i,{id:i,count:0,logTimes:void 0!==n.logTimes?n.logTimes:ye}),Object.defineProperty(e,n.name,{get:function(){return ge(t,n.name,y,i,n.suggest)},set:function(){ge(t,n.name,y,i,n.suggest)},enumerable:!1})}))})),ve=function(e,t,n,i,r){var o=Ee.get(i),a=void 0===r?"":"("+r+")";o&&o.logTimes>o.count&&(n("'%s' is deprecated. "+a,e+"."+t),o.count++)},e("dY",(function(e,t,n){if(null!=e){var i=function(e,t,n,i,r,o){if(e.get){var a=e.get();e.get=function(){return ve(t,n,i,r,o),a.call(this)}}if(e.set){var s=Object.create(e.set);e.set=function(e){ve(t,n,i,r,o),s.call(this,e)}}};n.forEach((function(n){var r=n.name,o=Object.getOwnPropertyDescriptor(e,r);if(o){var a=xe++;if(Ee.set(a,{id:a,count:0,logTimes:void 0!==n.logTimes?n.logTimes:ye}),null!=o.value)if("function"==typeof o.value){var s=o.value;e[r]=function(){return ve(t,r,g,a,n.suggest),s.call.apply(s,[this].concat(Array.prototype.slice.call(arguments)))}}else i(o,t,r,g,a,n.suggest);else i(o,t,r,g,a,n.suggest);Object.defineProperty(e,r,{enumerable:!1})}}))}}));var Se=function(){function e(e){this.i=0,this.array=e}var t=e.prototype;return t.remove=function(e){var t=this.array.indexOf(e);t>=0&&this.removeAt(t)},t.removeAt=function(e){this.array.splice(e,1),e<=this.i&&--this.i},t.fastRemove=function(e){var t=this.array.indexOf(e);t>=0&&this.fastRemoveAt(t)},t.fastRemoveAt=function(e){var t=this.array;t[e]=t[t.length-1],--t.length,e<=this.i&&--this.i},t.push=function(e){this.array.push(e)},Z(e,[{key:"length",get:function(){return this.array.length},set:function(e){this.array.length=e,this.i>=e&&(this.i=e-1)}}]),e}();function Te(e,t){e.splice(t,1)}function Ae(e,t){var n=e.length;t<0||t>=n||(e[t]=e[n-1],e.length=n-1)}function Ce(e,t){var n=e.indexOf(t);return n>=0&&(Te(e,n),!0)}function we(e,t){return e.indexOf(t)>=0}var Ie=Object.freeze({__proto__:null,removeAt:Te,fastRemoveAt:Ae,remove:Ce,fastRemove:function(e,t){var n=e.indexOf(t);n>=0&&(e[n]=e[e.length-1],--e.length)},removeIf:function(e,t){var n=e.findIndex(t);if(n>=0){var i=e[n];return Te(e,n),i}},verifyType:function(e,t){if(e&&e.length>0)for(var n,i=ne(e);!(n=i()).done;)if(!(n.value instanceof t))return C(1300),!1;return!0},removeArray:function(e,t){for(var n=0,i=t.length;n<i;n++)Ce(e,t[n])},appendObjectsAt:function(e,t,n){return e.splice.apply(e,[n,0].concat(t)),e},contains:we,copy:function(e){for(var t=e.length,n=new Array(t),i=0;i<t;i+=1)n[i]=e[i];return n},MutableForwardIterator:Se}),be=function(){function e(e){this.id=void 0,this.prefix=void 0,this.id=0|998*Math.random(),this.prefix=e?e+".":""}return e.prototype.getNewId=function(){return this.prefix+ ++this.id},e}();be.global=new be("global");var Re=new be("TmpCId."),Oe="undefined"==typeof Symbol?"__aliases__":Symbol("[[Aliases]]");function Ne(e){return"number"==typeof e||e instanceof Number}function Pe(e){return"string"==typeof e||e instanceof String}function Me(e){for(var t in e)return!1;return!0}var De,Le=(De={value:void 0,enumerable:!1,writable:!1,configurable:!0},function(e,t,n,i,r){De.value=n,De.writable=i,De.enumerable=r,Object.defineProperty(e,t,De),De.value=void 0}),Fe=function(){var e={get:void 0,set:void 0,enumerable:!1};return function(t,n,i,r,o,a){void 0===o&&(o=!1),void 0===a&&(a=!1),"boolean"==typeof r&&(o=r,r=void 0),e.get=i,e.set=r,e.enumerable=o,e.configurable=a,Object.defineProperty(t,n,e),e.get=void 0,e.set=void 0}}(),ze=function(){var e={get:void 0,enumerable:!1,configurable:!1};return function(t,n,i,r,o){e.get=i,e.enumerable=r,e.configurable=o,Object.defineProperty(t,n,e),e.get=void 0}}(),Be=function(){var e={set:void 0,enumerable:!1,configurable:!1};return function(t,n,i,r,o){e.set=i,e.enumerable=r,e.configurable=o,Object.defineProperty(t,n,e),e.set=void 0}}();function Ue(e){var t=Object.create(null);return e&&(t["."]=1,t["/"]=1,delete t["."],delete t["/"]),t}function Ge(e){if("function"==typeof e){var t=e.prototype;if(t&&t.hasOwnProperty("__classname__")&&t.__classname__)return t.__classname__;var n="";if(e.name&&(n=e.name),e.toString){var i,r=e.toString();(i="["===r.charAt(0)?r.match(/\[\w+\s*(\w+)\]/):r.match(/function\s*(\w+)/))&&2===i.length&&(n=i[1])}return"Object"!==n?n:""}return e&&e.constructor?Ge(e.constructor):""}function He(e,t,n,i){var r=/([^.]+)$/,o=r.exec(t)[0],a=r.exec(n)[0];function s(){return this[a]}i?Fe(e,o,s,(function(e){this[a]=e})):ze(e,o,s)}function ke(e,t,n,i){for(var r in n)He(e,t+"."+r,n[r],i)}var Ve=/(%d)|(%s)/,je=/%s/;function We(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];if(0===arguments.length)return"";if(0===n.length)return""+e;var r="string"==typeof e&&Ve.test(e);if(r)for(var o,a=ne(n);!(o=a()).done;){var s=o.value,c="number"==typeof s?Ve:je;if(c.test(e)){var l=""+s;e=e.replace(c,l)}else e+=" "+s}else for(var u,h=ne(n);!(u=h()).done;){var _=u.value;e+=" "+_}return e}function qe(){for(var e=arguments.length-1,t=new Array(e),n=0;n<e;++n)t[n]=arguments[n+1];return t}function Ye(e,t){for(;e;){var n=Object.getOwnPropertyDescriptor(e,t);if(n)return n;e=Object.getPrototypeOf(e)}return null}function Xe(e,t,n){var i=Ye(t,e);i&&Object.defineProperty(n,e,i)}function Ke(e){e=e||{};for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];for(var r=0,o=n;r<o.length;r++){var a=o[r];if(a){if("object"!=typeof a){R(5402,a);continue}for(var s in a)s in e||Xe(s,a,e)}}return e}function Qe(e){e=e||{};for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];for(var r=0,o=n;r<o.length;r++){var a=o[r];if(a){if("object"!=typeof a){R(5403,a);continue}for(var s in a)Xe(s,a,e)}}return e}function Ze(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);return e.prototype=Object.create(t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),e}function Je(e){var t=e.prototype,n=t&&Object.getPrototypeOf(t);return n&&n.constructor}function $e(e,t){if(e&&t){if("function"!=typeof e)return!1;if("function"!=typeof t)return!1;if(e===t)return!0;for(;;){if(!(e=Je(e)))return!1;if(e===t)return!0}}return!1}function et(e){for(var t=0,n=Object.keys(e);t<n.length;t++)delete e[n[t]]}function tt(e){return"string"!=typeof e||e.startsWith(Re.prefix)}var nt=Ue(!0),it=Ue(!0);function rt(e,t){return function(n,i){if(i.prototype.hasOwnProperty(e)&&delete t[i.prototype[e]],Le(i.prototype,e,n),n){var r=t[n];r&&r!==i?y("A Class already exists with the same "+e+' : "'+n+'".'):t[n]=i}}}var ot=rt("__cid__",nt),at=rt("__classname__",it);function st(e,t){if(at(e,t),!t.prototype.hasOwnProperty("__cid__")){var n=e||Re.getNewId();n&&ot(n,t)}}function ct(e,t){var n=it[t],i=nt[t],r=!0;if(n&&n!==e&&(y('"'+t+'" has already been set as name or alias of another class.'),r=!1),i&&i!==e&&(y('"'+t+'" has already been set as id or alias of another class.'),r=!1),r){var o=e[Oe];o||(o=[],e[Oe]=o),o.push(t),it[t]=e,nt[t]=e}}function lt(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];for(var i=0,r=t;i<r.length;i++){var o=r[i],a=o.prototype,s=a.__cid__;s&&delete nt[s];var c=a.__classname__;c&&delete it[c];var l=a[Oe];if(l)for(var u=0;u<l.length;++u){var h=l[u];delete it[h],delete nt[h]}}}function ut(e){return nt[e]}function ht(e){return it[e]}function _t(e,t){var n;if(t=void 0===t||t,"function"==typeof e&&e.prototype.hasOwnProperty("__cid__"))return n=e.prototype.__cid__,!t&&i&&tt(n)?"":n;if(e&&e.constructor){var r=e.constructor.prototype;if(r&&r.hasOwnProperty("__cid__"))return n=e.__cid__,!t&&i&&tt(n)?"":n}return""}var ft=e("bX",function(){var e=t.prototype;function t(e,t){this.count=void 0,this._pool=void 0,this._cleanup=void 0;var n=void 0===t?e:t,i=void 0===t?null:e;this.count=0,this._pool=new Array(n),this._cleanup=i}return e.get=function(){return this._get()},e._get=function(){if(this.count>0){--this.count;var e=this._pool[this.count];return this._pool[this.count]=null,e}return null},e.put=function(e){var t=this._pool;if(this.count<t.length){if(this._cleanup&&!1===this._cleanup(e))return;t[this.count]=e,++this.count}},e.resize=function(e){e>=0&&(this._pool.length=e,this.count>e&&(this.count=e))},t}()),mt=e("cR",Ie),dt=e("bg",{IDGenerator:be,Pool:ft,array:Ie,isNumber:Ne,isString:Pe,isEmptyObject:Me,getPropertyDescriptor:Ye,addon:Ke,mixin:Qe,extend:Ze,getSuper:Je,isChildClassOf:$e,clear:et,value:Le,getset:Fe,get:ze,set:Be,unregisterClass:lt,getClassName:Ge,setClassName:st,setClassAlias:ct,getClassByName:ht,get _registeredClassNames(){return J({},it)},set _registeredClassNames(e){et(it),Object.assign(it,e)},get _registeredClassIds(){return J({},nt)},set _registeredClassIds(e){et(nt),Object.assign(nt,e)},_getClassId:_t,_setClassId:ot,_getClassById:ut,obsolete:He,obsoletes:ke,formatStr:We,shiftArguments:qe,createMap:Ue});function pt(e){if("__bitmask__"in e)return e;Le(e,"__bitmask__",null,!0);for(var t=-1,n=Object.keys(e),i=0;i<n.length;i++){var r=n[i],o=e[r];if(-1===o)o=++t,e[r]=o;else if("number"==typeof o)t=o;else if("string"==typeof o&&Number.isInteger(parseFloat(r)))continue;var a=""+o;r!==a&&Le(e,a,r)}return e}function vt(e){return"__enums__"in e?e:(Le(e,"__enums__",null,!0),vt.update(e))}function gt(e){e.hasOwnProperty("__enums__")}function yt(e){gt(e);var t=e.__enums__||[];for(var n in t.length=0,e){var i=e[n];Number.isInteger(i)&&t.push({name:n,value:i})}return t.sort((function(e,t){return e.value-t.value})),e.__enums__=t,t}function xt(e){"__enums__"in e||Le(e,"__enums__",null,!0)}c.js=dt,e("dT",Object.freeze({__proto__:null,array:mt,js:dt,IDGenerator:be,Pool:ft,isNumber:Ne,isString:Pe,isEmptyObject:Me,value:Le,getset:Fe,get:ze,set:Be,createMap:Ue,getClassName:Ge,obsolete:He,obsoletes:ke,formatStr:We,shiftArguments:qe,getPropertyDescriptor:Ye,addon:Ke,mixin:Qe,extend:Ze,getSuper:Je,isChildClassOf:$e,clear:et,_idToClass:nt,_nameToClass:it,_setClassId:ot,setClassName:st,setClassAlias:ct,unregisterClass:lt,_getClassById:ut,getClassByName:ht,_getClassId:_t})),pt.isBitMask=function(e){return e&&e.hasOwnProperty("__bitmask__")},pt.getList=function(e){if(e.__bitmask__)return e.__bitmask__;var t=e.__bitmask__=[];for(var n in e){var i=e[n];Number.isInteger(i)&&t.push({name:n,value:i})}return t.sort((function(e,t){return e.value-t.value})),t},c.BitMask=pt,vt.update=function(e){for(var t=-1,n=Object.keys(e),i=0;i<n.length;i++){var r=n[i],o=e[r];if(-1===o)o=++t,e[r]=o;else if("number"==typeof o)t=o;else if("string"==typeof o&&Number.isInteger(parseFloat(r)))continue;var a=""+o;r!==a&&Le(e,a,r)}return Array.isArray(e.__enums__)&&yt(e),e},vt||(vt=e("aZ",{})),vt.isEnum=function(e){return e&&e.hasOwnProperty("__enums__")},vt.getList=function(e){return gt(e),e.__enums__?e.__enums__:yt(e)},c.Enum=vt;var Et=e("dS",function(){function e(){}var t=e.prototype;return t.clone=function(){return R(100,Ge(this)+".clone"),this},t.equals=function(){return!1},t.set=function(){R(100,Ge(this)+".set")},t.toString=function(){return""+{}},e}());st("cc.ValueType",Et),c.ValueType=Et;var St=e("ab",{SUPPORT_TEXTURE_FORMATS:[".astc",".pkm",".pvr",".webp",".jpg",".jpeg",".bmp",".png"],KEY:{none:0,back:6,menu:18,backspace:8,tab:9,enter:13,shift:16,ctrl:17,alt:18,pause:19,capslock:20,escape:27,space:32,pageup:33,pagedown:34,end:35,home:36,left:37,up:38,right:39,down:40,select:41,insert:45,Delete:46,0:48,1:49,2:50,3:51,4:52,5:53,6:54,7:55,8:56,9:57,a:65,b:66,c:67,d:68,e:69,f:70,g:71,h:72,i:73,j:74,k:75,l:76,m:77,n:78,o:79,p:80,q:81,r:82,s:83,t:84,u:85,v:86,w:87,x:88,y:89,z:90,num0:96,num1:97,num2:98,num3:99,num4:100,num5:101,num6:102,num7:103,num8:104,num9:105,"*":106,"+":107,"-":109,numdel:110,"/":111,f1:112,f2:113,f3:114,f4:115,f5:116,f6:117,f7:118,f8:119,f9:120,f10:121,f11:122,f12:123,numlock:144,scrolllock:145,";":186,semicolon:186,equal:187,"=":187,",":188,comma:188,dash:189,".":190,period:190,forwardslash:191,grave:192,"[":219,openbracket:219,backslash:220,"]":221,closebracket:221,quote:222,dpadLeft:1e3,dpadRight:1001,dpadUp:1003,dpadDown:1004,dpadCenter:1005},RAD:Math.PI/180,DEG:180/Math.PI,REPEAT_FOREVER:Number.MAX_VALUE-1,FLT_EPSILON:1.192092896e-7,ORIENTATION_PORTRAIT:1,ORIENTATION_LANDSCAPE:2,ORIENTATION_AUTO:3,ENABLE_TILEDMAP_CULLING:!0,TOUCH_TIMEOUT:5e3,ENABLE_TRANSPARENT_CANVAS:!1,ENABLE_WEBGL_ANTIALIAS:!0,CLEANUP_IMAGE_CACHE:!1,ENABLE_MULTI_TOUCH:!0,MAX_LABEL_CANVAS_POOL_SIZE:20});c.macro=St;for(var Tt=/^(?:cc|dragonBones|sp|ccsg)\..+/,At=new Array(123),Ct=0;Ct<123;++Ct)At[Ct]=64;for(var wt=0;wt<64;++wt)At["ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charCodeAt(wt)]=wt;var It=At;function bt(e,t,n){function i(e,t,n,i){var r=Object.getOwnPropertyDescriptor(e,t);if(r)r.get&&(e[n]=r.get),r.set&&i&&(e[i]=r.set);else{var o=e[n];Fe(e,t,o,e[i])}}for(var r,o=e.prototype,a=0;a<t.length;a++){var s=(r=t[a])[0].toUpperCase()+r.slice(1);i(o,r,"get"+s,"set"+s)}for(r in n){var c=n[r];i(o,r,c[0],c[1])}}function Rt(e,t,n,i){var r=e[t];r?Array.isArray(r)?i?(r.push(r[0]),r[0]=n):r.push(n):e[t]=i?[n,r]:[r,n]:e[t]=n}function Ot(e,t){if("function"==typeof e.contains)return e.contains(t);if("function"==typeof e.compareDocumentPosition)return!!(16&e.compareDocumentPosition(t));var n=t.parentNode;if(n)do{if(n===e)return!0;n=n.parentNode}while(null!==n);return!1}function Nt(e){return"object"==typeof window&&"function"==typeof Node?e instanceof Node:e&&"object"==typeof e&&"number"==typeof e.nodeType&&"string"==typeof e.nodeName}function Pt(e,t,n){e&&setTimeout((function(){e(t,n)}),0)}function Mt(e){return!(!e||e.constructor!==Object)&&Me(e)}function Dt(e,t,n){if(t>n){var i=t;t=n,n=i}return e<t?t:e<n?e:n}function Lt(e){return e*St.RAD}function Ft(e){return e*St.DEG}function zt(e,t){var n=t?Object.create(t):{};return Le(e,"__attrs__",n),n}function Bt(e){if("function"!=typeof e)return zt(e,Gt(e.constructor));for(var t,n=c.Class.getInheritanceChain(e),i=n.length-1;i>=0;i--){var r=n[i];r.hasOwnProperty("__attrs__")&&r.__attrs__||zt(r,(t=n[i+1])&&t.__attrs__)}return zt(e,(t=n[0])&&t.__attrs__),e.__attrs__}function Ut(e,t){var n=Gt(e),i=t+"$_$",r={};for(var o in n)o.startsWith(i)&&(r[o.slice(i.length)]=n[o]);return r}function Gt(e){return e.hasOwnProperty("__attrs__")&&e.__attrs__||Bt(e)}function Ht(e,t,n,i){Gt(e)[t+"$_$"+n]=i}c.misc={BUILTIN_CLASSID_RE:Tt,BASE64_VALUES:It,propertyDefine:bt,pushToMap:Rt,contains:Ot,isDomNode:Nt,callInNextTick:Pt,isPlainEmptyObj_DEV:Mt,clampf:Dt,degreesToRadians:Lt,radiansToDegrees:Ft},e("dU",Object.freeze({__proto__:null,BUILTIN_CLASSID_RE:Tt,BASE64_VALUES:It,propertyDefine:bt,pushToMap:Rt,contains:Ot,isDomNode:Nt,callInNextTick:Pt,tryCatchFunctor_EDITOR:function(e){return Function("target","try {\n  target."+e+"();\n}\ncatch (e) {\n  cc._throw(e);\n}")},isPlainEmptyObj_DEV:Mt,clampf:Dt,degreesToRadians:Lt,radiansToDegrees:Ft}));var kt=function(){function e(e,t){this.name=void 0,this.default=void 0,this.name=e,this.default=t}return e.prototype.toString=function(){return this.name},e}(),Vt=e("e4",new kt("Integer",0));c.Integer=Vt,c.CCInteger=Vt;var jt=e("e5",new kt("Float",0));c.Float=jt,c.CCFloat=jt;var Wt=e("e6",new kt("Boolean",!1));c.Boolean=Wt,c.CCBoolean=Wt;var qt=e("bf",new kt("String",""));function Yt(e,t){return function(n,i){var r='"'+Ge(n)+"."+i+'"',o=Ut(n,i),a=o.type;if(a===Vt||a===jt?a="Number":a!==qt&&a!==Wt||(a=""+a),a===e){if(o.hasOwnProperty("default")){var s=o.default;if(void 0!==s&&!Array.isArray(s)&&!Mt(s)){var c=typeof s,l=e.toLowerCase();if(c===l)if("object"===l){if(!s||s instanceof o.ctor)return;I(3605,r,Ge(o.ctor))}else"Number"!==e&&I(3606,t,r,e);else{if("function"===c)return;e===qt.default&&null==s?I(3607,r):I(3611,t,r,c)}delete o.type}}}else I(3604,r)}}c.String=qt,c.CCString=qt;var Xt=Object.freeze({__proto__:null,DELIMETER:"$_$",createAttrsSingle:zt,createAttrs:Bt,attr:Ut,getClassAttrs:Gt,setClassAttr:Ht,PrimitiveType:kt,CCInteger:Vt,CCFloat:jt,CCBoolean:Wt,CCString:qt,getTypeChecker_ET:Yt,getObjTypeChecker_ET:function(e){return function(t,n){Yt("Object","type")(t,n);var i=Gt(t)[n+"$_$default"],r=c.Class.getDefault(i);if(!Array.isArray(r)&&$e(e,c.ValueType)){var o=Ge(e),a=We('No need to specify the "type" of "%s.%s" because %s is a child class of ValueType.',Ge(t),n,o);i?v(a):I(3612,a,o,Ge(t),n,o)}}}}),Kt={default:{},serializable:{},editorOnly:{},formerlySerializedAs:{}};function Qt(e,t,n,i){if(!e.get&&!e.set&&e.hasOwnProperty("default")){var r="_N$"+t;e.get=function(){return this[r]},e.set=function(e){var t=this[r];this[r]=e,n.call(this,t)};var o={};for(var a in i[r]=o,Kt){var s=Kt[a];e.hasOwnProperty(a)&&(o[a]=e[a],s.canUsedInGet||delete e[a])}}}function Zt(e,t,n,i){if(Array.isArray(t)){if(!(t.length>0))return R(5508,n,i);e.type=t=t[0]}"function"==typeof t&&(t===String?e.type=c.String:t===Boolean?e.type=c.Boolean:t===Number&&(e.type=c.Float))}function Jt(e,t,n){var i=e?{_short:!0}:{_short:!0,default:t};return n&&(i.type=n),i}function $t(e,t){if(!e||e.constructor!==Object){if(Array.isArray(e)&&e.length>0)return Jt(t,[],e);if("function"==typeof e){var n=e;return Jt(t,$e(n,c.ValueType)?new n:null,n)}return Jt(t,e instanceof kt?e.default:e)}return null}var en=[];function tn(){return en[en.length-1]}c._RF={push:function(e,t,n,i){void 0===n&&(n=t,t=""),en.push({uuid:t,script:n,module:e,exports:e.exports,beh:null,importMeta:i})},pop:function(){var e=en.pop(),t=e.module,n=t.exports;if(n===e.exports){for(var i in n)return;t.exports=n=e.cls}},peek:tn};var nn={datas:null,push:function(e){if(this.datas)this.datas.push(e);else{this.datas=[e];var t=this;setTimeout((function(){t.init()}),0)}},init:function(){var e=this.datas;if(e){for(var t=0;t<e.length;++t){var n=e[t],i=n.cls,r=n.props;"function"==typeof r&&(r=r());var o=Ge(i);r?cn(i,o,r,i.$super,n.mixins):R(3633,o)}this.datas=null}}};function rn(e,t,n,i){!function(e,t){!function(e,t){e.indexOf(t)<0&&e.push(t)}(e.__props__,t)}(e,n),hn(e,i,t,n)}function on(e,t,n,i){var r=i.get;i.set,r&&(hn(e,i,t,n),Ht(e,n,"serializable",!1))}function an(e){return"function"==typeof e?e():e}function sn(e,t,n){for(var i in t)e.hasOwnProperty(i)||n&&!n(i)||Object.defineProperty(e,i,Ye(t,i))}function cn(e,t,n,i,r){if(e.__props__=[],i&&i.__props__&&(e.__props__=i.__props__.slice()),r)for(var o=0;o<r.length;++o){var a=r[o];a.__props__&&(e.__props__=e.__props__.concat(a.__props__.filter((function(t){return e.__props__.indexOf(t)<0}))))}if(n)for(var s in function(e,t){for(var n in e){var i=e[n],r=$t(i,!1);if(r&&(i=e[n]=r),i){var o=i.notify;o&&Qt(i,n,o,e),"type"in i&&Zt(i,i.type,t,n)}}}(n,t),n){var c=n[s];c.get||c.set?on(e,t,s,c):rn(e,t,s,c)}var l=Gt(e);e.__values__=e.__props__.filter((function(e){return!1!==l[e+"$_$serializable"]}))}function ln(e){var t=e.name,n=e.extends,i=e.mixins,r=function(e,t,n,i){var r=c.Component,o=tn();if(o&&$e(t,r)){if($e(o.cls,r))return R(3615),null;e=e||o.script}var a=function(e,t,n,i){var r=i.ctor,o=[r],a=r;Le(a,"__ctors__",o.length>0?o:null,!0);var s=a.prototype;if(t&&(a.$super=t),n){for(var c=n.length-1;c>=0;c--){var l=n[c];sn(s,l.prototype),ln._isCCClass(l)&&sn(Gt(a),Gt(l))}s.constructor=a}return st(e,a),a}(e,t,n,i);if(o)if($e(t,r)){var s=o.uuid;s&&ot(s,a),o.cls=a}else $e(o.cls,r)||(o.cls=a);return a}(t,n,i,e);t||(t=c.js.getClassName(r)),r._sealed=!0,n&&(n._sealed=!1);var o=e.properties;"function"==typeof o||n&&null===n.__props__||i&&i.some((function(e){return null===e.__props__}))?(nn.push({cls:r,props:o,mixins:i}),r.__props__=r.__values__=null):cn(r,t,o,n,e.mixins);var a=e.editor;return a&&$e(n,c.Component)&&c.Component._registerEditorProps(r,a),r}ln._isCCClass=function(e){var t;return null==e||null===(t=e.hasOwnProperty)||void 0===t?void 0:t.call(e,"__ctors__")},ln.fastDefine=function(e,t,n){st(e,t);for(var i=t.__props__=t.__values__=Object.keys(n),r=Gt(t),o=0;o<i.length;o++){var a=i[o];r[a+"$_$visible"]=!1,r[a+"$_$default"]=n[a]}},ln.Attr=Xt,ln.attr=Ut,ln.getInheritanceChain=function(e){for(var t=[];e=Je(e);)e!==Object&&t.push(e);return t};var un={Integer:"Number",Float:"Number",Boolean:"Boolean",String:"String"};function hn(e,t,n,i){var r=null,o="";function a(){return o=i+"$_$",r=Gt(e)}"type"in t&&void 0===t.type&&I(3660,i,n);var s=t.type;s&&(un[s]?(r||a())[o+"type"]=s:"Object"===s||("object"==typeof s?vt.isEnum(s)?((r||a())[o+"type"]="Enum",r[o+"enumList"]=vt.getList(s)):pt.isBitMask(s)&&((r||a())[o+"type"]="BitMask",r[o+"bitmaskList"]=pt.getList(s)):"function"==typeof s&&((r||a())[o+"type"]="Object",r[o+"ctor"]=s))),"default"in t&&((r||a())[o+"default"]=t.default);var c,l=function(e,n){if(e in t){var i=t[e];typeof i===n&&((r||a())[o+e]=i)}};t.editorOnly&&((r||a())[o+"editorOnly"]=!0),t.__noImplicit?(r||a())[o+"serializable"]=null!==(c=t.serializable)&&void 0!==c&&c:!1===t.serializable&&((r||a())[o+"serializable"]=!1),l("formerlySerializedAs","string");var u=t.range;u&&Array.isArray(u)&&u.length>=2&&((r||a())[o+"min"]=u[0],r[o+"max"]=u[1],u.length>2&&(r[o+"step"]=u[2])),l("min","number"),l("max","number"),l("step","number")}ln.isArray=function(e){return e=an(e),Array.isArray(e)},ln.getDefault=an,ln.escapeForJS=function(e){return JSON.stringify(e).replace(/\u2028/g,"\\u2028").replace(/\u2029/g,"\\u2029")},ln.IDENTIFIER_RE=/^[A-Za-z_$][0-9A-Za-z_$]*$/,ln.getNewValueTypeCode=function(e){for(var t=Ge(e),n=e.constructor,i="new "+t+"(",r=0;r<n.__props__.length;r++)i+=e[n.__props__[r]],r<n.__props__.length-1&&(i+=",");return i+")"},c.Class=ln;var _n=Math.PI/180,fn=180/Math.PI,mn=e("dK",1e-6);function dn(e,t){return Math.abs(e-t)<=mn*Math.max(1,Math.abs(e),Math.abs(t))}function pn(e,t,n){return n=n||mn,Math.abs(e-t)<=n}function vn(e,t,n){if(t>n){var i=t;t=n,n=i}return e<t?t:e>n?n:e}function gn(e){return e<0?0:e>1?1:e}function yn(e,t,n){return e+(t-e)*n}function xn(e){return e*_n}function En(e){return e*fn}var Sn=e("c_",Math.random);function Tn(e,t){return Math.random()*(t-e)+e}function An(e,t){return Math.floor(Tn(e,t))}function Cn(e){return(e=(9301*e+49297)%233280)/233280}function wn(e,t,n){return Cn(e)*(n-t)+t}function In(e,t,n){return Math.floor(wn(e,t,n))}function bn(e){return--e,e|=e>>1,e|=e>>2,e|=e>>4,e|=e>>8,e|=e>>16,++e}function Rn(e,t){return e-Math.floor(e/t)*t}function On(e,t){return e=Rn(e,2*t),t-Math.abs(e-t)}function Nn(e,t,n){return(n-e)/(t-e)}function Pn(e){return Math.abs(e.x)>Math.abs(e.y)?Math.abs(e.x)>Math.abs(e.z)?e.x:e.z:Math.abs(e.y)>Math.abs(e.z)?e.y:e.z}function Mn(e,t){return Math.abs(e)>Math.abs(t)?e:t}var Dn=e("bm",function(e){function t(t,n,i,r){var o;return(o=e.call(this)||this)._val=0,"string"==typeof t?o.fromHEX(t):void 0!==n?o.set(t,n,i,r):o.set(t),o}$(t,e),t.clone=function(e){var n=new t;return e._val?n._val=e._val:n._val=(e.a<<24>>>0)+(e.b<<16)+(e.g<<8)+e.r,n},t.copy=function(e,t){return e.r=t.r,e.g=t.g,e.b=t.b,e.a=t.a,e},t.set=function(e,t,n,i,r){return e.r=t,e.g=n,e.b=i,e.a=r,e},t.fromHEX=function(e,t){return t=0===t.indexOf("#")?t.substring(1):t,e.r=parseInt(t.substr(0,2),16)||0,e.g=parseInt(t.substr(2,2),16)||0,e.b=parseInt(t.substr(4,2),16)||0,e.a=parseInt(t.substr(6,2),16)||255,e._val=(e.a<<24>>>0)+(e.b<<16)+(e.g<<8)+e.r,e},t.add=function(e,t,n){return e.r=t.r+n.r,e.g=t.g+n.g,e.b=t.b+n.b,e.a=t.a+n.a,e},t.subtract=function(e,t,n){return e.r=t.r-n.r,e.g=t.g-n.g,e.b=t.b-n.b,e.a=t.a-n.a,e},t.multiply=function(e,t,n){return e.r=t.r*n.r,e.g=t.g*n.g,e.b=t.b*n.b,e.a=t.a*n.a,e},t.divide=function(e,t,n){return e.r=t.r/n.r,e.g=t.g/n.g,e.b=t.b/n.b,e.a=t.a/n.a,e},t.scale=function(e,t,n){return e.r=t.r*n,e.g=t.g*n,e.b=t.b*n,e.a=t.a*n,e},t.lerp=function(e,t,n,i){var r=t.r,o=t.g,a=t.b,s=t.a;return r+=(n.r-r)*i,o+=(n.g-o)*i,a+=(n.b-a)*i,s+=(n.a-s)*i,e._val=Math.floor((s<<24>>>0)+(a<<16)+(o<<8)+r),e},t.toArray=function(e,n,i){void 0===i&&(i=0);var r=n instanceof t||n.a>1?1/255:1;return e[i+0]=n.r*r,e[i+1]=n.g*r,e[i+2]=n.b*r,e[i+3]=n.a*r,e},t.fromArray=function(e,t,n){return void 0===n&&(n=0),t.r=255*e[n+0],t.g=255*e[n+1],t.b=255*e[n+2],t.a=255*e[n+3],t},t.strictEquals=function(e,t){return e.r===t.r&&e.g===t.g&&e.b===t.b&&e.a===t.a},t.equals=function(e,t,n){return void 0===n&&(n=mn),Math.abs(e.r-t.r)<=n*Math.max(1,Math.abs(e.r),Math.abs(t.r))&&Math.abs(e.g-t.g)<=n*Math.max(1,Math.abs(e.g),Math.abs(t.g))&&Math.abs(e.b-t.b)<=n*Math.max(1,Math.abs(e.b),Math.abs(t.b))&&Math.abs(e.a-t.a)<=n*Math.max(1,Math.abs(e.a),Math.abs(t.a))},t.hex=function(e){return(255*e.r<<24|255*e.g<<16|255*e.b<<8|255*e.a)>>>0},Z(t,[{key:"r",get:function(){return 255&this._val},set:function(e){e=~~vn(e,0,255),this._val=(4294967040&this._val|e)>>>0}},{key:"g",get:function(){return(65280&this._val)>>8},set:function(e){e=~~vn(e,0,255),this._val=(4294902015&this._val|e<<8)>>>0}},{key:"b",get:function(){return(16711680&this._val)>>16},set:function(e){e=~~vn(e,0,255),this._val=(4278255615&this._val|e<<16)>>>0}},{key:"a",get:function(){return(4278190080&this._val)>>>24},set:function(e){e=~~vn(e,0,255),this._val=(16777215&this._val|e<<24)>>>0}},{key:"x",get:function(){return this.r*(1/255)},set:function(e){this.r=255*e}},{key:"y",get:function(){return this.g*(1/255)},set:function(e){this.g=255*e}},{key:"z",get:function(){return this.b*(1/255)},set:function(e){this.b=255*e}},{key:"w",get:function(){return this.a*(1/255)},set:function(e){this.a=255*e}}]);var n=t.prototype;return n.clone=function(){var e=new t;return e._val=this._val,e},n.equals=function(e){return e&&this._val===e._val},n.lerp=function(e,t){var n=this.r,i=this.g,r=this.b,o=this.a;return n+=(e.r-n)*t,i+=(e.g-i)*t,r+=(e.b-r)*t,o+=(e.a-o)*t,this._val=Math.floor((o<<24>>>0)+(r<<16)+(i<<8)+n),this},n.toString=function(){return"rgba("+this.r.toFixed()+", "+this.g.toFixed()+", "+this.b.toFixed()+", "+this.a.toFixed()+")"},n.toCSS=function(e){return void 0===e&&(e="rgba"),"rgba"===e?"rgba("+this.r+","+this.g+","+this.b+","+(this.a*(1/255)).toFixed(2)+")":"rgb"===e?"rgb("+this.r+","+this.g+","+this.b+")":"#"+this.toHEX(e)},n.fromHEX=function(e){e=0===e.indexOf("#")?e.substring(1):e;var t=parseInt(e.substr(0,2),16)||0,n=parseInt(e.substr(2,2),16)||0,i=parseInt(e.substr(4,2),16)||0,r=parseInt(e.substr(6,2),16)||255;return this._val=(r<<24>>>0)+(i<<16)+(n<<8)+(0|t),this},n.toHEX=function(e){void 0===e&&(e="#rrggbb");var t=[(this.r<16?"0":"")+this.r.toString(16),(this.g<16?"0":"")+this.g.toString(16),(this.b<16?"0":"")+this.b.toString(16)];return"#rgb"===e?(t[0]=t[0][0],t[1]=t[1][0],t[2]=t[2][0]):"#rrggbbaa"===e&&t.push((this.a<16?"0":"")+this.a.toString(16)),t.join("")},n.toRGBValue=function(){return 16777215&this._val},n.fromHSV=function(e,t,n){var i=0,r=0,o=0;if(0===t)i=r=o=n;else if(0===n)i=r=o=0;else{1===e&&(e=0),e*=6;var a=Math.floor(e),s=e-a,c=n*(1-t),l=n*(1-t*s),u=n*(1-t*(1-s));switch(a){case 0:i=n,r=u,o=c;break;case 1:i=l,r=n,o=c;break;case 2:i=c,r=n,o=u;break;case 3:i=c,r=l,o=n;break;case 4:i=u,r=c,o=n;break;case 5:i=n,r=c,o=l}}return i*=255,r*=255,o*=255,this._val=(this.a<<24>>>0)+(o<<16)+(r<<8)+(0|i),this},n.toHSV=function(){var e=this.r*(1/255),t=this.g*(1/255),n=this.b*(1/255),i={h:0,s:0,v:0},r=Math.max(e,t,n),o=Math.min(e,t,n),a=0;return i.v=r,i.s=r?(r-o)/r:0,i.s?(a=r-o,i.h=e===r?(t-n)/a:t===r?2+(n-e)/a:4+(e-t)/a,i.h/=6,i.h<0&&(i.h+=1)):i.h=0,i},n.set=function(e,t,n,i){return"object"==typeof e?null!=e._val?this._val=e._val:(t=e.g||0,n=e.b||0,i="number"==typeof e.a?e.a:255,e=e.r||0,this._val=(i<<24>>>0)+(n<<16)+(t<<8)+(0|e)):(e=e||0,t=t||0,n=n||0,i="number"==typeof i?i:255,this._val=(i<<24>>>0)+(n<<16)+(t<<8)+(0|e)),this},n.multiply=function(e){var t=(255&this._val)*e.r>>8,n=(65280&this._val)*e.g>>8,i=(16711680&this._val)*e.b>>8,r=((4278190080&this._val)>>>8)*e.a;return this._val=4278190080&r|16711680&i|65280&n|255&t,this},n._set_r_unsafe=function(e){return this._val=(4294967040&this._val|e)>>>0,this},n._set_g_unsafe=function(e){return this._val=(4294902015&this._val|e<<8)>>>0,this},n._set_b_unsafe=function(e){return this._val=(4278255615&this._val|e<<16)>>>0,this},n._set_a_unsafe=function(e){return this._val=(16777215&this._val|e<<24)>>>0,this},t}(Et));function Ln(e,t,n,i){return new Dn(e,t,n,i)}Dn.WHITE=Object.freeze(new Dn(255,255,255,255)),Dn.GRAY=Object.freeze(new Dn(127,127,127,255)),Dn.BLACK=Object.freeze(new Dn(0,0,0,255)),Dn.TRANSPARENT=Object.freeze(new Dn(0,0,0,0)),Dn.RED=Object.freeze(new Dn(255,0,0,255)),Dn.GREEN=Object.freeze(new Dn(0,255,0,255)),Dn.BLUE=Object.freeze(new Dn(0,0,255,255)),Dn.CYAN=Object.freeze(new Dn(0,255,255,255)),Dn.MAGENTA=Object.freeze(new Dn(255,0,255,255)),Dn.YELLOW=Object.freeze(new Dn(255,255,0,255)),ln.fastDefine("cc.Color",Dn,{r:0,g:0,b:0,a:255}),c.Color=Dn,c.color=Ln;var Fn=e("aH",function(e){function t(t,n,i){var r;return r=e.call(this)||this,t&&"object"==typeof t?(r.x=t.x,r.y=t.y,r.z=t.z):(r.x=t||0,r.y=n||0,r.z=i||0),r}$(t,e),t.zero=function(e){return e.x=0,e.y=0,e.z=0,e},t.clone=function(e){return new t(e.x,e.y,e.z)},t.copy=function(e,t){return e.x=t.x,e.y=t.y,e.z=t.z,e},t.set=function(e,t,n,i){return e.x=t,e.y=n,e.z=i,e},t.add=function(e,t,n){return e.x=t.x+n.x,e.y=t.y+n.y,e.z=t.z+n.z,e},t.subtract=function(e,t,n){return e.x=t.x-n.x,e.y=t.y-n.y,e.z=t.z-n.z,e},t.multiply=function(e,t,n){return e.x=t.x*n.x,e.y=t.y*n.y,e.z=t.z*n.z,e},t.divide=function(e,t,n){return e.x=t.x/n.x,e.y=t.y/n.y,e.z=t.z/n.z,e},t.ceil=function(e,t){return e.x=Math.ceil(t.x),e.y=Math.ceil(t.y),e.z=Math.ceil(t.z),e},t.floor=function(e,t){return e.x=Math.floor(t.x),e.y=Math.floor(t.y),e.z=Math.floor(t.z),e},t.min=function(e,t,n){return e.x=Math.min(t.x,n.x),e.y=Math.min(t.y,n.y),e.z=Math.min(t.z,n.z),e},t.max=function(e,t,n){return e.x=Math.max(t.x,n.x),e.y=Math.max(t.y,n.y),e.z=Math.max(t.z,n.z),e},t.round=function(e,t){return e.x=Math.round(t.x),e.y=Math.round(t.y),e.z=Math.round(t.z),e},t.multiplyScalar=function(e,t,n){return e.x=t.x*n,e.y=t.y*n,e.z=t.z*n,e},t.scaleAndAdd=function(e,t,n,i){return e.x=t.x+n.x*i,e.y=t.y+n.y*i,e.z=t.z+n.z*i,e},t.distance=function(e,t){var n=t.x-e.x,i=t.y-e.y,r=t.z-e.z;return Math.sqrt(n*n+i*i+r*r)},t.squaredDistance=function(e,t){var n=t.x-e.x,i=t.y-e.y,r=t.z-e.z;return n*n+i*i+r*r},t.len=function(e){var t=e.x,n=e.y,i=e.z;return Math.sqrt(t*t+n*n+i*i)},t.lengthSqr=function(e){var t=e.x,n=e.y,i=e.z;return t*t+n*n+i*i},t.negate=function(e,t){return e.x=-t.x,e.y=-t.y,e.z=-t.z,e},t.invert=function(e,t){return e.x=1/t.x,e.y=1/t.y,e.z=1/t.z,e},t.invertSafe=function(e,t){var n=t.x,i=t.y,r=t.z;return Math.abs(n)<mn?e.x=0:e.x=1/n,Math.abs(i)<mn?e.y=0:e.y=1/i,Math.abs(r)<mn?e.z=0:e.z=1/r,e},t.normalize=function(e,t){var n=t.x,i=t.y,r=t.z,o=n*n+i*i+r*r;return o>0&&(o=1/Math.sqrt(o),e.x=n*o,e.y=i*o,e.z=r*o),e},t.dot=function(e,t){return e.x*t.x+e.y*t.y+e.z*t.z},t.cross=function(e,t,n){var i=t.x,r=t.y,o=t.z,a=n.x,s=n.y,c=n.z;return e.x=r*c-o*s,e.y=o*a-i*c,e.z=i*s-r*a,e},t.lerp=function(e,t,n,i){return e.x=t.x+i*(n.x-t.x),e.y=t.y+i*(n.y-t.y),e.z=t.z+i*(n.z-t.z),e},t.random=function(e,t){t=t||1;var n=2*Sn()*Math.PI,i=2*Sn()-1,r=Math.sqrt(1-i*i);return e.x=r*Math.cos(n)*t,e.y=r*Math.sin(n)*t,e.z=i*t,e},t.transformMat4=function(e,t,n){var i=t.x,r=t.y,o=t.z,a=n.m03*i+n.m07*r+n.m11*o+n.m15;return a=a?Math.abs(1/a):1,e.x=(n.m00*i+n.m04*r+n.m08*o+n.m12)*a,e.y=(n.m01*i+n.m05*r+n.m09*o+n.m13)*a,e.z=(n.m02*i+n.m06*r+n.m10*o+n.m14)*a,e},t.transformMat4Normal=function(e,t,n){var i=t.x,r=t.y,o=t.z,a=n.m03*i+n.m07*r+n.m11*o;return a=a?Math.abs(1/a):1,e.x=(n.m00*i+n.m04*r+n.m08*o)*a,e.y=(n.m01*i+n.m05*r+n.m09*o)*a,e.z=(n.m02*i+n.m06*r+n.m10*o)*a,e},t.transformMat3=function(e,t,n){var i=t.x,r=t.y,o=t.z;return e.x=i*n.m00+r*n.m03+o*n.m06,e.y=i*n.m01+r*n.m04+o*n.m07,e.z=i*n.m02+r*n.m05+o*n.m08,e},t.transformAffine=function(e,t,n){var i=t.x,r=t.y,o=t.z;return e.x=n.m00*i+n.m04*r+n.m08*o+n.m12,e.y=n.m01*i+n.m05*r+n.m09*o+n.m13,e.x=n.m02*i+n.m06*r+n.m10*o+n.m14,e},t.transformQuat=function(e,t,n){var i=n.w*t.x+n.y*t.z-n.z*t.y,r=n.w*t.y+n.z*t.x-n.x*t.z,o=n.w*t.z+n.x*t.y-n.y*t.x,a=-n.x*t.x-n.y*t.y-n.z*t.z;return e.x=i*n.w+a*-n.x+r*-n.z-o*-n.y,e.y=r*n.w+a*-n.y+o*-n.x-i*-n.z,e.z=o*n.w+a*-n.z+i*-n.y-r*-n.x,e},t.transformRTS=function(e,t,n,i,r){var o=t.x*r.x,a=t.y*r.y,s=t.z*r.z,c=n.w*o+n.y*s-n.z*a,l=n.w*a+n.z*o-n.x*s,u=n.w*s+n.x*a-n.y*o,h=-n.x*o-n.y*a-n.z*s;return e.x=c*n.w+h*-n.x+l*-n.z-u*-n.y+i.x,e.y=l*n.w+h*-n.y+u*-n.x-c*-n.z+i.y,e.z=u*n.w+h*-n.z+c*-n.y-l*-n.x+i.z,e},t.transformInverseRTS=function(e,t,n,i,r){var o=t.x-i.x,a=t.y-i.y,s=t.z-i.z,c=n.w*o-n.y*s+n.z*a,l=n.w*a-n.z*o+n.x*s,u=n.w*s-n.x*a+n.y*o,h=n.x*o+n.y*a+n.z*s;return e.x=(c*n.w+h*n.x+l*n.z-u*n.y)/r.x,e.y=(l*n.w+h*n.y+u*n.x-c*n.z)/r.y,e.z=(u*n.w+h*n.z+c*n.y-l*n.x)/r.z,e},t.rotateX=function(e,t,n,i){var r=t.x-n.x,o=t.y-n.y,a=t.z-n.z,s=Math.cos(i),c=Math.sin(i),l=r,u=o*s-a*c,h=o*c+a*s;return e.x=l+n.x,e.y=u+n.y,e.z=h+n.z,e},t.rotateY=function(e,t,n,i){var r=t.x-n.x,o=t.y-n.y,a=t.z-n.z,s=Math.cos(i),c=Math.sin(i),l=a*c+r*s,u=o,h=a*s-r*c;return e.x=l+n.x,e.y=u+n.y,e.z=h+n.z,e},t.rotateZ=function(e,t,n,i){var r=t.x-n.x,o=t.y-n.y,a=t.z-n.z,s=Math.cos(i),c=Math.sin(i),l=r*s-o*c,u=r*c+o*s,h=a;return e.x=l+n.x,e.y=u+n.y,e.z=h+n.z,e},t.toArray=function(e,t,n){return void 0===n&&(n=0),e[n+0]=t.x,e[n+1]=t.y,e[n+2]=t.z,e},t.fromArray=function(e,t,n){return void 0===n&&(n=0),e.x=t[n+0],e.y=t[n+1],e.z=t[n+2],e},t.strictEquals=function(e,t){return e.x===t.x&&e.y===t.y&&e.z===t.z},t.equals=function(e,t,n){void 0===n&&(n=mn);var i=e.x,r=e.y,o=e.z,a=t.x,s=t.y,c=t.z;return Math.abs(i-a)<=n*Math.max(1,Math.abs(i),Math.abs(a))&&Math.abs(r-s)<=n*Math.max(1,Math.abs(r),Math.abs(s))&&Math.abs(o-c)<=n*Math.max(1,Math.abs(o),Math.abs(c))},t.angle=function(e,n){t.normalize(zn,e),t.normalize(Bn,n);var i=t.dot(zn,Bn);return i>1?0:i<-1?Math.PI:Math.acos(i)},t.projectOnPlane=function(e,n,i){return t.subtract(e,n,t.project(e,n,i))},t.project=function(e,n,i){var r=t.lengthSqr(i);return r<1e-6?t.set(e,0,0,0):t.multiplyScalar(e,i,t.dot(n,i)/r)};var n=t.prototype;return n.clone=function(){return new t(this.x,this.y,this.z)},n.set=function(e,t,n){return e&&"object"==typeof e?(this.x=e.x,this.y=e.y,this.z=e.z):(this.x=e||0,this.y=t||0,this.z=n||0),this},n.equals=function(e,t){return void 0===t&&(t=mn),Math.abs(this.x-e.x)<=t*Math.max(1,Math.abs(this.x),Math.abs(e.x))&&Math.abs(this.y-e.y)<=t*Math.max(1,Math.abs(this.y),Math.abs(e.y))&&Math.abs(this.z-e.z)<=t*Math.max(1,Math.abs(this.z),Math.abs(e.z))},n.equals3f=function(e,t,n,i){return void 0===i&&(i=mn),Math.abs(this.x-e)<=i*Math.max(1,Math.abs(this.x),Math.abs(e))&&Math.abs(this.y-t)<=i*Math.max(1,Math.abs(this.y),Math.abs(t))&&Math.abs(this.z-n)<=i*Math.max(1,Math.abs(this.z),Math.abs(n))},n.strictEquals=function(e){return this.x===e.x&&this.y===e.y&&this.z===e.z},n.strictEquals3f=function(e,t,n){return this.x===e&&this.y===t&&this.z===n},n.toString=function(){return"("+this.x.toFixed(2)+", "+this.y.toFixed(2)+", "+this.z.toFixed(2)+")"},n.lerp=function(e,t){return this.x+=t*(e.x-this.x),this.y+=t*(e.y-this.y),this.z+=t*(e.z-this.z),this},n.add=function(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this},n.add3f=function(e,t,n){return this.x+=e,this.y+=t,this.z+=n,this},n.subtract=function(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this},n.subtract3f=function(e,t,n){return this.x-=e,this.y-=t,this.z-=n,this},n.multiplyScalar=function(e){return"object"==typeof e&&console.warn("should use Vec3.multiply for vector * vector operation"),this.x*=e,this.y*=e,this.z*=e,this},n.multiply=function(e){return"object"!=typeof e&&console.warn("should use Vec3.scale for vector * scalar operation"),this.x*=e.x,this.y*=e.y,this.z*=e.z,this},n.multiply3f=function(e,t,n){return this.x*=e,this.y*=t,this.z*=n,this},n.divide=function(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this},n.divide3f=function(e,t,n){return this.x/=e,this.y/=t,this.z/=n,this},n.negative=function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this},n.clampf=function(e,t){return this.x=vn(this.x,e.x,t.x),this.y=vn(this.y,e.y,t.y),this.z=vn(this.z,e.z,t.z),this},n.dot=function(e){return this.x*e.x+this.y*e.y+this.z*e.z},n.cross=function(e){var t=this.x,n=this.y,i=this.z,r=e.x,o=e.y,a=e.z;return this.x=n*a-i*o,this.y=i*r-t*a,this.z=t*o-n*r,this},n.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},n.lengthSqr=function(){return this.x*this.x+this.y*this.y+this.z*this.z},n.normalize=function(){var e=this.x,t=this.y,n=this.z,i=e*e+t*t+n*n;return i>0&&(i=1/Math.sqrt(i),this.x=e*i,this.y=t*i,this.z=n*i),this},n.transformMat4=function(e){var t=this.x,n=this.y,i=this.z,r=e.m03*t+e.m07*n+e.m11*i+e.m15;return r=r?1/r:1,this.x=(e.m00*t+e.m04*n+e.m08*i+e.m12)*r,this.y=(e.m01*t+e.m05*n+e.m09*i+e.m13)*r,this.z=(e.m02*t+e.m06*n+e.m10*i+e.m14)*r,this},t}(Et));Fn.UNIT_X=Object.freeze(new Fn(1,0,0)),Fn.UNIT_Y=Object.freeze(new Fn(0,1,0)),Fn.UNIT_Z=Object.freeze(new Fn(0,0,1)),Fn.RIGHT=Object.freeze(new Fn(1,0,0)),Fn.UP=Object.freeze(new Fn(0,1,0)),Fn.FORWARD=Object.freeze(new Fn(0,0,-1)),Fn.ZERO=Object.freeze(new Fn(0,0,0)),Fn.ONE=Object.freeze(new Fn(1,1,1)),Fn.NEG_ONE=Object.freeze(new Fn(-1,-1,-1));var zn=new Fn,Bn=new Fn;function Un(e,t,n){return new Fn(e,t,n)}ln.fastDefine("cc.Vec3",Fn,{x:0,y:0,z:0}),c.Vec3=Fn,c.v3=Un;var Gn=e("dF",function(e){function t(t,n,i,r,o,a,s,c,l){var u;return void 0===t&&(t=1),void 0===n&&(n=0),void 0===i&&(i=0),void 0===r&&(r=0),void 0===o&&(o=1),void 0===a&&(a=0),void 0===s&&(s=0),void 0===c&&(c=0),void 0===l&&(l=1),u=e.call(this)||this,"object"==typeof t?(u.m00=t.m00,u.m01=t.m01,u.m02=t.m02,u.m03=t.m03,u.m04=t.m04,u.m05=t.m05,u.m06=t.m06,u.m07=t.m07,u.m08=t.m08):(u.m00=t,u.m01=n,u.m02=i,u.m03=r,u.m04=o,u.m05=a,u.m06=s,u.m07=c,u.m08=l),u}$(t,e),t.clone=function(e){return new t(e.m00,e.m01,e.m02,e.m03,e.m04,e.m05,e.m06,e.m07,e.m08)},t.copy=function(e,t){return e.m00=t.m00,e.m01=t.m01,e.m02=t.m02,e.m03=t.m03,e.m04=t.m04,e.m05=t.m05,e.m06=t.m06,e.m07=t.m07,e.m08=t.m08,e},t.set=function(e,t,n,i,r,o,a,s,c,l){return e.m00=t,e.m01=n,e.m02=i,e.m03=r,e.m04=o,e.m05=a,e.m06=s,e.m07=c,e.m08=l,e},t.identity=function(e){return e.m00=1,e.m01=0,e.m02=0,e.m03=0,e.m04=1,e.m05=0,e.m06=0,e.m07=0,e.m08=1,e},t.transpose=function(e,t){if(e===t){var n=t.m01,i=t.m02,r=t.m05;e.m01=t.m03,e.m02=t.m06,e.m03=n,e.m05=t.m07,e.m06=i,e.m07=r}else e.m00=t.m00,e.m01=t.m03,e.m02=t.m06,e.m03=t.m01,e.m04=t.m04,e.m05=t.m07,e.m06=t.m02,e.m07=t.m05,e.m08=t.m08;return e},t.invert=function(e,t){var n=t.m00,i=t.m01,r=t.m02,o=t.m03,a=t.m04,s=t.m05,c=t.m06,l=t.m07,u=t.m08,h=u*a-s*l,_=-u*o+s*c,f=l*o-a*c,m=n*h+i*_+r*f;return 0===m?(e.m00=0,e.m01=0,e.m02=0,e.m03=0,e.m04=0,e.m05=0,e.m06=0,e.m07=0,e.m08=0,e):(m=1/m,e.m00=h*m,e.m01=(-u*i+r*l)*m,e.m02=(s*i-r*a)*m,e.m03=_*m,e.m04=(u*n-r*c)*m,e.m05=(-s*n+r*o)*m,e.m06=f*m,e.m07=(-l*n+i*c)*m,e.m08=(a*n-i*o)*m,e)},t.determinant=function(e){var t=e.m00,n=e.m01,i=e.m02,r=e.m03,o=e.m04,a=e.m05,s=e.m06,c=e.m07,l=e.m08;return t*(l*o-a*c)+n*(-l*r+a*s)+i*(c*r-o*s)},t.multiply=function(e,t,n){var i=t.m00,r=t.m01,o=t.m02,a=t.m03,s=t.m04,c=t.m05,l=t.m06,u=t.m07,h=t.m08,_=n.m00,f=n.m01,m=n.m02,d=n.m03,p=n.m04,v=n.m05,g=n.m06,y=n.m07,x=n.m08;return e.m00=_*i+f*a+m*l,e.m01=_*r+f*s+m*u,e.m02=_*o+f*c+m*h,e.m03=d*i+p*a+v*l,e.m04=d*r+p*s+v*u,e.m05=d*o+p*c+v*h,e.m06=g*i+y*a+x*l,e.m07=g*r+y*s+x*u,e.m08=g*o+y*c+x*h,e},t.multiplyMat4=function(e,t,n){var i=t.m00,r=t.m01,o=t.m02,a=t.m03,s=t.m04,c=t.m05,l=t.m06,u=t.m07,h=t.m08,_=n.m00,f=n.m01,m=n.m02,d=n.m04,p=n.m05,v=n.m06,g=n.m08,y=n.m09,x=n.m10;return e.m00=_*i+f*a+m*l,e.m01=_*r+f*s+m*u,e.m02=_*o+f*c+m*h,e.m03=d*i+p*a+v*l,e.m04=d*r+p*s+v*u,e.m05=d*o+p*c+v*h,e.m06=g*i+y*a+x*l,e.m07=g*r+y*s+x*u,e.m08=g*o+y*c+x*h,e},t.transform=function(e,t,n){var i=t.m00,r=t.m01,o=t.m02,a=t.m03,s=t.m04,c=t.m05,l=t.m06,u=t.m07,h=t.m08,_=n.x,f=n.y;return e.m00=i,e.m01=r,e.m02=o,e.m03=a,e.m04=s,e.m05=c,e.m06=_*i+f*a+l,e.m07=_*r+f*s+u,e.m08=_*o+f*c+h,e},t.scale=function(e,t,n){var i=n.x,r=n.y;return e.m00=i*t.m00,e.m01=i*t.m01,e.m02=i*t.m02,e.m03=r*t.m03,e.m04=r*t.m04,e.m05=r*t.m05,e.m06=t.m06,e.m07=t.m07,e.m08=t.m08,e},t.rotate=function(e,t,n){var i=t.m00,r=t.m01,o=t.m02,a=t.m03,s=t.m04,c=t.m05,l=t.m06,u=t.m07,h=t.m08,_=Math.sin(n),f=Math.cos(n);return e.m00=f*i+_*a,e.m01=f*r+_*s,e.m02=f*o+_*c,e.m03=f*a-_*i,e.m04=f*s-_*r,e.m05=f*c-_*o,e.m06=l,e.m07=u,e.m08=h,e},t.fromMat4=function(e,t){return e.m00=t.m00,e.m01=t.m01,e.m02=t.m02,e.m03=t.m04,e.m04=t.m05,e.m05=t.m06,e.m06=t.m08,e.m07=t.m09,e.m08=t.m10,e},t.fromViewUp=function(e,n,i){return Fn.lengthSqr(n)<mn*mn?(t.identity(e),e):(i=i||Fn.UNIT_Y,Fn.normalize(Hn,Fn.cross(Hn,i,n)),Fn.lengthSqr(Hn)<mn*mn?(t.identity(e),e):(Fn.cross(kn,n,Hn),t.set(e,Hn.x,Hn.y,Hn.z,kn.x,kn.y,kn.z,n.x,n.y,n.z),e))},t.fromTranslation=function(e,t){return e.m00=1,e.m01=0,e.m02=0,e.m03=0,e.m04=1,e.m05=0,e.m06=t.x,e.m07=t.y,e.m08=1,e},t.fromScaling=function(e,t){return e.m00=t.x,e.m01=0,e.m02=0,e.m03=0,e.m04=t.y,e.m05=0,e.m06=0,e.m07=0,e.m08=1,e},t.fromRotation=function(e,t){var n=Math.sin(t),i=Math.cos(t);return e.m00=i,e.m01=n,e.m02=0,e.m03=-n,e.m04=i,e.m05=0,e.m06=0,e.m07=0,e.m08=1,e},t.fromQuat=function(e,t){var n=t.x,i=t.y,r=t.z,o=t.w,a=n+n,s=i+i,c=r+r,l=n*a,u=i*a,h=i*s,_=r*a,f=r*s,m=r*c,d=o*a,p=o*s,v=o*c;return e.m00=1-h-m,e.m03=u-v,e.m06=_+p,e.m01=u+v,e.m04=1-l-m,e.m07=f-d,e.m02=_-p,e.m05=f+d,e.m08=1-l-h,e},t.inverseTransposeMat4=function(e,t){var n=t.m00,i=t.m01,r=t.m02,o=t.m03,a=t.m04,s=t.m05,c=t.m06,l=t.m07,u=t.m08,h=t.m09,_=t.m10,f=t.m11,m=t.m12,d=t.m13,p=t.m14,v=t.m15,g=n*s-i*a,y=n*c-r*a,x=n*l-o*a,E=i*c-r*s,S=i*l-o*s,T=r*l-o*c,A=u*d-h*m,C=u*p-_*m,w=u*v-f*m,I=h*p-_*d,b=h*v-f*d,R=_*v-f*p,O=g*R-y*b+x*I+E*w-S*C+T*A;return O?(O=1/O,e.m00=(s*R-c*b+l*I)*O,e.m01=(c*w-a*R-l*C)*O,e.m02=(a*b-s*w+l*A)*O,e.m03=(r*b-i*R-o*I)*O,e.m04=(n*R-r*w+o*C)*O,e.m05=(i*w-n*b-o*A)*O,e.m06=(d*T-p*S+v*E)*O,e.m07=(p*x-m*T-v*y)*O,e.m08=(m*S-d*x+v*g)*O,e):null},t.toArray=function(e,t,n){return void 0===n&&(n=0),e[n+0]=t.m00,e[n+1]=t.m01,e[n+2]=t.m02,e[n+3]=t.m03,e[n+4]=t.m04,e[n+5]=t.m05,e[n+6]=t.m06,e[n+7]=t.m07,e[n+8]=t.m08,e},t.fromArray=function(e,t,n){return void 0===n&&(n=0),e.m00=t[n+0],e.m01=t[n+1],e.m02=t[n+2],e.m03=t[n+3],e.m04=t[n+4],e.m05=t[n+5],e.m06=t[n+6],e.m07=t[n+7],e.m08=t[n+8],e},t.add=function(e,t,n){return e.m00=t.m00+n.m00,e.m01=t.m01+n.m01,e.m02=t.m02+n.m02,e.m03=t.m03+n.m03,e.m04=t.m04+n.m04,e.m05=t.m05+n.m05,e.m06=t.m06+n.m06,e.m07=t.m07+n.m07,e.m08=t.m08+n.m08,e},t.subtract=function(e,t,n){return e.m00=t.m00-n.m00,e.m01=t.m01-n.m01,e.m02=t.m02-n.m02,e.m03=t.m03-n.m03,e.m04=t.m04-n.m04,e.m05=t.m05-n.m05,e.m06=t.m06-n.m06,e.m07=t.m07-n.m07,e.m08=t.m08-n.m08,e},t.multiplyScalar=function(e,t,n){return e.m00=t.m00*n,e.m01=t.m01*n,e.m02=t.m02*n,e.m03=t.m03*n,e.m04=t.m04*n,e.m05=t.m05*n,e.m06=t.m06*n,e.m07=t.m07*n,e.m08=t.m08*n,e},t.multiplyScalarAndAdd=function(e,t,n,i){return e.m00=n.m00*i+t.m00,e.m01=n.m01*i+t.m01,e.m02=n.m02*i+t.m02,e.m03=n.m03*i+t.m03,e.m04=n.m04*i+t.m04,e.m05=n.m05*i+t.m05,e.m06=n.m06*i+t.m06,e.m07=n.m07*i+t.m07,e.m08=n.m08*i+t.m08,e},t.strictEquals=function(e,t){return e.m00===t.m00&&e.m01===t.m01&&e.m02===t.m02&&e.m03===t.m03&&e.m04===t.m04&&e.m05===t.m05&&e.m06===t.m06&&e.m07===t.m07&&e.m08===t.m08},t.equals=function(e,t,n){return void 0===n&&(n=mn),Math.abs(e.m00-t.m00)<=n*Math.max(1,Math.abs(e.m00),Math.abs(t.m00))&&Math.abs(e.m01-t.m01)<=n*Math.max(1,Math.abs(e.m01),Math.abs(t.m01))&&Math.abs(e.m02-t.m02)<=n*Math.max(1,Math.abs(e.m02),Math.abs(t.m02))&&Math.abs(e.m03-t.m03)<=n*Math.max(1,Math.abs(e.m03),Math.abs(t.m03))&&Math.abs(e.m04-t.m04)<=n*Math.max(1,Math.abs(e.m04),Math.abs(t.m04))&&Math.abs(e.m05-t.m05)<=n*Math.max(1,Math.abs(e.m05),Math.abs(t.m05))&&Math.abs(e.m06-t.m06)<=n*Math.max(1,Math.abs(e.m06),Math.abs(t.m06))&&Math.abs(e.m07-t.m07)<=n*Math.max(1,Math.abs(e.m07),Math.abs(t.m07))&&Math.abs(e.m08-t.m08)<=n*Math.max(1,Math.abs(e.m08),Math.abs(t.m08))};var n=t.prototype;return n.clone=function(){var e=this;return new t(e.m00,e.m01,e.m02,e.m03,e.m04,e.m05,e.m06,e.m07,e.m08)},n.set=function(e,t,n,i,r,o,a,s,c){return void 0===e&&(e=1),void 0===t&&(t=0),void 0===n&&(n=0),void 0===i&&(i=0),void 0===r&&(r=1),void 0===o&&(o=0),void 0===a&&(a=0),void 0===s&&(s=0),void 0===c&&(c=1),"object"==typeof e?(this.m00=e.m00,this.m01=e.m01,this.m02=e.m02,this.m03=e.m03,this.m04=e.m04,this.m05=e.m05,this.m06=e.m06,this.m07=e.m07,this.m08=e.m08):(this.m00=e,this.m01=t,this.m02=n,this.m03=i,this.m04=r,this.m05=o,this.m06=a,this.m07=s,this.m08=c),this},n.equals=function(e,t){return void 0===t&&(t=mn),Math.abs(this.m00-e.m00)<=t*Math.max(1,Math.abs(this.m00),Math.abs(e.m00))&&Math.abs(this.m01-e.m01)<=t*Math.max(1,Math.abs(this.m01),Math.abs(e.m01))&&Math.abs(this.m02-e.m02)<=t*Math.max(1,Math.abs(this.m02),Math.abs(e.m02))&&Math.abs(this.m03-e.m03)<=t*Math.max(1,Math.abs(this.m03),Math.abs(e.m03))&&Math.abs(this.m04-e.m04)<=t*Math.max(1,Math.abs(this.m04),Math.abs(e.m04))&&Math.abs(this.m05-e.m05)<=t*Math.max(1,Math.abs(this.m05),Math.abs(e.m05))&&Math.abs(this.m06-e.m06)<=t*Math.max(1,Math.abs(this.m06),Math.abs(e.m06))&&Math.abs(this.m07-e.m07)<=t*Math.max(1,Math.abs(this.m07),Math.abs(e.m07))&&Math.abs(this.m08-e.m08)<=t*Math.max(1,Math.abs(this.m08),Math.abs(e.m08))},n.strictEquals=function(e){return this.m00===e.m00&&this.m01===e.m01&&this.m02===e.m02&&this.m03===e.m03&&this.m04===e.m04&&this.m05===e.m05&&this.m06===e.m06&&this.m07===e.m07&&this.m08===e.m08},n.toString=function(){var e=this;return"[\n"+e.m00+", "+e.m01+", "+e.m02+",\n"+e.m03+",\n"+e.m04+", "+e.m05+",\n"+e.m06+", "+e.m07+",\n"+e.m08+"\n]"},n.identity=function(){return this.m00=1,this.m01=0,this.m02=0,this.m03=0,this.m04=1,this.m05=0,this.m06=0,this.m07=0,this.m08=1,this},n.transpose=function(){var e=this.m01,t=this.m02,n=this.m05;return this.m01=this.m03,this.m02=this.m06,this.m03=e,this.m05=this.m07,this.m06=t,this.m07=n,this},n.invert=function(){var e=this.m00,t=this.m01,n=this.m02,i=this.m03,r=this.m04,o=this.m05,a=this.m06,s=this.m07,c=this.m08,l=c*r-o*s,u=-c*i+o*a,h=s*i-r*a,_=e*l+t*u+n*h;return 0===_?(this.set(0,0,0,0,0,0,0,0,0),this):(_=1/_,this.m00=l*_,this.m01=(-c*t+n*s)*_,this.m02=(o*t-n*r)*_,this.m03=u*_,this.m04=(c*e-n*a)*_,this.m05=(-o*e+n*i)*_,this.m06=h*_,this.m07=(-s*e+t*a)*_,this.m08=(r*e-t*i)*_,this)},n.determinant=function(){var e=this.m00,t=this.m01,n=this.m02,i=this.m03,r=this.m04,o=this.m05,a=this.m06,s=this.m07,c=this.m08;return e*(c*r-o*s)+t*(-c*i+o*a)+n*(s*i-r*a)},n.add=function(e){return this.m00+=e.m00,this.m01+=e.m01,this.m02+=e.m02,this.m03+=e.m03,this.m04+=e.m04,this.m05+=e.m05,this.m06+=e.m06,this.m07+=e.m07,this.m08+=e.m08,this},n.subtract=function(e){return this.m00-=e.m00,this.m01-=e.m01,this.m02-=e.m02,this.m03-=e.m03,this.m04-=e.m04,this.m05-=e.m05,this.m06-=e.m06,this.m07-=e.m07,this.m08-=e.m08,this},n.multiply=function(e){var t=this.m00,n=this.m01,i=this.m02,r=this.m03,o=this.m04,a=this.m05,s=this.m06,c=this.m07,l=this.m08,u=e.m00,h=e.m01,_=e.m02,f=e.m03,m=e.m04,d=e.m05,p=e.m06,v=e.m07,g=e.m08;return this.m00=u*t+h*r+_*s,this.m01=u*n+h*o+_*c,this.m02=u*i+h*a+_*l,this.m03=f*t+m*r+d*s,this.m04=f*n+m*o+d*c,this.m05=f*i+m*a+d*l,this.m06=p*t+v*r+g*s,this.m07=p*n+v*o+g*c,this.m08=p*i+v*a+g*l,this},n.multiplyScalar=function(e){return this.m00*=e,this.m01*=e,this.m02*=e,this.m03*=e,this.m04*=e,this.m05*=e,this.m06*=e,this.m07*=e,this.m08*=e,this},n.scale=function(e){var t=e.x,n=e.y;return this.m00=t*this.m00,this.m01=t*this.m01,this.m02=t*this.m02,this.m03=n*this.m03,this.m04=n*this.m04,this.m05=n*this.m05,this.m06=this.m06,this.m07=this.m07,this.m08=this.m08,this},n.rotate=function(e){var t=this.m00,n=this.m01,i=this.m02,r=this.m03,o=this.m04,a=this.m05,s=this.m06,c=this.m07,l=this.m08,u=Math.sin(e),h=Math.cos(e);return this.m00=h*t+u*r,this.m01=h*n+u*o,this.m02=h*i+u*a,this.m03=h*r-u*t,this.m04=h*o-u*n,this.m05=h*a-u*i,this.m06=s,this.m07=c,this.m08=l,this},n.fromQuat=function(e){var t=e.x,n=e.y,i=e.z,r=e.w,o=t+t,a=n+n,s=i+i,c=t*o,l=n*o,u=n*a,h=i*o,_=i*a,f=i*s,m=r*o,d=r*a,p=r*s;return this.m00=1-u-f,this.m03=l-p,this.m06=h+d,this.m01=l+p,this.m04=1-c-f,this.m07=_-m,this.m02=h-d,this.m05=_+m,this.m08=1-c-u,this},t}(Et));Gn.IDENTITY=Object.freeze(new Gn);var Hn=new Fn,kn=new Fn;ln.fastDefine("cc.Mat3",Gn,{m00:1,m01:0,m02:0,m03:0,m04:1,m05:0,m06:0,m07:0,m08:1}),c.Mat3=Gn;var Vn=e("aM",function(e){function t(t,n,i,r){var o;return o=e.call(this)||this,t&&"object"==typeof t?(o.x=t.x,o.y=t.y,o.z=t.z,o.w=t.w):(o.x=t||0,o.y=n||0,o.z=i||0,o.w=null!=r?r:1),o}$(t,e),t.clone=function(e){return new t(e.x,e.y,e.z,e.w)},t.copy=function(e,t){return e.x=t.x,e.y=t.y,e.z=t.z,e.w=t.w,e},t.set=function(e,t,n,i,r){return e.x=t,e.y=n,e.z=i,e.w=r,e},t.identity=function(e){return e.x=0,e.y=0,e.z=0,e.w=1,e},t.rotationTo=function(e,n,i){var r=Fn.dot(n,i);return r<-.999999?(Fn.cross(qn,Fn.UNIT_X,n),qn.length()<1e-6&&Fn.cross(qn,Fn.UNIT_Y,n),Fn.normalize(qn,qn),t.fromAxisAngle(e,qn,Math.PI),e):r>.999999?(e.x=0,e.y=0,e.z=0,e.w=1,e):(Fn.cross(qn,n,i),e.x=qn.x,e.y=qn.y,e.z=qn.z,e.w=1+r,t.normalize(e,e))},t.getAxisAngle=function(e,t){var n=2*Math.acos(t.w),i=Math.sin(n/2);return 0!==i?(e.x=t.x/i,e.y=t.y/i,e.z=t.z/i):(e.x=1,e.y=0,e.z=0),n},t.multiply=function(e,t,n){var i=t.x*n.w+t.w*n.x+t.y*n.z-t.z*n.y,r=t.y*n.w+t.w*n.y+t.z*n.x-t.x*n.z,o=t.z*n.w+t.w*n.z+t.x*n.y-t.y*n.x,a=t.w*n.w-t.x*n.x-t.y*n.y-t.z*n.z;return e.x=i,e.y=r,e.z=o,e.w=a,e},t.multiplyScalar=function(e,t,n){return e.x=t.x*n,e.y=t.y*n,e.z=t.z*n,e.w=t.w*n,e},t.scaleAndAdd=function(e,t,n,i){return e.x=t.x+n.x*i,e.y=t.y+n.y*i,e.z=t.z+n.z*i,e.w=t.w+n.w*i,e},t.rotateX=function(e,t,n){n*=.5;var i=Math.sin(n),r=Math.cos(n),o=t.x,a=t.y,s=t.z,c=t.w;return e.x=o*r+c*i,e.y=a*r+s*i,e.z=s*r-a*i,e.w=c*r-o*i,e},t.rotateY=function(e,t,n){n*=.5;var i=Math.sin(n),r=Math.cos(n),o=t.x,a=t.y,s=t.z,c=t.w;return e.x=o*r-s*i,e.y=a*r+c*i,e.z=s*r+o*i,e.w=c*r-a*i,e},t.rotateZ=function(e,t,n){n*=.5;var i=Math.sin(n),r=Math.cos(n),o=t.x,a=t.y,s=t.z,c=t.w;return e.x=o*r+a*i,e.y=a*r-o*i,e.z=s*r+c*i,e.w=c*r-s*i,e},t.rotateAround=function(e,n,i,r){return t.invert(jn,n),Fn.transformQuat(qn,i,jn),t.fromAxisAngle(jn,qn,r),t.multiply(e,n,jn),e},t.rotateAroundLocal=function(e,n,i,r){return t.fromAxisAngle(jn,i,r),t.multiply(e,n,jn),e},t.calculateW=function(e,t){return e.x=t.x,e.y=t.y,e.z=t.z,e.w=Math.sqrt(Math.abs(1-t.x*t.x-t.y*t.y-t.z*t.z)),e},t.dot=function(e,t){return e.x*t.x+e.y*t.y+e.z*t.z+e.w*t.w},t.lerp=function(e,t,n,i){return e.x=t.x+i*(n.x-t.x),e.y=t.y+i*(n.y-t.y),e.z=t.z+i*(n.z-t.z),e.w=t.w+i*(n.w-t.w),e},t.slerp=function(e,t,n,i){var r=0,o=0,a=n.x,s=n.y,c=n.z,l=n.w,u=t.x*n.x+t.y*n.y+t.z*n.z+t.w*n.w;if(u<0&&(u=-u,a=-a,s=-s,c=-c,l=-l),1-u>1e-6){var h=Math.acos(u),_=Math.sin(h);r=Math.sin((1-i)*h)/_,o=Math.sin(i*h)/_}else r=1-i,o=i;return e.x=r*t.x+o*a,e.y=r*t.y+o*s,e.z=r*t.z+o*c,e.w=r*t.w+o*l,e},t.sqlerp=function(e,n,i,r,o,a){return t.slerp(jn,n,o,a),t.slerp(Wn,i,r,a),t.slerp(e,jn,Wn,2*a*(1-a)),e},t.invert=function(e,t){var n=t.x*t.x+t.y*t.y+t.z*t.z+t.w*t.w,i=n?1/n:0;return e.x=-t.x*i,e.y=-t.y*i,e.z=-t.z*i,e.w=t.w*i,e},t.conjugate=function(e,t){return e.x=-t.x,e.y=-t.y,e.z=-t.z,e.w=t.w,e},t.len=function(e){return Math.sqrt(e.x*e.x+e.y*e.y+e.z*e.z+e.w*e.w)},t.lengthSqr=function(e){return e.x*e.x+e.y*e.y+e.z*e.z+e.w*e.w},t.normalize=function(e,t){var n=t.x*t.x+t.y*t.y+t.z*t.z+t.w*t.w;return n>0&&(n=1/Math.sqrt(n),e.x=t.x*n,e.y=t.y*n,e.z=t.z*n,e.w=t.w*n),e},t.fromAxes=function(e,n,i,r){return Gn.set(Yn,n.x,n.y,n.z,i.x,i.y,i.z,r.x,r.y,r.z),t.normalize(e,t.fromMat3(e,Yn))},t.fromViewUp=function(e,n,i){return Gn.fromViewUp(Yn,n,i),t.normalize(e,t.fromMat3(e,Yn))},t.fromAxisAngle=function(e,t,n){n*=.5;var i=Math.sin(n);return e.x=i*t.x,e.y=i*t.y,e.z=i*t.z,e.w=Math.cos(n),e},t.fromMat3=function(e,t){var n=t.m00,i=t.m03,r=t.m06,o=t.m01,a=t.m04,s=t.m07,c=t.m02,l=t.m05,u=t.m08,h=n+a+u;if(h>0){var _=.5/Math.sqrt(h+1);e.w=.25/_,e.x=(l-s)*_,e.y=(r-c)*_,e.z=(o-i)*_}else if(n>a&&n>u){var f=2*Math.sqrt(1+n-a-u);e.w=(l-s)/f,e.x=.25*f,e.y=(i+o)/f,e.z=(r+c)/f}else if(a>u){var m=2*Math.sqrt(1+a-n-u);e.w=(r-c)/m,e.x=(i+o)/m,e.y=.25*m,e.z=(s+l)/m}else{var d=2*Math.sqrt(1+u-n-a);e.w=(o-i)/d,e.x=(r+c)/d,e.y=(s+l)/d,e.z=.25*d}return e},t.fromEuler=function(e,t,n,i){t*=Xn,n*=Xn,i*=Xn;var r=Math.sin(t),o=Math.cos(t),a=Math.sin(n),s=Math.cos(n),c=Math.sin(i),l=Math.cos(i);return e.x=r*s*l+o*a*c,e.y=o*a*l+r*s*c,e.z=o*s*c-r*a*l,e.w=o*s*l-r*a*c,e},t.fromAngleZ=function(e,t){return t*=Xn,e.x=e.y=0,e.z=Math.sin(t),e.w=Math.cos(t),e},t.toAxisX=function(e,t){var n=2*t.y,i=2*t.z;return e.x=1-n*t.y-i*t.z,e.y=n*t.x+i*t.w,e.z=i*t.x+n*t.w,e},t.toAxisY=function(e,t){var n=2*t.x,i=2*t.y,r=2*t.z;return e.x=i*t.x-r*t.w,e.y=1-n*t.x-r*t.z,e.z=r*t.y+n*t.w,e},t.toAxisZ=function(e,t){var n=2*t.x,i=2*t.y,r=2*t.z;return e.x=r*t.x-i*t.w,e.y=r*t.y-n*t.w,e.z=1-n*t.x-i*t.y,e},t.toEuler=function(e,t,n){var i=t.x,r=t.y,o=t.z,a=t.w,s=0,c=0,l=0,u=i*r+o*a;if(u>.499999)s=0,c=En(2*Math.atan2(i,a)),l=90;else if(u<-.499999)s=0,c=-En(2*Math.atan2(i,a)),l=-90;else{var h=i*i,_=r*r,f=o*o;s=En(Math.atan2(2*i*a-2*r*o,1-2*h-2*f)),c=En(Math.atan2(2*r*a-2*i*o,1-2*_-2*f)),l=En(Math.asin(2*u)),n&&(s=-180*Math.sign(s+1e-6)+s,c=-180*Math.sign(c+1e-6)+c,l=180*Math.sign(l+1e-6)-l)}return e.x=s,e.y=c,e.z=l,e},t.toArray=function(e,t,n){return void 0===n&&(n=0),e[n+0]=t.x,e[n+1]=t.y,e[n+2]=t.z,e[n+3]=t.w,e},t.fromArray=function(e,t,n){return void 0===n&&(n=0),e.x=t[n+0],e.y=t[n+1],e.z=t[n+2],e.w=t[n+3],e},t.strictEquals=function(e,t){return e.x===t.x&&e.y===t.y&&e.z===t.z&&e.w===t.w},t.equals=function(e,t,n){return void 0===n&&(n=mn),Math.abs(e.x-t.x)<=n*Math.max(1,Math.abs(e.x),Math.abs(t.x))&&Math.abs(e.y-t.y)<=n*Math.max(1,Math.abs(e.y),Math.abs(t.y))&&Math.abs(e.z-t.z)<=n*Math.max(1,Math.abs(e.z),Math.abs(t.z))&&Math.abs(e.w-t.w)<=n*Math.max(1,Math.abs(e.w),Math.abs(t.w))};var n=t.prototype;return n.clone=function(){return new t(this.x,this.y,this.z,this.w)},n.set=function(e,t,n,i){return e&&"object"==typeof e?(this.x=e.x,this.y=e.y,this.z=e.z,this.w=e.w):(this.x=e||0,this.y=t||0,this.z=n||0,this.w=null!=i?i:1),this},n.equals=function(e,t){return void 0===t&&(t=mn),Math.abs(this.x-e.x)<=t*Math.max(1,Math.abs(this.x),Math.abs(e.x))&&Math.abs(this.y-e.y)<=t*Math.max(1,Math.abs(this.y),Math.abs(e.y))&&Math.abs(this.z-e.z)<=t*Math.max(1,Math.abs(this.z),Math.abs(e.z))&&Math.abs(this.w-e.w)<=t*Math.max(1,Math.abs(this.w),Math.abs(e.w))},n.strictEquals=function(e){return e&&this.x===e.x&&this.y===e.y&&this.z===e.z&&this.w===e.w},n.getEulerAngles=function(e){return t.toEuler(e,this)},n.lerp=function(e,t){return this.x+=t*(e.x-this.x),this.y+=t*(e.y-this.y),this.z+=t*(e.z-this.z),this.w+=t*(e.w-this.w),this},n.slerp=function(e,n){return t.slerp(this,this,e,n)},n.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)},n.lengthSqr=function(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w},t}(Et));Vn.IDENTITY=Object.freeze(new Vn);var jn=new Vn,Wn=new Vn,qn=new Fn,Yn=new Gn,Xn=.5*Math.PI/180;function Kn(e,t,n,i){return void 0===e&&(e=0),void 0===t&&(t=0),void 0===n&&(n=0),void 0===i&&(i=1),new Vn(e,t,n,i)}ln.fastDefine("cc.Quat",Vn,{x:0,y:0,z:0,w:1}),c.Quat=Vn,c.quat=Kn;var Qn=e("de",Object.freeze([Object.freeze([1,0,0,1]),Object.freeze([0,1,-1,0]),Object.freeze([-1,0,0,-1]),Object.freeze([0,-1,1,0])])),Zn=e("bc",function(e){function t(t,n,i,r,o,a,s,c,l,u,h,_,f,m,d,p){var v;return void 0===t&&(t=1),void 0===n&&(n=0),void 0===i&&(i=0),void 0===r&&(r=0),void 0===o&&(o=0),void 0===a&&(a=1),void 0===s&&(s=0),void 0===c&&(c=0),void 0===l&&(l=0),void 0===u&&(u=0),void 0===h&&(h=1),void 0===_&&(_=0),void 0===f&&(f=0),void 0===m&&(m=0),void 0===d&&(d=0),void 0===p&&(p=1),(v=e.call(this)||this).m00=void 0,v.m01=void 0,v.m02=void 0,v.m03=void 0,v.m04=void 0,v.m05=void 0,v.m06=void 0,v.m07=void 0,v.m08=void 0,v.m09=void 0,v.m10=void 0,v.m11=void 0,v.m12=void 0,v.m13=void 0,v.m14=void 0,v.m15=void 0,"object"==typeof t?(v.m00=t.m00,v.m01=t.m01,v.m02=t.m02,v.m03=t.m03,v.m04=t.m04,v.m05=t.m05,v.m06=t.m06,v.m07=t.m07,v.m08=t.m08,v.m09=t.m09,v.m10=t.m10,v.m11=t.m11,v.m12=t.m12,v.m13=t.m13,v.m14=t.m14,v.m15=t.m15):(v.m00=t,v.m01=n,v.m02=i,v.m03=r,v.m04=o,v.m05=a,v.m06=s,v.m07=c,v.m08=l,v.m09=u,v.m10=h,v.m11=_,v.m12=f,v.m13=m,v.m14=d,v.m15=p),v}$(t,e),t.clone=function(e){return new t(e.m00,e.m01,e.m02,e.m03,e.m04,e.m05,e.m06,e.m07,e.m08,e.m09,e.m10,e.m11,e.m12,e.m13,e.m14,e.m15)},t.copy=function(e,t){return e.m00=t.m00,e.m01=t.m01,e.m02=t.m02,e.m03=t.m03,e.m04=t.m04,e.m05=t.m05,e.m06=t.m06,e.m07=t.m07,e.m08=t.m08,e.m09=t.m09,e.m10=t.m10,e.m11=t.m11,e.m12=t.m12,e.m13=t.m13,e.m14=t.m14,e.m15=t.m15,e},t.set=function(e,t,n,i,r,o,a,s,c,l,u,h,_,f,m,d,p){return e.m00=t,e.m01=n,e.m02=i,e.m03=r,e.m04=o,e.m05=a,e.m06=s,e.m07=c,e.m08=l,e.m09=u,e.m10=h,e.m11=_,e.m12=f,e.m13=m,e.m14=d,e.m15=p,e},t.identity=function(e){return e.m00=1,e.m01=0,e.m02=0,e.m03=0,e.m04=0,e.m05=1,e.m06=0,e.m07=0,e.m08=0,e.m09=0,e.m10=1,e.m11=0,e.m12=0,e.m13=0,e.m14=0,e.m15=1,e},t.transpose=function(e,t){if(e===t){var n=t.m01,i=t.m02,r=t.m03,o=t.m06,a=t.m07,s=t.m11;e.m01=t.m04,e.m02=t.m08,e.m03=t.m12,e.m04=n,e.m06=t.m09,e.m07=t.m13,e.m08=i,e.m09=o,e.m11=t.m14,e.m12=r,e.m13=a,e.m14=s}else e.m00=t.m00,e.m01=t.m04,e.m02=t.m08,e.m03=t.m12,e.m04=t.m01,e.m05=t.m05,e.m06=t.m09,e.m07=t.m13,e.m08=t.m02,e.m09=t.m06,e.m10=t.m10,e.m11=t.m14,e.m12=t.m03,e.m13=t.m07,e.m14=t.m11,e.m15=t.m15;return e},t.invert=function(e,t){var n=t.m00,i=t.m01,r=t.m02,o=t.m03,a=t.m04,s=t.m05,c=t.m06,l=t.m07,u=t.m08,h=t.m09,_=t.m10,f=t.m11,m=t.m12,d=t.m13,p=t.m14,v=t.m15,g=n*s-i*a,y=n*c-r*a,x=n*l-o*a,E=i*c-r*s,S=i*l-o*s,T=r*l-o*c,A=u*d-h*m,C=u*p-_*m,w=u*v-f*m,I=h*p-_*d,b=h*v-f*d,R=_*v-f*p,O=g*R-y*b+x*I+E*w-S*C+T*A;return 0===O?(e.m00=0,e.m01=0,e.m02=0,e.m03=0,e.m04=0,e.m05=0,e.m06=0,e.m07=0,e.m08=0,e.m09=0,e.m10=0,e.m11=0,e.m12=0,e.m13=0,e.m14=0,e.m15=0,e):(O=1/O,e.m00=(s*R-c*b+l*I)*O,e.m01=(r*b-i*R-o*I)*O,e.m02=(d*T-p*S+v*E)*O,e.m03=(_*S-h*T-f*E)*O,e.m04=(c*w-a*R-l*C)*O,e.m05=(n*R-r*w+o*C)*O,e.m06=(p*x-m*T-v*y)*O,e.m07=(u*T-_*x+f*y)*O,e.m08=(a*b-s*w+l*A)*O,e.m09=(i*w-n*b-o*A)*O,e.m10=(m*S-d*x+v*g)*O,e.m11=(h*x-u*S-f*g)*O,e.m12=(s*C-a*I-c*A)*O,e.m13=(n*I-i*C+r*A)*O,e.m14=(d*y-m*E-p*g)*O,e.m15=(u*E-h*y+_*g)*O,e)},t.determinant=function(e){var t=e.m00,n=e.m01,i=e.m02,r=e.m03,o=e.m04,a=e.m05,s=e.m06,c=e.m07,l=e.m08,u=e.m09,h=e.m10,_=e.m11,f=e.m12,m=e.m13,d=e.m14,p=e.m15;return(t*a-n*o)*(h*p-_*d)-(t*s-i*o)*(u*p-_*m)+(t*c-r*o)*(u*d-h*m)+(n*s-i*a)*(l*p-_*f)-(n*c-r*a)*(l*d-h*f)+(i*c-r*s)*(l*m-u*f)},t.multiply=function(e,t,n){var i=t.m00,r=t.m01,o=t.m02,a=t.m03,s=t.m04,c=t.m05,l=t.m06,u=t.m07,h=t.m08,_=t.m09,f=t.m10,m=t.m11,d=t.m12,p=t.m13,v=t.m14,g=t.m15,y=n.m00,x=n.m01,E=n.m02,S=n.m03;return e.m00=y*i+x*s+E*h+S*d,e.m01=y*r+x*c+E*_+S*p,e.m02=y*o+x*l+E*f+S*v,e.m03=y*a+x*u+E*m+S*g,y=n.m04,x=n.m05,E=n.m06,S=n.m07,e.m04=y*i+x*s+E*h+S*d,e.m05=y*r+x*c+E*_+S*p,e.m06=y*o+x*l+E*f+S*v,e.m07=y*a+x*u+E*m+S*g,y=n.m08,x=n.m09,E=n.m10,S=n.m11,e.m08=y*i+x*s+E*h+S*d,e.m09=y*r+x*c+E*_+S*p,e.m10=y*o+x*l+E*f+S*v,e.m11=y*a+x*u+E*m+S*g,y=n.m12,x=n.m13,E=n.m14,S=n.m15,e.m12=y*i+x*s+E*h+S*d,e.m13=y*r+x*c+E*_+S*p,e.m14=y*o+x*l+E*f+S*v,e.m15=y*a+x*u+E*m+S*g,e},t.transform=function(e,t,n){var i=n.x,r=n.y,o=n.z;if(t===e)e.m12=t.m00*i+t.m04*r+t.m08*o+t.m12,e.m13=t.m01*i+t.m05*r+t.m09*o+t.m13,e.m14=t.m02*i+t.m06*r+t.m10*o+t.m14,e.m15=t.m03*i+t.m07*r+t.m11*o+t.m15;else{var a=t.m00,s=t.m01,c=t.m02,l=t.m03,u=t.m04,h=t.m05,_=t.m06,f=t.m07,m=t.m08,d=t.m09,p=t.m10,v=t.m11;t.m12,t.m13,t.m14,t.m15,e.m00=a,e.m01=s,e.m02=c,e.m03=l,e.m04=u,e.m05=h,e.m06=_,e.m07=f,e.m08=m,e.m09=d,e.m10=p,e.m11=v,e.m12=a*i+u*r+m*o+t.m12,e.m13=s*i+h*r+d*o+t.m13,e.m14=c*i+_*r+p*o+t.m14,e.m15=l*i+f*r+v*o+t.m15}return e},t.translate=function(e,t,n){return console.warn("function changed"),t===e?(e.m12+=n.x,e.m13+=n.y,e.m14+=n.z):(e.m00=t.m00,e.m01=t.m01,e.m02=t.m02,e.m03=t.m03,e.m04=t.m04,e.m05=t.m05,e.m06=t.m06,e.m07=t.m07,e.m08=t.m08,e.m09=t.m09,e.m10=t.m10,e.m11=t.m11,e.m12+=n.x,e.m13+=n.y,e.m14+=n.z,e.m15=t.m15),e},t.scale=function(e,t,n){var i=n.x,r=n.y,o=n.z;return e.m00=t.m00*i,e.m01=t.m01*i,e.m02=t.m02*i,e.m03=t.m03*i,e.m04=t.m04*r,e.m05=t.m05*r,e.m06=t.m06*r,e.m07=t.m07*r,e.m08=t.m08*o,e.m09=t.m09*o,e.m10=t.m10*o,e.m11=t.m11*o,e.m12=t.m12,e.m13=t.m13,e.m14=t.m14,e.m15=t.m15,e},t.rotate=function(e,t,n,i){var r=i.x,o=i.y,a=i.z,s=Math.sqrt(r*r+o*o+a*a);if(Math.abs(s)<mn)return null;r*=s=1/s,o*=s,a*=s;var c=Math.sin(n),l=Math.cos(n),u=1-l,h=t.m00,_=t.m01,f=t.m02,m=t.m03,d=t.m04,p=t.m05,v=t.m06,g=t.m07,y=t.m08,x=t.m09,E=t.m10,S=t.m11,T=r*r*u+l,A=o*r*u+a*c,C=a*r*u-o*c,w=r*o*u-a*c,I=o*o*u+l,b=a*o*u+r*c,R=r*a*u+o*c,O=o*a*u-r*c,N=a*a*u+l;return e.m00=h*T+d*A+y*C,e.m01=_*T+p*A+x*C,e.m02=f*T+v*A+E*C,e.m03=m*T+g*A+S*C,e.m04=h*w+d*I+y*b,e.m05=_*w+p*I+x*b,e.m06=f*w+v*I+E*b,e.m07=m*w+g*I+S*b,e.m08=h*R+d*O+y*N,e.m09=_*R+p*O+x*N,e.m10=f*R+v*O+E*N,e.m11=m*R+g*O+S*N,t!==e&&(e.m12=t.m12,e.m13=t.m13,e.m14=t.m14,e.m15=t.m15),e},t.rotateX=function(e,t,n){var i=Math.sin(n),r=Math.cos(n),o=t.m04,a=t.m05,s=t.m06,c=t.m07,l=t.m08,u=t.m09,h=t.m10,_=t.m11;return t!==e&&(e.m00=t.m00,e.m01=t.m01,e.m02=t.m02,e.m03=t.m03,e.m12=t.m12,e.m13=t.m13,e.m14=t.m14,e.m15=t.m15),e.m04=o*r+l*i,e.m05=a*r+u*i,e.m06=s*r+h*i,e.m07=c*r+_*i,e.m08=l*r-o*i,e.m09=u*r-a*i,e.m10=h*r-s*i,e.m11=_*r-c*i,e},t.rotateY=function(e,t,n){var i=Math.sin(n),r=Math.cos(n),o=t.m00,a=t.m01,s=t.m02,c=t.m03,l=t.m08,u=t.m09,h=t.m10,_=t.m11;return t!==e&&(e.m04=t.m04,e.m05=t.m05,e.m06=t.m06,e.m07=t.m07,e.m12=t.m12,e.m13=t.m13,e.m14=t.m14,e.m15=t.m15),e.m00=o*r-l*i,e.m01=a*r-u*i,e.m02=s*r-h*i,e.m03=c*r-_*i,e.m08=o*i+l*r,e.m09=a*i+u*r,e.m10=s*i+h*r,e.m11=c*i+_*r,e},t.rotateZ=function(e,t,n){var i=Math.sin(n),r=Math.cos(n),o=t.m00,a=t.m01,s=t.m02,c=t.m03,l=t.m04,u=t.m05,h=t.m06,_=t.m07;return t!==e&&(e.m08=t.m08,e.m09=t.m09,e.m10=t.m10,e.m11=t.m11,e.m12=t.m12,e.m13=t.m13,e.m14=t.m14,e.m15=t.m15),e.m00=o*r+l*i,e.m01=a*r+u*i,e.m02=s*r+h*i,e.m03=c*r+_*i,e.m04=l*r-o*i,e.m05=u*r-a*i,e.m06=h*r-s*i,e.m07=_*r-c*i,e},t.fromTranslation=function(e,t){return e.m00=1,e.m01=0,e.m02=0,e.m03=0,e.m04=0,e.m05=1,e.m06=0,e.m07=0,e.m08=0,e.m09=0,e.m10=1,e.m11=0,e.m12=t.x,e.m13=t.y,e.m14=t.z,e.m15=1,e},t.fromScaling=function(e,t){return e.m00=t.x,e.m01=0,e.m02=0,e.m03=0,e.m04=0,e.m05=t.y,e.m06=0,e.m07=0,e.m08=0,e.m09=0,e.m10=t.z,e.m11=0,e.m12=0,e.m13=0,e.m14=0,e.m15=1,e},t.fromRotation=function(e,t,n){var i=n.x,r=n.y,o=n.z,a=Math.sqrt(i*i+r*r+o*o);if(Math.abs(a)<mn)return null;i*=a=1/a,r*=a,o*=a;var s=Math.sin(t),c=Math.cos(t),l=1-c;return e.m00=i*i*l+c,e.m01=r*i*l+o*s,e.m02=o*i*l-r*s,e.m03=0,e.m04=i*r*l-o*s,e.m05=r*r*l+c,e.m06=o*r*l+i*s,e.m07=0,e.m08=i*o*l+r*s,e.m09=r*o*l-i*s,e.m10=o*o*l+c,e.m11=0,e.m12=0,e.m13=0,e.m14=0,e.m15=1,e},t.fromXRotation=function(e,t){var n=Math.sin(t),i=Math.cos(t);return e.m00=1,e.m01=0,e.m02=0,e.m03=0,e.m04=0,e.m05=i,e.m06=n,e.m07=0,e.m08=0,e.m09=-n,e.m10=i,e.m11=0,e.m12=0,e.m13=0,e.m14=0,e.m15=1,e},t.fromYRotation=function(e,t){var n=Math.sin(t),i=Math.cos(t);return e.m00=i,e.m01=0,e.m02=-n,e.m03=0,e.m04=0,e.m05=1,e.m06=0,e.m07=0,e.m08=n,e.m09=0,e.m10=i,e.m11=0,e.m12=0,e.m13=0,e.m14=0,e.m15=1,e},t.fromZRotation=function(e,t){var n=Math.sin(t),i=Math.cos(t);return e.m00=i,e.m01=n,e.m02=0,e.m03=0,e.m04=-n,e.m05=i,e.m06=0,e.m07=0,e.m08=0,e.m09=0,e.m10=1,e.m11=0,e.m12=0,e.m13=0,e.m14=0,e.m15=1,e},t.fromRT=function(e,t,n){var i=t.x,r=t.y,o=t.z,a=t.w,s=i+i,c=r+r,l=o+o,u=i*s,h=i*c,_=i*l,f=r*c,m=r*l,d=o*l,p=a*s,v=a*c,g=a*l;return e.m00=1-(f+d),e.m01=h+g,e.m02=_-v,e.m03=0,e.m04=h-g,e.m05=1-(u+d),e.m06=m+p,e.m07=0,e.m08=_+v,e.m09=m-p,e.m10=1-(u+f),e.m11=0,e.m12=n.x,e.m13=n.y,e.m14=n.z,e.m15=1,e},t.getTranslation=function(e,t){return e.x=t.m12,e.y=t.m13,e.z=t.m14,e},t.getScaling=function(e,t){var n=$n.m00=t.m00,i=$n.m01=t.m01,r=$n.m02=t.m02,o=$n.m03=t.m04,a=$n.m04=t.m05,s=$n.m05=t.m06,c=$n.m06=t.m08,l=$n.m07=t.m09,u=$n.m08=t.m10;return e.x=Math.sqrt(n*n+i*i+r*r),e.y=Math.sqrt(o*o+a*a+s*s),e.z=Math.sqrt(c*c+l*l+u*u),Gn.determinant($n)<0&&(e.x*=-1),e},t.getRotation=function(e,t){var n=t.m00+t.m05+t.m10,i=0;return n>0?(i=2*Math.sqrt(n+1),e.w=.25*i,e.x=(t.m06-t.m09)/i,e.y=(t.m08-t.m02)/i,e.z=(t.m01-t.m04)/i):t.m00>t.m05&&t.m00>t.m10?(i=2*Math.sqrt(1+t.m00-t.m05-t.m10),e.w=(t.m06-t.m09)/i,e.x=.25*i,e.y=(t.m01+t.m04)/i,e.z=(t.m08+t.m02)/i):t.m05>t.m10?(i=2*Math.sqrt(1+t.m05-t.m00-t.m10),e.w=(t.m08-t.m02)/i,e.x=(t.m01+t.m04)/i,e.y=.25*i,e.z=(t.m06+t.m09)/i):(i=2*Math.sqrt(1+t.m10-t.m00-t.m05),e.w=(t.m01-t.m04)/i,e.x=(t.m08+t.m02)/i,e.y=(t.m06+t.m09)/i,e.z=.25*i),e},t.toRTS=function(e,t,n,i){i.x=Fn.set(Jn,e.m00,e.m01,e.m02).length(),$n.m00=e.m00/i.x,$n.m01=e.m01/i.x,$n.m02=e.m02/i.x,i.y=Fn.set(Jn,e.m04,e.m05,e.m06).length(),$n.m03=e.m04/i.y,$n.m04=e.m05/i.y,$n.m05=e.m06/i.y,i.z=Fn.set(Jn,e.m08,e.m09,e.m10).length(),$n.m06=e.m08/i.z,$n.m07=e.m09/i.z,$n.m08=e.m10/i.z,Gn.determinant($n)<0&&(i.x*=-1,$n.m00*=-1,$n.m01*=-1,$n.m02*=-1),Vn.fromMat3(t,$n),Fn.set(n,e.m12,e.m13,e.m14)},t.fromRTS=function(e,t,n,i){var r=t.x,o=t.y,a=t.z,s=t.w,c=r+r,l=o+o,u=a+a,h=r*c,_=r*l,f=r*u,m=o*l,d=o*u,p=a*u,v=s*c,g=s*l,y=s*u,x=i.x,E=i.y,S=i.z;return e.m00=(1-(m+p))*x,e.m01=(_+y)*x,e.m02=(f-g)*x,e.m03=0,e.m04=(_-y)*E,e.m05=(1-(h+p))*E,e.m06=(d+v)*E,e.m07=0,e.m08=(f+g)*S,e.m09=(d-v)*S,e.m10=(1-(h+m))*S,e.m11=0,e.m12=n.x,e.m13=n.y,e.m14=n.z,e.m15=1,e},t.fromRTSOrigin=function(e,t,n,i,r){var o=t.x,a=t.y,s=t.z,c=t.w,l=o+o,u=a+a,h=s+s,_=o*l,f=o*u,m=o*h,d=a*u,p=a*h,v=s*h,g=c*l,y=c*u,x=c*h,E=i.x,S=i.y,T=i.z,A=r.x,C=r.y,w=r.z;return e.m00=(1-(d+v))*E,e.m01=(f+x)*E,e.m02=(m-y)*E,e.m03=0,e.m04=(f-x)*S,e.m05=(1-(_+v))*S,e.m06=(p+g)*S,e.m07=0,e.m08=(m+y)*T,e.m09=(p-g)*T,e.m10=(1-(_+d))*T,e.m11=0,e.m12=n.x+A-(e.m00*A+e.m04*C+e.m08*w),e.m13=n.y+C-(e.m01*A+e.m05*C+e.m09*w),e.m14=n.z+w-(e.m02*A+e.m06*C+e.m10*w),e.m15=1,e},t.fromQuat=function(e,t){var n=t.x,i=t.y,r=t.z,o=t.w,a=n+n,s=i+i,c=r+r,l=n*a,u=i*a,h=i*s,_=r*a,f=r*s,m=r*c,d=o*a,p=o*s,v=o*c;return e.m00=1-h-m,e.m01=u+v,e.m02=_-p,e.m03=0,e.m04=u-v,e.m05=1-l-m,e.m06=f+d,e.m07=0,e.m08=_+p,e.m09=f-d,e.m10=1-l-h,e.m11=0,e.m12=0,e.m13=0,e.m14=0,e.m15=1,e},t.frustum=function(e,t,n,i,r,o,a){var s=1/(n-t),c=1/(r-i),l=1/(o-a);return e.m00=2*o*s,e.m01=0,e.m02=0,e.m03=0,e.m04=0,e.m05=2*o*c,e.m06=0,e.m07=0,e.m08=(n+t)*s,e.m09=(r+i)*c,e.m10=(a+o)*l,e.m11=-1,e.m12=0,e.m13=0,e.m14=a*o*2*l,e.m15=0,e},t.perspective=function(e,t,n,i,r,o,a,s,c){void 0===o&&(o=!0),void 0===a&&(a=-1),void 0===s&&(s=1),void 0===c&&(c=0);var l=1/Math.tan(t/2),u=1/(i-r),h=o?l/n:l,_=(o?l:l*n)*s,f=Qn[c];return e.m00=h*f[0],e.m01=h*f[1],e.m02=0,e.m03=0,e.m04=_*f[2],e.m05=_*f[3],e.m06=0,e.m07=0,e.m08=0,e.m09=0,e.m10=(r-a*i)*u,e.m11=-1,e.m12=0,e.m13=0,e.m14=r*i*u*(1-a),e.m15=0,e},t.ortho=function(e,t,n,i,r,o,a,s,c,l){void 0===s&&(s=-1),void 0===c&&(c=1),void 0===l&&(l=0);var u=1/(t-n),h=1/(i-r)*c,_=1/(o-a),f=-2*u,m=-2*h,d=(t+n)*u,p=(r+i)*h,v=Qn[l];return e.m00=f*v[0],e.m01=f*v[1],e.m02=0,e.m03=0,e.m04=m*v[2],e.m05=m*v[3],e.m06=0,e.m07=0,e.m08=0,e.m09=0,e.m10=_*(1-s),e.m11=0,e.m12=d*v[0]+p*v[2],e.m13=d*v[1]+p*v[3],e.m14=(o-s*a)*_,e.m15=1,e},t.lookAt=function(e,t,n,i){var r=t.x,o=t.y,a=t.z,s=i.x,c=i.y,l=i.z,u=r-n.x,h=o-n.y,_=a-n.z,f=1/Math.sqrt(u*u+h*h+_*_),m=c*(_*=f)-l*(h*=f),d=l*(u*=f)-s*_,p=s*h-c*u,v=h*(p*=f=1/Math.sqrt(m*m+d*d+p*p))-_*(d*=f),g=_*(m*=f)-u*p,y=u*d-h*m;return e.m00=m,e.m01=v,e.m02=u,e.m03=0,e.m04=d,e.m05=g,e.m06=h,e.m07=0,e.m08=p,e.m09=y,e.m10=_,e.m11=0,e.m12=-(m*r+d*o+p*a),e.m13=-(v*r+g*o+y*a),e.m14=-(u*r+h*o+_*a),e.m15=1,e},t.inverseTranspose=function(e,t){var n=t.m00,i=t.m01,r=t.m02,o=t.m03,a=t.m04,s=t.m05,c=t.m06,l=t.m07,u=t.m08,h=t.m09,_=t.m10,f=t.m11,m=t.m12,d=t.m13,p=t.m14,v=t.m15,g=n*s-i*a,y=n*c-r*a,x=n*l-o*a,E=i*c-r*s,S=i*l-o*s,T=r*l-o*c,A=u*d-h*m,C=u*p-_*m,w=u*v-f*m,I=h*p-_*d,b=h*v-f*d,R=_*v-f*p,O=g*R-y*b+x*I+E*w-S*C+T*A;return O?(O=1/O,e.m00=(s*R-c*b+l*I)*O,e.m01=(c*w-a*R-l*C)*O,e.m02=(a*b-s*w+l*A)*O,e.m03=0,e.m04=(r*b-i*R-o*I)*O,e.m05=(n*R-r*w+o*C)*O,e.m06=(i*w-n*b-o*A)*O,e.m07=0,e.m08=(d*T-p*S+v*E)*O,e.m09=(p*x-m*T-v*y)*O,e.m10=(m*S-d*x+v*g)*O,e.m11=0,e.m12=0,e.m13=0,e.m14=0,e.m15=1,e):null},t.toArray=function(e,t,n){return void 0===n&&(n=0),e[n+0]=t.m00,e[n+1]=t.m01,e[n+2]=t.m02,e[n+3]=t.m03,e[n+4]=t.m04,e[n+5]=t.m05,e[n+6]=t.m06,e[n+7]=t.m07,e[n+8]=t.m08,e[n+9]=t.m09,e[n+10]=t.m10,e[n+11]=t.m11,e[n+12]=t.m12,e[n+13]=t.m13,e[n+14]=t.m14,e[n+15]=t.m15,e},t.fromArray=function(e,t,n){return void 0===n&&(n=0),e.m00=t[n+0],e.m01=t[n+1],e.m02=t[n+2],e.m03=t[n+3],e.m04=t[n+4],e.m05=t[n+5],e.m06=t[n+6],e.m07=t[n+7],e.m08=t[n+8],e.m09=t[n+9],e.m10=t[n+10],e.m11=t[n+11],e.m12=t[n+12],e.m13=t[n+13],e.m14=t[n+14],e.m15=t[n+15],e},t.add=function(e,t,n){return e.m00=t.m00+n.m00,e.m01=t.m01+n.m01,e.m02=t.m02+n.m02,e.m03=t.m03+n.m03,e.m04=t.m04+n.m04,e.m05=t.m05+n.m05,e.m06=t.m06+n.m06,e.m07=t.m07+n.m07,e.m08=t.m08+n.m08,e.m09=t.m09+n.m09,e.m10=t.m10+n.m10,e.m11=t.m11+n.m11,e.m12=t.m12+n.m12,e.m13=t.m13+n.m13,e.m14=t.m14+n.m14,e.m15=t.m15+n.m15,e},t.subtract=function(e,t,n){return e.m00=t.m00-n.m00,e.m01=t.m01-n.m01,e.m02=t.m02-n.m02,e.m03=t.m03-n.m03,e.m04=t.m04-n.m04,e.m05=t.m05-n.m05,e.m06=t.m06-n.m06,e.m07=t.m07-n.m07,e.m08=t.m08-n.m08,e.m09=t.m09-n.m09,e.m10=t.m10-n.m10,e.m11=t.m11-n.m11,e.m12=t.m12-n.m12,e.m13=t.m13-n.m13,e.m14=t.m14-n.m14,e.m15=t.m15-n.m15,e},t.multiplyScalar=function(e,t,n){return e.m00=t.m00*n,e.m01=t.m01*n,e.m02=t.m02*n,e.m03=t.m03*n,e.m04=t.m04*n,e.m05=t.m05*n,e.m06=t.m06*n,e.m07=t.m07*n,e.m08=t.m08*n,e.m09=t.m09*n,e.m10=t.m10*n,e.m11=t.m11*n,e.m12=t.m12*n,e.m13=t.m13*n,e.m14=t.m14*n,e.m15=t.m15*n,e},t.multiplyScalarAndAdd=function(e,t,n,i){return e.m00=t.m00+n.m00*i,e.m01=t.m01+n.m01*i,e.m02=t.m02+n.m02*i,e.m03=t.m03+n.m03*i,e.m04=t.m04+n.m04*i,e.m05=t.m05+n.m05*i,e.m06=t.m06+n.m06*i,e.m07=t.m07+n.m07*i,e.m08=t.m08+n.m08*i,e.m09=t.m09+n.m09*i,e.m10=t.m10+n.m10*i,e.m11=t.m11+n.m11*i,e.m12=t.m12+n.m12*i,e.m13=t.m13+n.m13*i,e.m14=t.m14+n.m14*i,e.m15=t.m15+n.m15*i,e},t.strictEquals=function(e,t){return e.m00===t.m00&&e.m01===t.m01&&e.m02===t.m02&&e.m03===t.m03&&e.m04===t.m04&&e.m05===t.m05&&e.m06===t.m06&&e.m07===t.m07&&e.m08===t.m08&&e.m09===t.m09&&e.m10===t.m10&&e.m11===t.m11&&e.m12===t.m12&&e.m13===t.m13&&e.m14===t.m14&&e.m15===t.m15},t.equals=function(e,t,n){return void 0===n&&(n=mn),Math.abs(e.m00-t.m00)<=n*Math.max(1,Math.abs(e.m00),Math.abs(t.m00))&&Math.abs(e.m01-t.m01)<=n*Math.max(1,Math.abs(e.m01),Math.abs(t.m01))&&Math.abs(e.m02-t.m02)<=n*Math.max(1,Math.abs(e.m02),Math.abs(t.m02))&&Math.abs(e.m03-t.m03)<=n*Math.max(1,Math.abs(e.m03),Math.abs(t.m03))&&Math.abs(e.m04-t.m04)<=n*Math.max(1,Math.abs(e.m04),Math.abs(t.m04))&&Math.abs(e.m05-t.m05)<=n*Math.max(1,Math.abs(e.m05),Math.abs(t.m05))&&Math.abs(e.m06-t.m06)<=n*Math.max(1,Math.abs(e.m06),Math.abs(t.m06))&&Math.abs(e.m07-t.m07)<=n*Math.max(1,Math.abs(e.m07),Math.abs(t.m07))&&Math.abs(e.m08-t.m08)<=n*Math.max(1,Math.abs(e.m08),Math.abs(t.m08))&&Math.abs(e.m09-t.m09)<=n*Math.max(1,Math.abs(e.m09),Math.abs(t.m09))&&Math.abs(e.m10-t.m10)<=n*Math.max(1,Math.abs(e.m10),Math.abs(t.m10))&&Math.abs(e.m11-t.m11)<=n*Math.max(1,Math.abs(e.m11),Math.abs(t.m11))&&Math.abs(e.m12-t.m12)<=n*Math.max(1,Math.abs(e.m12),Math.abs(t.m12))&&Math.abs(e.m13-t.m13)<=n*Math.max(1,Math.abs(e.m13),Math.abs(t.m13))&&Math.abs(e.m14-t.m14)<=n*Math.max(1,Math.abs(e.m14),Math.abs(t.m14))&&Math.abs(e.m15-t.m15)<=n*Math.max(1,Math.abs(e.m15),Math.abs(t.m15))};var n=t.prototype;return n.clone=function(){return new t(this.m00,this.m01,this.m02,this.m03,this.m04,this.m05,this.m06,this.m07,this.m08,this.m09,this.m10,this.m11,this.m12,this.m13,this.m14,this.m15)},n.set=function(e,t,n,i,r,o,a,s,c,l,u,h,_,f,m,d){return void 0===e&&(e=1),void 0===t&&(t=0),void 0===n&&(n=0),void 0===i&&(i=0),void 0===r&&(r=0),void 0===o&&(o=1),void 0===a&&(a=0),void 0===s&&(s=0),void 0===c&&(c=0),void 0===l&&(l=0),void 0===u&&(u=1),void 0===h&&(h=0),void 0===_&&(_=0),void 0===f&&(f=0),void 0===m&&(m=0),void 0===d&&(d=1),"object"==typeof e?(this.m01=e.m01,this.m02=e.m02,this.m03=e.m03,this.m04=e.m04,this.m05=e.m05,this.m06=e.m06,this.m07=e.m07,this.m08=e.m08,this.m09=e.m09,this.m10=e.m10,this.m11=e.m11,this.m12=e.m12,this.m13=e.m13,this.m14=e.m14,this.m15=e.m15,this.m00=e.m00):(this.m01=t,this.m02=n,this.m03=i,this.m04=r,this.m05=o,this.m06=a,this.m07=s,this.m08=c,this.m09=l,this.m10=u,this.m11=h,this.m12=_,this.m13=f,this.m14=m,this.m15=d,this.m00=e),this},n.equals=function(e,t){return void 0===t&&(t=mn),Math.abs(this.m00-e.m00)<=t*Math.max(1,Math.abs(this.m00),Math.abs(e.m00))&&Math.abs(this.m01-e.m01)<=t*Math.max(1,Math.abs(this.m01),Math.abs(e.m01))&&Math.abs(this.m02-e.m02)<=t*Math.max(1,Math.abs(this.m02),Math.abs(e.m02))&&Math.abs(this.m03-e.m03)<=t*Math.max(1,Math.abs(this.m03),Math.abs(e.m03))&&Math.abs(this.m04-e.m04)<=t*Math.max(1,Math.abs(this.m04),Math.abs(e.m04))&&Math.abs(this.m05-e.m05)<=t*Math.max(1,Math.abs(this.m05),Math.abs(e.m05))&&Math.abs(this.m06-e.m06)<=t*Math.max(1,Math.abs(this.m06),Math.abs(e.m06))&&Math.abs(this.m07-e.m07)<=t*Math.max(1,Math.abs(this.m07),Math.abs(e.m07))&&Math.abs(this.m08-e.m08)<=t*Math.max(1,Math.abs(this.m08),Math.abs(e.m08))&&Math.abs(this.m09-e.m09)<=t*Math.max(1,Math.abs(this.m09),Math.abs(e.m09))&&Math.abs(this.m10-e.m10)<=t*Math.max(1,Math.abs(this.m10),Math.abs(e.m10))&&Math.abs(this.m11-e.m11)<=t*Math.max(1,Math.abs(this.m11),Math.abs(e.m11))&&Math.abs(this.m12-e.m12)<=t*Math.max(1,Math.abs(this.m12),Math.abs(e.m12))&&Math.abs(this.m13-e.m13)<=t*Math.max(1,Math.abs(this.m13),Math.abs(e.m13))&&Math.abs(this.m14-e.m14)<=t*Math.max(1,Math.abs(this.m14),Math.abs(e.m14))&&Math.abs(this.m15-e.m15)<=t*Math.max(1,Math.abs(this.m15),Math.abs(e.m15))},n.strictEquals=function(e){return this.m00===e.m00&&this.m01===e.m01&&this.m02===e.m02&&this.m03===e.m03&&this.m04===e.m04&&this.m05===e.m05&&this.m06===e.m06&&this.m07===e.m07&&this.m08===e.m08&&this.m09===e.m09&&this.m10===e.m10&&this.m11===e.m11&&this.m12===e.m12&&this.m13===e.m13&&this.m14===e.m14&&this.m15===e.m15},n.toString=function(){return"[\n"+this.m00+", "+this.m01+", "+this.m02+", "+this.m03+",\n"+this.m04+", "+this.m05+", "+this.m06+", "+this.m07+",\n"+this.m08+", "+this.m09+", "+this.m10+", "+this.m11+",\n"+this.m12+", "+this.m13+", "+this.m14+", "+this.m15+"\n]"},n.identity=function(){return this.m00=1,this.m01=0,this.m02=0,this.m03=0,this.m04=0,this.m05=1,this.m06=0,this.m07=0,this.m08=0,this.m09=0,this.m10=1,this.m11=0,this.m12=0,this.m13=0,this.m14=0,this.m15=1,this},n.zero=function(){return this.m00=0,this.m01=0,this.m02=0,this.m03=0,this.m04=0,this.m05=0,this.m06=0,this.m07=0,this.m08=0,this.m09=0,this.m10=0,this.m11=0,this.m12=0,this.m13=0,this.m14=0,this.m15=0,this},n.transpose=function(){var e=this.m01,t=this.m02,n=this.m03,i=this.m06,r=this.m07,o=this.m11;return this.m01=this.m04,this.m02=this.m08,this.m03=this.m12,this.m04=e,this.m06=this.m09,this.m07=this.m13,this.m08=t,this.m09=i,this.m11=this.m14,this.m12=n,this.m13=r,this.m14=o,this},n.invert=function(){var e=this.m00,t=this.m01,n=this.m02,i=this.m03,r=this.m04,o=this.m05,a=this.m06,s=this.m07,c=this.m08,l=this.m09,u=this.m10,h=this.m11,_=this.m12,f=this.m13,m=this.m14,d=this.m15,p=e*o-t*r,v=e*a-n*r,g=e*s-i*r,y=t*a-n*o,x=t*s-i*o,E=n*s-i*a,S=c*f-l*_,T=c*m-u*_,A=c*d-h*_,C=l*m-u*f,w=l*d-h*f,I=u*d-h*m,b=p*I-v*w+g*C+y*A-x*T+E*S;return 0===b?(this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0),this):(b=1/b,this.m00=(o*I-a*w+s*C)*b,this.m01=(n*w-t*I-i*C)*b,this.m02=(f*E-m*x+d*y)*b,this.m03=(u*x-l*E-h*y)*b,this.m04=(a*A-r*I-s*T)*b,this.m05=(e*I-n*A+i*T)*b,this.m06=(m*g-_*E-d*v)*b,this.m07=(c*E-u*g+h*v)*b,this.m08=(r*w-o*A+s*S)*b,this.m09=(t*A-e*w-i*S)*b,this.m10=(_*x-f*g+d*p)*b,this.m11=(l*g-c*x-h*p)*b,this.m12=(o*T-r*C-a*S)*b,this.m13=(e*C-t*T+n*S)*b,this.m14=(f*v-_*y-m*p)*b,this.m15=(c*y-l*v+u*p)*b,this)},n.determinant=function(){var e=this.m00,t=this.m01,n=this.m02,i=this.m03,r=this.m04,o=this.m05,a=this.m06,s=this.m07,c=this.m08,l=this.m09,u=this.m10,h=this.m11,_=this.m12,f=this.m13,m=this.m14,d=this.m15;return(e*o-t*r)*(u*d-h*m)-(e*a-n*r)*(l*d-h*f)+(e*s-i*r)*(l*m-u*f)+(t*a-n*o)*(c*d-h*_)-(t*s-i*o)*(c*m-u*_)+(n*s-i*a)*(c*f-l*_)},n.add=function(e){return this.m00+=e.m00,this.m01+=e.m01,this.m02+=e.m02,this.m03+=e.m03,this.m04+=e.m04,this.m05+=e.m05,this.m06+=e.m06,this.m07+=e.m07,this.m08+=e.m08,this.m09+=e.m09,this.m10+=e.m10,this.m11+=e.m11,this.m12+=e.m12,this.m13+=e.m13,this.m14+=e.m14,this.m15+=e.m15,this},n.subtract=function(e){return this.m00-=e.m00,this.m01-=e.m01,this.m02-=e.m02,this.m03-=e.m03,this.m04-=e.m04,this.m05-=e.m05,this.m06-=e.m06,this.m07-=e.m07,this.m08-=e.m08,this.m09-=e.m09,this.m10-=e.m10,this.m11-=e.m11,this.m12-=e.m12,this.m13-=e.m13,this.m14-=e.m14,this.m15-=e.m15,this},n.multiply=function(e){var t=this.m00,n=this.m01,i=this.m02,r=this.m03,o=this.m04,a=this.m05,s=this.m06,c=this.m07,l=this.m08,u=this.m09,h=this.m10,_=this.m11,f=this.m12,m=this.m13,d=this.m14,p=this.m15,v=e.m00,g=e.m01,y=e.m02,x=e.m03;return this.m00=v*t+g*o+y*l+x*f,this.m01=v*n+g*a+y*u+x*m,this.m02=v*i+g*s+y*h+x*d,this.m03=v*r+g*c+y*_+x*p,v=e.m04,g=e.m05,y=e.m06,x=e.m07,this.m04=v*t+g*o+y*l+x*f,this.m05=v*n+g*a+y*u+x*m,this.m06=v*i+g*s+y*h+x*d,this.m07=v*r+g*c+y*_+x*p,v=e.m08,g=e.m09,y=e.m10,x=e.m11,this.m08=v*t+g*o+y*l+x*f,this.m09=v*n+g*a+y*u+x*m,this.m10=v*i+g*s+y*h+x*d,this.m11=v*r+g*c+y*_+x*p,v=e.m12,g=e.m13,y=e.m14,x=e.m15,this.m12=v*t+g*o+y*l+x*f,this.m13=v*n+g*a+y*u+x*m,this.m14=v*i+g*s+y*h+x*d,this.m15=v*r+g*c+y*_+x*p,this},n.multiplyScalar=function(e){return this.m00*=e,this.m01*=e,this.m02*=e,this.m03*=e,this.m04*=e,this.m05*=e,this.m06*=e,this.m07*=e,this.m08*=e,this.m09*=e,this.m10*=e,this.m11*=e,this.m12*=e,this.m13*=e,this.m14*=e,this.m15*=e,this},n.translate=function(e){return console.warn("function changed"),this.m12+=e.x,this.m13+=e.y,this.m14+=e.z,this},n.scale=function(e){var t=e.x,n=e.y,i=e.z;return this.m00*=t,this.m01*=t,this.m02*=t,this.m03*=t,this.m04*=n,this.m05*=n,this.m06*=n,this.m07*=n,this.m08*=i,this.m09*=i,this.m10*=i,this.m11*=i,this},n.rotate=function(e,t){var n=t.x,i=t.y,r=t.z,o=Math.sqrt(n*n+i*i+r*r);if(Math.abs(o)<mn)return null;n*=o=1/o,i*=o,r*=o;var a=Math.sin(e),s=Math.cos(e),c=1-s,l=this.m00,u=this.m01,h=this.m02,_=this.m03,f=this.m04,m=this.m05,d=this.m06,p=this.m07,v=this.m08,g=this.m09,y=this.m10,x=this.m11,E=n*n*c+s,S=i*n*c+r*a,T=r*n*c-i*a,A=n*i*c-r*a,C=i*i*c+s,w=r*i*c+n*a,I=n*r*c+i*a,b=i*r*c-n*a,R=r*r*c+s;return this.m00=l*E+f*S+v*T,this.m01=u*E+m*S+g*T,this.m02=h*E+d*S+y*T,this.m03=_*E+p*S+x*T,this.m04=l*A+f*C+v*w,this.m05=u*A+m*C+g*w,this.m06=h*A+d*C+y*w,this.m07=_*A+p*C+x*w,this.m08=l*I+f*b+v*R,this.m09=u*I+m*b+g*R,this.m10=h*I+d*b+y*R,this.m11=_*I+p*b+x*R,this},n.getTranslation=function(e){return e.x=this.m12,e.y=this.m13,e.z=this.m14,e},n.getScale=function(e){var t=$n.m00=this.m00,n=$n.m01=this.m01,i=$n.m02=this.m02,r=$n.m03=this.m04,o=$n.m04=this.m05,a=$n.m05=this.m06,s=$n.m06=this.m08,c=$n.m07=this.m09,l=$n.m08=this.m10;return e.x=Math.sqrt(t*t+n*n+i*i),e.y=Math.sqrt(r*r+o*o+a*a),e.z=Math.sqrt(s*s+c*c+l*l),Gn.determinant($n)<0&&(e.x*=-1),e},n.getRotation=function(e){var t=this.m00+this.m05+this.m10,n=0;return t>0?(n=2*Math.sqrt(t+1),e.w=.25*n,e.x=(this.m06-this.m09)/n,e.y=(this.m08-this.m02)/n,e.z=(this.m01-this.m04)/n):this.m00>this.m05&&this.m00>this.m10?(n=2*Math.sqrt(1+this.m00-this.m05-this.m10),e.w=(this.m06-this.m09)/n,e.x=.25*n,e.y=(this.m01+this.m04)/n,e.z=(this.m08+this.m02)/n):this.m05>this.m10?(n=2*Math.sqrt(1+this.m05-this.m00-this.m10),e.w=(this.m08-this.m02)/n,e.x=(this.m01+this.m04)/n,e.y=.25*n,e.z=(this.m06+this.m09)/n):(n=2*Math.sqrt(1+this.m10-this.m00-this.m05),e.w=(this.m01-this.m04)/n,e.x=(this.m08+this.m02)/n,e.y=(this.m06+this.m09)/n,e.z=.25*n),e},n.fromRTS=function(e,t,n){var i=e.x,r=e.y,o=e.z,a=e.w,s=i+i,c=r+r,l=o+o,u=i*s,h=i*c,_=i*l,f=r*c,m=r*l,d=o*l,p=a*s,v=a*c,g=a*l,y=n.x,x=n.y,E=n.z;return this.m00=(1-(f+d))*y,this.m01=(h+g)*y,this.m02=(_-v)*y,this.m03=0,this.m04=(h-g)*x,this.m05=(1-(u+d))*x,this.m06=(m+p)*x,this.m07=0,this.m08=(_+v)*E,this.m09=(m-p)*E,this.m10=(1-(u+f))*E,this.m11=0,this.m12=t.x,this.m13=t.y,this.m14=t.z,this.m15=1,this},n.fromQuat=function(e){var t=e.x,n=e.y,i=e.z,r=e.w,o=t+t,a=n+n,s=i+i,c=t*o,l=n*o,u=n*a,h=i*o,_=i*a,f=i*s,m=r*o,d=r*a,p=r*s;return this.m00=1-u-f,this.m01=l+p,this.m02=h-d,this.m03=0,this.m04=l-p,this.m05=1-c-f,this.m06=_+m,this.m07=0,this.m08=h+d,this.m09=_-m,this.m10=1-c-u,this.m11=0,this.m12=0,this.m13=0,this.m14=0,this.m15=1,this},t}(Et));Zn.IDENTITY=Object.freeze(new Zn);var Jn=new Fn,$n=new Gn;function ei(e,t,n,i,r,o,a,s,c,l,u,h,_,f,m,d){return new Zn(e,t,n,i,r,o,a,s,c,l,u,h,_,f,m,d)}ln.fastDefine("cc.Mat4",Zn,{m00:1,m01:0,m02:0,m03:0,m04:0,m05:1,m06:0,m07:0,m08:0,m09:0,m10:1,m11:0,m12:0,m13:0,m14:0,m15:1}),c.Mat4=Zn,c.mat4=ei;var ti=e("bO",function(e){function t(t,n){var i;return i=e.call(this)||this,t&&"object"==typeof t?(i.x=t.x,i.y=t.y):(i.x=t||0,i.y=n||0),i}$(t,e),t.clone=function(e){return new t(e.x,e.y)},t.copy=function(e,t){return e.x=t.x,e.y=t.y,e},t.set=function(e,t,n){return e.x=t,e.y=n,e},t.add=function(e,t,n){return e.x=t.x+n.x,e.y=t.y+n.y,e},t.subtract=function(e,t,n){return e.x=t.x-n.x,e.y=t.y-n.y,e},t.multiply=function(e,t,n){return e.x=t.x*n.x,e.y=t.y*n.y,e},t.divide=function(e,t,n){return e.x=t.x/n.x,e.y=t.y/n.y,e},t.ceil=function(e,t){return e.x=Math.ceil(t.x),e.y=Math.ceil(t.y),e},t.floor=function(e,t){return e.x=Math.floor(t.x),e.y=Math.floor(t.y),e},t.min=function(e,t,n){return e.x=Math.min(t.x,n.x),e.y=Math.min(t.y,n.y),e},t.max=function(e,t,n){return e.x=Math.max(t.x,n.x),e.y=Math.max(t.y,n.y),e},t.round=function(e,t){return e.x=Math.round(t.x),e.y=Math.round(t.y),e},t.multiplyScalar=function(e,t,n){return e.x=t.x*n,e.y=t.y*n,e},t.scaleAndAdd=function(e,t,n,i){return e.x=t.x+n.x*i,e.y=t.y+n.y*i,e},t.distance=function(e,t){var n=t.x-e.x,i=t.y-e.y;return Math.sqrt(n*n+i*i)},t.squaredDistance=function(e,t){var n=t.x-e.x,i=t.y-e.y;return n*n+i*i},t.len=function(e){var t=e.x,n=e.y;return Math.sqrt(t*t+n*n)},t.lengthSqr=function(e){var t=e.x,n=e.y;return t*t+n*n},t.negate=function(e,t){return e.x=-t.x,e.y=-t.y,e},t.inverse=function(e,t){return e.x=1/t.x,e.y=1/t.y,e},t.inverseSafe=function(e,t){var n=t.x,i=t.y;return Math.abs(n)<mn?e.x=0:e.x=1/n,Math.abs(i)<mn?e.y=0:e.y=1/i,e},t.normalize=function(e,t){var n=t.x,i=t.y,r=n*n+i*i;return r>0&&(r=1/Math.sqrt(r),e.x=n*r,e.y=i*r),e},t.dot=function(e,t){return e.x*t.x+e.y*t.y},t.cross=function(e,t,n){return e.x=e.y=0,e.z=t.x*n.y-t.y*n.x,e},t.lerp=function(e,t,n,i){var r=t.x,o=t.y;return e.x=r+i*(n.x-r),e.y=o+i*(n.y-o),e},t.random=function(e,t){t=t||1;var n=2*Sn()*Math.PI;return e.x=Math.cos(n)*t,e.y=Math.sin(n)*t,e},t.transformMat3=function(e,t,n){var i=t.x,r=t.y;return e.x=n.m00*i+n.m03*r+n.m06,e.y=n.m01*i+n.m04*r+n.m07,e},t.transformMat4=function(e,t,n){var i=t.x,r=t.y;return e.x=n.m00*i+n.m04*r+n.m12,e.y=n.m01*i+n.m05*r+n.m13,e},t.str=function(e){return"Vec2("+e.x+", "+e.y+")"},t.toArray=function(e,t,n){return void 0===n&&(n=0),e[n+0]=t.x,e[n+1]=t.y,e},t.fromArray=function(e,t,n){return void 0===n&&(n=0),e.x=t[n+0],e.y=t[n+1],e},t.strictEquals=function(e,t){return e.x===t.x&&e.y===t.y},t.equals=function(e,t,n){return void 0===n&&(n=mn),Math.abs(e.x-t.x)<=n*Math.max(1,Math.abs(e.x),Math.abs(t.x))&&Math.abs(e.y-t.y)<=n*Math.max(1,Math.abs(e.y),Math.abs(t.y))},t.angle=function(e,n){t.normalize(ni,e),t.normalize(ii,n);var i=t.dot(ni,ii);return i>1?0:i<-1?Math.PI:Math.acos(i)};var n=t.prototype;return n.clone=function(){return new t(this.x,this.y)},n.set=function(e,t){return e&&"object"==typeof e?(this.x=e.x,this.y=e.y):(this.x=e||0,this.y=t||0),this},n.equals=function(e,t){return void 0===t&&(t=mn),Math.abs(this.x-e.x)<=t*Math.max(1,Math.abs(this.x),Math.abs(e.x))&&Math.abs(this.y-e.y)<=t*Math.max(1,Math.abs(this.y),Math.abs(e.y))},n.equals2f=function(e,t,n){return void 0===n&&(n=mn),Math.abs(this.x-e)<=n*Math.max(1,Math.abs(this.x),Math.abs(e))&&Math.abs(this.y-t)<=n*Math.max(1,Math.abs(this.y),Math.abs(t))},n.strictEquals=function(e){return e&&this.x===e.x&&this.y===e.y},n.strictEquals2f=function(e,t){return this.x===e&&this.y===t},n.toString=function(){return"("+this.x.toFixed(2)+", "+this.y.toFixed(2)+")"},n.lerp=function(e,t){var n=this.x,i=this.y;return this.x=n+t*(e.x-n),this.y=i+t*(e.y-i),this},n.clampf=function(e,t){return this.x=vn(this.x,e.x,t.x),this.y=vn(this.y,e.y,t.y),this},n.add=function(e){return this.x+=e.x,this.y+=e.y,this},n.add2f=function(e,t){return this.x+=e,this.y+=t,this},n.subtract=function(e){return this.x-=e.x,this.y-=e.y,this},n.subtract2f=function(e,t){return this.x-=e,this.y-=t,this},n.multiplyScalar=function(e){return"object"==typeof e&&console.warn("should use Vec2.multiply for vector * vector operation"),this.x*=e,this.y*=e,this},n.multiply=function(e){return"object"!=typeof e&&console.warn("should use Vec2.scale for vector * scalar operation"),this.x*=e.x,this.y*=e.y,this},n.multiply2f=function(e,t){return this.x*=e,this.y*=t,this},n.divide=function(e){return this.x/=e.x,this.y/=e.y,this},n.divide2f=function(e,t){return this.x/=e,this.y/=t,this},n.negative=function(){return this.x=-this.x,this.y=-this.y,this},n.dot=function(e){return this.x*e.x+this.y*e.y},n.cross=function(e){return this.x*e.y-this.y*e.x},n.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y)},n.lengthSqr=function(){return this.x*this.x+this.y*this.y},n.normalize=function(){var e=this.x,t=this.y,n=e*e+t*t;return n>0&&(n=1/Math.sqrt(n),this.x*=n,this.y*=n),this},n.angle=function(e){var t=this.lengthSqr(),n=e.lengthSqr();if(0===t||0===n)return console.warn("Can't get angle between zero vector"),0;var i=this.dot(e)/Math.sqrt(t*n);return i=vn(i,-1,1),Math.acos(i)},n.signAngle=function(e){var t=this.angle(e);return this.cross(e)<0?-t:t},n.rotate=function(e){var t=this.x,n=this.y,i=Math.sin(e),r=Math.cos(e);return this.x=r*t-i*n,this.y=i*t+r*n,this},n.project=function(e){var t=this.dot(e)/e.dot(e);return this.x=e.x*t,this.y=e.y*t,this},n.transformMat4=function(e){var t=this.x,n=this.y;return this.x=e.m00*t+e.m04*n+e.m12,this.y=e.m01*t+e.m05*n+e.m13,this},t}(Et));ti.ZERO=Object.freeze(new ti(0,0)),ti.ONE=Object.freeze(new ti(1,1)),ti.NEG_ONE=Object.freeze(new ti(-1,-1)),ti.UNIT_X=Object.freeze(new ti(1,0)),ti.UNIT_Y=Object.freeze(new ti(0,1));var ni=new ti,ii=new ti;function ri(e,t){return new ti(e,t)}ln.fastDefine("cc.Vec2",ti,{x:0,y:0}),c.Vec2=ti,c.v2=ri;var oi=e("b6",function(e){function t(t,n,i,r){var o;return o=e.call(this)||this,t&&"object"==typeof t?(o.x=t.x,o.y=t.y,o.z=t.z,o.w=t.w):(o.x=t||0,o.y=n||0,o.z=i||0,o.w=r||0),o}$(t,e),t.clone=function(e){return new t(e.x,e.y,e.z,e.w)},t.copy=function(e,t){return e.x=t.x,e.y=t.y,e.z=t.z,e.w=t.w,e},t.set=function(e,t,n,i,r){return e.x=t,e.y=n,e.z=i,e.w=r,e},t.add=function(e,t,n){return e.x=t.x+n.x,e.y=t.y+n.y,e.z=t.z+n.z,e.w=t.w+n.w,e},t.subtract=function(e,t,n){return e.x=t.x-n.x,e.y=t.y-n.y,e.z=t.z-n.z,e.w=t.w-n.w,e},t.multiply=function(e,t,n){return e.x=t.x*n.x,e.y=t.y*n.y,e.z=t.z*n.z,e.w=t.w*n.w,e},t.divide=function(e,t,n){return e.x=t.x/n.x,e.y=t.y/n.y,e.z=t.z/n.z,e.w=t.w/n.w,e},t.ceil=function(e,t){return e.x=Math.ceil(t.x),e.y=Math.ceil(t.y),e.z=Math.ceil(t.z),e.w=Math.ceil(t.w),e},t.floor=function(e,t){return e.x=Math.floor(t.x),e.y=Math.floor(t.y),e.z=Math.floor(t.z),e.w=Math.floor(t.w),e},t.min=function(e,t,n){return e.x=Math.min(t.x,n.x),e.y=Math.min(t.y,n.y),e.z=Math.min(t.z,n.z),e.w=Math.min(t.w,n.w),e},t.max=function(e,t,n){return e.x=Math.max(t.x,n.x),e.y=Math.max(t.y,n.y),e.z=Math.max(t.z,n.z),e.w=Math.max(t.w,n.w),e},t.round=function(e,t){return e.x=Math.round(t.x),e.y=Math.round(t.y),e.z=Math.round(t.z),e.w=Math.round(t.w),e},t.multiplyScalar=function(e,t,n){return e.x=t.x*n,e.y=t.y*n,e.z=t.z*n,e.w=t.w*n,e},t.scaleAndAdd=function(e,t,n,i){return e.x=t.x+n.x*i,e.y=t.y+n.y*i,e.z=t.z+n.z*i,e.w=t.w+n.w*i,e},t.distance=function(e,t){var n=t.x-e.x,i=t.y-e.y,r=t.z-e.z,o=t.w-e.w;return Math.sqrt(n*n+i*i+r*r+o*o)},t.squaredDistance=function(e,t){var n=t.x-e.x,i=t.y-e.y,r=t.z-e.z,o=t.w-e.w;return n*n+i*i+r*r+o*o},t.len=function(e){var t=e.x,n=e.y,i=e.z,r=e.w;return Math.sqrt(t*t+n*n+i*i+r*r)},t.lengthSqr=function(e){var t=e.x,n=e.y,i=e.z,r=e.w;return t*t+n*n+i*i+r*r},t.negate=function(e,t){return e.x=-t.x,e.y=-t.y,e.z=-t.z,e.w=-t.w,e},t.inverse=function(e,t){return e.x=1/t.x,e.y=1/t.y,e.z=1/t.z,e.w=1/t.w,e},t.inverseSafe=function(e,t){var n=t.x,i=t.y,r=t.z,o=t.w;return Math.abs(n)<mn?e.x=0:e.x=1/n,Math.abs(i)<mn?e.y=0:e.y=1/i,Math.abs(r)<mn?e.z=0:e.z=1/r,Math.abs(o)<mn?e.w=0:e.w=1/o,e},t.normalize=function(e,t){var n=t.x,i=t.y,r=t.z,o=t.w,a=n*n+i*i+r*r+o*o;return a>0&&(a=1/Math.sqrt(a),e.x=n*a,e.y=i*a,e.z=r*a,e.w=o*a),e},t.dot=function(e,t){return e.x*t.x+e.y*t.y+e.z*t.z+e.w*t.w},t.lerp=function(e,t,n,i){return e.x=t.x+i*(n.x-t.x),e.y=t.y+i*(n.y-t.y),e.z=t.z+i*(n.z-t.z),e.w=t.w+i*(n.w-t.w),e},t.random=function(e,t){t=t||1;var n=2*Sn()*Math.PI,i=2*Sn()-1,r=Math.sqrt(1-i*i);return e.x=r*Math.cos(n)*t,e.y=r*Math.sin(n)*t,e.z=i*t,e.w=0,e},t.transformMat4=function(e,t,n){var i=t.x,r=t.y,o=t.z,a=t.w;return e.x=n.m00*i+n.m04*r+n.m08*o+n.m12*a,e.y=n.m01*i+n.m05*r+n.m09*o+n.m13*a,e.z=n.m02*i+n.m06*r+n.m10*o+n.m14*a,e.w=n.m03*i+n.m07*r+n.m11*o+n.m15*a,e},t.transformAffine=function(e,t,n){var i=t.x,r=t.y,o=t.z,a=t.w;return e.x=n.m00*i+n.m01*r+n.m02*o+n.m03*a,e.y=n.m04*i+n.m05*r+n.m06*o+n.m07*a,e.x=n.m08*i+n.m09*r+n.m10*o+n.m11*a,e.w=t.w,e},t.transformQuat=function(e,t,n){var i=t.x,r=t.y,o=t.z,a=n.x,s=n.y,c=n.z,l=n.w,u=l*i+s*o-c*r,h=l*r+c*i-a*o,_=l*o+a*r-s*i,f=-a*i-s*r-c*o;return e.x=u*l+f*-a+h*-c-_*-s,e.y=h*l+f*-s+_*-a-u*-c,e.z=_*l+f*-c+u*-s-h*-a,e.w=t.w,e},t.toArray=function(e,t,n){return void 0===n&&(n=0),e[n+0]=t.x,e[n+1]=t.y,e[n+2]=t.z,e[n+3]=t.w,e},t.fromArray=function(e,t,n){return void 0===n&&(n=0),e.x=t[n+0],e.y=t[n+1],e.z=t[n+2],e.w=t[n+3],e},t.strictEquals=function(e,t){return e.x===t.x&&e.y===t.y&&e.z===t.z&&e.w===t.w},t.equals=function(e,t,n){return void 0===n&&(n=mn),Math.abs(e.x-t.x)<=n*Math.max(1,Math.abs(e.x),Math.abs(t.x))&&Math.abs(e.y-t.y)<=n*Math.max(1,Math.abs(e.y),Math.abs(t.y))&&Math.abs(e.z-t.z)<=n*Math.max(1,Math.abs(e.z),Math.abs(t.z))&&Math.abs(e.w-t.w)<=n*Math.max(1,Math.abs(e.w),Math.abs(t.w))};var n=t.prototype;return n.clone=function(){return new t(this.x,this.y,this.z,this.w)},n.set=function(e,t,n,i){return e&&"object"==typeof e?(this.x=e.x,this.y=e.y,this.z=e.z,this.w=e.w):(this.x=e||0,this.y=t||0,this.z=n||0,this.w=i||0),this},n.equals=function(e,t){return void 0===t&&(t=mn),Math.abs(this.x-e.x)<=t*Math.max(1,Math.abs(this.x),Math.abs(e.x))&&Math.abs(this.y-e.y)<=t*Math.max(1,Math.abs(this.y),Math.abs(e.y))&&Math.abs(this.z-e.z)<=t*Math.max(1,Math.abs(this.z),Math.abs(e.z))&&Math.abs(this.w-e.w)<=t*Math.max(1,Math.abs(this.w),Math.abs(e.w))},n.equals4f=function(e,t,n,i,r){return void 0===r&&(r=mn),Math.abs(this.x-e)<=r*Math.max(1,Math.abs(this.x),Math.abs(e))&&Math.abs(this.y-t)<=r*Math.max(1,Math.abs(this.y),Math.abs(t))&&Math.abs(this.z-n)<=r*Math.max(1,Math.abs(this.z),Math.abs(n))&&Math.abs(this.w-i)<=r*Math.max(1,Math.abs(this.w),Math.abs(i))},n.strictEquals=function(e){return this.x===e.x&&this.y===e.y&&this.z===e.z&&this.w===e.w},n.strictEquals4f=function(e,t,n,i){return this.x===e&&this.y===t&&this.z===n&&this.w===i},n.lerp=function(e,t){var n=this.x,i=this.y,r=this.z,o=this.w;return this.x=n+t*(e.x-n),this.y=i+t*(e.y-i),this.z=r+t*(e.z-r),this.w=o+t*(e.w-o),this},n.toString=function(){return"("+this.x.toFixed(2)+", "+this.y.toFixed(2)+", "+this.z.toFixed(2)+", "+this.w.toFixed(2)+")"},n.clampf=function(e,t){return this.x=vn(this.x,e.x,t.x),this.y=vn(this.y,e.y,t.y),this.z=vn(this.z,e.z,t.z),this.w=vn(this.w,e.w,t.w),this},n.add=function(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this},n.add4f=function(e,t,n,i){return this.x+=e,this.y+=t,this.z+=n,this.w+=i,this},n.subtract=function(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this.w-=e.w,this},n.subtract4f=function(e,t,n,i){return this.x-=e,this.y-=t,this.z-=n,this.w-=i,this},n.multiplyScalar=function(e){return"object"==typeof e&&console.warn("should use Vec4.multiply for vector * vector operation"),this.x*=e,this.y*=e,this.z*=e,this.w*=e,this},n.multiply=function(e){return"object"!=typeof e&&console.warn("should use Vec4.scale for vector * scalar operation"),this.x*=e.x,this.y*=e.y,this.z*=e.z,this.w*=e.w,this},n.multiply4f=function(e,t,n,i){return this.x*=e,this.y*=t,this.z*=n,this.w*=i,this},n.divide=function(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this.w/=e.w,this},n.divide4f=function(e,t,n,i){return this.x/=e,this.y/=t,this.z/=n,this.w/=i,this},n.negative=function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this},n.dot=function(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w},n.cross=function(e){var t=this.x,n=this.y,i=this.z,r=e.x,o=e.y,a=e.z;return this.x=n*a-i*o,this.y=i*r-t*a,this.z=t*o-n*r,this},n.length=function(){var e=this.x,t=this.y,n=this.z,i=this.w;return Math.sqrt(e*e+t*t+n*n+i*i)},n.lengthSqr=function(){var e=this.x,t=this.y,n=this.z,i=this.w;return e*e+t*t+n*n+i*i},n.normalize=function(){var e=this.x,t=this.y,n=this.z,i=this.w,r=e*e+t*t+n*n+i*i;return r>0&&(r=1/Math.sqrt(r),this.x=e*r,this.y=t*r,this.z=n*r,this.w=i*r),this},n.transformMat4=function(e){var t=this.x,n=this.y,i=this.z,r=this.w;return this.x=e.m00*t+e.m04*n+e.m08*i+e.m12*r,this.y=e.m01*t+e.m05*n+e.m09*i+e.m13*r,this.z=e.m02*t+e.m06*n+e.m10*i+e.m14*r,this.w=e.m03*t+e.m07*n+e.m11*i+e.m15*r,this},t}(Et));function ai(e,t,n,i){return new oi(e,t,n,i)}oi.ZERO=Object.freeze(new oi(0,0,0,0)),oi.ONE=Object.freeze(new oi(1,1,1,1)),oi.NEG_ONE=Object.freeze(new oi(-1,-1,-1,-1)),ln.fastDefine("cc.Vec4",oi,{x:0,y:0,z:0,w:0}),c.Vec4=oi,c.v4=ai,me(ti,"Vec2",[{name:"sub",newName:"subtract",target:ti,targetName:"Vec2"},{name:"mul",newName:"multiply",target:ti,targetName:"Vec2"},{name:"div",newName:"divide",target:ti,targetName:"Vec2"},{name:"dist",newName:"distance",target:ti,targetName:"Vec2"},{name:"sqrDist",newName:"squaredDistance",target:ti,targetName:"Vec2"},{name:"mag",newName:"len",target:ti,targetName:"Vec2"},{name:"sqrMag",newName:"lengthSqr",target:ti,targetName:"Vec2"},{name:"scale",newName:"multiplyScalar",target:ti,targetName:"Vec2"},{name:"exactEquals",newName:"strictEquals",target:ti,targetName:"Vec2"}]),me(ti.prototype,"Vec2",[{name:"mag",newName:"length",target:ti.prototype,targetName:"Vec2"},{name:"magSqr",newName:"lengthSqr",target:ti.prototype,targetName:"Vec2"},{name:"scale",newName:"multiplyScalar",target:ti.prototype,targetName:"Vec2"},{name:"exactEquals",newName:"strictEquals",target:ti.prototype,targetName:"Vec2"}]),me(Fn,"Vec3",[{name:"sub",newName:"subtract",target:Fn,targetName:"Vec3"},{name:"mul",newName:"multiply",target:Fn,targetName:"Vec3"},{name:"div",newName:"divide",target:Fn,targetName:"Vec3"},{name:"dist",newName:"distance",target:Fn,targetName:"Vec3"},{name:"sqrDist",newName:"squaredDistance",target:Fn,targetName:"Vec3"},{name:"mag",newName:"len",target:Fn,targetName:"Vec3"},{name:"sqrMag",newName:"lengthSqr",target:Fn,targetName:"Vec3"},{name:"scale",newName:"multiplyScalar",target:Fn,targetName:"Vec3"},{name:"exactEquals",newName:"strictEquals",target:Fn,targetName:"Vec3"}]),me(Fn.prototype,"Vec3",[{name:"mag",newName:"length",target:Fn.prototype,targetName:"Vec3"},{name:"magSqr",newName:"lengthSqr",target:Fn.prototype,targetName:"Vec3"},{name:"scale",newName:"multiplyScalar",target:Fn.prototype,targetName:"Vec3"},{name:"exactEquals",newName:"strictEquals",target:Fn.prototype,targetName:"Vec3"}]),me(oi,"Vec4",[{name:"sub",newName:"subtract",target:oi,targetName:"Vec4"},{name:"mul",newName:"multiply",target:oi,targetName:"Vec4"},{name:"div",newName:"divide",target:oi,targetName:"Vec4"},{name:"dist",newName:"distance",target:oi,targetName:"Vec4"},{name:"sqrDist",newName:"squaredDistance",target:oi,targetName:"Vec4"},{name:"mag",newName:"len",target:oi,targetName:"Vec4"},{name:"sqrMag",newName:"lengthSqr",target:oi,targetName:"Vec4"},{name:"scale",newName:"multiplyScalar",target:oi,targetName:"Vec4"},{name:"exactEquals",newName:"strictEquals",target:oi,targetName:"Vec4"}]),me(oi.prototype,"Vec4",[{name:"mag",newName:"length",target:oi.prototype,targetName:"Vec4"},{name:"magSqr",newName:"lengthSqr",target:oi.prototype,targetName:"Vec4"},{name:"scale",newName:"multiplyScalar",target:oi.prototype,targetName:"Vec4"},{name:"exactEquals",newName:"strictEquals",target:oi.prototype,targetName:"Vec4"}]),me(Vn,"Quat",[{name:"mag",newName:"len",target:Vn,targetName:"Quat"},{name:"mul",newName:"multiply",target:Vn,targetName:"Quat"},{name:"sqrMag",newName:"lengthSqr",target:Vn,targetName:"Quat"},{name:"scale",newName:"multiplyScalar",target:Vn,targetName:"Quat"},{name:"exactEquals",newName:"strictEquals",target:Vn,targetName:"Quat"}]),me(Vn.prototype,"Quat",[{name:"scale",newName:"multiplyScalar",target:Vn.prototype,targetName:"Quat"},{name:"exactEquals",newName:"strictEquals",target:Vn.prototype,targetName:"Quat"}]),me(Dn,"Color",[{name:"sub",newName:"subtract",target:Dn,targetName:"Color"},{name:"mul",newName:"multiply",target:Dn,targetName:"Color"},{name:"div",newName:"divide",target:Dn,targetName:"Color"},{name:"exactEquals",newName:"strictEquals",target:Dn,targetName:"Color"},{name:"fromHex",newName:"fromHEX",customFunction:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];var i=t[1].toString(16);return c.Color.fromHEX(t[0],i)}}]),me(Gn,"Mat3",[{name:"sub",newName:"subtract",target:Gn,targetName:"Mat3"},{name:"mul",newName:"multiply",target:Gn,targetName:"Mat3"},{name:"exactEquals",newName:"strictEquals",target:Gn,targetName:"Mat3"},{name:"transfrom",newName:"transform",target:Gn,targetName:"Mat3"}]),me(Gn.prototype,"Mat3",[{name:"sub",newName:"subtract",target:Gn.prototype,targetName:"Mat3"},{name:"mul",newName:"multiply",target:Gn.prototype,targetName:"Mat3"},{name:"mulScalar",newName:"multiplyScalar",target:Gn.prototype,targetName:"Mat3"},{name:"exactEquals",newName:"strictEquals",target:Gn.prototype,targetName:"Mat3"}]),me(Zn,"Mat4",[{name:"sub",newName:"subtract",target:Zn,targetName:"Mat4"},{name:"mul",newName:"multiply",target:Zn,targetName:"Mat4"},{name:"exactEquals",newName:"strictEquals",target:Zn,targetName:"Mat4"}]),me(Zn.prototype,"Mat4",[{name:"sub",newName:"subtract",target:Zn.prototype,targetName:"Mat4"},{name:"mul",newName:"multiply",target:Zn.prototype,targetName:"Mat4"},{name:"mulScalar",newName:"multiplyScalar",target:Zn.prototype,targetName:"Mat4"},{name:"exactEquals",newName:"strictEquals",target:Zn.prototype,targetName:"Mat4"}]);var si=e("dG",function(){function e(e,t,n,i,r,o){void 0===e&&(e=1),void 0===t&&(t=0),void 0===n&&(n=0),void 0===i&&(i=1),void 0===r&&(r=0),void 0===o&&(o=0),this.a=e,this.b=t,this.c=n,this.d=i,this.tx=r,this.ty=o}return e.identity=function(){return new e},e.clone=function(t){return new e(t.a,t.b,t.c,t.d,t.tx,t.ty)},e.concat=function(e,t,n){var i=t.a,r=t.b,o=t.c,a=t.d,s=t.tx,c=t.ty;e.a=i*n.a+r*n.c,e.b=i*n.b+r*n.d,e.c=o*n.a+a*n.c,e.d=o*n.b+a*n.d,e.tx=s*n.a+c*n.c+n.tx,e.ty=s*n.b+c*n.d+n.ty},e.invert=function(e,t){var n=1/(t.a*t.d-t.b*t.c);e.a=n*t.d,e.b=-n*t.b,e.c=-n*t.c,e.d=n*t.a,e.tx=n*(t.c*t.ty-t.d*t.tx),e.ty=n*(t.b*t.tx-t.a*t.ty)},e.fromMat4=function(e,t){e.a=t.m00,e.b=t.m01,e.c=t.m04,e.d=t.m05,e.tx=t.m12,e.ty=t.m13},e.transformVec2=function(e,t,n,i){var r,o;void 0===i?(i=n,r=t.x,o=t.y):(r=t,o=n),e.x=i.a*r+i.c*o+i.tx,e.y=i.b*r+i.d*o+i.ty},e.transformSize=function(e,t,n){e.width=n.a*t.width+n.c*t.height,e.height=n.b*t.width+n.d*t.height},e.transformRect=function(e,t,n){var i=t.x+t.width,r=t.y+t.height,o=n.a*t.x+n.c*t.y+n.tx,a=n.b*t.x+n.d*t.y+n.ty,s=n.a*i+n.c*t.y+n.tx,c=n.b*i+n.d*t.y+n.ty,l=n.a*t.x+n.c*r+n.tx,u=n.b*t.x+n.d*r+n.ty,h=n.a*i+n.c*r+n.tx,_=n.b*i+n.d*r+n.ty,f=Math.min(o,s,l,h),m=Math.max(o,s,l,h),d=Math.min(a,c,u,_),p=Math.max(a,c,u,_);e.x=f,e.y=d,e.width=m-f,e.height=p-d},e.transformObb=function(e,t,n,i,r,o){var a=o.a*r.x+o.c*r.y+o.tx,s=o.b*r.x+o.d*r.y+o.ty,c=o.a*r.width,l=o.b*r.width,u=o.c*r.height,h=o.d*r.height;t.x=a,t.y=s,n.x=c+a,n.y=l+s,e.x=u+a,e.y=h+s,i.x=c+u+a,i.y=l+h+s},e}());c.AffineTransform=si;var ci=e("bS",function(e){function t(t,n){var i;return i=e.call(this)||this,t&&"object"==typeof t?(i.width=t.width,i.height=t.height):(i.width=t||0,i.height=n||0),i}$(t,e),t.lerp=function(e,t,n,i){return e.width=t.width+(n.width-t.width)*i,e.height=t.height+(n.height-t.height)*i,e},Z(t,[{key:"x",set:function(e){this.width=e},get:function(){return this.width}},{key:"y",set:function(e){this.height=e},get:function(){return this.height}}]);var n=t.prototype;return n.clone=function(){return new t(this.width,this.height)},n.set=function(e,t){return e&&"object"==typeof e?(this.height=e.height,this.width=e.width):(this.width=e||0,this.height=t||0),this},n.equals=function(e){return this.width===e.width&&this.height===e.height},n.lerp=function(e,t){return this.width+=(e.width-this.width)*t,this.height+=(e.height-this.height)*t,this},n.toString=function(){return"("+this.width.toFixed(2)+", "+this.height.toFixed(2)+")"},t}(Et));function li(e,t){return void 0===e&&(e=0),void 0===t&&(t=0),new ci(e,t)}ci.ZERO=Object.freeze(new ci(0,0)),ci.ONE=Object.freeze(new ci(1,1)),ln.fastDefine("cc.Size",ci,{width:0,height:0}),c.size=li,c.Size=ci;var ui=e("bR",function(e){function t(t,n,i,r){var o;return(o=e.call(this)||this).T=void 0,t&&"object"==typeof t?(o.y=t.y,o.width=t.width,o.height=t.height,o.x=t.x):(o.x=t||0,o.y=n||0,o.width=i||0,o.height=r||0),o}$(t,e),t.fromMinMax=function(e,t,n){var i=Math.min(t.x,n.x),r=Math.min(t.y,n.y),o=Math.max(t.x,n.x),a=Math.max(t.y,n.y);return e.x=i,e.y=r,e.width=o-i,e.height=a-r,e},t.lerp=function(e,t,n,i){var r=t.x,o=t.y,a=t.width,s=t.height;return e.x=r+(n.x-r)*i,e.y=o+(n.y-o)*i,e.width=a+(n.width-a)*i,e.height=s+(n.height-s)*i,e},t.intersection=function(e,t,n){var i=t.x,r=t.y,o=t.x+t.width,a=t.y+t.height,s=n.x,c=n.y,l=n.x+n.width,u=n.y+n.height;return e.x=Math.max(i,s),e.y=Math.max(r,c),e.width=Math.min(o,l)-e.x,e.height=Math.min(a,u)-e.y,e},t.union=function(e,t,n){var i=t.x,r=t.y,o=t.width,a=t.height,s=n.x,c=n.y,l=n.width,u=n.height;return e.x=Math.min(i,s),e.y=Math.min(r,c),e.width=Math.max(i+o,s+l)-e.x,e.height=Math.max(r+a,c+u)-e.y,e},Z(t,[{key:"xMin",get:function(){return this.x},set:function(e){this.width+=this.x-e,this.x=e}},{key:"yMin",get:function(){return this.y},set:function(e){this.height+=this.y-e,this.y=e}},{key:"xMax",get:function(){return this.x+this.width},set:function(e){this.width=e-this.x}},{key:"yMax",get:function(){return this.y+this.height},set:function(e){this.height=e-this.y}},{key:"center",get:function(){return new ti(this.x+.5*this.width,this.y+.5*this.height)},set:function(e){this.x=e.x-.5*this.width,this.y=e.y-.5*this.height}},{key:"origin",get:function(){return new ti(this.x,this.y)},set:function(e){this.x=e.x,this.y=e.y}},{key:"size",get:function(){return new ci(this.width,this.height)},set:function(e){this.width=e.width,this.height=e.height}},{key:"z",set:function(e){this.width=e},get:function(){return this.width}},{key:"w",set:function(e){this.height=e},get:function(){return this.height}}]);var n=t.prototype;return n.clone=function(){return new t(this.x,this.y,this.width,this.height)},n.set=function(e,t,n,i){return e&&"object"==typeof e?(this.y=e.y,this.width=e.width,this.height=e.height,this.x=e.x):(this.x=e||0,this.y=t||0,this.width=n||0,this.height=i||0),this},n.equals=function(e){return this.x===e.x&&this.y===e.y&&this.width===e.width&&this.height===e.height},n.lerp=function(e,t){var n=this.x,i=this.y,r=this.width,o=this.height;return this.x=n+(e.x-n)*t,this.y=i+(e.y-i)*t,this.width=r+(e.width-r)*t,this.height=o+(e.height-o)*t,this},n.toString=function(){return"("+this.x.toFixed(2)+", "+this.y.toFixed(2)+", "+this.width.toFixed(2)+", "+this.height.toFixed(2)+")"},n.intersects=function(e){var t=this.x+this.width,n=this.y+this.height,i=e.x+e.width,r=e.y+e.height;return!(t<e.x||i<this.x||n<e.y||r<this.y)},n.contains=function(e){return this.x<=e.x&&this.x+this.width>=e.x&&this.y<=e.y&&this.y+this.height>=e.y},n.containsRect=function(e){return this.x<=e.x&&this.x+this.width>=e.x+e.width&&this.y<=e.y&&this.y+this.height>=e.y+e.height},n.transformMat4=function(e){var t=this.x,n=this.y,i=t+this.width,r=n+this.height,o=e.m00*t+e.m04*n+e.m12,a=e.m01*t+e.m05*n+e.m13,s=e.m00*i+e.m04*n+e.m12,c=e.m01*i+e.m05*n+e.m13,l=e.m00*t+e.m04*r+e.m12,u=e.m01*t+e.m05*r+e.m13,h=e.m00*i+e.m04*r+e.m12,_=e.m01*i+e.m05*r+e.m13,f=Math.min(o,s,l,h),m=Math.max(o,s,l,h),d=Math.min(a,c,u,_),p=Math.max(a,c,u,_);return this.x=f,this.y=d,this.width=m-f,this.height=p-d,this},n.transformMat4ToPoints=function(e,t,n,i,r){var o=this.x,a=this.y,s=o+this.width,c=a+this.height;t.x=e.m00*o+e.m04*a+e.m12,t.y=e.m01*o+e.m05*a+e.m13,r.x=e.m00*s+e.m04*a+e.m12,r.y=e.m01*s+e.m05*a+e.m13,n.x=e.m00*o+e.m04*c+e.m12,n.y=e.m01*o+e.m05*c+e.m13,i.x=e.m00*s+e.m04*c+e.m12,i.y=e.m01*s+e.m05*c+e.m13},t}(Et));function hi(e,t,n,i){return void 0===e&&(e=0),void 0===t&&(t=0),void 0===n&&(n=0),void 0===i&&(i=0),new ui(e,t,n,i)}ln.fastDefine("cc.Rect",ui,{x:0,y:0,width:0,height:0}),c.Rect=ui,c.rect=hi;var _i=Object.freeze({__proto__:null,bits:fe,Vec2:ti,v2:ri,Vec3:Fn,v3:Un,Vec4:oi,v4:ai,Quat:Vn,quat:Kn,Mat3:Gn,Mat4:Zn,mat4:ei,AffineTransform:si,Size:ci,size:li,Rect:ui,rect:hi,Color:Dn,color:Ln,EPSILON:mn,equals:dn,approx:pn,clamp:vn,clamp01:gn,lerp:yn,toRadian:xn,toDegree:En,random:Sn,randomRange:Tn,randomRangeInt:An,pseudoRandom:Cn,pseudoRandomRange:wn,pseudoRandomRangeInt:In,nextPow2:bn,repeat:Rn,pingPong:On,inverseLerp:Nn,absMaxComponent:Pn,absMax:Mn});e("dx",_i);var fi,mi,di,pi,vi,gi,yi,xi,Ei,Si,Ti,Ai,Ci,wi,Ii,bi,Ri,Oi,Ni,Pi,Mi,Di,Li,Fi,zi=function(){function e(e,t,n){this._arrayBuffers=[],this._chunkSize=void 0,this._chunkSize=n*(1<<t)}return e.prototype.allocateNewChunk=function(){return new ArrayBuffer(this._chunkSize)},e}(),Bi=function(){},Ui=function(){function e(){}var t=e.prototype;return t.alloc=function(e,t){return new ArrayBuffer(t)},t.free=function(){},e}();!function(e){e[e.UINT32=0]="UINT32",e[e.FLOAT32=1]="FLOAT32",e[e.NEVER=2]="NEVER"}(Fi||(Fi={}));var Gi,Hi=function(){function e(e,t,n,i){void 0===i&&(i=8),this._dataType=void 0,this._elementCount=void 0,this._entryBits=void 0,this._stride=void 0,this._entriesPerChunk=void 0,this._entryMask=void 0,this._chunkMask=void 0,this._poolFlag=void 0,this._arrayBuffers=[],this._freelists=[],this._uint32BufferViews=[],this._float32BufferViews=[],this._hasUint32=!1,this._hasFloat32=!1,this._nativePool=void 0,this._elementCount=n.COUNT,this._entryBits=i,this._dataType=t,this._stride=4*this._elementCount,this._entriesPerChunk=1<<i,this._entryMask=this._entriesPerChunk-1,this._poolFlag=1<<30,this._chunkMask=~(this._entryMask|this._poolFlag),this._nativePool=new zi(e,i,this._stride);var r=Fi.NEVER,o=!1,a=!1;for(var s in t){if(o=this._hasFloat32,(a=this._hasUint32)&&o)break;r=t[s],o||r!==Fi.FLOAT32?a||r!==Fi.UINT32||(this._hasUint32=!0):this._hasFloat32=!0}}var t=e.prototype;return t.alloc=function(){for(var e=0;e<this._freelists.length;e++){var t=this._freelists[e];if(t.length){var n=t[t.length-1];return t.length--,(e<<this._entryBits)+n+this._poolFlag}}for(var i=this._nativePool.allocateNewChunk(),r=[],o=[],a=[],s=this._hasFloat32,c=this._hasUint32,l=0;l<this._entriesPerChunk;l++)s&&r.push(new Float32Array(i,this._stride*l,this._elementCount)),c&&o.push(new Uint32Array(i,this._stride*l,this._elementCount)),l&&a.push(l);return this._arrayBuffers.push(i),c&&this._uint32BufferViews.push(o),s&&this._float32BufferViews.push(r),this._freelists.push(a),(e<<this._entryBits)+this._poolFlag},t.get=function(e,t){var n=(this._chunkMask&e)>>this._entryBits,i=this._entryMask&e;return(this._dataType[t]===Fi.UINT32?this._uint32BufferViews:this._float32BufferViews)[n][i][t]},t.set=function(e,t,n){var i=(this._chunkMask&e)>>this._entryBits,r=this._entryMask&e;(this._dataType[t]===Fi.UINT32?this._uint32BufferViews:this._float32BufferViews)[i][r][t]=n},t.setVec2=function(){},t.setVec3=function(){},t.setVec4=function(){},t.setMat4=function(){},t.free=function(e){var t=(this._chunkMask&e)>>this._entryBits,n=this._entryMask&e;(this._hasUint32?this._uint32BufferViews:this._float32BufferViews)[t][n].fill(0),this._freelists[t].push(n)},e}(),ki=function(){function e(e,t,n){this._ctor=void 0,this._dtor=void 0,this._indexMask=void 0,this._poolFlag=void 0,this._array=[],this._freelist=[],this._nativePool=void 0,this._ctor=t,n&&(this._dtor=n),this._poolFlag=1<<29,this._indexMask=~this._poolFlag,this._nativePool=new Bi(e,this._array)}var t=e.prototype;return t.alloc=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];var i=this._freelist,r=-1;if(i.length)r=i[i.length-1],i.length--,this._array[r]=this._ctor(arguments,this._array[r]);else{r=this._array.length;var o=this._ctor(arguments);if(!o)return 0;this._array.push(o)}return r+this._poolFlag},t.get=function(e){var t=this._indexMask&e;return this._array[t]},t.free=function(e){var t=this._indexMask&e;this._dtor&&(this._array[t]=this._dtor(this._array[t])),this._freelist.push(t)},e}(),Vi=function(){function e(e){this._nativeBufferAllocator=void 0,this._buffers=new Map,this._nextBufferIdx=0,this._poolFlag=void 0,this._bufferIdxMask=void 0,this._poolFlag=1<<30,this._bufferIdxMask=~this._poolFlag,this._nativeBufferAllocator=new Ui(e)}var t=e.prototype;return t.alloc=function(e){var t=this._nextBufferIdx++,n=this._nativeBufferAllocator.alloc(t,e);return this._buffers.set(t,n),t|this._poolFlag},t.free=function(e){var t=this._bufferIdxMask&e;this._buffers.get(t)&&(this._nativeBufferAllocator.free(t),this._buffers.delete(t))},t.getBuffer=function(e){var t=this._bufferIdxMask&e;return this._buffers.get(t)||null},e}(),ji=function(e){function t(t,n,i,r){var o;return(o=e.call(this,t)||this)._viewCtor=void 0,o._size=void 0,o._step=void 0,o._viewCtor=n,o._size=i*n.BYTES_PER_ELEMENT,o._step=r||i,o}$(t,e);var n=t.prototype;return n.alloc=function(){var e=this._nextBufferIdx++,t=this._nativeBufferAllocator.alloc(e,this._size);return this._buffers.set(e,new this._viewCtor(t)),e|this._poolFlag},n.getBuffer=function(){return null},n.assign=function(e,t,n){var i=this._bufferIdxMask&e,r=this._buffers.get(i);if(r){var o=t+1;if(o>=r.length){for(var a=r.length;o>=a;)a+=this._step;a*=this._viewCtor.BYTES_PER_ELEMENT;var s=new this._viewCtor(this._nativeBufferAllocator.alloc(i,a));s.set(r),r=s,this._buffers.set(i,r)}r[o]=n;var c=r[0];r[0]=o>c?o:c}},n.erase=function(e,t){var n=this._bufferIdxMask&e,i=this._buffers.get(n);if(i&&!(t>=i[0])){for(var r=t+1;r<i[0];++r)i[r]=i[r+1];--i[0]}},n.push=function(e,t){var n=this._bufferIdxMask&e,i=this._buffers.get(n);i&&this.assign(e,i[0],t)},n.pop=function(e){var t=this._bufferIdxMask&e,n=this._buffers.get(t);n&&0!==n[0]&&--n[0]},n.clear=function(e){var t=this._bufferIdxMask&e,n=this._buffers.get(t);n&&(n[0]=0)},n.get=function(e,t){var n=this._bufferIdxMask&e,i=this._buffers.get(n);return!i||t>=i[0]?0:i[t+1]},n.length=function(e){var t=this._bufferIdxMask&e,n=this._buffers.get(t);return n?n[0]:0},t}(Vi);function Wi(e,t,n,i){void 0===i&&(i=!0);for(var r=t.length(e),o=0;o<r;o++){var a=t.get(e,o);a&&n.free(a)}i?t.free(e):t.clear(e)}!function(e){e[e.ATTRIBUTE=0]="ATTRIBUTE",e[e.DESCRIPTOR_SETS=1]="DESCRIPTOR_SETS",e[e.SHADER=2]="SHADER",e[e.INPUT_ASSEMBLER=3]="INPUT_ASSEMBLER",e[e.PIPELINE_LAYOUT=4]="PIPELINE_LAYOUT",e[e.FRAMEBUFFER=5]="FRAMEBUFFER",e[e.PASS=100]="PASS",e[e.SUB_MODEL=101]="SUB_MODEL",e[e.MODEL=102]="MODEL",e[e.SCENE=103]="SCENE",e[e.CAMERA=104]="CAMERA",e[e.NODE=105]="NODE",e[e.ROOT=106]="ROOT",e[e.AABB=107]="AABB",e[e.RENDER_WINDOW=108]="RENDER_WINDOW",e[e.FRUSTUM=109]="FRUSTUM",e[e.AMBIENT=110]="AMBIENT",e[e.FOG=111]="FOG",e[e.SKYBOX=112]="SKYBOX",e[e.SHADOW=113]="SHADOW",e[e.LIGHT=114]="LIGHT",e[e.SPHERE=115]="SPHERE",e[e.INSTANCED_ATTRIBUTE=116]="INSTANCED_ATTRIBUTE",e[e.FLAT_BUFFER=117]="FLAT_BUFFER",e[e.SUB_MESH=118]="SUB_MESH",e[e.RASTERIZER_STATE=119]="RASTERIZER_STATE",e[e.DEPTH_STENCIL_STATE=120]="DEPTH_STENCIL_STATE",e[e.BLEND_TARGET=121]="BLEND_TARGET",e[e.BLEND_STATE=122]="BLEND_STATE",e[e.BATCH_2D=123]="BATCH_2D",e[e.SUB_MODEL_ARRAY=200]="SUB_MODEL_ARRAY",e[e.MODEL_ARRAY=201]="MODEL_ARRAY",e[e.ATTRIBUTE_ARRAY=202]="ATTRIBUTE_ARRAY",e[e.FLAT_BUFFER_ARRAY=203]="FLAT_BUFFER_ARRAY",e[e.INSTANCED_BUFFER_ARRAY=204]="INSTANCED_BUFFER_ARRAY",e[e.LIGHT_ARRAY=205]="LIGHT_ARRAY",e[e.BLEND_TARGET_ARRAY=206]="BLEND_TARGET_ARRAY",e[e.BATCH_ARRAY_2D=207]="BATCH_ARRAY_2D",e[e.RAW_BUFFER=300]="RAW_BUFFER",e[e.RAW_OBJECT=400]="RAW_OBJECT"}(Gi||(Gi={}));var qi,Yi=e("cm",0),Xi=new ki(Gi.SHADER,(function(e,t){return t?(t.initialize(e[1]),t):e[0].createShader(e[1])}),(function(e){return e&&e.destroy(),e})),Ki=e("cy",new ki(Gi.DESCRIPTOR_SETS,(function(e,t){return t?(t.initialize(e[1]),t):e[0].createDescriptorSet(e[1])}),(function(e){return e&&e.destroy(),e}))),Qi=e("cl",new ki(Gi.INPUT_ASSEMBLER,(function(e,t){return t?(t.initialize(e[1]),t):e[0].createInputAssembler(e[1])}),(function(e){return e&&e.destroy(),e}))),Zi=new ki(Gi.PIPELINE_LAYOUT,(function(e,t){return t?(t.initialize(e[1]),t):e[0].createPipelineLayout(e[1])}),(function(e){return e&&e.destroy(),e})),Ji=new ki(Gi.FRAMEBUFFER,(function(e,t){return t?(t.initialize(e[1]),t):e[0].createFramebuffer(e[1])}),(function(e){return e&&e.destroy(),e})),$i=new ji(Gi.SUB_MODEL_ARRAY,Uint32Array,8,4),er=new ji(Gi.MODEL_ARRAY,Uint32Array,32,16),tr=new ji(Gi.ATTRIBUTE_ARRAY,Uint32Array,8,4),nr=new ji(Gi.FLAT_BUFFER_ARRAY,Uint32Array,8,4),ir=new ji(Gi.LIGHT_ARRAY,Uint32Array,8,4),rr=new ji(Gi.BLEND_TARGET_ARRAY,Uint32Array,8,4),or=new ji(Gi.BATCH_ARRAY_2D,Uint32Array,32,16),ar=new Vi(Gi.RAW_BUFFER),sr=new ki(Gi.RAW_OBJECT,(function(e){return e[0]||{}}),(function(){}));!function(e){e[e.PRIORITY=0]="PRIORITY",e[e.STAGE=1]="STAGE",e[e.PHASE=2]="PHASE",e[e.BATCHING_SCHEME=3]="BATCHING_SCHEME",e[e.PRIMITIVE=4]="PRIMITIVE",e[e.DYNAMIC_STATES=5]="DYNAMIC_STATES",e[e.HASH=6]="HASH",e[e.RASTERIZER_STATE=7]="RASTERIZER_STATE",e[e.DEPTH_STENCIL_STATE=8]="DEPTH_STENCIL_STATE",e[e.BLEND_STATE=9]="BLEND_STATE",e[e.DESCRIPTOR_SET=10]="DESCRIPTOR_SET",e[e.PIPELINE_LAYOUT=11]="PIPELINE_LAYOUT",e[e.COUNT=12]="COUNT"}(qi||(qi={}));var cr,lr=((fi={})[qi.PRIORITY]=Fi.UINT32,fi[qi.STAGE]=Fi.UINT32,fi[qi.PHASE]=Fi.UINT32,fi[qi.BATCHING_SCHEME]=Fi.UINT32,fi[qi.PRIMITIVE]=Fi.UINT32,fi[qi.DYNAMIC_STATES]=Fi.UINT32,fi[qi.HASH]=Fi.UINT32,fi[qi.RASTERIZER_STATE]=Fi.UINT32,fi[qi.DEPTH_STENCIL_STATE]=Fi.UINT32,fi[qi.BLEND_STATE]=Fi.UINT32,fi[qi.DESCRIPTOR_SET]=Fi.UINT32,fi[qi.PIPELINE_LAYOUT]=Fi.UINT32,fi[qi.COUNT]=Fi.NEVER,fi),ur=e("cr",new Hi(Gi.PASS,lr,qi));!function(e){e[e.PRIORITY=0]="PRIORITY",e[e.PASS_COUNT=1]="PASS_COUNT",e[e.PASS_0=2]="PASS_0",e[e.PASS_1=3]="PASS_1",e[e.PASS_2=4]="PASS_2",e[e.PASS_3=5]="PASS_3",e[e.SHADER_0=6]="SHADER_0",e[e.SHADER_1=7]="SHADER_1",e[e.SHADER_2=8]="SHADER_2",e[e.SHADER_3=9]="SHADER_3",e[e.PLANAR_SHADER=10]="PLANAR_SHADER",e[e.DESCRIPTOR_SET=11]="DESCRIPTOR_SET",e[e.INPUT_ASSEMBLER=12]="INPUT_ASSEMBLER",e[e.SUB_MESH=13]="SUB_MESH",e[e.COUNT=14]="COUNT"}(cr||(cr=e("cw",{})));var hr,_r=((mi={})[cr.PRIORITY]=Fi.UINT32,mi[cr.PASS_COUNT]=Fi.UINT32,mi[cr.PASS_0]=Fi.UINT32,mi[cr.PASS_1]=Fi.UINT32,mi[cr.PASS_2]=Fi.UINT32,mi[cr.PASS_3]=Fi.UINT32,mi[cr.SHADER_0]=Fi.UINT32,mi[cr.SHADER_1]=Fi.UINT32,mi[cr.SHADER_2]=Fi.UINT32,mi[cr.SHADER_3]=Fi.UINT32,mi[cr.PLANAR_SHADER]=Fi.UINT32,mi[cr.DESCRIPTOR_SET]=Fi.UINT32,mi[cr.INPUT_ASSEMBLER]=Fi.UINT32,mi[cr.SUB_MESH]=Fi.UINT32,mi[cr.COUNT]=Fi.NEVER,mi),fr=e("cv",new Hi(Gi.SUB_MODEL,_r,cr));!function(e){e[e.ENABLED=0]="ENABLED",e[e.VIS_FLAGS=1]="VIS_FLAGS",e[e.CAST_SHADOW=2]="CAST_SHADOW",e[e.RECEIVE_SHADOW=3]="RECEIVE_SHADOW",e[e.WORLD_BOUNDS=4]="WORLD_BOUNDS",e[e.NODE=5]="NODE",e[e.TRANSFORM=6]="TRANSFORM",e[e.SUB_MODEL_ARRAY=7]="SUB_MODEL_ARRAY",e[e.INSTANCED_BUFFER=8]="INSTANCED_BUFFER",e[e.INSTANCED_ATTR_ARRAY=9]="INSTANCED_ATTR_ARRAY",e[e.COUNT=10]="COUNT"}(hr||(hr={}));var mr,dr=((di={})[hr.ENABLED]=Fi.UINT32,di[hr.VIS_FLAGS]=Fi.UINT32,di[hr.CAST_SHADOW]=Fi.UINT32,di[hr.RECEIVE_SHADOW]=Fi.UINT32,di[hr.WORLD_BOUNDS]=Fi.UINT32,di[hr.NODE]=Fi.UINT32,di[hr.TRANSFORM]=Fi.UINT32,di[hr.SUB_MODEL_ARRAY]=Fi.UINT32,di[hr.INSTANCED_BUFFER]=Fi.UINT32,di[hr.INSTANCED_ATTR_ARRAY]=Fi.UINT32,di[hr.COUNT]=Fi.NEVER,di),pr=new Hi(Gi.MODEL,dr,hr);!function(e){e[e.VIS_FLAGS=0]="VIS_FLAGS",e[e.PASS_COUNT=1]="PASS_COUNT",e[e.PASS_0=2]="PASS_0",e[e.PASS_1=3]="PASS_1",e[e.PASS_2=4]="PASS_2",e[e.PASS_3=5]="PASS_3",e[e.SHADER_0=6]="SHADER_0",e[e.SHADER_1=7]="SHADER_1",e[e.SHADER_2=8]="SHADER_2",e[e.SHADER_3=9]="SHADER_3",e[e.DESCRIPTOR_SET=10]="DESCRIPTOR_SET",e[e.INPUT_ASSEMBLER=11]="INPUT_ASSEMBLER",e[e.COUNT=12]="COUNT"}(mr||(mr=e("cp",{})));var vr,gr=((pi={})[mr.VIS_FLAGS]=Fi.UINT32,pi[mr.PASS_COUNT]=Fi.UINT32,pi[mr.PASS_0]=Fi.UINT32,pi[mr.PASS_1]=Fi.UINT32,pi[mr.PASS_2]=Fi.UINT32,pi[mr.PASS_3]=Fi.UINT32,pi[mr.SHADER_0]=Fi.UINT32,pi[mr.SHADER_1]=Fi.UINT32,pi[mr.SHADER_2]=Fi.UINT32,pi[mr.SHADER_3]=Fi.UINT32,pi[mr.DESCRIPTOR_SET]=Fi.UINT32,pi[mr.INPUT_ASSEMBLER]=Fi.UINT32,pi[mr.COUNT]=Fi.NEVER,pi),yr=e("co",new Hi(Gi.BATCH_2D,gr,mr));!function(e){e[e.CENTER=0]="CENTER",e[e.HALF_EXTENSION=3]="HALF_EXTENSION",e[e.COUNT=6]="COUNT"}(vr||(vr=e("bD",{})));var xr,Er=((vi={})[vr.CENTER]=Fi.FLOAT32,vi[vr.HALF_EXTENSION]=Fi.FLOAT32,vi[vr.COUNT]=Fi.NEVER,vi),Sr=e("bC",new Hi(Gi.AABB,Er,vr));!function(e){e[e.MAIN_LIGHT=0]="MAIN_LIGHT",e[e.MODEL_ARRAY=1]="MODEL_ARRAY",e[e.SPHERE_LIGHT_ARRAY=2]="SPHERE_LIGHT_ARRAY",e[e.SPOT_LIGHT_ARRAY=3]="SPOT_LIGHT_ARRAY",e[e.BATCH_ARRAY_2D=4]="BATCH_ARRAY_2D",e[e.COUNT=5]="COUNT"}(xr||(xr={}));var Tr,Ar=((gi={})[xr.MAIN_LIGHT]=Fi.UINT32,gi[xr.MODEL_ARRAY]=Fi.UINT32,gi[xr.SPHERE_LIGHT_ARRAY]=Fi.UINT32,gi[xr.SPOT_LIGHT_ARRAY]=Fi.UINT32,gi[xr.BATCH_ARRAY_2D]=Fi.UINT32,gi[xr.COUNT]=Fi.NEVER,gi),Cr=new Hi(Gi.SCENE,Ar,xr);!function(e){e[e.WIDTH=0]="WIDTH",e[e.HEIGHT=1]="HEIGHT",e[e.EXPOSURE=2]="EXPOSURE",e[e.CLEAR_FLAG=3]="CLEAR_FLAG",e[e.CLEAR_DEPTH=4]="CLEAR_DEPTH",e[e.CLEAR_STENCIL=5]="CLEAR_STENCIL",e[e.VISIBILITY=6]="VISIBILITY",e[e.NODE=7]="NODE",e[e.SCENE=8]="SCENE",e[e.FRUSTUM=9]="FRUSTUM",e[e.WINDOW=10]="WINDOW",e[e.FORWARD=11]="FORWARD",e[e.POSITION=14]="POSITION",e[e.VIEW_PORT=17]="VIEW_PORT",e[e.CLEAR_COLOR=21]="CLEAR_COLOR",e[e.MAT_VIEW=25]="MAT_VIEW",e[e.MAT_VIEW_PROJ=41]="MAT_VIEW_PROJ",e[e.MAT_VIEW_PROJ_INV=57]="MAT_VIEW_PROJ_INV",e[e.MAT_PROJ=73]="MAT_PROJ",e[e.MAT_PROJ_INV=89]="MAT_PROJ_INV",e[e.COUNT=105]="COUNT"}(Tr||(Tr={}));var wr,Ir=((yi={})[Tr.WIDTH]=Fi.UINT32,yi[Tr.HEIGHT]=Fi.UINT32,yi[Tr.EXPOSURE]=Fi.FLOAT32,yi[Tr.CLEAR_FLAG]=Fi.UINT32,yi[Tr.CLEAR_DEPTH]=Fi.FLOAT32,yi[Tr.CLEAR_STENCIL]=Fi.UINT32,yi[Tr.VISIBILITY]=Fi.UINT32,yi[Tr.NODE]=Fi.UINT32,yi[Tr.SCENE]=Fi.UINT32,yi[Tr.FRUSTUM]=Fi.UINT32,yi[Tr.WINDOW]=Fi.UINT32,yi[Tr.FORWARD]=Fi.FLOAT32,yi[Tr.POSITION]=Fi.FLOAT32,yi[Tr.VIEW_PORT]=Fi.FLOAT32,yi[Tr.CLEAR_COLOR]=Fi.FLOAT32,yi[Tr.MAT_VIEW]=Fi.FLOAT32,yi[Tr.MAT_VIEW_PROJ]=Fi.FLOAT32,yi[Tr.MAT_VIEW_PROJ_INV]=Fi.FLOAT32,yi[Tr.MAT_PROJ]=Fi.FLOAT32,yi[Tr.MAT_PROJ_INV]=Fi.FLOAT32,yi[Tr.COUNT]=Fi.NEVER,yi),br=new Hi(Gi.CAMERA,Ir,Tr);!function(e){e[e.FLAGS_CHANGED=0]="FLAGS_CHANGED",e[e.LAYER=1]="LAYER",e[e.WORLD_SCALE=2]="WORLD_SCALE",e[e.WORLD_POSITION=5]="WORLD_POSITION",e[e.WORLD_ROTATION=8]="WORLD_ROTATION",e[e.WORLD_MATRIX=12]="WORLD_MATRIX",e[e.COUNT=28]="COUNT"}(wr||(wr={}));var Rr=((xi={})[wr.FLAGS_CHANGED]=Fi.UINT32,xi[wr.LAYER]=Fi.UINT32,xi[wr.WORLD_SCALE]=Fi.FLOAT32,xi[wr.WORLD_POSITION]=Fi.FLOAT32,xi[wr.WORLD_ROTATION]=Fi.FLOAT32,xi[wr.WORLD_MATRIX]=Fi.FLOAT32,xi[wr.COUNT]=Fi.NEVER,xi);delete wr[wr.COUNT],wr[wr.COUNT=wr.LAYER+1]="COUNT";var Or,Nr=new Hi(Gi.NODE,Rr,wr);!function(e){e[e.CUMULATIVE_TIME=0]="CUMULATIVE_TIME",e[e.FRAME_TIME=1]="FRAME_TIME",e[e.COUNT=2]="COUNT"}(Or||(Or={}));var Pr,Mr=((Ei={})[Or.CUMULATIVE_TIME]=Fi.FLOAT32,Ei[Or.FRAME_TIME]=Fi.FLOAT32,Ei[Or.COUNT]=Fi.NEVER,Ei),Dr=new Hi(Gi.ROOT,Mr,Or,1);!function(e){e[e.HAS_ON_SCREEN_ATTACHMENTS=0]="HAS_ON_SCREEN_ATTACHMENTS",e[e.HAS_OFF_SCREEN_ATTACHMENTS=1]="HAS_OFF_SCREEN_ATTACHMENTS",e[e.FRAMEBUFFER=2]="FRAMEBUFFER",e[e.COUNT=3]="COUNT"}(Pr||(Pr={}));var Lr,Fr=((Si={})[Pr.HAS_ON_SCREEN_ATTACHMENTS]=Fi.UINT32,Si[Pr.HAS_OFF_SCREEN_ATTACHMENTS]=Fi.UINT32,Si[Pr.FRAMEBUFFER]=Fi.UINT32,Si[Pr.COUNT]=Fi.NEVER,Si),zr=new Hi(Gi.RENDER_WINDOW,Fr,Pr,2);!function(e){e[e.VERTICES=0]="VERTICES",e[e.PLANES=24]="PLANES",e[e.COUNT=48]="COUNT"}(Lr||(Lr={}));var Br,Ur=((Ti={})[Lr.VERTICES]=Fi.FLOAT32,Ti[Lr.PLANES]=Fi.FLOAT32,Ti[Lr.COUNT]=Fi.NEVER,Ti),Gr=new Hi(Gi.FRUSTUM,Ur,Lr);!function(e){e[e.ENABLE=0]="ENABLE",e[e.ILLUM=1]="ILLUM",e[e.SKY_COLOR=2]="SKY_COLOR",e[e.GROUND_ALBEDO=6]="GROUND_ALBEDO",e[e.COUNT=10]="COUNT"}(Br||(Br={}));var Hr=((Ai={})[Br.ENABLE]=Fi.UINT32,Ai[Br.ILLUM]=Fi.FLOAT32,Ai[Br.SKY_COLOR]=Fi.FLOAT32,Ai[Br.GROUND_ALBEDO]=Fi.FLOAT32,Ai[Br.COUNT]=Fi.NEVER,Ai);delete Br[Br.COUNT],Br[Br.COUNT=Br.ILLUM+1]="COUNT";var kr,Vr=new Hi(Gi.AMBIENT,Hr,Br,1);!function(e){e[e.ENABLE=0]="ENABLE",e[e.IS_RGBE=1]="IS_RGBE",e[e.USE_IBL=2]="USE_IBL",e[e.MODEL=3]="MODEL",e[e.COUNT=4]="COUNT"}(kr||(kr={}));var jr,Wr=((Ci={})[kr.ENABLE]=Fi.UINT32,Ci[kr.IS_RGBE]=Fi.UINT32,Ci[kr.USE_IBL]=Fi.UINT32,Ci[kr.MODEL]=Fi.UINT32,Ci[kr.COUNT]=Fi.NEVER,Ci),qr=new Hi(Gi.SKYBOX,Wr,kr,1);!function(e){e[e.ENABLE=0]="ENABLE",e[e.TYPE=1]="TYPE",e[e.DENSITY=2]="DENSITY",e[e.START=3]="START",e[e.END=4]="END",e[e.ATTEN=5]="ATTEN",e[e.TOP=6]="TOP",e[e.RANGE=7]="RANGE",e[e.COLOR=8]="COLOR",e[e.COUNT=12]="COUNT"}(jr||(jr={}));var Yr=((wi={})[jr.ENABLE]=Fi.UINT32,wi[jr.TYPE]=Fi.UINT32,wi[jr.DENSITY]=Fi.FLOAT32,wi[jr.START]=Fi.FLOAT32,wi[jr.END]=Fi.FLOAT32,wi[jr.ATTEN]=Fi.FLOAT32,wi[jr.TOP]=Fi.FLOAT32,wi[jr.RANGE]=Fi.FLOAT32,wi[jr.COLOR]=Fi.FLOAT32,wi[jr.COUNT]=Fi.NEVER,wi);delete jr[jr.COUNT],jr[jr.COUNT=jr.RANGE+1]="COUNT";var Xr,Kr=new Hi(Gi.FOG,Yr,jr);!function(e){e[e.ENABLE=0]="ENABLE",e[e.DIRTY=1]="DIRTY",e[e.TYPE=2]="TYPE",e[e.DISTANCE=3]="DISTANCE",e[e.INSTANCE_PASS=4]="INSTANCE_PASS",e[e.PLANAR_PASS=5]="PLANAR_PASS",e[e.NEAR=6]="NEAR",e[e.FAR=7]="FAR",e[e.ASPECT=8]="ASPECT",e[e.PCF_TYPE=9]="PCF_TYPE",e[e.SHADOW_MAP_DIRTY=10]="SHADOW_MAP_DIRTY",e[e.BIAS=11]="BIAS",e[e.ORTHO_SIZE=12]="ORTHO_SIZE",e[e.AUTO_ADAPT=13]="AUTO_ADAPT",e[e.COLOR=14]="COLOR",e[e.SIZE=18]="SIZE",e[e.NORMAL=20]="NORMAL",e[e.MAT_LIGHT=23]="MAT_LIGHT",e[e.COUNT=39]="COUNT"}(Xr||(Xr={}));var Qr=((Ii={})[Xr.ENABLE]=Fi.UINT32,Ii[Xr.DIRTY]=Fi.UINT32,Ii[Xr.TYPE]=Fi.UINT32,Ii[Xr.DISTANCE]=Fi.FLOAT32,Ii[Xr.INSTANCE_PASS]=Fi.UINT32,Ii[Xr.PLANAR_PASS]=Fi.UINT32,Ii[Xr.NEAR]=Fi.FLOAT32,Ii[Xr.FAR]=Fi.FLOAT32,Ii[Xr.ASPECT]=Fi.FLOAT32,Ii[Xr.PCF_TYPE]=Fi.UINT32,Ii[Xr.SHADOW_MAP_DIRTY]=Fi.UINT32,Ii[Xr.BIAS]=Fi.FLOAT32,Ii[Xr.ORTHO_SIZE]=Fi.FLOAT32,Ii[Xr.AUTO_ADAPT]=Fi.UINT32,Ii[Xr.COLOR]=Fi.FLOAT32,Ii[Xr.SIZE]=Fi.FLOAT32,Ii[Xr.NORMAL]=Fi.FLOAT32,Ii[Xr.MAT_LIGHT]=Fi.FLOAT32,Ii[Xr.COUNT]=Fi.NEVER,Ii);delete Xr[Xr.COUNT],Xr[Xr.COUNT=Xr.AUTO_ADAPT+1]="COUNT";var Zr,Jr=new Hi(Gi.SHADOW,Qr,Xr,1);!function(e){e[e.USE_COLOR_TEMPERATURE=0]="USE_COLOR_TEMPERATURE",e[e.ILLUMINANCE=1]="ILLUMINANCE",e[e.NODE=2]="NODE",e[e.RANGE=3]="RANGE",e[e.TYPE=4]="TYPE",e[e.AABB=5]="AABB",e[e.FRUSTUM=6]="FRUSTUM",e[e.SIZE=7]="SIZE",e[e.SPOT_ANGLE=8]="SPOT_ANGLE",e[e.ASPECT=9]="ASPECT",e[e.DIRECTION=10]="DIRECTION",e[e.COLOR=13]="COLOR",e[e.COLOR_TEMPERATURE_RGB=16]="COLOR_TEMPERATURE_RGB",e[e.POSITION=19]="POSITION",e[e.COUNT=22]="COUNT"}(Zr||(Zr={}));var $r,eo=((bi={})[Zr.USE_COLOR_TEMPERATURE]=Fi.UINT32,bi[Zr.ILLUMINANCE]=Fi.FLOAT32,bi[Zr.NODE]=Fi.UINT32,bi[Zr.RANGE]=Fi.FLOAT32,bi[Zr.TYPE]=Fi.UINT32,bi[Zr.AABB]=Fi.UINT32,bi[Zr.FRUSTUM]=Fi.UINT32,bi[Zr.SIZE]=Fi.FLOAT32,bi[Zr.SPOT_ANGLE]=Fi.FLOAT32,bi[Zr.ASPECT]=Fi.FLOAT32,bi[Zr.DIRECTION]=Fi.FLOAT32,bi[Zr.COLOR]=Fi.FLOAT32,bi[Zr.COLOR_TEMPERATURE_RGB]=Fi.FLOAT32,bi[Zr.POSITION]=Fi.FLOAT32,bi[Zr.COUNT]=Fi.NEVER,bi),to=new Hi(Gi.LIGHT,eo,Zr,3);!function(e){e[e.RADIUS=0]="RADIUS",e[e.CENTER=1]="CENTER",e[e.COUNT=4]="COUNT"}($r||($r={}));var no=((Ri={})[$r.RADIUS]=Fi.FLOAT32,Ri[$r.CENTER]=Fi.FLOAT32,Ri[$r.COUNT]=Fi.NEVER,Ri);delete $r[$r.COUNT],$r[$r.COUNT=$r.RADIUS+1]="COUNT";var io,ro=new Hi(Gi.SPHERE,no,$r,3);!function(e){e[e.STRIDE=0]="STRIDE",e[e.AMOUNT=1]="AMOUNT",e[e.BUFFER=2]="BUFFER",e[e.COUNT=3]="COUNT"}(io||(io={}));var oo,ao=((Oi={})[io.STRIDE]=Fi.UINT32,Oi[io.AMOUNT]=Fi.UINT32,Oi[io.BUFFER]=Fi.UINT32,Oi[io.COUNT]=Fi.NEVER,Oi),so=new Hi(Gi.FLAT_BUFFER,ao,io,3);!function(e){e[e.FLAT_BUFFER_ARRAY=0]="FLAT_BUFFER_ARRAY",e[e.COUNT=1]="COUNT"}(oo||(oo={}));var co,lo=((Ni={})[oo.FLAT_BUFFER_ARRAY]=Fi.UINT32,Ni[oo.COUNT]=Fi.NEVER,Ni),uo=new Hi(Gi.SUB_MESH,lo,oo,3);!function(e){e[e.IS_DISCARD=0]="IS_DISCARD",e[e.POLYGO_MODEL=1]="POLYGO_MODEL",e[e.SHADE_MODEL=2]="SHADE_MODEL",e[e.CULL_MODE=3]="CULL_MODE",e[e.IS_FRONT_FACE_CCW=4]="IS_FRONT_FACE_CCW",e[e.DEPTH_BIAS_ENABLED=5]="DEPTH_BIAS_ENABLED",e[e.DEPTH_BIAS=6]="DEPTH_BIAS",e[e.DEPTH_BIAS_CLAMP=7]="DEPTH_BIAS_CLAMP",e[e.DEPTH_BIAS_SLOP=8]="DEPTH_BIAS_SLOP",e[e.IS_DEPTH_CLIP=9]="IS_DEPTH_CLIP",e[e.IS_MULTI_SAMPLE=10]="IS_MULTI_SAMPLE",e[e.LINE_WIDTH=11]="LINE_WIDTH",e[e.COUNT=12]="COUNT"}(co||(co={}));var ho,_o=((Pi={})[co.IS_DISCARD]=Fi.UINT32,Pi[co.POLYGO_MODEL]=Fi.UINT32,Pi[co.SHADE_MODEL]=Fi.UINT32,Pi[co.CULL_MODE]=Fi.UINT32,Pi[co.IS_FRONT_FACE_CCW]=Fi.UINT32,Pi[co.DEPTH_BIAS_ENABLED]=Fi.UINT32,Pi[co.DEPTH_BIAS]=Fi.FLOAT32,Pi[co.DEPTH_BIAS_CLAMP]=Fi.FLOAT32,Pi[co.DEPTH_BIAS_SLOP]=Fi.FLOAT32,Pi[co.IS_DEPTH_CLIP]=Fi.UINT32,Pi[co.IS_MULTI_SAMPLE]=Fi.UINT32,Pi[co.LINE_WIDTH]=Fi.FLOAT32,Pi[co.COUNT]=Fi.NEVER,Pi),fo=new Hi(Gi.RASTERIZER_STATE,_o,co,9);!function(e){e[e.DEPTH_TEST=0]="DEPTH_TEST",e[e.DEPTH_WRITE=1]="DEPTH_WRITE",e[e.DEPTH_FUNC=2]="DEPTH_FUNC",e[e.STENCIL_TEST_FRONT=3]="STENCIL_TEST_FRONT",e[e.STENCIL_FUNC_FRONT=4]="STENCIL_FUNC_FRONT",e[e.STENCIL_READ_MASK_FRONT=5]="STENCIL_READ_MASK_FRONT",e[e.STENCIL_WRITE_MASK_FRONT=6]="STENCIL_WRITE_MASK_FRONT",e[e.STENCIL_FAIL_OP_FRONT=7]="STENCIL_FAIL_OP_FRONT",e[e.STENCIL_Z_FAIL_OP_FRONT=8]="STENCIL_Z_FAIL_OP_FRONT",e[e.STENCIL_PASS_OP_FRONT=9]="STENCIL_PASS_OP_FRONT",e[e.STENCIL_REF_FRONT=10]="STENCIL_REF_FRONT",e[e.STENCIL_TEST_BACK=11]="STENCIL_TEST_BACK",e[e.STENCIL_FUNC_BACK=12]="STENCIL_FUNC_BACK",e[e.STENCIL_READ_MADK_BACK=13]="STENCIL_READ_MADK_BACK",e[e.STENCIL_WRITE_MASK_BACK=14]="STENCIL_WRITE_MASK_BACK",e[e.STENCIL_FAIL_OP_BACK=15]="STENCIL_FAIL_OP_BACK",e[e.STENCIL_Z_FAIL_OP_BACK=16]="STENCIL_Z_FAIL_OP_BACK",e[e.STENCIL_PASS_OP_BACK=17]="STENCIL_PASS_OP_BACK",e[e.STENCIL_REF_BACK=18]="STENCIL_REF_BACK",e[e.COUNT=19]="COUNT"}(ho||(ho={}));var mo,po=((Mi={})[ho.DEPTH_TEST]=Fi.UINT32,Mi[ho.DEPTH_WRITE]=Fi.UINT32,Mi[ho.DEPTH_FUNC]=Fi.UINT32,Mi[ho.STENCIL_TEST_FRONT]=Fi.UINT32,Mi[ho.STENCIL_FUNC_FRONT]=Fi.UINT32,Mi[ho.STENCIL_READ_MASK_FRONT]=Fi.UINT32,Mi[ho.STENCIL_WRITE_MASK_FRONT]=Fi.UINT32,Mi[ho.STENCIL_FAIL_OP_FRONT]=Fi.UINT32,Mi[ho.STENCIL_Z_FAIL_OP_FRONT]=Fi.UINT32,Mi[ho.STENCIL_PASS_OP_FRONT]=Fi.UINT32,Mi[ho.STENCIL_REF_FRONT]=Fi.UINT32,Mi[ho.STENCIL_TEST_BACK]=Fi.UINT32,Mi[ho.STENCIL_FUNC_BACK]=Fi.UINT32,Mi[ho.STENCIL_READ_MADK_BACK]=Fi.UINT32,Mi[ho.STENCIL_WRITE_MASK_BACK]=Fi.UINT32,Mi[ho.STENCIL_FAIL_OP_BACK]=Fi.UINT32,Mi[ho.STENCIL_Z_FAIL_OP_BACK]=Fi.UINT32,Mi[ho.STENCIL_PASS_OP_BACK]=Fi.UINT32,Mi[ho.STENCIL_REF_BACK]=Fi.UINT32,Mi[ho.COUNT]=Fi.NEVER,Mi),vo=new Hi(Gi.DEPTH_STENCIL_STATE,po,ho,9);!function(e){e[e.BLEND=0]="BLEND",e[e.BLEND_SRC=1]="BLEND_SRC",e[e.BLEND_DST=2]="BLEND_DST",e[e.BLEND_EQ=3]="BLEND_EQ",e[e.BLEND_SRC_ALPHA=4]="BLEND_SRC_ALPHA",e[e.BLEND_DST_ALPHA=5]="BLEND_DST_ALPHA",e[e.BLEND_ALPHA_EQ=6]="BLEND_ALPHA_EQ",e[e.BLEND_COLOR_MASK=7]="BLEND_COLOR_MASK",e[e.COUNT=8]="COUNT"}(mo||(mo={})),(Di={})[mo.BLEND]=Fi.UINT32,Di[mo.BLEND_SRC]=Fi.UINT32,Di[mo.BLEND_DST]=Fi.UINT32,Di[mo.BLEND_EQ]=Fi.UINT32,Di[mo.BLEND_SRC_ALPHA]=Fi.UINT32,Di[mo.BLEND_DST_ALPHA]=Fi.UINT32,Di[mo.BLEND_ALPHA_EQ]=Fi.UINT32,Di[mo.BLEND_COLOR_MASK]=Fi.UINT32,Di[mo.COUNT]=Fi.NEVER;var go,yo=new Hi(Gi.BLEND_TARGET,po,mo,9);!function(e){e[e.IS_A2C=0]="IS_A2C",e[e.IS_INDEPEND=1]="IS_INDEPEND",e[e.BLEND_COLOR=2]="BLEND_COLOR",e[e.BLEND_TARGET=6]="BLEND_TARGET",e[e.COUNT=7]="COUNT"}(go||(go={}));var xo=((Li={})[go.IS_A2C]=Fi.UINT32,Li[go.IS_INDEPEND]=Fi.UINT32,Li[go.BLEND_COLOR]=Fi.FLOAT32,Li[go.BLEND_TARGET]=Fi.UINT32,Li[go.COUNT]=Fi.NEVER,Li),Eo=new Hi(Gi.BLEND_STATE,xo,go,9),So=function(){function e(){this._skyColor=new Dn(51,128,204,1),this._groundAlbedo=new Dn(51,51,51,255),this._albedoArray=Float32Array.from([.2,.2,.2,1]),this._colorArray=Float32Array.from([.2,.5,.8,1]),this._handle=Yi,this._handle=Vr.alloc()}Z(e,[{key:"colorArray",get:function(){return this._colorArray}},{key:"albedoArray",get:function(){return this._albedoArray}},{key:"enabled",set:function(e){Vr.set(this._handle,Br.ENABLE,e?1:0)},get:function(){return Vr.get(this._handle,Br.ENABLE)}},{key:"skyColor",get:function(){return this._skyColor},set:function(e){this._skyColor.set(e),Dn.toArray(this._colorArray,this._skyColor),Vr.setVec4(this._handle,Br.SKY_COLOR,this._skyColor)}},{key:"skyIllum",get:function(){return Vr.get(this._handle,Br.ILLUM)},set:function(e){Vr.set(this._handle,Br.ILLUM,e)}},{key:"groundAlbedo",get:function(){return this._groundAlbedo},set:function(e){this._groundAlbedo.set(e),Fn.toArray(this._albedoArray,this._groundAlbedo),Vr.setVec4(this._handle,Br.GROUND_ALBEDO,this._groundAlbedo)}},{key:"handle",get:function(){return this._handle}}]);var t=e.prototype;return t.initialize=function(e){this._skyColor.set(e.skyColor),this._groundAlbedo.set(e.groundAlbedo),Dn.toArray(this._colorArray,this._skyColor),Fn.toArray(this._albedoArray,this._groundAlbedo),Vr.setVec4(this._handle,Br.SKY_COLOR,this._skyColor),Vr.setVec4(this._handle,Br.GROUND_ALBEDO,this._groundAlbedo),Vr.set(this._handle,Br.ILLUM,e.skyIllum)},t.destroy=function(){this._handle&&(Vr.free(this._handle),this._handle=Yi)},e}();So.SUN_ILLUM=65e3,So.SKY_ILLUM=2e4,c.Ambient=So;var To=new Fn,Ao=new Fn,Co=new Fn,wo=new Fn,Io=new Fn,bo=new Fn,Ro=new Array(3),Oo=new Array(3);function No(e,t){return Fn.dot(t.n,e)-t.d}function Po(e,t,n){return Fn.copy(e,t),Fn.subtract(Io,n.center,n.halfExtents),Fn.add(bo,n.center,n.halfExtents),e.x=e.x<Io.x?Io.x:e.x,e.y=e.y<Io.y?Io.y:e.y,e.z=e.z<Io.z?Io.z:e.z,e.x=e.x>bo.x?bo.x:e.x,e.y=e.y>bo.y?bo.y:e.y,e.z=e.z>bo.z?bo.z:e.z,e}function Mo(e,t,n){Fn.set(To,n.orientation.m00,n.orientation.m01,n.orientation.m02),Fn.set(Ao,n.orientation.m03,n.orientation.m04,n.orientation.m05),Fn.set(Co,n.orientation.m06,n.orientation.m07,n.orientation.m08),Ro[0]=To,Ro[1]=Ao,Ro[2]=Co,Oo[0]=n.halfExtents.x,Oo[1]=n.halfExtents.y,Oo[2]=n.halfExtents.z,Fn.subtract(wo,t,n.center),Fn.set(e,n.center.x,n.center.y,n.center.z);for(var i=0;i<3;i++){var r=Fn.dot(wo,Ro[i]);r>Oo[i]&&(r=Oo[i]),r<-Oo[i]&&(r=-Oo[i]),e.x+=r*Ro[i].x,e.y+=r*Ro[i].y,e.z+=r*Ro[i].z}return e}var Do=Object.freeze({__proto__:null,point_plane:No,pt_point_plane:function(e,t,n){var i=No(t,n);return Fn.subtract(e,t,Fn.multiplyScalar(e,n.n,i))},pt_point_aabb:Po,pt_point_obb:Mo,pt_point_line:function(e,t,n,i){Fn.subtract(To,n,i);var r=To,o=Fn.lengthSqr(r);if(0==o)Fn.copy(e,n);else{Fn.subtract(To,t,n);var a=Fn.dot(To,r)/o;a<0?Fn.copy(e,n):a>1?Fn.copy(e,i):Fn.scaleAndAdd(e,n,r,a)}}}),Lo={SHAPE_RAY:1,SHAPE_LINE:2,SHAPE_SPHERE:4,SHAPE_AABB:8,SHAPE_OBB:16,SHAPE_PLANE:32,SHAPE_TRIANGLE:64,SHAPE_FRUSTUM:128,SHAPE_FRUSTUM_ACCURATE:256,SHAPE_CAPSULE:512},Fo=function(){function e(e,t,n,i,r,o){void 0===e&&(e=0),void 0===t&&(t=0),void 0===n&&(n=0),void 0===i&&(i=0),void 0===r&&(r=0),void 0===o&&(o=-1),this.s=void 0,this.e=void 0,this._type=void 0,this._type=Lo.SHAPE_LINE,this.s=new Fn(e,t,n),this.e=new Fn(i,r,o)}return e.create=function(t,n,i,r,o,a){return new e(t,n,i,r,o,a)},e.clone=function(t){return new e(t.s.x,t.s.y,t.s.z,t.e.x,t.e.y,t.e.z)},e.copy=function(e,t){return Fn.copy(e.s,t.s),Fn.copy(e.e,t.e),e},e.fromPoints=function(e,t,n){return Fn.copy(e.s,t),Fn.copy(e.e,n),e},e.set=function(e,t,n,i,r,o,a){return e.s.x=t,e.s.y=n,e.s.z=i,e.e.x=r,e.e.y=o,e.e.z=a,e},e.len=function(e){return Fn.distance(e.s,e.e)},Z(e,[{key:"type",get:function(){return this._type}}]),e.prototype.length=function(){return Fn.distance(this.s,this.e)},e}(),zo=function(){function e(e,t,n,i,r,o){void 0===e&&(e=0),void 0===t&&(t=0),void 0===n&&(n=0),void 0===i&&(i=0),void 0===r&&(r=0),void 0===o&&(o=-1),this.o=void 0,this.d=void 0,this._type=void 0,this._type=Lo.SHAPE_RAY,this.o=new Fn(e,t,n),this.d=new Fn(i,r,o)}return e.create=function(t,n,i,r,o,a){return void 0===t&&(t=0),void 0===n&&(n=0),void 0===i&&(i=0),void 0===r&&(r=0),void 0===o&&(o=0),void 0===a&&(a=1),new e(t,n,i,r,o,a)},e.clone=function(t){return new e(t.o.x,t.o.y,t.o.z,t.d.x,t.d.y,t.d.z)},e.copy=function(e,t){return Fn.copy(e.o,t.o),Fn.copy(e.d,t.d),e},e.fromPoints=function(e,t,n){return Fn.copy(e.o,t),Fn.normalize(e.d,Fn.subtract(e.d,n,t)),e},e.set=function(e,t,n,i,r,o,a){return e.o.x=t,e.o.y=n,e.o.z=i,e.d.x=r,e.d.y=o,e.d.z=a,e},Z(e,[{key:"type",get:function(){return this._type}}]),e.prototype.computeHit=function(e,t){Fn.normalize(e,this.d),Fn.scaleAndAdd(e,this.o,e,t)},e}(),Bo=new Fn,Uo=new Fn,Go=new Fn,Ho=new Fn;function ko(e){return Math.max(Math.max(e.x,e.y),e.z)}var Vo,jo=e("db",function(){function e(e,t,n,i){void 0===e&&(e=0),void 0===t&&(t=0),void 0===n&&(n=0),void 0===i&&(i=1),this._center=new Fn(0,0,0),this._poolHandle=Yi,this._type=void 0,this._type=Lo.SHAPE_SPHERE,this._center=new Fn(e,t,n),this._poolHandle=ro.alloc(),ro.setVec3(this._poolHandle,$r.CENTER,this._center),ro.set(this._poolHandle,$r.RADIUS,i)}e.create=function(t,n,i,r){return new e(t,n,i,r)},e.clone=function(t){return new e(t.center.x,t.center.y,t.center.z,t.radius)},e.copy=function(e,t){return Fn.copy(e.center,t.center),e.radius=t.radius,e},e.fromPoints=function(e,t,n){return Fn.multiplyScalar(e.center,Fn.add(Bo,t,n),.5),e.radius=.5*Fn.subtract(Bo,n,t).length(),e},e.set=function(e,t,n,i,r){return e.center.x=t,e.center.y=n,e.center.z=i,e.radius=r,e},e.mergePoint=function(e,t,n){if(t.radius<0)return e.center.set(n),e.radius=0,e;Fn.subtract(Uo,n,t.center);var i=Uo.length();if(i>t.radius){var r=.5*(i-t.radius);e.radius+=r,Fn.multiplyScalar(Uo,Uo,r/i),Fn.add(e.center,e.center,Uo)}return e},e.mergeAABB=function(t,n,i){return i.getBoundary(Go,Ho),e.mergePoint(t,n,Go),e.mergePoint(t,n,Ho),t},Z(e,[{key:"center",get:function(){return this._center},set:function(e){this._center=e,ro.setVec3(this._poolHandle,$r.CENTER,this._center)}},{key:"radius",get:function(){return ro.get(this._poolHandle,$r.RADIUS)},set:function(e){ro.set(this._poolHandle,$r.RADIUS,e)}},{key:"handle",get:function(){return this._poolHandle}},{key:"type",get:function(){return this._type}}]);var t=e.prototype;return t.destroy=function(){this._poolHandle&&(ro.free(this._poolHandle),this._poolHandle=Yi)},t.clone=function(){return e.clone(this)},t.copy=function(t){return e.copy(this,t)},t.getBoundary=function(e,t){Fn.set(e,this.center.x-this.radius,this.center.y-this.radius,this.center.z-this.radius),Fn.set(t,this.center.x+this.radius,this.center.y+this.radius,this.center.z+this.radius)},t.transform=function(e,t,n,i,r){Fn.transformMat4(r.center,this.center,e),r.radius=this.radius*ko(i)},t.translateAndRotate=function(e,t,n){Fn.transformMat4(n.center,this.center,e)},t.setScale=function(e,t){t.radius=this.radius*ko(e)},e}()),Wo=function(){function e(e,t,n,i,r,o,a,s,c){void 0===e&&(e=0),void 0===t&&(t=0),void 0===n&&(n=0),void 0===i&&(i=1),void 0===r&&(r=0),void 0===o&&(o=0),void 0===a&&(a=0),void 0===s&&(s=1),void 0===c&&(c=0),this.a=void 0,this.b=void 0,this.c=void 0,this._type=void 0,this._type=Lo.SHAPE_TRIANGLE,this.a=new Fn(e,t,n),this.b=new Fn(i,r,o),this.c=new Fn(a,s,c)}return e.create=function(t,n,i,r,o,a,s,c,l){return void 0===t&&(t=1),void 0===n&&(n=0),void 0===i&&(i=0),void 0===r&&(r=0),void 0===o&&(o=0),void 0===a&&(a=0),void 0===s&&(s=0),void 0===c&&(c=0),void 0===l&&(l=1),new e(t,n,i,r,o,a,s,c,l)},e.clone=function(t){return new e(t.a.x,t.a.y,t.a.z,t.b.x,t.b.y,t.b.z,t.c.x,t.c.y,t.c.z)},e.copy=function(e,t){return Fn.copy(e.a,t.a),Fn.copy(e.b,t.b),Fn.copy(e.c,t.c),e},e.fromPoints=function(e,t,n,i){return Fn.copy(e.a,t),Fn.copy(e.b,n),Fn.copy(e.c,i),e},e.set=function(e,t,n,i,r,o,a,s,c,l){return e.a.x=t,e.a.y=n,e.a.z=i,e.b.x=r,e.b.y=o,e.b.z=a,e.c.x=s,e.c.y=c,e.c.z=l,e},Z(e,[{key:"type",get:function(){return this._type}}]),e}(),qo=e("ey",4);!function(e){e[e.UNKNOWN=0]="UNKNOWN",e[e.BUFFER=1]="BUFFER",e[e.TEXTURE=2]="TEXTURE",e[e.RENDER_PASS=3]="RENDER_PASS",e[e.FRAMEBUFFER=4]="FRAMEBUFFER",e[e.SAMPLER=5]="SAMPLER",e[e.SHADER=6]="SHADER",e[e.DESCRIPTOR_SET_LAYOUT=7]="DESCRIPTOR_SET_LAYOUT",e[e.PIPELINE_LAYOUT=8]="PIPELINE_LAYOUT",e[e.PIPELINE_STATE=9]="PIPELINE_STATE",e[e.DESCRIPTOR_SET=10]="DESCRIPTOR_SET",e[e.INPUT_ASSEMBLER=11]="INPUT_ASSEMBLER",e[e.COMMAND_BUFFER=12]="COMMAND_BUFFER",e[e.FENCE=13]="FENCE",e[e.QUEUE=14]="QUEUE",e[e.WINDOW=15]="WINDOW"}(Vo||(Vo=e("ez",{})));var Yo,Xo,Ko,Qo,Zo,Jo,$o,ea,ta,na,ia,ra,oa,aa,sa,ca,la,ua,ha,_a,fa,ma,da,pa,va,ga,ya,xa,Ea,Sa,Ta,Aa,Ca,wa,Ia,ba,Ra,Oa=e("eA",function(){function e(e){this._gfxType=Vo.UNKNOWN,this._gfxType=e}return Z(e,[{key:"gfxType",get:function(){return this._gfxType}}]),e}());!function(e){e.ATTR_POSITION="a_position",e.ATTR_NORMAL="a_normal",e.ATTR_TANGENT="a_tangent",e.ATTR_BITANGENT="a_bitangent",e.ATTR_WEIGHTS="a_weights",e.ATTR_JOINTS="a_joints",e.ATTR_COLOR="a_color",e.ATTR_COLOR1="a_color1",e.ATTR_COLOR2="a_color2",e.ATTR_TEX_COORD="a_texCoord",e.ATTR_TEX_COORD1="a_texCoord1",e.ATTR_TEX_COORD2="a_texCoord2",e.ATTR_TEX_COORD3="a_texCoord3",e.ATTR_TEX_COORD4="a_texCoord4",e.ATTR_TEX_COORD5="a_texCoord5",e.ATTR_TEX_COORD6="a_texCoord6",e.ATTR_TEX_COORD7="a_texCoord7",e.ATTR_TEX_COORD8="a_texCoord8",e.ATTR_BATCH_ID="a_batch_id",e.ATTR_BATCH_UV="a_batch_uv"}(Yo||(Yo=e("at",{}))),function(e){e[e.UNKNOWN=0]="UNKNOWN",e[e.BOOL=1]="BOOL",e[e.BOOL2=2]="BOOL2",e[e.BOOL3=3]="BOOL3",e[e.BOOL4=4]="BOOL4",e[e.INT=5]="INT",e[e.INT2=6]="INT2",e[e.INT3=7]="INT3",e[e.INT4=8]="INT4",e[e.UINT=9]="UINT",e[e.UINT2=10]="UINT2",e[e.UINT3=11]="UINT3",e[e.UINT4=12]="UINT4",e[e.FLOAT=13]="FLOAT",e[e.FLOAT2=14]="FLOAT2",e[e.FLOAT3=15]="FLOAT3",e[e.FLOAT4=16]="FLOAT4",e[e.MAT2=17]="MAT2",e[e.MAT2X3=18]="MAT2X3",e[e.MAT2X4=19]="MAT2X4",e[e.MAT3X2=20]="MAT3X2",e[e.MAT3=21]="MAT3",e[e.MAT3X4=22]="MAT3X4",e[e.MAT4X2=23]="MAT4X2",e[e.MAT4X3=24]="MAT4X3",e[e.MAT4=25]="MAT4",e[e.SAMPLER1D=26]="SAMPLER1D",e[e.SAMPLER1D_ARRAY=27]="SAMPLER1D_ARRAY",e[e.SAMPLER2D=28]="SAMPLER2D",e[e.SAMPLER2D_ARRAY=29]="SAMPLER2D_ARRAY",e[e.SAMPLER3D=30]="SAMPLER3D",e[e.SAMPLER_CUBE=31]="SAMPLER_CUBE",e[e.COUNT=32]="COUNT"}(Xo||(Xo=e("A",{}))),function(e){e[e.UNKNOWN=0]="UNKNOWN",e[e.A8=1]="A8",e[e.L8=2]="L8",e[e.LA8=3]="LA8",e[e.R8=4]="R8",e[e.R8SN=5]="R8SN",e[e.R8UI=6]="R8UI",e[e.R8I=7]="R8I",e[e.R16F=8]="R16F",e[e.R16UI=9]="R16UI",e[e.R16I=10]="R16I",e[e.R32F=11]="R32F",e[e.R32UI=12]="R32UI",e[e.R32I=13]="R32I",e[e.RG8=14]="RG8",e[e.RG8SN=15]="RG8SN",e[e.RG8UI=16]="RG8UI",e[e.RG8I=17]="RG8I",e[e.RG16F=18]="RG16F",e[e.RG16UI=19]="RG16UI",e[e.RG16I=20]="RG16I",e[e.RG32F=21]="RG32F",e[e.RG32UI=22]="RG32UI",e[e.RG32I=23]="RG32I",e[e.RGB8=24]="RGB8",e[e.SRGB8=25]="SRGB8",e[e.RGB8SN=26]="RGB8SN",e[e.RGB8UI=27]="RGB8UI",e[e.RGB8I=28]="RGB8I",e[e.RGB16F=29]="RGB16F",e[e.RGB16UI=30]="RGB16UI",e[e.RGB16I=31]="RGB16I",e[e.RGB32F=32]="RGB32F",e[e.RGB32UI=33]="RGB32UI",e[e.RGB32I=34]="RGB32I",e[e.RGBA8=35]="RGBA8",e[e.BGRA8=36]="BGRA8",e[e.SRGB8_A8=37]="SRGB8_A8",e[e.RGBA8SN=38]="RGBA8SN",e[e.RGBA8UI=39]="RGBA8UI",e[e.RGBA8I=40]="RGBA8I",e[e.RGBA16F=41]="RGBA16F",e[e.RGBA16UI=42]="RGBA16UI",e[e.RGBA16I=43]="RGBA16I",e[e.RGBA32F=44]="RGBA32F",e[e.RGBA32UI=45]="RGBA32UI",e[e.RGBA32I=46]="RGBA32I",e[e.R5G6B5=47]="R5G6B5",e[e.R11G11B10F=48]="R11G11B10F",e[e.RGB5A1=49]="RGB5A1",e[e.RGBA4=50]="RGBA4",e[e.RGB10A2=51]="RGB10A2",e[e.RGB10A2UI=52]="RGB10A2UI",e[e.RGB9E5=53]="RGB9E5",e[e.D16=54]="D16",e[e.D16S8=55]="D16S8",e[e.D24=56]="D24",e[e.D24S8=57]="D24S8",e[e.D32F=58]="D32F",e[e.D32F_S8=59]="D32F_S8",e[e.BC1=60]="BC1",e[e.BC1_ALPHA=61]="BC1_ALPHA",e[e.BC1_SRGB=62]="BC1_SRGB",e[e.BC1_SRGB_ALPHA=63]="BC1_SRGB_ALPHA",e[e.BC2=64]="BC2",e[e.BC2_SRGB=65]="BC2_SRGB",e[e.BC3=66]="BC3",e[e.BC3_SRGB=67]="BC3_SRGB",e[e.BC4=68]="BC4",e[e.BC4_SNORM=69]="BC4_SNORM",e[e.BC5=70]="BC5",e[e.BC5_SNORM=71]="BC5_SNORM",e[e.BC6H_UF16=72]="BC6H_UF16",e[e.BC6H_SF16=73]="BC6H_SF16",e[e.BC7=74]="BC7",e[e.BC7_SRGB=75]="BC7_SRGB",e[e.ETC_RGB8=76]="ETC_RGB8",e[e.ETC2_RGB8=77]="ETC2_RGB8",e[e.ETC2_SRGB8=78]="ETC2_SRGB8",e[e.ETC2_RGB8_A1=79]="ETC2_RGB8_A1",e[e.ETC2_SRGB8_A1=80]="ETC2_SRGB8_A1",e[e.ETC2_RGBA8=81]="ETC2_RGBA8",e[e.ETC2_SRGB8_A8=82]="ETC2_SRGB8_A8",e[e.EAC_R11=83]="EAC_R11",e[e.EAC_R11SN=84]="EAC_R11SN",e[e.EAC_RG11=85]="EAC_RG11",e[e.EAC_RG11SN=86]="EAC_RG11SN",e[e.PVRTC_RGB2=87]="PVRTC_RGB2",e[e.PVRTC_RGBA2=88]="PVRTC_RGBA2",e[e.PVRTC_RGB4=89]="PVRTC_RGB4",e[e.PVRTC_RGBA4=90]="PVRTC_RGBA4",e[e.PVRTC2_2BPP=91]="PVRTC2_2BPP",e[e.PVRTC2_4BPP=92]="PVRTC2_4BPP",e[e.ASTC_RGBA_4x4=93]="ASTC_RGBA_4x4",e[e.ASTC_RGBA_5x4=94]="ASTC_RGBA_5x4",e[e.ASTC_RGBA_5x5=95]="ASTC_RGBA_5x5",e[e.ASTC_RGBA_6x5=96]="ASTC_RGBA_6x5",e[e.ASTC_RGBA_6x6=97]="ASTC_RGBA_6x6",e[e.ASTC_RGBA_8x5=98]="ASTC_RGBA_8x5",e[e.ASTC_RGBA_8x6=99]="ASTC_RGBA_8x6",e[e.ASTC_RGBA_8x8=100]="ASTC_RGBA_8x8",e[e.ASTC_RGBA_10x5=101]="ASTC_RGBA_10x5",e[e.ASTC_RGBA_10x6=102]="ASTC_RGBA_10x6",e[e.ASTC_RGBA_10x8=103]="ASTC_RGBA_10x8",e[e.ASTC_RGBA_10x10=104]="ASTC_RGBA_10x10",e[e.ASTC_RGBA_12x10=105]="ASTC_RGBA_12x10",e[e.ASTC_RGBA_12x12=106]="ASTC_RGBA_12x12",e[e.ASTC_SRGBA_4x4=107]="ASTC_SRGBA_4x4",e[e.ASTC_SRGBA_5x4=108]="ASTC_SRGBA_5x4",e[e.ASTC_SRGBA_5x5=109]="ASTC_SRGBA_5x5",e[e.ASTC_SRGBA_6x5=110]="ASTC_SRGBA_6x5",e[e.ASTC_SRGBA_6x6=111]="ASTC_SRGBA_6x6",e[e.ASTC_SRGBA_8x5=112]="ASTC_SRGBA_8x5",e[e.ASTC_SRGBA_8x6=113]="ASTC_SRGBA_8x6",e[e.ASTC_SRGBA_8x8=114]="ASTC_SRGBA_8x8",e[e.ASTC_SRGBA_10x5=115]="ASTC_SRGBA_10x5",e[e.ASTC_SRGBA_10x6=116]="ASTC_SRGBA_10x6",e[e.ASTC_SRGBA_10x8=117]="ASTC_SRGBA_10x8",e[e.ASTC_SRGBA_10x10=118]="ASTC_SRGBA_10x10",e[e.ASTC_SRGBA_12x10=119]="ASTC_SRGBA_12x10",e[e.ASTC_SRGBA_12x12=120]="ASTC_SRGBA_12x12"}(Ko||(Ko=e("F",{}))),function(e){e[e.NONE=0]="NONE",e[e.TRANSFER_SRC=1]="TRANSFER_SRC",e[e.TRANSFER_DST=2]="TRANSFER_DST",e[e.INDEX=4]="INDEX",e[e.VERTEX=8]="VERTEX",e[e.UNIFORM=16]="UNIFORM",e[e.STORAGE=32]="STORAGE",e[e.INDIRECT=64]="INDIRECT"}(Qo||(Qo=e("B",{}))),function(e){e[e.NONE=0]="NONE",e[e.DEVICE=1]="DEVICE",e[e.HOST=2]="HOST"}(Zo||(Zo=e("q",{}))),function(e){e[e.NONE=0]="NONE",e[e.BAKUP_BUFFER=4]="BAKUP_BUFFER"}(Jo||(Jo=e("G",{}))),function(e){e[e.NONE=0]="NONE",e[e.READ=1]="READ",e[e.WRITE=2]="WRITE"}($o||($o=e("eB",{}))),function(e){e[e.POINT_LIST=0]="POINT_LIST",e[e.LINE_LIST=1]="LINE_LIST",e[e.LINE_STRIP=2]="LINE_STRIP",e[e.LINE_LOOP=3]="LINE_LOOP",e[e.LINE_LIST_ADJACENCY=4]="LINE_LIST_ADJACENCY",e[e.LINE_STRIP_ADJACENCY=5]="LINE_STRIP_ADJACENCY",e[e.ISO_LINE_LIST=6]="ISO_LINE_LIST",e[e.TRIANGLE_LIST=7]="TRIANGLE_LIST",e[e.TRIANGLE_STRIP=8]="TRIANGLE_STRIP",e[e.TRIANGLE_FAN=9]="TRIANGLE_FAN",e[e.TRIANGLE_LIST_ADJACENCY=10]="TRIANGLE_LIST_ADJACENCY",e[e.TRIANGLE_STRIP_ADJACENCY=11]="TRIANGLE_STRIP_ADJACENCY",e[e.TRIANGLE_PATCH_ADJACENCY=12]="TRIANGLE_PATCH_ADJACENCY",e[e.QUAD_PATCH_LIST=13]="QUAD_PATCH_LIST"}(ea||(ea=e("aV",{}))),function(e){e[e.FILL=0]="FILL",e[e.POINT=1]="POINT",e[e.LINE=2]="LINE"}(ta||(ta=e("eC",{}))),function(e){e[e.GOURAND=0]="GOURAND",e[e.FLAT=1]="FLAT"}(na||(na=e("eD",{}))),function(e){e[e.NONE=0]="NONE",e[e.FRONT=1]="FRONT",e[e.BACK=2]="BACK"}(ia||(ia=e("v",{}))),function(e){e[e.NEVER=0]="NEVER",e[e.LESS=1]="LESS",e[e.EQUAL=2]="EQUAL",e[e.LESS_EQUAL=3]="LESS_EQUAL",e[e.GREATER=4]="GREATER",e[e.NOT_EQUAL=5]="NOT_EQUAL",e[e.GREATER_EQUAL=6]="GREATER_EQUAL",e[e.ALWAYS=7]="ALWAYS"}(ra||(ra=e("c1",{}))),function(e){e[e.ZERO=0]="ZERO",e[e.KEEP=1]="KEEP",e[e.REPLACE=2]="REPLACE",e[e.INCR=3]="INCR",e[e.DECR=4]="DECR",e[e.INVERT=5]="INVERT",e[e.INCR_WRAP=6]="INCR_WRAP",e[e.DECR_WRAP=7]="DECR_WRAP"}(oa||(oa=e("c2",{}))),function(e){e[e.ADD=0]="ADD",e[e.SUB=1]="SUB",e[e.REV_SUB=2]="REV_SUB",e[e.MIN=3]="MIN",e[e.MAX=4]="MAX"}(aa||(aa=e("dr",{}))),function(e){e[e.ZERO=0]="ZERO",e[e.ONE=1]="ONE",e[e.SRC_ALPHA=2]="SRC_ALPHA",e[e.DST_ALPHA=3]="DST_ALPHA",e[e.ONE_MINUS_SRC_ALPHA=4]="ONE_MINUS_SRC_ALPHA",e[e.ONE_MINUS_DST_ALPHA=5]="ONE_MINUS_DST_ALPHA",e[e.SRC_COLOR=6]="SRC_COLOR",e[e.DST_COLOR=7]="DST_COLOR",e[e.ONE_MINUS_SRC_COLOR=8]="ONE_MINUS_SRC_COLOR",e[e.ONE_MINUS_DST_COLOR=9]="ONE_MINUS_DST_COLOR",e[e.SRC_ALPHA_SATURATE=10]="SRC_ALPHA_SATURATE",e[e.CONSTANT_COLOR=11]="CONSTANT_COLOR",e[e.ONE_MINUS_CONSTANT_COLOR=12]="ONE_MINUS_CONSTANT_COLOR",e[e.CONSTANT_ALPHA=13]="CONSTANT_ALPHA",e[e.ONE_MINUS_CONSTANT_ALPHA=14]="ONE_MINUS_CONSTANT_ALPHA"}(sa||(sa=e("c4",{}))),function(e){e[e.NONE=0]="NONE",e[e.R=1]="R",e[e.G=2]="G",e[e.B=4]="B",e[e.A=8]="A",e[e.ALL=15]="ALL"}(ca||(ca=e("u",{}))),function(e){e[e.NONE=0]="NONE",e[e.POINT=1]="POINT",e[e.LINEAR=2]="LINEAR",e[e.ANISOTROPIC=3]="ANISOTROPIC"}(la||(la=e("a2",{}))),function(e){e[e.WRAP=0]="WRAP",e[e.MIRROR=1]="MIRROR",e[e.CLAMP=2]="CLAMP",e[e.BORDER=3]="BORDER"}(ua||(ua=e("bu",{}))),function(e){e[e.TEX1D=0]="TEX1D",e[e.TEX2D=1]="TEX2D",e[e.TEX3D=2]="TEX3D",e[e.CUBE=3]="CUBE",e[e.TEX1D_ARRAY=4]="TEX1D_ARRAY",e[e.TEX2D_ARRAY=5]="TEX2D_ARRAY"}(ha||(ha=e("T",{}))),function(e){e[e.NONE=0]="NONE",e[e.TRANSFER_SRC=1]="TRANSFER_SRC",e[e.TRANSFER_DST=2]="TRANSFER_DST",e[e.SAMPLED=4]="SAMPLED",e[e.STORAGE=8]="STORAGE",e[e.COLOR_ATTACHMENT=16]="COLOR_ATTACHMENT",e[e.DEPTH_STENCIL_ATTACHMENT=32]="DEPTH_STENCIL_ATTACHMENT",e[e.TRANSIENT_ATTACHMENT=64]="TRANSIENT_ATTACHMENT",e[e.INPUT_ATTACHMENT=128]="INPUT_ATTACHMENT"}(_a||(_a=e("al",{}))),function(e){e[e.X1=0]="X1",e[e.X2=1]="X2",e[e.X4=2]="X4",e[e.X8=3]="X8",e[e.X16=4]="X16",e[e.X32=5]="X32",e[e.X64=6]="X64"}(fa||(fa=e("S",{}))),function(e){e[e.NONE=0]="NONE",e[e.GEN_MIPMAP=1]="GEN_MIPMAP",e[e.CUBEMAP=2]="CUBEMAP",e[e.BAKUP_BUFFER=4]="BAKUP_BUFFER",e[e.IMMUTABLE=8]="IMMUTABLE"}(ma||(ma=e("z",{}))),function(e){e[e.NONE=0]="NONE",e[e.VERTEX=1]="VERTEX",e[e.CONTROL=2]="CONTROL",e[e.EVALUATION=4]="EVALUATION",e[e.GEOMETRY=8]="GEOMETRY",e[e.FRAGMENT=16]="FRAGMENT",e[e.COMPUTE=32]="COMPUTE",e[e.ALL=63]="ALL"}(da||(da=e("E",{}))),function(e){e[e.UNKNOWN=0]="UNKNOWN",e[e.UNIFORM_BUFFER=1]="UNIFORM_BUFFER",e[e.DYNAMIC_UNIFORM_BUFFER=2]="DYNAMIC_UNIFORM_BUFFER",e[e.STORAGE_BUFFER=4]="STORAGE_BUFFER",e[e.DYNAMIC_STORAGE_BUFFER=8]="DYNAMIC_STORAGE_BUFFER",e[e.SAMPLER=16]="SAMPLER"}(pa||(pa=e("eE",{}))),function(e){e[e.PRIMARY=0]="PRIMARY",e[e.SECONDARY=1]="SECONDARY"}(va||(va=e("K",{}))),function(e){e[e.LOAD=0]="LOAD",e[e.CLEAR=1]="CLEAR",e[e.DISCARD=2]="DISCARD"}(ga||(ga=e("L",{}))),function(e){e[e.STORE=0]="STORE",e[e.DISCARD=1]="DISCARD"}(ya||(ya=e("eF",{}))),function(e){e[e.UNDEFINED=0]="UNDEFINED",e[e.GENERAL=1]="GENERAL",e[e.COLOR_ATTACHMENT_OPTIMAL=2]="COLOR_ATTACHMENT_OPTIMAL",e[e.DEPTH_STENCIL_ATTACHMENT_OPTIMAL=3]="DEPTH_STENCIL_ATTACHMENT_OPTIMAL",e[e.DEPTH_STENCIL_READONLY_OPTIMAL=4]="DEPTH_STENCIL_READONLY_OPTIMAL",e[e.SHADER_READONLY_OPTIMAL=5]="SHADER_READONLY_OPTIMAL",e[e.TRANSFER_SRC_OPTIMAL=6]="TRANSFER_SRC_OPTIMAL",e[e.TRANSFER_DST_OPTIMAL=7]="TRANSFER_DST_OPTIMAL",e[e.PREINITIALIZED=8]="PREINITIALIZED",e[e.PRESENT_SRC=9]="PRESENT_SRC"}(xa||(xa=e("eG",{}))),function(e){e[e.GRAPHICS=0]="GRAPHICS",e[e.COMPUTE=1]="COMPUTE",e[e.RAY_TRACING=2]="RAY_TRACING"}(Ea||(Ea=e("eH",{}))),function(e){e[e.NONE=0]="NONE",e[e.VIEWPORT=1]="VIEWPORT",e[e.SCISSOR=2]="SCISSOR",e[e.LINE_WIDTH=4]="LINE_WIDTH",e[e.DEPTH_BIAS=8]="DEPTH_BIAS",e[e.BLEND_CONSTANTS=16]="BLEND_CONSTANTS",e[e.DEPTH_BOUNDS=32]="DEPTH_BOUNDS",e[e.STENCIL_WRITE_MASK=64]="STENCIL_WRITE_MASK",e[e.STENCIL_COMPARE_MASK=128]="STENCIL_COMPARE_MASK"}(Sa||(Sa=e("x",{}))),function(e){e[e.FRONT=0]="FRONT",e[e.BACK=1]="BACK",e[e.ALL=2]="ALL"}(Ta||(Ta=e("y",{}))),function(e){e[e.GRAPHICS=0]="GRAPHICS",e[e.COMPUTE=1]="COMPUTE",e[e.TRANSFER=2]="TRANSFER"}(Aa||(Aa=e("ai",{}))),function(e){e[e.NONE=0]="NONE",e[e.COLOR=1]="COLOR",e[e.DEPTH=2]="DEPTH",e[e.STENCIL=4]="STENCIL",e[e.DEPTH_STENCIL=6]="DEPTH_STENCIL",e[e.ALL=7]="ALL"}(Ca||(Ca=e("o",{}))),function(e){e[e.NONE=0]="NONE",e[e.UNORM=1]="UNORM",e[e.SNORM=2]="SNORM",e[e.UINT=3]="UINT",e[e.INT=4]="INT",e[e.UFLOAT=5]="UFLOAT",e[e.FLOAT=6]="FLOAT"}(wa||(wa=e("aP",{}))),function(e){e[e.UNKNOWN=0]="UNKNOWN",e[e.GLES2=1]="GLES2",e[e.GLES3=2]="GLES3",e[e.METAL=3]="METAL",e[e.VULKAN=4]="VULKAN",e[e.WEBGL=5]="WEBGL",e[e.WEBGL2=6]="WEBGL2",e[e.WEBGPU=7]="WEBGPU"}(Ia||(Ia=e("ac",{}))),function(e){e[e.IDENTITY=0]="IDENTITY",e[e.ROTATE_90=1]="ROTATE_90",e[e.ROTATE_180=2]="ROTATE_180",e[e.ROTATE_270=3]="ROTATE_270"}(ba||(ba=e("eI",{}))),function(e){e[e.COLOR_FLOAT=0]="COLOR_FLOAT",e[e.COLOR_HALF_FLOAT=1]="COLOR_HALF_FLOAT",e[e.TEXTURE_FLOAT=2]="TEXTURE_FLOAT",e[e.TEXTURE_HALF_FLOAT=3]="TEXTURE_HALF_FLOAT",e[e.TEXTURE_FLOAT_LINEAR=4]="TEXTURE_FLOAT_LINEAR",e[e.TEXTURE_HALF_FLOAT_LINEAR=5]="TEXTURE_HALF_FLOAT_LINEAR",e[e.FORMAT_R11G11B10F=6]="FORMAT_R11G11B10F",e[e.FORMAT_D16=7]="FORMAT_D16",e[e.FORMAT_D16S8=8]="FORMAT_D16S8",e[e.FORMAT_D24=9]="FORMAT_D24",e[e.FORMAT_D24S8=10]="FORMAT_D24S8",e[e.FORMAT_D32F=11]="FORMAT_D32F",e[e.FORMAT_D32FS8=12]="FORMAT_D32FS8",e[e.FORMAT_ETC1=13]="FORMAT_ETC1",e[e.FORMAT_ETC2=14]="FORMAT_ETC2",e[e.FORMAT_DXT=15]="FORMAT_DXT",e[e.FORMAT_PVRTC=16]="FORMAT_PVRTC",e[e.FORMAT_ASTC=17]="FORMAT_ASTC",e[e.FORMAT_RGB8=18]="FORMAT_RGB8",e[e.MSAA=19]="MSAA",e[e.ELEMENT_INDEX_UINT=20]="ELEMENT_INDEX_UINT",e[e.INSTANCED_ARRAYS=21]="INSTANCED_ARRAYS",e[e.MULTIPLE_RENDER_TARGETS=22]="MULTIPLE_RENDER_TARGETS",e[e.BLEND_MINMAX=23]="BLEND_MINMAX",e[e.DEPTH_BOUNDS=24]="DEPTH_BOUNDS",e[e.LINE_WIDTH=25]="LINE_WIDTH",e[e.STENCIL_WRITE_MASK=26]="STENCIL_WRITE_MASK",e[e.STENCIL_COMPARE_MASK=27]="STENCIL_COMPARE_MASK",e[e.COUNT=28]="COUNT"}(Ra||(Ra=e("ag",{})));var Na=e("eJ",(function(e,t,n,i,r,o,a,s){this.name=e,this.size=t,this.count=n,this.type=i,this.hasAlpha=r,this.hasDepth=o,this.hasStencil=a,this.isCompressed=s})),Pa=e("eK",(function(e,t){void 0===e&&(e=0),void 0===t&&(t=0),this.bufferSize=e,this.textureSize=t})),Ma=e("s",Object.freeze([new Na("UNKNOWN",0,0,wa.NONE,!1,!1,!1,!1),new Na("A8",1,1,wa.UNORM,!0,!1,!1,!1),new Na("L8",1,1,wa.UNORM,!1,!1,!1,!1),new Na("LA8",1,2,wa.UNORM,!0,!1,!1,!1),new Na("R8",1,1,wa.UNORM,!1,!1,!1,!1),new Na("R8SN",1,1,wa.SNORM,!1,!1,!1,!1),new Na("R8UI",1,1,wa.UINT,!1,!1,!1,!1),new Na("R8I",1,1,wa.INT,!1,!1,!1,!1),new Na("R16F",2,1,wa.FLOAT,!1,!1,!1,!1),new Na("R16UI",2,1,wa.UINT,!1,!1,!1,!1),new Na("R16I",2,1,wa.INT,!1,!1,!1,!1),new Na("R32F",4,1,wa.FLOAT,!1,!1,!1,!1),new Na("R32UI",4,1,wa.UINT,!1,!1,!1,!1),new Na("R32I",4,1,wa.INT,!1,!1,!1,!1),new Na("RG8",2,2,wa.UNORM,!1,!1,!1,!1),new Na("RG8SN",2,2,wa.SNORM,!1,!1,!1,!1),new Na("RG8UI",2,2,wa.UINT,!1,!1,!1,!1),new Na("RG8I",2,2,wa.INT,!1,!1,!1,!1),new Na("RG16F",4,2,wa.FLOAT,!1,!1,!1,!1),new Na("RG16UI",4,2,wa.UINT,!1,!1,!1,!1),new Na("RG16I",4,2,wa.INT,!1,!1,!1,!1),new Na("RG32F",8,2,wa.FLOAT,!1,!1,!1,!1),new Na("RG32UI",8,2,wa.UINT,!1,!1,!1,!1),new Na("RG32I",8,2,wa.INT,!1,!1,!1,!1),new Na("RGB8",3,3,wa.UNORM,!1,!1,!1,!1),new Na("SRGB8",3,3,wa.UNORM,!1,!1,!1,!1),new Na("RGB8SN",3,3,wa.SNORM,!1,!1,!1,!1),new Na("RGB8UI",3,3,wa.UINT,!1,!1,!1,!1),new Na("RGB8I",3,3,wa.INT,!1,!1,!1,!1),new Na("RGB16F",6,3,wa.FLOAT,!1,!1,!1,!1),new Na("RGB16UI",6,3,wa.UINT,!1,!1,!1,!1),new Na("RGB16I",6,3,wa.INT,!1,!1,!1,!1),new Na("RGB32F",12,3,wa.FLOAT,!1,!1,!1,!1),new Na("RGB32UI",12,3,wa.UINT,!1,!1,!1,!1),new Na("RGB32I",12,3,wa.INT,!1,!1,!1,!1),new Na("RGBA8",4,4,wa.UNORM,!0,!1,!1,!1),new Na("BGRA8",4,4,wa.UNORM,!0,!1,!1,!1),new Na("SRGB8_A8",4,4,wa.UNORM,!0,!1,!1,!1),new Na("RGBA8SN",4,4,wa.SNORM,!0,!1,!1,!1),new Na("RGBA8UI",4,4,wa.UINT,!0,!1,!1,!1),new Na("RGBA8I",4,4,wa.INT,!0,!1,!1,!1),new Na("RGBA16F",8,4,wa.FLOAT,!0,!1,!1,!1),new Na("RGBA16UI",8,4,wa.UINT,!0,!1,!1,!1),new Na("RGBA16I",8,4,wa.INT,!0,!1,!1,!1),new Na("RGBA32F",16,4,wa.FLOAT,!0,!1,!1,!1),new Na("RGBA32UI",16,4,wa.UINT,!0,!1,!1,!1),new Na("RGBA32I",16,4,wa.INT,!0,!1,!1,!1),new Na("R5G6B5",2,3,wa.UNORM,!1,!1,!1,!1),new Na("R11G11B10F",4,3,wa.FLOAT,!1,!1,!1,!1),new Na("RGB5A1",2,4,wa.UNORM,!0,!1,!1,!1),new Na("RGBA4",2,4,wa.UNORM,!0,!1,!1,!1),new Na("RGB10A2",2,4,wa.UNORM,!0,!1,!1,!1),new Na("RGB10A2UI",2,4,wa.UINT,!0,!1,!1,!1),new Na("RGB9E5",2,4,wa.FLOAT,!0,!1,!1,!1),new Na("D16",2,1,wa.UINT,!1,!0,!1,!1),new Na("D16S8",3,2,wa.UINT,!1,!0,!0,!1),new Na("D24",3,1,wa.UINT,!1,!0,!1,!1),new Na("D24S8",4,2,wa.UINT,!1,!0,!0,!1),new Na("D32F",4,1,wa.FLOAT,!1,!0,!1,!1),new Na("D32FS8",5,2,wa.FLOAT,!1,!0,!0,!1),new Na("BC1",1,3,wa.UNORM,!1,!1,!1,!0),new Na("BC1_ALPHA",1,4,wa.UNORM,!0,!1,!1,!0),new Na("BC1_SRGB",1,3,wa.UNORM,!1,!1,!1,!0),new Na("BC1_SRGB_ALPHA",1,4,wa.UNORM,!0,!1,!1,!0),new Na("BC2",1,4,wa.UNORM,!0,!1,!1,!0),new Na("BC2_SRGB",1,4,wa.UNORM,!0,!1,!1,!0),new Na("BC3",1,4,wa.UNORM,!0,!1,!1,!0),new Na("BC3_SRGB",1,4,wa.UNORM,!0,!1,!1,!0),new Na("BC4",1,1,wa.UNORM,!1,!1,!1,!0),new Na("BC4_SNORM",1,1,wa.SNORM,!1,!1,!1,!0),new Na("BC5",1,2,wa.UNORM,!1,!1,!1,!0),new Na("BC5_SNORM",1,2,wa.SNORM,!1,!1,!1,!0),new Na("BC6H_UF16",1,3,wa.UFLOAT,!1,!1,!1,!0),new Na("BC6H_SF16",1,3,wa.FLOAT,!1,!1,!1,!0),new Na("BC7",1,4,wa.UNORM,!0,!1,!1,!0),new Na("BC7_SRGB",1,4,wa.UNORM,!0,!1,!1,!0),new Na("ETC_RGB8",1,3,wa.UNORM,!1,!1,!1,!0),new Na("ETC2_RGB8",1,3,wa.UNORM,!1,!1,!1,!0),new Na("ETC2_SRGB8",1,3,wa.UNORM,!1,!1,!1,!0),new Na("ETC2_RGB8_A1",1,4,wa.UNORM,!0,!1,!1,!0),new Na("ETC2_SRGB8_A1",1,4,wa.UNORM,!0,!1,!1,!0),new Na("ETC2_RGBA8",2,4,wa.UNORM,!0,!1,!1,!0),new Na("ETC2_SRGB8_A8",2,4,wa.UNORM,!0,!1,!1,!0),new Na("EAC_R11",1,1,wa.UNORM,!1,!1,!1,!0),new Na("EAC_R11SN",1,1,wa.SNORM,!1,!1,!1,!0),new Na("EAC_RG11",2,2,wa.UNORM,!1,!1,!1,!0),new Na("EAC_RG11SN",2,2,wa.SNORM,!1,!1,!1,!0),new Na("PVRTC_RGB2",2,3,wa.UNORM,!1,!1,!1,!0),new Na("PVRTC_RGBA2",2,4,wa.UNORM,!0,!1,!1,!0),new Na("PVRTC_RGB4",2,3,wa.UNORM,!1,!1,!1,!0),new Na("PVRTC_RGBA4",2,4,wa.UNORM,!0,!1,!1,!0),new Na("PVRTC2_2BPP",2,4,wa.UNORM,!0,!1,!1,!0),new Na("PVRTC2_4BPP",2,4,wa.UNORM,!0,!1,!1,!0),new Na("ASTC_RGBA_4x4",1,4,wa.UNORM,!0,!1,!1,!0),new Na("ASTC_RGBA_5x4",1,4,wa.UNORM,!0,!1,!1,!0),new Na("ASTC_RGBA_5x5",1,4,wa.UNORM,!0,!1,!1,!0),new Na("ASTC_RGBA_6x5",1,4,wa.UNORM,!0,!1,!1,!0),new Na("ASTC_RGBA_6x6",1,4,wa.UNORM,!0,!1,!1,!0),new Na("ASTC_RGBA_8x5",1,4,wa.UNORM,!0,!1,!1,!0),new Na("ASTC_RGBA_8x6",1,4,wa.UNORM,!0,!1,!1,!0),new Na("ASTC_RGBA_8x8",1,4,wa.UNORM,!0,!1,!1,!0),new Na("ASTC_RGBA_10x5",1,4,wa.UNORM,!0,!1,!1,!0),new Na("ASTC_RGBA_10x6",1,4,wa.UNORM,!0,!1,!1,!0),new Na("ASTC_RGBA_10x8",1,4,wa.UNORM,!0,!1,!1,!0),new Na("ASTC_RGBA_10x10",1,4,wa.UNORM,!0,!1,!1,!0),new Na("ASTC_RGBA_12x10",1,4,wa.UNORM,!0,!1,!1,!0),new Na("ASTC_RGBA_12x12",1,4,wa.UNORM,!0,!1,!1,!0),new Na("ASTC_SRGBA_4x4",1,4,wa.UNORM,!0,!1,!1,!0),new Na("ASTC_SRGBA_5x4",1,4,wa.UNORM,!0,!1,!1,!0),new Na("ASTC_SRGBA_5x5",1,4,wa.UNORM,!0,!1,!1,!0),new Na("ASTC_SRGBA_6x5",1,4,wa.UNORM,!0,!1,!1,!0),new Na("ASTC_SRGBA_6x6",1,4,wa.UNORM,!0,!1,!1,!0),new Na("ASTC_SRGBA_8x5",1,4,wa.UNORM,!0,!1,!1,!0),new Na("ASTC_SRGBA_8x6",1,4,wa.UNORM,!0,!1,!1,!0),new Na("ASTC_SRGBA_8x8",1,4,wa.UNORM,!0,!1,!1,!0),new Na("ASTC_SRGBA_10x5",1,4,wa.UNORM,!0,!1,!1,!0),new Na("ASTC_SRGBA_10x6",1,4,wa.UNORM,!0,!1,!1,!0),new Na("ASTC_SRGBA_10x8",1,4,wa.UNORM,!0,!1,!1,!0),new Na("ASTC_SRGBA_10x10",1,4,wa.UNORM,!0,!1,!1,!0),new Na("ASTC_SRGBA_12x10",1,4,wa.UNORM,!0,!1,!1,!0),new Na("ASTC_SRGBA_12x12",1,4,wa.UNORM,!0,!1,!1,!0)]));function Da(e,t,n,i){if(!Ma[e].isCompressed)return t*n*i*Ma[e].size;switch(e){case Ko.BC1:case Ko.BC1_ALPHA:case Ko.BC1_SRGB:case Ko.BC1_SRGB_ALPHA:return Math.ceil(t/4)*Math.ceil(n/4)*8*i;case Ko.BC2:case Ko.BC2_SRGB:case Ko.BC3:case Ko.BC3_SRGB:case Ko.BC4:case Ko.BC4_SNORM:case Ko.BC6H_SF16:case Ko.BC6H_UF16:case Ko.BC7:case Ko.BC7_SRGB:return Math.ceil(t/4)*Math.ceil(n/4)*16*i;case Ko.BC5:case Ko.BC5_SNORM:return Math.ceil(t/4)*Math.ceil(n/4)*32*i;case Ko.ETC_RGB8:case Ko.ETC2_RGB8:case Ko.ETC2_SRGB8:case Ko.ETC2_RGB8_A1:case Ko.EAC_R11:case Ko.EAC_R11SN:return Math.ceil(t/4)*Math.ceil(n/4)*8*i;case Ko.ETC2_RGBA8:case Ko.ETC2_SRGB8_A1:case Ko.EAC_RG11:case Ko.EAC_RG11SN:return Math.ceil(t/4)*Math.ceil(n/4)*16*i;case Ko.PVRTC_RGB2:case Ko.PVRTC_RGBA2:case Ko.PVRTC2_2BPP:return Math.ceil(Math.max(t,16)*Math.max(n,8)/4)*i;case Ko.PVRTC_RGB4:case Ko.PVRTC_RGBA4:case Ko.PVRTC2_4BPP:return Math.ceil(Math.max(t,8)*Math.max(n,8)/2)*i;case Ko.ASTC_RGBA_4x4:case Ko.ASTC_SRGBA_4x4:return Math.ceil(t/4)*Math.ceil(n/4)*16*i;case Ko.ASTC_RGBA_5x4:case Ko.ASTC_SRGBA_5x4:return Math.ceil(t/5)*Math.ceil(n/4)*16*i;case Ko.ASTC_RGBA_5x5:case Ko.ASTC_SRGBA_5x5:return Math.ceil(t/5)*Math.ceil(n/5)*16*i;case Ko.ASTC_RGBA_6x5:case Ko.ASTC_SRGBA_6x5:return Math.ceil(t/6)*Math.ceil(n/5)*16*i;case Ko.ASTC_RGBA_6x6:case Ko.ASTC_SRGBA_6x6:return Math.ceil(t/6)*Math.ceil(n/6)*16*i;case Ko.ASTC_RGBA_8x5:case Ko.ASTC_SRGBA_8x5:return Math.ceil(t/8)*Math.ceil(n/5)*16*i;case Ko.ASTC_RGBA_8x6:case Ko.ASTC_SRGBA_8x6:return Math.ceil(t/8)*Math.ceil(n/6)*16*i;case Ko.ASTC_RGBA_8x8:case Ko.ASTC_SRGBA_8x8:return Math.ceil(t/8)*Math.ceil(n/8)*16*i;case Ko.ASTC_RGBA_10x5:case Ko.ASTC_SRGBA_10x5:return Math.ceil(t/10)*Math.ceil(n/5)*16*i;case Ko.ASTC_RGBA_10x6:case Ko.ASTC_SRGBA_10x6:return Math.ceil(t/10)*Math.ceil(n/6)*16*i;case Ko.ASTC_RGBA_10x8:case Ko.ASTC_SRGBA_10x8:return Math.ceil(t/10)*Math.ceil(n/8)*16*i;case Ko.ASTC_RGBA_10x10:case Ko.ASTC_SRGBA_10x10:return Math.ceil(t/10)*Math.ceil(n/10)*16*i;case Ko.ASTC_RGBA_12x10:case Ko.ASTC_SRGBA_12x10:return Math.ceil(t/12)*Math.ceil(n/10)*16*i;case Ko.ASTC_RGBA_12x12:case Ko.ASTC_SRGBA_12x12:return Math.ceil(t/12)*Math.ceil(n/12)*16*i;default:return 0}}function La(e,t,n,i,r){for(var o=0,a=0;a<r;++a)o+=Da(e,t,n,i),t=Math.max(t>>1,1),n=Math.max(n>>1,1);return o}var Fa=[0,4,8,12,16,4,8,12,16,4,8,12,16,4,8,12,16,16,24,32,24,36,48,32,48,64,4,4,4,4,4,4];function za(e){return Fa[e]||0}function Ba(e){var t=e.size/e.count;switch(e.type){case wa.UNORM:case wa.UINT:switch(t){case 1:return Uint8Array;case 2:return Uint16Array;case 4:return Uint32Array}break;case wa.SNORM:case wa.INT:switch(t){case 1:return Int8Array;case 2:return Int16Array;case 4:return Int32Array}break;case wa.FLOAT:return Float32Array}return Float32Array}var Ua=e("p",(function(e,t,n,i,r,o,a){void 0===e&&(e=0),void 0===t&&(t=0),void 0===n&&(n=0),void 0===i&&(i=0),void 0===r&&(r=0),void 0===o&&(o=0),void 0===a&&(a=0),this.vertexCount=e,this.firstVertex=t,this.indexCount=n,this.firstIndex=i,this.vertexOffset=r,this.instanceCount=o,this.firstInstance=a})),Ga=e("cU",28),Ha=e("I",(function(e){void 0===e&&(e=[]),this.drawInfos=e})),ka=e("aA",(function(e,t,n,i,r){void 0===n&&(n=0),void 0===i&&(i=0),void 0===r&&(r=Jo.NONE),this.usage=e,this.memUsage=t,this.size=n,this.stride=i,this.flags=r})),Va=e("ex",(function(e,t,n){void 0===t&&(t=0),void 0===n&&(n=0),this.buffer=e,this.offset=t,this.range=n})),ja=e("J",function(e){function t(t){var n;return(n=e.call(this,Vo.BUFFER)||this)._device=void 0,n._usage=Qo.NONE,n._memUsage=Zo.NONE,n._size=0,n._stride=1,n._count=0,n._flags=Jo.NONE,n._bakcupBuffer=null,n._indirectBuffer=null,n._isBufferView=!1,n._device=t,n}return $(t,e),Z(t,[{key:"usage",get:function(){return this._usage}},{key:"memUsage",get:function(){return this._memUsage}},{key:"size",get:function(){return this._size}},{key:"stride",get:function(){return this._stride}},{key:"count",get:function(){return this._count}},{key:"flags",get:function(){return this._flags}},{key:"backupBuffer",get:function(){return this._bakcupBuffer}}]),t}(Oa)),Wa=e("aj",(function(e,t){void 0===t&&(t=va.PRIMARY),this.queue=e,this.type=t})),qa=e("N",function(e){function t(t){var n;return(n=e.call(this,Vo.COMMAND_BUFFER)||this)._device=void 0,n._queue=null,n._type=va.PRIMARY,n._numDrawCalls=0,n._numInstances=0,n._numTris=0,n._device=t,n}return $(t,e),Z(t,[{key:"type",get:function(){return this._type}},{key:"queue",get:function(){return this._queue}},{key:"numDrawCalls",get:function(){return this._numDrawCalls}},{key:"numInstances",get:function(){return this._numInstances}},{key:"numTris",get:function(){return this._numTris}}]),t}(Oa));xt(Ko);var Ya=e("aq",(function(e,t,n){void 0===e&&(e=[]),void 0===t&&(t=[]),void 0===n&&(n=0),this.bufferOffsets=e,this.samplerOffsets=t,this.flexibleSet=n})),Xa=e("eQ",(function(e,t,n,i,r,o,a){void 0===t&&(t=!0),void 0===n&&(n=!0),void 0===i&&(i=1),void 0===r&&(r=1),void 0===o&&(o=1),void 0===a&&(a=new Ya),this.canvasElm=e,this.isAntialias=t,this.isPremultipliedAlpha=n,this.devicePixelRatio=i,this.nativeWidth=r,this.nativeHeight=o,this.bindingMappingInfo=a})),Ka=e("ar",function(){function e(){this._canvas=null,this._canvas2D=null,this._gfxAPI=Ia.UNKNOWN,this._transform=ba.IDENTITY,this._deviceName="",this._renderer="",this._vendor="",this._version="",this._features=new Array(Ra.COUNT),this._queue=null,this._cmdBuff=null,this._devicePixelRatio=1,this._width=0,this._height=0,this._nativeWidth=0,this._nativeHeight=0,this._maxVertexAttributes=0,this._maxVertexUniformVectors=0,this._maxFragmentUniformVectors=0,this._maxTextureUnits=0,this._maxVertexTextureUnits=0,this._maxUniformBufferBindings=0,this._maxUniformBlockSize=0,this._maxTextureSize=0,this._maxCubeMapTextureSize=0,this._uboOffsetAlignment=1,this._depthBits=0,this._stencilBits=0,this._colorFmt=Ko.UNKNOWN,this._depthStencilFmt=Ko.UNKNOWN,this._macros=new Map,this._numDrawCalls=0,this._numInstances=0,this._numTris=0,this._memoryStatus=new Pa,this._clipSpaceMinZ=-1,this._screenSpaceSignY=1,this._UVSpaceSignY=-1}return e.prototype.hasFeature=function(e){return this._features[e]},Z(e,[{key:"canvas",get:function(){return this._canvas}},{key:"canvas2D",get:function(){return this._canvas2D}},{key:"gfxAPI",get:function(){return this._gfxAPI}},{key:"queue",get:function(){return this._queue}},{key:"commandBuffer",get:function(){return this._cmdBuff}},{key:"devicePixelRatio",get:function(){return this._devicePixelRatio}},{key:"width",get:function(){return this._width}},{key:"height",get:function(){return this._height}},{key:"nativeWidth",get:function(){return this._nativeWidth}},{key:"nativeHeight",get:function(){return this._nativeHeight}},{key:"renderer",get:function(){return this._renderer}},{key:"vendor",get:function(){return this._vendor}},{key:"maxVertexAttributes",get:function(){return this._maxVertexAttributes}},{key:"maxVertexUniformVectors",get:function(){return this._maxVertexUniformVectors}},{key:"maxFragmentUniformVectors",get:function(){return this._maxFragmentUniformVectors}},{key:"maxTextureUnits",get:function(){return this._maxTextureUnits}},{key:"maxVertexTextureUnits",get:function(){return this._maxVertexTextureUnits}},{key:"maxUniformBufferBindings",get:function(){return this._maxUniformBufferBindings}},{key:"maxUniformBlockSize",get:function(){return this._maxUniformBlockSize}},{key:"maxTextureSize",get:function(){return this._maxTextureSize}},{key:"maxCubeMapTextureSize",get:function(){return this._maxCubeMapTextureSize}},{key:"uboOffsetAlignment",get:function(){return this._uboOffsetAlignment}},{key:"depthBits",get:function(){return this._depthBits}},{key:"stencilBits",get:function(){return this._stencilBits}},{key:"colorFormat",get:function(){return this._colorFmt}},{key:"depthStencilFormat",get:function(){return this._depthStencilFmt}},{key:"macros",get:function(){return this._macros}},{key:"numDrawCalls",get:function(){return this._numDrawCalls}},{key:"numInstances",get:function(){return this._numInstances}},{key:"numTris",get:function(){return this._numTris}},{key:"memoryStatus",get:function(){return this._memoryStatus}},{key:"clipSpaceMinZ",get:function(){return this._clipSpaceMinZ}},{key:"screenSpaceSignY",get:function(){return this._screenSpaceSignY}},{key:"UVSpaceSignY",get:function(){return this._UVSpaceSignY}},{key:"surfaceTransform",get:function(){return this._transform}}]),e}()),Qa=e("eR",(function(e,t,n,i,r){void 0===t&&(t=[]),void 0===n&&(n=null),void 0===i&&(i=[]),void 0===r&&(r=0),this.renderPass=e,this.colorTextures=t,this.depthStencilTexture=n,this.colorMipmapLevels=i,this.depStencilMipmapLevel=r})),Za=e("Q",function(e){function t(t){var n;return(n=e.call(this,Vo.FRAMEBUFFER)||this)._device=void 0,n._renderPass=null,n._colorTextures=[],n._depthStencilTexture=null,n._device=t,n}return $(t,e),Z(t,[{key:"renderPass",get:function(){return this._renderPass}},{key:"colorTextures",get:function(){return this._colorTextures}},{key:"depthStencilTexture",get:function(){return this._depthStencilTexture}}]),t}(Oa)),Ja=String.prototype.charCodeAt;function $a(e){return this[e]}function es(e,t){for(var n=e.length,i=t^n,r=0,o="string"==typeof e?Ja:$a;n>=4;){var a=255&o.call(e,r)|(255&o.call(e,++r))<<8|(255&o.call(e,++r))<<16|(255&o.call(e,++r))<<24;a=1540483477*(65535&a)+((1540483477*(a>>>16)&65535)<<16),i=1540483477*(65535&i)+((1540483477*(i>>>16)&65535)<<16)^(a=1540483477*(65535&(a^=a>>>24))+((1540483477*(a>>>16)&65535)<<16)),n-=4,++r}switch(n){case 3:i^=(255&o.call(e,r+2))<<16;case 2:i^=(255&o.call(e,r+1))<<8;case 1:i=1540483477*(65535&(i^=255&o.call(e,r)))+((1540483477*(i>>>16)&65535)<<16)}return i=1540483477*(65535&(i^=i>>>13))+((1540483477*(i>>>16)&65535)<<16),(i^=i>>>15)>>>0}var ts=e("aR",(function(e,t,n,i,r,o){void 0===e&&(e=""),void 0===t&&(t=Ko.UNKNOWN),void 0===n&&(n=!1),void 0===i&&(i=0),void 0===r&&(r=!1),void 0===o&&(o=0),this.name=e,this.format=t,this.isNormalized=n,this.stream=i,this.isInstanced=r,this.location=o})),ns=e("ck",(function(e,t,n,i){void 0===e&&(e=[]),void 0===t&&(t=[]),void 0===n&&(n=null),void 0===i&&(i=null),this.attributes=e,this.vertexBuffers=t,this.indexBuffer=n,this.indirectBuffer=i})),is=e("W",function(e){function t(t){var n;return(n=e.call(this,Vo.INPUT_ASSEMBLER)||this)._device=void 0,n._attributes=[],n._vertexBuffers=[],n._indexBuffer=null,n._vertexCount=0,n._firstVertex=0,n._indexCount=0,n._firstIndex=0,n._vertexOffset=0,n._instanceCount=0,n._firstInstance=0,n._attributesHash=0,n._indirectBuffer=null,n._device=t,n}$(t,e),Z(t,[{key:"vertexBuffers",get:function(){return this._vertexBuffers}},{key:"indexBuffer",get:function(){return this._indexBuffer}},{key:"attributes",get:function(){return this._attributes}},{key:"attributesHash",get:function(){return this._attributesHash}},{key:"vertexCount",get:function(){return this._vertexCount},set:function(e){this._vertexCount=e}},{key:"firstVertex",get:function(){return this._firstVertex},set:function(e){this._firstVertex=e}},{key:"indexCount",get:function(){return this._indexCount},set:function(e){this._indexCount=e}},{key:"firstIndex",get:function(){return this._firstIndex},set:function(e){this._firstIndex=e}},{key:"vertexOffset",get:function(){return this._vertexOffset},set:function(e){this._vertexOffset=e}},{key:"instanceCount",get:function(){return this._instanceCount},set:function(e){this._instanceCount=e}},{key:"firstInstance",get:function(){return this._firstInstance},set:function(e){this._firstInstance=e}},{key:"indirectBuffer",get:function(){return this._indirectBuffer}}]);var n=t.prototype;return n.getVertexBuffer=function(e){return void 0===e&&(e=0),e<this._vertexBuffers.length?this._vertexBuffers[e]:null},n.computeAttributesHash=function(){for(var e="attrs",t=0;t<this.attributes.length;++t){var n=this.attributes[t];e+=","+n.name+","+n.format+","+n.isNormalized+","+n.stream+","+n.isInstanced}return es(e,666)},t}(Oa)),rs=e("n",(function(e,t,n,i){void 0===e&&(e=0),void 0===t&&(t=0),void 0===n&&(n=1),void 0===i&&(i=1),this.x=e,this.y=t,this.width=n,this.height=i})),os=e("V",(function(e,t,n,i,r,o){void 0===e&&(e=0),void 0===t&&(t=0),void 0===n&&(n=0),void 0===i&&(i=0),void 0===r&&(r=0),void 0===o&&(o=1),this.left=e,this.top=t,this.width=n,this.height=i,this.minDepth=r,this.maxDepth=o})),as=e("eL",(function(e,t,n,i){void 0===e&&(e=0),void 0===t&&(t=0),void 0===n&&(n=0),void 0===i&&(i=0),this.x=e,this.y=t,this.z=n,this.w=i})),ss=e("eM",(function(e,t,n){void 0===e&&(e=0),void 0===t&&(t=0),void 0===n&&(n=0),this.x=e,this.y=t,this.z=n})),cs=e("eN",(function(e,t,n){void 0===e&&(e=0),void 0===t&&(t=0),void 0===n&&(n=1),this.width=e,this.height=t,this.depth=n})),ls=e("eO",(function(e,t,n){void 0===e&&(e=0),void 0===t&&(t=0),void 0===n&&(n=1),this.mipLevel=e,this.baseArrayLayer=t,this.layerCount=n})),us=e("eP",(function(e,t,n,i,r){void 0===e&&(e=new ls),void 0===t&&(t=new ss),void 0===n&&(n=new ls),void 0===i&&(i=new ss),void 0===r&&(r=new cs),this.srcSubres=e,this.srcOffset=t,this.dstSubres=n,this.dstOffset=i,this.extent=r})),hs=e("am",(function(e,t,n,i,r){void 0===e&&(e=0),void 0===t&&(t=0),void 0===n&&(n=new ss),void 0===i&&(i=new cs),void 0===r&&(r=new ls),this.buffStride=e,this.buffTexHeight=t,this.texOffset=n,this.texExtent=i,this.texSubres=r})),_s=e("a5",function(){function e(e,t,n,i,r,o,a,s,c,l,u,h){void 0===e&&(e=!1),void 0===t&&(t=ta.FILL),void 0===n&&(n=na.GOURAND),void 0===i&&(i=ia.BACK),void 0===r&&(r=!0),void 0===o&&(o=!1),void 0===a&&(a=0),void 0===s&&(s=0),void 0===c&&(c=0),void 0===l&&(l=!0),void 0===u&&(u=!1),void 0===h&&(h=1),this.isDiscard=e,this.polygonMode=t,this.shadeModel=n,this.cullMode=i,this.isFrontFaceCCW=r,this.depthBiasEnabled=o,this.depthBias=a,this.depthBiasClamp=s,this.depthBiasSlop=c,this.isDepthClip=l,this.isMultisample=u,this.lineWidth=h}var t=e.prototype;return t.reset=function(){this.isDiscard=!1,this.polygonMode=ta.FILL,this.shadeModel=na.GOURAND,this.cullMode=ia.BACK,this.isFrontFaceCCW=!0,this.depthBiasEnabled=!1,this.depthBias=0,this.depthBiasClamp=0,this.depthBiasSlop=0,this.isDepthClip=!0,this.isMultisample=!1,this.lineWidth=1},t.assign=function(e){Object.assign(this,e)},t.destroy=function(){},Z(e,[{key:"handle",get:function(){return Yi}}]),e}()),fs=e("a6",function(){function e(e,t,n,i,r,o,a,s,c,l,u,h,_,f,m,d,p,v,g){void 0===e&&(e=!0),void 0===t&&(t=!0),void 0===n&&(n=ra.LESS),void 0===i&&(i=!1),void 0===r&&(r=ra.ALWAYS),void 0===o&&(o=65535),void 0===a&&(a=65535),void 0===s&&(s=oa.KEEP),void 0===c&&(c=oa.KEEP),void 0===l&&(l=oa.KEEP),void 0===u&&(u=1),void 0===h&&(h=!1),void 0===_&&(_=ra.ALWAYS),void 0===f&&(f=65535),void 0===m&&(m=65535),void 0===d&&(d=oa.KEEP),void 0===p&&(p=oa.KEEP),void 0===v&&(v=oa.KEEP),void 0===g&&(g=1),this.depthTest=e,this.depthWrite=t,this.depthFunc=n,this.stencilTestFront=i,this.stencilFuncFront=r,this.stencilReadMaskFront=o,this.stencilWriteMaskFront=a,this.stencilFailOpFront=s,this.stencilZFailOpFront=c,this.stencilPassOpFront=l,this.stencilRefFront=u,this.stencilTestBack=h,this.stencilFuncBack=_,this.stencilReadMaskBack=f,this.stencilWriteMaskBack=m,this.stencilFailOpBack=d,this.stencilZFailOpBack=p,this.stencilPassOpBack=v,this.stencilRefBack=g}var t=e.prototype;return t.reset=function(){this.depthTest=!0,this.depthWrite=!0,this.depthFunc=ra.LESS,this.stencilTestFront=!1,this.stencilFuncFront=ra.ALWAYS,this.stencilReadMaskFront=65535,this.stencilWriteMaskFront=65535,this.stencilFailOpFront=oa.KEEP,this.stencilZFailOpFront=oa.KEEP,this.stencilPassOpFront=oa.KEEP,this.stencilRefFront=1,this.stencilTestBack=!1,this.stencilFuncBack=ra.ALWAYS,this.stencilReadMaskBack=65535,this.stencilWriteMaskBack=65535,this.stencilFailOpBack=oa.KEEP,this.stencilZFailOpBack=oa.KEEP,this.stencilPassOpBack=oa.KEEP,this.stencilRefBack=1},t.assign=function(e){Object.assign(this,e)},t.destroy=function(){},Z(e,[{key:"handle",get:function(){return Yi}}]),e}()),ms=e("c5",function(){function e(e,t,n,i,r,o,a,s){void 0===e&&(e=!1),void 0===t&&(t=sa.ONE),void 0===n&&(n=sa.ZERO),void 0===i&&(i=aa.ADD),void 0===r&&(r=sa.ONE),void 0===o&&(o=sa.ZERO),void 0===a&&(a=aa.ADD),void 0===s&&(s=ca.ALL),this.blend=e,this.blendSrc=t,this.blendDst=n,this.blendEq=i,this.blendSrcAlpha=r,this.blendDstAlpha=o,this.blendAlphaEq=a,this.blendColorMask=s}var t=e.prototype;return t.reset=function(){this.blend=!1,this.blendSrc=sa.ONE,this.blendDst=sa.ZERO,this.blendEq=aa.ADD,this.blendSrcAlpha=sa.ONE,this.blendDstAlpha=sa.ZERO,this.blendAlphaEq=aa.ADD,this.blendColorMask=ca.ALL},t.assign=function(e){Object.assign(this,e)},t.destroy=function(){},Z(e,[{key:"handle",get:function(){return Yi}}]),e}()),ds=e("a7",function(){function e(e,t,n,i){void 0===e&&(e=!1),void 0===t&&(t=!1),void 0===n&&(n=new as),void 0===i&&(i=[new ms]),this.isA2C=e,this.isIndepend=t,this.blendColor=n,this.targets=i}var t=e.prototype;return t.setTarget=function(e,t){var n=this.targets[e];n||(n=this.targets[e]=new ms),Object.assign(n,t)},t.reset=function(){this.isA2C=!1,this.isIndepend=!1,this.blendColor.x=0,this.blendColor.y=0,this.blendColor.z=0,this.blendColor.w=0,this.targets.length=1,this.targets[0].reset()},t.destroy=function(){},Z(e,[{key:"handle",get:function(){return Yi}}]),e}()),ps=e("eV",(function(e){void 0===e&&(e=[]),this.attributes=e})),vs=e("eW",(function(e,t,n,i,r,o,a,s,c){void 0===s&&(s=ea.TRIANGLE_LIST),void 0===c&&(c=Sa.NONE),this.shader=e,this.pipelineLayout=t,this.renderPass=n,this.inputState=i,this.rasterizerState=r,this.depthStencilState=o,this.blendState=a,this.primitive=s,this.dynamicStates=c})),gs=e("$",function(e){function t(t){var n;return(n=e.call(this,Vo.PIPELINE_STATE)||this)._device=void 0,n._shader=null,n._pipelineLayout=null,n._primitive=ea.TRIANGLE_LIST,n._is=null,n._rs=new _s,n._dss=new fs,n._bs=new ds,n._dynamicStates=Sa.NONE,n._renderPass=null,n._device=t,n}return $(t,e),Z(t,[{key:"shader",get:function(){return this._shader}},{key:"pipelineLayout",get:function(){return this._pipelineLayout}},{key:"primitive",get:function(){return this._primitive}},{key:"rasterizerState",get:function(){return this._rs}},{key:"depthStencilState",get:function(){return this._dss}},{key:"blendState",get:function(){return this._bs}},{key:"inputState",get:function(){return this._is}},{key:"dynamicStates",get:function(){return this._dynamicStates}},{key:"renderPass",get:function(){return this._renderPass}}]),t}(Oa)),ys=e("ah",(function(e){void 0===e&&(e=Aa.GRAPHICS),this.type=e})),xs=e("a0",function(e){function t(t){var n;return(n=e.call(this,Vo.QUEUE)||this)._device=void 0,n._type=Aa.GRAPHICS,n._isAsync=!1,n._device=t,n}return $(t,e),Z(t,[{key:"type",get:function(){return this._type}}]),t.prototype.isAsync=function(){return this._isAsync},t}(Oa)),Es=e("eY",(function(e,t,n,i,r,o){void 0===e&&(e=Ko.UNKNOWN),void 0===t&&(t=1),void 0===n&&(n=ga.CLEAR),void 0===i&&(i=ya.STORE),void 0===r&&(r=xa.UNDEFINED),void 0===o&&(o=xa.PRESENT_SRC),this.format=e,this.sampleCount=t,this.loadOp=n,this.storeOp=i,this.beginLayout=r,this.endLayout=o})),Ss=e("eZ",(function(e,t,n,i,r,o,a,s){void 0===e&&(e=Ko.UNKNOWN),void 0===t&&(t=1),void 0===n&&(n=ga.CLEAR),void 0===i&&(i=ya.STORE),void 0===r&&(r=ga.CLEAR),void 0===o&&(o=ya.STORE),void 0===a&&(a=xa.UNDEFINED),void 0===s&&(s=xa.DEPTH_STENCIL_ATTACHMENT_OPTIMAL),this.format=e,this.sampleCount=t,this.depthLoadOp=n,this.depthStoreOp=i,this.stencilLoadOp=r,this.stencilStoreOp=o,this.beginLayout=a,this.endLayout=s})),Ts=e("e_",(function(e,t,n,i,r,o){void 0===e&&(e=Ea.GRAPHICS),void 0===t&&(t=[]),void 0===n&&(n=[]),void 0===i&&(i=[]),void 0===r&&(r=-1),void 0===o&&(o=[]),this.bindPoint=e,this.inputs=t,this.colors=n,this.resolves=i,this.depthStencil=r,this.preserves=o})),As=e("e$",(function(e,t,n){void 0===e&&(e=[]),void 0===t&&(t=null),void 0===n&&(n=[]),this.colorAttachments=e,this.depthStencilAttachment=t,this.subPasses=n})),Cs=e("a1",function(e){function t(t){var n;return(n=e.call(this,Vo.RENDER_PASS)||this)._device=void 0,n._colorInfos=[],n._depthStencilInfo=null,n._subPasses=[],n._hash=0,n._device=t,n}return $(t,e),Z(t,[{key:"colorAttachments",get:function(){return this._colorInfos}},{key:"depthStencilAttachment",get:function(){return this._depthStencilInfo}},{key:"subPasses",get:function(){return this._subPasses}},{key:"hash",get:function(){return this._hash}}]),t.prototype.computeHash=function(){var e="";if(this._subPasses.length)for(var t=0;t<this._subPasses.length;++t){var n=this._subPasses[t];if(n.inputs.length){e+="ia";for(var i=0;i<n.inputs.length;++i){var r=this._colorInfos[n.inputs[i]];e+=","+r.format+","+r.sampleCount}}if(n.colors.length){e+="ca";for(var o=0;o<n.inputs.length;++o){var a=this._colorInfos[n.inputs[o]];e+=","+a.format+","+a.sampleCount}}if(n.depthStencil>=0){var s=this._colorInfos[n.depthStencil];e+="ds,"+s.format+","+s.sampleCount}}else{e+="ca";for(var c=0;c<this._colorInfos.length;++c){var l=this._colorInfos[c];e+=","+l.format+","+l.sampleCount}var u=this._depthStencilInfo;u&&(e+="ds,"+u.format+","+u.sampleCount)}return es(e,666)},t}(Oa)),ws=e("f0",(function(e,t,n,i,r,o,a,s,c,l,u,h){void 0===e&&(e=la.LINEAR),void 0===t&&(t=la.LINEAR),void 0===n&&(n=la.NONE),void 0===i&&(i=ua.WRAP),void 0===r&&(r=ua.WRAP),void 0===o&&(o=ua.WRAP),void 0===a&&(a=16),void 0===s&&(s=ra.NEVER),void 0===c&&(c=new as),void 0===l&&(l=0),void 0===u&&(u=0),void 0===h&&(h=0),this.minFilter=e,this.magFilter=t,this.mipFilter=n,this.addressU=i,this.addressV=r,this.addressW=o,this.maxAnisotropy=a,this.cmpFunc=s,this.borderColor=c,this.minLOD=l,this.maxLOD=u,this.mipLODBias=h})),Is=e("a3",function(e){function t(t){var n;return(n=e.call(this,Vo.SAMPLER)||this)._device=void 0,n._minFilter=la.LINEAR,n._magFilter=la.LINEAR,n._mipFilter=la.NONE,n._addressU=ua.WRAP,n._addressV=ua.WRAP,n._addressW=ua.WRAP,n._maxAnisotropy=16,n._cmpFunc=ra.NEVER,n._borderColor=new as,n._minLOD=0,n._maxLOD=0,n._mipLODBias=0,n._device=t,n}return $(t,e),Z(t,[{key:"minFilter",get:function(){return this._minFilter}},{key:"magFilter",get:function(){return this._magFilter}},{key:"mipFilter",get:function(){return this._mipFilter}},{key:"addressU",get:function(){return this._addressU}},{key:"addressV",get:function(){return this._addressV}},{key:"addressW",get:function(){return this._addressW}},{key:"maxAnisotropy",get:function(){return this._maxAnisotropy}},{key:"cmpFunc",get:function(){return this._cmpFunc}},{key:"borderColor",get:function(){return this._borderColor}},{key:"minLOD",get:function(){return this._minLOD}},{key:"maxLOD",get:function(){return this._maxLOD}},{key:"mipLODBias",get:function(){return this._mipLODBias}}]),t}(Oa)),bs=e("f1",(function(e,t){void 0===e&&(e=da.NONE),void 0===t&&(t=""),this.stage=e,this.source=t})),Rs=e("f2",(function(e,t,n){void 0===e&&(e=""),void 0===t&&(t=Xo.UNKNOWN),void 0===n&&(n=1),this.name=e,this.type=t,this.count=n})),Os=e("f3",(function(e,t,n,i,r){void 0===e&&(e=-1),void 0===t&&(t=-1),void 0===n&&(n=""),void 0===i&&(i=[]),void 0===r&&(r=1),this.set=e,this.binding=t,this.name=n,this.members=i,this.count=r})),Ns=e("f4",(function(e,t,n,i,r){void 0===e&&(e=-1),void 0===t&&(t=-1),void 0===n&&(n=""),void 0===i&&(i=Xo.UNKNOWN),void 0===r&&(r=1),this.set=e,this.binding=t,this.name=n,this.type=i,this.count=r})),Ps=e("f5",(function(e,t,n,i,r){void 0===e&&(e=""),void 0===t&&(t=[]),void 0===n&&(n=[]),void 0===i&&(i=[]),void 0===r&&(r=[]),this.name=e,this.stages=t,this.attributes=n,this.blocks=i,this.samplers=r})),Ms=e("a4",function(e){function t(n){var i;return(i=e.call(this,Vo.SHADER)||this)._device=void 0,i._id=void 0,i._name="",i._stages=[],i._attributes=[],i._blocks=[],i._samplers=[],i._device=n,i._id=t._shaderIdGen++,i}return $(t,e),Z(t,[{key:"id",get:function(){return this._id}},{key:"name",get:function(){return this._name}},{key:"attributes",get:function(){return this._attributes}},{key:"blocks",get:function(){return this._blocks}},{key:"samplers",get:function(){return this._samplers}}]),t}(Oa));Ms._shaderIdGen=0;var Ds=e("ak",(function(e,t,n,i,r,o,a,s,c,l){void 0===t&&(t=_a.NONE),void 0===n&&(n=Ko.UNKNOWN),void 0===i&&(i=0),void 0===r&&(r=0),void 0===o&&(o=ma.NONE),void 0===a&&(a=1),void 0===s&&(s=1),void 0===c&&(c=fa.X1),void 0===l&&(l=1),this.type=e,this.usage=t,this.format=n,this.width=i,this.height=r,this.flags=o,this.layerCount=a,this.levelCount=s,this.samples=c,this.depth=l})),Ls=e("f6",(function(e,t,n,i,r,o,a){void 0===t&&(t=ha.TEX2D),void 0===n&&(n=Ko.UNKNOWN),void 0===i&&(i=0),void 0===r&&(r=1),void 0===o&&(o=0),void 0===a&&(a=1),this.texture=e,this.type=t,this.format=n,this.baseLevel=i,this.levelCount=r,this.baseLayer=o,this.layerCount=a}));function Fs(e){return e>0&&0==(e&e-1)}var zs=e("aa",function(e){function t(t){var n;return(n=e.call(this,Vo.TEXTURE)||this)._device=void 0,n._type=ha.TEX2D,n._usage=_a.NONE,n._format=Ko.UNKNOWN,n._width=0,n._height=0,n._depth=1,n._layerCount=1,n._levelCount=1,n._samples=fa.X1,n._flags=ma.NONE,n._isPowerOf2=!1,n._size=0,n._buffer=null,n._device=t,n}return $(t,e),Z(t,[{key:"type",get:function(){return this._type}},{key:"usage",get:function(){return this._usage}},{key:"format",get:function(){return this._format}},{key:"width",get:function(){return this._width}},{key:"height",get:function(){return this._height}},{key:"depth",get:function(){return this._depth}},{key:"layerCount",get:function(){return this._layerCount}},{key:"levelCount",get:function(){return this._levelCount}},{key:"samples",get:function(){return this._samples}},{key:"flags",get:function(){return this._flags}},{key:"size",get:function(){return this._size}},{key:"buffer",get:function(){return this._buffer}}]),t}(Oa)),Bs={Device:Ka,Buffer:ja,Texture:zs,Sampler:Is,Shader:Ms,InputAssembler:is,RenderPass:Cs,Framebuffer:Za,PipelineState:gs,CommandBuffer:qa,Queue:xs,FormatSize:Da,FormatSurfaceSize:La,GetTypeSize:za,getTypedArrayConstructor:Ba,MAX_ATTACHMENTS:qo,ObjectType:Vo,Obj:Oa,AttributeName:Yo,Type:Xo,Format:Ko,BufferUsageBit:Qo,MemoryUsageBit:Zo,BufferFlagBit:Jo,BufferAccessBit:$o,PrimitiveMode:ea,PolygonMode:ta,ShadeModel:na,CullMode:ia,ComparisonFunc:ra,StencilOp:oa,BlendOp:aa,BlendFactor:sa,ColorMask:ca,Filter:la,Address:ua,TextureType:ha,TextureUsageBit:_a,SampleCount:fa,TextureFlagBit:ma,ShaderStageFlagBit:da,DescriptorType:pa,CommandBufferType:va,LoadOp:ga,StoreOp:ya,TextureLayout:xa,PipelineBindPoint:Ea,DynamicStateFlagBit:Sa,StencilFace:Ta,QueueType:Aa,Rect:rs,Viewport:os,Color:as,ClearFlag:Ca,Offset:ss,Extent:cs,TextureSubres:ls,TextureCopy:us,BufferTextureCopy:hs,FormatType:wa,FormatInfo:Na,MemoryStatus:Pa,FormatInfos:Ma},Us=e("D",pa.UNIFORM_BUFFER|pa.DYNAMIC_UNIFORM_BUFFER|pa.STORAGE_BUFFER|pa.DYNAMIC_STORAGE_BUFFER),Gs=e("k",pa.SAMPLER),Hs=e("cA",(function(e){this.layout=e})),ks=e("m",function(e){function t(t){var n;return(n=e.call(this,Vo.DESCRIPTOR_SET)||this)._device=void 0,n._layout=null,n._buffers=[],n._textures=[],n._samplers=[],n._isDirty=!1,n._device=t,n}$(t,e),Z(t,[{key:"layout",get:function(){return this._layout}}]);var n=t.prototype;return n.bindBuffer=function(e,t,n){void 0===n&&(n=0);var i=this._layout.bindingIndices[e],r=this._layout.bindings[i];if(r)if(r.descriptorType&Us){var o=this._layout.descriptorIndices[e];this._buffers[o+n]!==t&&(this._buffers[o+n]=t,this._isDirty=!0)}else console.warn("Setting binding is not DescriptorType.UNIFORM_BUFFER.")},n.bindSampler=function(e,t,n){void 0===n&&(n=0);var i=this._layout.bindingIndices[e],r=this._layout.bindings[i];if(r)if(r.descriptorType&Gs){var o=this._layout.descriptorIndices[e];this._samplers[o+n]!==t&&(this._samplers[o+n]=t,this._isDirty=!0)}else console.warn("Setting binding is not DescriptorType.SAMPLER.")},n.bindTexture=function(e,t,n){void 0===n&&(n=0);var i=this._layout.bindingIndices[e],r=this._layout.bindings[i];if(r)if(r.descriptorType&Gs){var o=this._layout.descriptorIndices[e];this._textures[o+n]!==t&&(this._textures[o+n]=t,this._isDirty=!0)}else console.warn("Setting binding is not DescriptorType.SAMPLER.")},n.getBuffer=function(e,t){void 0===t&&(t=0);var n=this._layout.descriptorIndices[e];return this._buffers[n+t]},n.getSampler=function(e,t){void 0===t&&(t=0);var n=this._layout.descriptorIndices[e];return this._samplers[n+t]},n.getTexture=function(e,t){void 0===t&&(t=0);var n=this._layout.descriptorIndices[e];return this._textures[n+t]},t}(Oa)),Vs=e("eS",(function(e,t,n,i,r){void 0===e&&(e=-1),void 0===t&&(t=pa.UNKNOWN),void 0===n&&(n=0),void 0===i&&(i=da.NONE),void 0===r&&(r=[]),this.binding=e,this.descriptorType=t,this.count=n,this.stageFlags=i,this.immutableSamplers=r})),js=e("eT",(function(e){void 0===e&&(e=[]),this.bindings=e})),Ws=e("X",pa.DYNAMIC_STORAGE_BUFFER|pa.DYNAMIC_UNIFORM_BUFFER),qs=e("Y",function(e){function t(t){var n;return(n=e.call(this,Vo.DESCRIPTOR_SET_LAYOUT)||this)._device=void 0,n._bindings=[],n._bindingIndices=[],n._descriptorIndices=[],n._device=t,n}return $(t,e),Z(t,[{key:"bindings",get:function(){return this._bindings}},{key:"bindingIndices",get:function(){return this._bindingIndices}},{key:"descriptorIndices",get:function(){return this._descriptorIndices}}]),t}(Oa)),Ys=e("eU",(function(e){void 0===e&&(e=[]),this.setLayouts=e})),Xs=e("Z",function(e){function t(t){var n;return(n=e.call(this,Vo.PIPELINE_LAYOUT)||this)._device=void 0,n._setLayouts=[],n._device=t,n}return $(t,e),Z(t,[{key:"setLayouts",get:function(){return this._setLayouts}}]),t}(Oa)),Ks=e("eX",(function(){})),Qs=e("O",function(e){function t(t){var n;return(n=e.call(this,Vo.FENCE)||this)._device=void 0,n._device=t,n}return $(t,e),t}(Oa));me(c,"cc",[{name:"GFXDynamicState",newName:"DynamicStateFlagBit"},{name:"GFXBindingType",newName:"DescriptorType"},{name:"GFXBindingLayout",newName:"DescriptorSet"}]),de(qa.prototype,"CommandBuffer.prototype",[{name:"bindBindingLayout",suggest:"Use `bindDescriptorSet` instead"}]);var Zs,Js={MAX_ATTACHMENTS:"GFX_MAX_ATTACHMENTS",Obj:"GFXObject",getTypedArrayConstructor:""};for(var $s in Bs){var ec=Js[$s];""!==ec&&(void 0===ec&&(ec="GFX"+$s),me(c,"cc",[{name:ec,newName:$s,target:c.gfx,targetName:"cc.gfx"}]))}c.gfx=Bs,e("dz",Object.freeze({__proto__:null,DESCRIPTOR_BUFFER_TYPE:Us,DESCRIPTOR_SAMPLER_TYPE:Gs,DescriptorSetInfo:Hs,DescriptorSet:ks,DrawInfo:Ua,DRAW_INFO_SIZE:Ga,IndirectBuffer:Ha,BufferInfo:ka,BufferViewInfo:Va,Buffer:ja,CommandBufferInfo:Wa,CommandBuffer:qa,MAX_ATTACHMENTS:qo,get ObjectType(){return Vo},Obj:Oa,get AttributeName(){return Yo},get Type(){return Xo},get Format(){return Ko},get BufferUsageBit(){return Qo},get MemoryUsageBit(){return Zo},get BufferFlagBit(){return Jo},get BufferAccessBit(){return $o},get PrimitiveMode(){return ea},get PolygonMode(){return ta},get ShadeModel(){return na},get CullMode(){return ia},get ComparisonFunc(){return ra},get StencilOp(){return oa},get BlendOp(){return aa},get BlendFactor(){return sa},get ColorMask(){return ca},get Filter(){return la},get Address(){return ua},get TextureType(){return ha},get TextureUsageBit(){return _a},get SampleCount(){return fa},get TextureFlagBit(){return ma},get ShaderStageFlagBit(){return da},get DescriptorType(){return pa},get CommandBufferType(){return va},get LoadOp(){return ga},get StoreOp(){return ya},get TextureLayout(){return xa},get PipelineBindPoint(){return Ea},get DynamicStateFlagBit(){return Sa},get StencilFace(){return Ta},get QueueType(){return Aa},get ClearFlag(){return Ca},get FormatType(){return wa},get API(){return Ia},get SurfaceTransform(){return ba},get Feature(){return Ra},FormatInfo:Na,MemoryStatus:Pa,FormatInfos:Ma,FormatSize:Da,FormatSurfaceSize:La,GetTypeSize:za,getTypedArrayConstructor:Ba,Rect:rs,Viewport:os,Color:as,Offset:ss,Extent:cs,TextureSubres:ls,TextureCopy:us,BufferTextureCopy:hs,BindingMappingInfo:Ya,DeviceInfo:Xa,Device:Ka,FramebufferInfo:Qa,Framebuffer:Za,Attribute:ts,InputAssemblerInfo:ns,InputAssembler:is,DescriptorSetLayoutBinding:Vs,DescriptorSetLayoutInfo:js,DESCRIPTOR_DYNAMIC_TYPE:Ws,DescriptorSetLayout:qs,PipelineLayoutInfo:Ys,PipelineLayout:Xs,RasterizerState:_s,DepthStencilState:fs,BlendTarget:ms,BlendState:ds,InputState:ps,PipelineStateInfo:vs,PipelineState:gs,FenceInfo:Ks,Fence:Qs,QueueInfo:ys,Queue:xs,ColorAttachment:Es,DepthStencilAttachment:Ss,SubPassInfo:Ts,RenderPassInfo:As,RenderPass:Cs,SamplerInfo:ws,Sampler:Is,ShaderStage:bs,Uniform:Rs,UniformBlock:Os,UniformSampler:Ns,ShaderInfo:Ps,Shader:Ms,TextureInfo:Ds,TextureViewInfo:Ls,IsPowerOf2:Fs,Texture:zs})),function(e){e[e.ALL=0]="ALL",e[e.CLOSEST=1]="CLOSEST",e[e.ANY=2]="ANY"}(Zs||(Zs={}));var tc,nc,ic,rc,oc,ac,sc,cc,lc=(tc=new Fn(0,0,0),function(e,t){var n=Fn.dot(e.d,t.n);if(Math.abs(n)<Number.EPSILON)return 0;Fn.multiplyScalar(tc,t.n,t.d);var i=Fn.dot(Fn.subtract(tc,tc,e.o),t.n)/n;return i<0?0:i}),uc=(nc=new Fn(0,0,0),ic=new Fn(0,0,0),rc=new Fn(0,0,0),oc=new Fn(0,0,0),ac=new Fn(0,0,0),function(e,t,n){Fn.subtract(nc,t.b,t.a),Fn.subtract(ic,t.c,t.a),Fn.cross(rc,e.d,ic);var i=Fn.dot(nc,rc);if(i<Number.EPSILON&&(!n||i>-Number.EPSILON))return 0;var r=1/i;Fn.subtract(oc,e.o,t.a);var o=Fn.dot(oc,rc)*r;if(o<0||o>1)return 0;Fn.cross(ac,oc,nc);var a=Fn.dot(e.d,ac)*r;if(a<0||o+a>1)return 0;var s=Fn.dot(ic,ac)*r;return s<0?0:s}),hc=function(){var e=new Fn(0,0,0);return function(t,n){var i=n.radius,r=n.center,o=t.o,a=t.d,s=i*i;Fn.subtract(e,r,o);var c=e.lengthSqr(),l=Fn.dot(e,a),u=s-(c-l*l);if(u<0)return 0;var h=Math.sqrt(u),_=c<s?l+h:l-h;return _<0?0:_}}(),_c=(sc=new Fn,cc=new Fn,function(e,t){return Fn.subtract(sc,t.center,t.halfExtents),Fn.add(cc,t.center,t.halfExtents),fc(e,sc,cc)});function fc(e,t,n){var i=e.o,r=e.d,o=1/r.x,a=1/r.y,s=1/r.z,c=(t.x-i.x)*o,l=(n.x-i.x)*o,u=(t.y-i.y)*a,h=(n.y-i.y)*a,_=(t.z-i.z)*s,f=(n.z-i.z)*s,m=Math.max(Math.max(Math.min(c,l),Math.min(u,h)),Math.min(_,f)),d=Math.min(Math.min(Math.max(c,l),Math.max(u,h)),Math.max(_,f));return d<0||m>d?0:m>0?m:d}var mc,dc,pc,vc,gc=function(){var e=new Fn,t=new Fn,n=new Fn,i=new Fn,r=new Fn,o=new Fn,a=new Fn,s=new Array(3),c=new Array(3),l=new Array(3),u=new Array(6);return function(h,_){s[0]=_.halfExtents.x,s[1]=_.halfExtents.y,s[2]=_.halfExtents.z,e=_.center,t=h.o,n=h.d,Fn.set(i,_.orientation.m00,_.orientation.m01,_.orientation.m02),Fn.set(r,_.orientation.m03,_.orientation.m04,_.orientation.m05),Fn.set(o,_.orientation.m06,_.orientation.m07,_.orientation.m08),Fn.subtract(a,e,t),c[0]=Fn.dot(i,n),c[1]=Fn.dot(r,n),c[2]=Fn.dot(o,n),l[0]=Fn.dot(i,a),l[1]=Fn.dot(r,a),l[2]=Fn.dot(o,a);for(var f=0;f<3;++f){if(0===c[f]){if(-l[f]-s[f]>0||-l[f]+s[f]<0)return 0;c[f]=1e-7}u[2*f+0]=(l[f]+s[f])/c[f],u[2*f+1]=(l[f]-s[f])/c[f]}var m=Math.max(Math.max(Math.min(u[0],u[1]),Math.min(u[2],u[3])),Math.min(u[4],u[5])),d=Math.min(Math.min(Math.max(u[0],u[1]),Math.max(u[2],u[3])),Math.max(u[4],u[5]));return d<0||m>d?0:m>0?m:d}}(),yc=function(){var e=new Fn,t=new Fn,n=new Fn,i=new Fn,r=new Fn,o=new Fn,a=new Fn,s=new jo;return function(c,l){var u=l.radius*l.radius,h=Fn.normalize(e,c.d),_=l.ellipseCenter0,f=l.ellipseCenter1,m=Fn.subtract(t,f,_);if(m.equals(Fn.ZERO))return s.radius=l.radius,s.center.set(l.ellipseCenter0),il.raySphere(c,s);var d=c.o,p=Fn.subtract(n,d,_),v=Fn.cross(i,h,m),g=v.lengthSqr();if(0===g){s.radius=l.radius;var y=Fn.subtract(r,f,d);return p.lengthSqr()<y.lengthSqr()?s.center.set(l.ellipseCenter0):s.center.set(l.ellipseCenter1),il.raySphere(c,s)}var x=Fn.cross(r,p,m),E=m.lengthSqr(),S=2*Fn.dot(v,x),T=S*S-4*g*(x.lengthSqr()-u*E);if(T<0)return 0;var A=(-S-Math.sqrt(T))/(2*g);if(A<0){s.radius=l.radius;var C=Fn.subtract(o,f,d);return p.lengthSqr()<C.lengthSqr()?s.center.set(l.ellipseCenter0):s.center.set(l.ellipseCenter1),il.raySphere(c,s)}var w=Fn.scaleAndAdd(o,c.o,h,A),I=Fn.subtract(a,w,_),b=Fn.dot(I,m)/E;return b>=0&&b<=1?A:b<0?(s.radius=l.radius,s.center.set(l.ellipseCenter0),il.raySphere(c,s)):b>1?(s.radius=l.radius,s.center.set(l.ellipseCenter1),il.raySphere(c,s)):0}}(),xc=(mc=Wo.create(),dc={distance:1/0,doubleSided:!1,mode:Zs.ANY},pc=0,vc=function(e,t,n,i,r,o){e===Zs.CLOSEST?(pc>t||0===pc)&&(pc=t,o&&(0===o.length?o.push({distance:t,vertexIndex0:n/3,vertexIndex1:i/3,vertexIndex2:r/3}):(o[0].distance=t,o[0].vertexIndex0=n/3,o[0].vertexIndex1=i/3,o[0].vertexIndex2=r/3))):(pc=t,o&&o.push({distance:t,vertexIndex0:n/3,vertexIndex1:i/3,vertexIndex2:r/3}))},function(e,t,n){if(pc=0,0===t.geometricInfo.positions.length)return pc;var i=void 0===n?dc:n;if(fc(e,t.geometricInfo.boundingBox.min,t.geometricInfo.boundingBox.max)){var r=t.primitiveMode,o=t.geometricInfo;!function(e,t,n,i,r){if(n===ea.TRIANGLE_LIST)for(var o=t.length,a=0;a<o;a+=3){var s=3*t[a],c=3*t[a+1],l=3*t[a+2];Fn.set(mc.a,e[s],e[s+1],e[s+2]),Fn.set(mc.b,e[c],e[c+1],e[c+2]),Fn.set(mc.c,e[l],e[l+1],e[l+2]);var u=il.rayTriangle(i,mc,r.doubleSided);if(!(0===u||u>r.distance)&&(vc(r.mode,u,s,c,l,r.result),r.mode===Zs.ANY))return u}else if(n===ea.TRIANGLE_STRIP)for(var h=t.length-2,_=0,f=0;f<h;f+=1){var m=3*t[f-_],d=3*t[f+_+1],p=3*t[f+2];Fn.set(mc.a,e[m],e[m+1],e[m+2]),Fn.set(mc.b,e[d],e[d+1],e[d+2]),Fn.set(mc.c,e[p],e[p+1],e[p+2]),_=~_;var v=il.rayTriangle(i,mc,r.doubleSided);if(!(0===v||v>r.distance)&&(vc(r.mode,v,m,d,p,r.result),r.mode===Zs.ANY))return v}else if(n===ea.TRIANGLE_FAN){var g=t.length-1,y=3*t[0];Fn.set(mc.a,e[y],e[y+1],e[y+2]);for(var x=1;x<g;x+=1){var E=3*t[x],S=3*t[x+1];Fn.set(mc.b,e[E],e[E+1],e[E+2]),Fn.set(mc.c,e[S],e[S+1],e[S+2]);var T=il.rayTriangle(i,mc,r.doubleSided);if(!(0===T||T>r.distance)&&(vc(r.mode,T,y,E,S,r.result),r.mode===Zs.ANY))return T}}}(o.positions,o.indices,r,e,i)}return pc}),Ec=function(){var e=0,t={distance:1/0,doubleSided:!1,mode:Zs.ANY};return function(n,i,r){e=0;var o=void 0===r?t:r,a=i.renderingSubMeshes.length,s=i.struct.minPosition,c=i.struct.maxPosition;if(s&&c&&!fc(n,s,c))return e;for(var l=0;l<a;l++){var u=i.renderingSubMeshes[l],h=xc(n,u,o);if(h)if(o.mode===Zs.CLOSEST)(0===e||e>h)&&(e=h,o.subIndices&&(o.subIndices[0]=l));else if(e=h,o.subIndices&&o.subIndices.push(l),o.mode===Zs.ANY)return h}return e&&o.mode===Zs.CLOSEST&&(o.result&&(o.result[0].distance=e,o.result.length=1),o.subIndices&&(o.subIndices.length=1)),e}}(),Sc=function(){var e=0,t={distance:1/0,doubleSided:!1,mode:Zs.ANY},n=new zo,i=new Zn;return function(r,o,a){e=0;var s=void 0===a?t:a,c=o.worldBounds;if(c&&!_c(r,c))return e;zo.copy(n,r),o.node&&(Zn.invert(i,o.node.getWorldMatrix(i)),Fn.transformMat4(n.o,r.o,i),Fn.transformMat4Normal(n.d,r.d,i));for(var l=o.subModels,u=0;u<l.length;u++){var h=l[u].subMesh,_=xc(n,h,s);if(_)if(s.mode===Zs.CLOSEST)(0===e||e>_)&&(e=_,s.subIndices&&(s.subIndices[0]=u));else if(e=_,s.subIndices&&s.subIndices.push(u),s.mode===Zs.ANY)return _}return e&&s.mode===Zs.CLOSEST&&(s.result&&(s.result[0].distance=e,s.result.length=1),s.subIndices&&(s.subIndices.length=1)),e}}(),Tc=function(){var e=new Fn(0,0,0);return function(t,n){Fn.subtract(e,t.e,t.s);var i=(n.d-Fn.dot(t.s,n.n))/Fn.dot(e,n.n);return i<0||i>1?0:i}}(),Ac=function(){var e=new Fn(0,0,0),t=new Fn(0,0,0),n=new Fn(0,0,0),i=new Fn(0,0,0),r=new Fn(0,0,0),o=new Fn(0,0,0);return function(a,s,c){Fn.subtract(e,s.b,s.a),Fn.subtract(t,s.c,s.a),Fn.subtract(n,a.s,a.e),Fn.cross(r,e,t);var l=Fn.dot(n,r);if(l<=0)return 0;Fn.subtract(i,a.s,s.a);var u=Fn.dot(i,r);if(u<0||u>l)return 0;Fn.cross(o,n,i);var h=Fn.dot(t,o);if(h<0||h>l)return 0;var _=-Fn.dot(e,o);if(_<0||h+_>l)return 0;if(c){var f=1/l,m=1-(h*=f)-(_*=f);Fn.set(c,s.a.x*m+s.b.x*h+s.c.x*_,s.a.y*m+s.b.y*h+s.c.y*_,s.a.z*m+s.b.z*h+s.c.z*_)}return 1}}(),Cc=new zo;function wc(e,t){Cc.o.set(e.s),Fn.subtract(Cc.d,e.e,e.s),Cc.d.normalize();var n=_c(Cc,t);return n<=e.length()?n:0}function Ic(e,t){Cc.o.set(e.s),Fn.subtract(Cc.d,e.e,e.s),Cc.d.normalize();var n=gc(Cc,t);return n<=e.length()?n:0}function bc(e,t){Cc.o.set(e.s),Fn.subtract(Cc.d,e.e,e.s),Cc.d.normalize();var n=hc(Cc,t);return n<=e.length()?n:0}var Rc,Oc,Nc,Pc,Mc=(Rc=new Fn,Oc=new Fn,Nc=new Fn,Pc=new Fn,function(e,t){return Fn.subtract(Rc,e.center,e.halfExtents),Fn.add(Oc,e.center,e.halfExtents),Fn.subtract(Nc,t.center,t.halfExtents),Fn.add(Pc,t.center,t.halfExtents),Rc.x<=Pc.x&&Oc.x>=Nc.x&&Rc.y<=Pc.y&&Oc.y>=Nc.y&&Rc.z<=Pc.z&&Oc.z>=Nc.z});function Dc(e,t,n,i,r,o){Fn.set(o[0],e.x+n.x*t.x+i.x*t.y+r.x*t.z,e.y+n.y*t.x+i.y*t.y+r.y*t.z,e.z+n.z*t.x+i.z*t.y+r.z*t.z),Fn.set(o[1],e.x-n.x*t.x+i.x*t.y+r.x*t.z,e.y-n.y*t.x+i.y*t.y+r.y*t.z,e.z-n.z*t.x+i.z*t.y+r.z*t.z),Fn.set(o[2],e.x+n.x*t.x-i.x*t.y+r.x*t.z,e.y+n.y*t.x-i.y*t.y+r.y*t.z,e.z+n.z*t.x-i.z*t.y+r.z*t.z),Fn.set(o[3],e.x+n.x*t.x+i.x*t.y-r.x*t.z,e.y+n.y*t.x+i.y*t.y-r.y*t.z,e.z+n.z*t.x+i.z*t.y-r.z*t.z),Fn.set(o[4],e.x-n.x*t.x-i.x*t.y-r.x*t.z,e.y-n.y*t.x-i.y*t.y-r.y*t.z,e.z-n.z*t.x-i.z*t.y-r.z*t.z),Fn.set(o[5],e.x+n.x*t.x-i.x*t.y-r.x*t.z,e.y+n.y*t.x-i.y*t.y-r.y*t.z,e.z+n.z*t.x-i.z*t.y-r.z*t.z),Fn.set(o[6],e.x-n.x*t.x+i.x*t.y-r.x*t.z,e.y-n.y*t.x+i.y*t.y-r.y*t.z,e.z-n.z*t.x+i.z*t.y-r.z*t.z),Fn.set(o[7],e.x-n.x*t.x-i.x*t.y+r.x*t.z,e.y-n.y*t.x-i.y*t.y+r.y*t.z,e.z-n.z*t.x-i.z*t.y+r.z*t.z)}function Lc(e,t){for(var n=Fn.dot(t,e[0]),i=n,r=1;r<8;++r){var o=Fn.dot(t,e[r]);n=o<n?o:n,i=o>i?o:i}return[n,i]}var Fc,zc,Bc,Uc=function(){for(var e=new Array(15),t=0;t<15;t++)e[t]=new Fn(0,0,0);for(var n=new Array(8),i=new Array(8),r=0;r<8;r++)n[r]=new Fn(0,0,0),i[r]=new Fn(0,0,0);var o=new Fn,a=new Fn;return function(t,r){Fn.set(e[0],1,0,0),Fn.set(e[1],0,1,0),Fn.set(e[2],0,0,1),Fn.set(e[3],r.orientation.m00,r.orientation.m01,r.orientation.m02),Fn.set(e[4],r.orientation.m03,r.orientation.m04,r.orientation.m05),Fn.set(e[5],r.orientation.m06,r.orientation.m07,r.orientation.m08);for(var s=0;s<3;++s)Fn.cross(e[6+3*s],e[s],e[0]),Fn.cross(e[7+3*s],e[s],e[1]),Fn.cross(e[7+3*s],e[s],e[2]);Fn.subtract(o,t.center,t.halfExtents),Fn.add(a,t.center,t.halfExtents),function(e,t,n){Fn.set(n[0],e.x,t.y,t.z),Fn.set(n[1],e.x,t.y,e.z),Fn.set(n[2],e.x,e.y,t.z),Fn.set(n[3],e.x,e.y,e.z),Fn.set(n[4],t.x,t.y,t.z),Fn.set(n[5],t.x,t.y,e.z),Fn.set(n[6],t.x,e.y,t.z),Fn.set(n[7],t.x,e.y,e.z)}(o,a,n),Dc(r.center,r.halfExtents,e[3],e[4],e[5],i);for(var c=0;c<15;++c){var l=Lc(n,e[c]),u=Lc(i,e[c]);if(u[0]>l[1]||l[0]>u[1])return 0}return 1}}(),Gc=function(e,t){var n=e.halfExtents.x*Math.abs(t.n.x)+e.halfExtents.y*Math.abs(t.n.y)+e.halfExtents.z*Math.abs(t.n.z),i=Fn.dot(t.n,e.center);return i+n<t.d?-1:i-n>t.d?0:1},Hc=function(e,t){for(var n=0;n<t.planes.length;n++)if(-1===Gc(e,t.planes[n]))return 0;return 1},kc=function(){for(var e=new Array(8),t=0,n=0,i=0;i<e.length;i++)e[i]=new Fn(0,0,0);return function(i,r){for(var o=0,a=!1,s=0;s<r.planes.length;s++){if(-1===(o=Gc(i,r.planes[s])))return 0;1===o&&(a=!0)}if(!a)return 1;for(var c=0;c<r.vertices.length;c++)Fn.subtract(e[c],r.vertices[c],i.center);t=0,n=0;for(var l=0;l<r.vertices.length;l++)e[l].x>i.halfExtents.x?t++:e[l].x<-i.halfExtents.x&&n++;if(t===r.vertices.length||n===r.vertices.length)return 0;t=0,n=0;for(var u=0;u<r.vertices.length;u++)e[u].y>i.halfExtents.y?t++:e[u].y<-i.halfExtents.y&&n++;if(t===r.vertices.length||n===r.vertices.length)return 0;t=0,n=0;for(var h=0;h<r.vertices.length;h++)e[h].z>i.halfExtents.z?t++:e[h].z<-i.halfExtents.z&&n++;return t===r.vertices.length||n===r.vertices.length?0:1}}(),Vc=(Fc=new Fn(0,0,0),zc=new Gn,function(e,t){return Fn.subtract(Fc,t,e.center),Fn.transformMat3(Fc,Fc,Gn.transpose(zc,e.orientation)),n=Fc,i=e.halfExtents,Math.abs(n.x)<i.x&&Math.abs(n.y)<i.y&&Math.abs(n.z)<i.z;var n,i}),jc=(Bc=function(e,t,n,i){return Math.abs(e.x*t+e.y*n+e.z*i)},function(e,t){var n=e.halfExtents.x*Bc(t.n,e.orientation.m00,e.orientation.m01,e.orientation.m02)+e.halfExtents.y*Bc(t.n,e.orientation.m03,e.orientation.m04,e.orientation.m05)+e.halfExtents.z*Bc(t.n,e.orientation.m06,e.orientation.m07,e.orientation.m08),i=Fn.dot(t.n,e.center);return i+n<t.d?-1:i-n>t.d?0:1}),Wc=function(e,t){for(var n=0;n<t.planes.length;n++)if(-1===jc(e,t.planes[n]))return 0;return 1},qc=function(){for(var e=new Array(8),t=0,n=0,i=0,r=0;r<e.length;r++)e[r]=new Fn(0,0,0);var o=function(e,t,n,i){return e.x*t+e.y*n+e.z*i};return function(r,a){for(var s=0,c=!1,l=0;l<a.planes.length;l++){if(-1===(s=jc(r,a.planes[l])))return 0;1===s&&(c=!0)}if(!c)return 1;for(var u=0;u<a.vertices.length;u++)Fn.subtract(e[u],a.vertices[u],r.center);n=0,i=0;for(var h=0;h<a.vertices.length;h++)(t=o(e[h],r.orientation.m00,r.orientation.m01,r.orientation.m02))>r.halfExtents.x?n++:t<-r.halfExtents.x&&i++;if(n===a.vertices.length||i===a.vertices.length)return 0;n=0,i=0;for(var _=0;_<a.vertices.length;_++)(t=o(e[_],r.orientation.m03,r.orientation.m04,r.orientation.m05))>r.halfExtents.y?n++:t<-r.halfExtents.y&&i++;if(n===a.vertices.length||i===a.vertices.length)return 0;n=0,i=0;for(var f=0;f<a.vertices.length;f++)(t=o(e[f],r.orientation.m06,r.orientation.m07,r.orientation.m08))>r.halfExtents.z?n++:t<-r.halfExtents.z&&i++;return n===a.vertices.length||i===a.vertices.length?0:1}}(),Yc=function(){for(var e=new Array(15),t=0;t<15;t++)e[t]=new Fn(0,0,0);for(var n=new Array(8),i=new Array(8),r=0;r<8;r++)n[r]=new Fn(0,0,0),i[r]=new Fn(0,0,0);return function(t,r){Fn.set(e[0],t.orientation.m00,t.orientation.m01,t.orientation.m02),Fn.set(e[1],t.orientation.m03,t.orientation.m04,t.orientation.m05),Fn.set(e[2],t.orientation.m06,t.orientation.m07,t.orientation.m08),Fn.set(e[3],r.orientation.m00,r.orientation.m01,r.orientation.m02),Fn.set(e[4],r.orientation.m03,r.orientation.m04,r.orientation.m05),Fn.set(e[5],r.orientation.m06,r.orientation.m07,r.orientation.m08);for(var o=0;o<3;++o)Fn.cross(e[6+3*o],e[o],e[0]),Fn.cross(e[7+3*o],e[o],e[1]),Fn.cross(e[7+3*o],e[o],e[2]);Dc(t.center,t.halfExtents,e[0],e[1],e[2],n),Dc(r.center,r.halfExtents,e[3],e[4],e[5],i);for(var a=0;a<15;++a){var s=Lc(n,e[a]),c=Lc(i,e[a]);if(c[0]>s[1]||s[0]>c[1])return 0}return 1}}(),Xc=function(){for(var e=new jo,t=new Fn,n=new Fn,i=new Fn,r=new Array(8),o=0;o<8;o++)r[o]=new Fn;for(var a=new Array(8),s=0;s<8;s++)a[s]=new Fn;return function(o,s){if(0===Fn.squaredDistance(s.ellipseCenter0,s.ellipseCenter1))return e.radius=s.radius,e.center.set(s.ellipseCenter0),il.sphereOBB(e,o);t.x=o.orientation.m00,t.y=o.orientation.m01,t.z=o.orientation.m02,n.x=o.orientation.m03,n.y=o.orientation.m04,n.z=o.orientation.m05,i.x=o.orientation.m06,i.y=o.orientation.m07,i.z=o.orientation.m08,Dc(o.center,o.halfExtents,t,n,i,r);var c=a,l=Fn.copy(c[0],t),u=Fn.copy(c[1],n),h=Fn.copy(c[2],i);Fn.subtract(c[3],s.center,o.center).normalize();var _=Fn.subtract(c[4],s.ellipseCenter0,s.ellipseCenter1);_.normalize(),Fn.cross(c[5],l,_),Fn.cross(c[6],u,_),Fn.cross(c[7],h,_);for(var f=0;f<8;++f){var m=Lc(r,c[f]),d=Fn.dot(c[f],s.ellipseCenter0),p=Fn.dot(c[f],s.ellipseCenter1),v=Math.max(d,p),g=Math.min(d,p)-s.radius,y=v+s.radius;if(g>m[1]||m[0]>y)return 0}return 1}}(),Kc=function(e,t){var n=Fn.dot(t.n,e.center),i=e.radius*t.n.length();return n+i<t.d?-1:n-i>t.d?0:1},Qc=function(e,t){for(var n=0;n<t.planes.length;n++)if(-1===Kc(e,t.planes[n]))return 0;return 1},Zc=function(){var e=new Fn(0,0,0),t=[1,-1,1,-1,1,-1];return function(n,i){for(var r=0;r<6;r++){var o=i.planes[r],a=n.radius,s=n.center,c=o.n,l=o.d,u=Fn.dot(c,s);if(u+a<l)return 0;if(!(u-a>l)){Fn.add(e,s,Fn.multiplyScalar(e,c,a));for(var h=0;h<6;h++)if(h!==r&&h!==r+t[r]){var _=i.planes[h];if(Fn.dot(_.n,e)<_.d)return 0}}}return 1}}(),Jc=function(e,t){var n=e.radius+t.radius;return Fn.squaredDistance(e.center,t.center)<n*n},$c=function(){var e=new Fn;return function(t,n){return Po(e,t.center,n),Fn.squaredDistance(t.center,e)<t.radius*t.radius}}(),el=function(){var e=new Fn;return function(t,n){return Mo(e,t.center,n),Fn.squaredDistance(t.center,e)<t.radius*t.radius}}(),tl=function(){var e=new Fn,t=new Fn;return function(n,i){var r=n.radius+i.radius,o=r*r,a=Fn.squaredDistance(i.ellipseCenter0,i.ellipseCenter1);if(0===a)return Fn.squaredDistance(n.center,i.center)<o;Fn.subtract(e,n.center,i.ellipseCenter0),Fn.subtract(t,i.ellipseCenter1,i.ellipseCenter0);var s=Fn.dot(e,t)/a;return s<0?Fn.squaredDistance(n.center,i.ellipseCenter0)<o:s>1?Fn.squaredDistance(n.center,i.ellipseCenter1)<o:(Fn.scaleAndAdd(e,i.ellipseCenter0,t,s),Fn.squaredDistance(n.center,e)<o)}}(),nl=function(){var e=new Fn,t=new Fn,n=new Fn,i=new Fn,r=new Fn,o=new Fn;return function(a,s){var c,l,u,h,_=Fn.subtract(e,a.ellipseCenter1,a.ellipseCenter0),f=Fn.subtract(t,s.ellipseCenter1,s.ellipseCenter0),m=Fn.subtract(n,a.ellipseCenter0,s.ellipseCenter0),d=Fn.dot(_,_),p=Fn.dot(_,f),v=Fn.dot(f,f),g=Fn.dot(_,m),y=Fn.dot(f,m),x=d*v-p*p,E=x,S=x;x<mn?(l=0,E=1,h=y,S=v):(h=d*y-p*g,(l=p*y-v*g)<0?(l=0,h=y,S=v):l>E&&(l=E,h=y+p,S=v)),h<0?(h=0,-g<0?l=0:-g>d?l=E:(l=-g,E=d)):h>S&&(h=S,-g+p<0?l=0:-g+p>d?l=E:(l=-g+p,E=d)),c=Math.abs(l)<mn?0:l/E,u=Math.abs(h)<mn?0:h/S;var T=i;T.set(m),T.add(Fn.multiplyScalar(r,_,c)),T.subtract(Fn.multiplyScalar(o,f,u));var A=a.radius+s.radius;return T.lengthSqr()<A*A}}(),il={raySphere:hc,rayAABB:_c,rayOBB:gc,rayPlane:lc,rayTriangle:uc,rayCapsule:yc,raySubMesh:xc,rayMesh:Ec,rayModel:Sc,lineSphere:bc,lineAABB:wc,lineOBB:Ic,linePlane:Tc,lineTriangle:Ac,sphereWithSphere:Jc,sphereAABB:$c,sphereOBB:el,spherePlane:Kc,sphereFrustum:Qc,sphereFrustumAccurate:Zc,sphereCapsule:tl,aabbWithAABB:Mc,aabbWithOBB:Uc,aabbPlane:Gc,aabbFrustum:Hc,aabbFrustumAccurate:kc,obbWithOBB:Yc,obbPlane:jc,obbFrustum:Wc,obbFrustumAccurate:qc,obbPoint:Vc,obbCapsule:Xc,capsuleWithCapsule:nl,resolve:function(e,t,n){void 0===n&&(n=null);var i=e._type,r=t._type,o=this[i|r];return i<r?o(e,t,n):o(t,e,n)}};il[Lo.SHAPE_RAY|Lo.SHAPE_SPHERE]=hc,il[Lo.SHAPE_RAY|Lo.SHAPE_AABB]=_c,il[Lo.SHAPE_RAY|Lo.SHAPE_OBB]=gc,il[Lo.SHAPE_RAY|Lo.SHAPE_PLANE]=lc,il[Lo.SHAPE_RAY|Lo.SHAPE_TRIANGLE]=uc,il[Lo.SHAPE_RAY|Lo.SHAPE_CAPSULE]=yc,il[Lo.SHAPE_LINE|Lo.SHAPE_SPHERE]=bc,il[Lo.SHAPE_LINE|Lo.SHAPE_AABB]=wc,il[Lo.SHAPE_LINE|Lo.SHAPE_OBB]=Ic,il[Lo.SHAPE_LINE|Lo.SHAPE_PLANE]=Tc,il[Lo.SHAPE_LINE|Lo.SHAPE_TRIANGLE]=Ac,il[Lo.SHAPE_SPHERE]=Jc,il[Lo.SHAPE_SPHERE|Lo.SHAPE_AABB]=$c,il[Lo.SHAPE_SPHERE|Lo.SHAPE_OBB]=el,il[Lo.SHAPE_SPHERE|Lo.SHAPE_PLANE]=Kc,il[Lo.SHAPE_SPHERE|Lo.SHAPE_FRUSTUM]=Qc,il[Lo.SHAPE_SPHERE|Lo.SHAPE_FRUSTUM_ACCURATE]=Zc,il[Lo.SHAPE_SPHERE|Lo.SHAPE_CAPSULE]=tl,il[Lo.SHAPE_AABB]=Mc,il[Lo.SHAPE_AABB|Lo.SHAPE_OBB]=Uc,il[Lo.SHAPE_AABB|Lo.SHAPE_PLANE]=Gc,il[Lo.SHAPE_AABB|Lo.SHAPE_FRUSTUM]=Hc,il[Lo.SHAPE_AABB|Lo.SHAPE_FRUSTUM_ACCURATE]=kc,il[Lo.SHAPE_OBB]=Yc,il[Lo.SHAPE_OBB|Lo.SHAPE_PLANE]=jc,il[Lo.SHAPE_OBB|Lo.SHAPE_FRUSTUM]=Wc,il[Lo.SHAPE_OBB|Lo.SHAPE_FRUSTUM_ACCURATE]=qc,il[Lo.SHAPE_OBB|Lo.SHAPE_CAPSULE]=Xc,il[Lo.SHAPE_CAPSULE]=nl,me(Fo.prototype,"line",[{name:"mag",newName:"len"},{name:"magnitude",newName:"len"}]),de(il,"intersect",[{name:"line_quad"}]);var rl=new Fn(0,0,0),ol=new Fn(0,0,0),al=c.mat4(),sl=c.v4(),cl=function(){function e(e,t,n,i){void 0===e&&(e=0),void 0===t&&(t=1),void 0===n&&(n=0),void 0===i&&(i=0),this.n=void 0,this.d=void 0,this._type=void 0,this._type=Lo.SHAPE_PLANE,this.n=new Fn(e,t,n),this.d=i}return e.create=function(t,n,i,r){return new e(t,n,i,r)},e.clone=function(t){return new e(t.n.x,t.n.y,t.n.z,t.d)},e.copy=function(e,t){return Fn.copy(e.n,t.n),e.d=t.d,e},e.fromPoints=function(e,t,n,i){return Fn.subtract(rl,n,t),Fn.subtract(ol,i,t),Fn.normalize(e.n,Fn.cross(e.n,rl,ol)),e.d=Fn.dot(e.n,t),e},e.set=function(e,t,n,i,r){return e.n.x=t,e.n.y=n,e.n.z=i,e.d=r,e},e.fromNormalAndPoint=function(e,t,n){return Fn.copy(e.n,t),e.d=Fn.dot(t,n),e},e.normalize=function(e,t){var n=t.n.length();return Fn.normalize(e.n,t.n),n>0&&(e.d=t.d/n),e},Z(e,[{key:"type",get:function(){return this._type}},{key:"x",set:function(e){this.n.x=e},get:function(){return this.n.x}},{key:"y",set:function(e){this.n.y=e},get:function(){return this.n.y}},{key:"z",set:function(e){this.n.z=e},get:function(){return this.n.z}},{key:"w",set:function(e){this.d=e},get:function(){return this.d}}]),e.prototype.transform=function(e){Zn.invert(al,e),Zn.transpose(al,al),oi.set(sl,this.n.x,this.n.y,this.n.z,this.d),oi.transformMat4(sl,sl,al),Fn.set(this.n,sl.x,sl.y,sl.z),this.d=sl.w},e}(),ll=new Fn,ul=new Fn,hl=new Fn,_l=new Fn,fl=new Gn,ml=function(e,t,n){fl.m00=Math.abs(n.m00),fl.m01=Math.abs(n.m01),fl.m02=Math.abs(n.m02),fl.m03=Math.abs(n.m04),fl.m04=Math.abs(n.m05),fl.m05=Math.abs(n.m06),fl.m06=Math.abs(n.m08),fl.m07=Math.abs(n.m09),fl.m08=Math.abs(n.m10),Fn.transformMat3(e,t,fl)},dl=e("aL",function(){function e(e,t,n,i,r,o){void 0===e&&(e=0),void 0===t&&(t=0),void 0===n&&(n=0),void 0===i&&(i=1),void 0===r&&(r=1),void 0===o&&(o=1),this.center=void 0,this.halfExtents=void 0,this._type=void 0,this._type=Lo.SHAPE_AABB,this.center=new Fn(e,t,n),this.halfExtents=new Fn(i,r,o)}e.create=function(t,n,i,r,o,a){return new e(t,n,i,r,o,a)},e.clone=function(t){return new e(t.center.x,t.center.y,t.center.z,t.halfExtents.x,t.halfExtents.y,t.halfExtents.z)},e.copy=function(e,t){return Fn.copy(e.center,t.center),Fn.copy(e.halfExtents,t.halfExtents),e},e.fromPoints=function(e,t,n){return Fn.add(ll,n,t),Fn.subtract(ul,n,t),Fn.multiplyScalar(e.center,ll,.5),Fn.multiplyScalar(e.halfExtents,ul,.5),e},e.set=function(e,t,n,i,r,o,a){return Fn.set(e.center,t,n,i),Fn.set(e.halfExtents,r,o,a),e},e.merge=function(t,n,i){return Fn.subtract(ll,n.center,n.halfExtents),Fn.subtract(ul,i.center,i.halfExtents),Fn.add(hl,n.center,n.halfExtents),Fn.add(_l,i.center,i.halfExtents),Fn.max(_l,hl,_l),Fn.min(hl,ll,ul),e.fromPoints(t,hl,_l)},e.toBoundingSphere=function(e,t){t.getBoundary(ll,ul),e.center.set(ll),e.radius=0,Fn.subtract(hl,ul,e.center);var n=hl.length(),i=.5*n;return e.radius+=i,Fn.multiplyScalar(hl,hl,i/n),Fn.add(e.center,e.center,hl),e},e.transform=function(e,t,n){return Fn.transformMat4(e.center,t.center,n),ml(e.halfExtents,t.halfExtents,n),e},Z(e,[{key:"type",get:function(){return this._type}}]);var t=e.prototype;return t.getBoundary=function(e,t){Fn.subtract(e,this.center,this.halfExtents),Fn.add(t,this.center,this.halfExtents)},t.transform=function(e,t,n,i,r){Fn.transformMat4(r.center,this.center,e),ml(r.halfExtents,this.halfExtents,e)},t.clone=function(){return e.clone(this)},t.copy=function(t){return e.copy(this,t)},e}()),pl=new Fn,vl=new Fn,gl=new Gn,yl=function(){function e(e,t,n,i,r,o,a,s,c,l,u,h,_,f,m){void 0===e&&(e=0),void 0===t&&(t=0),void 0===n&&(n=0),void 0===i&&(i=1),void 0===r&&(r=1),void 0===o&&(o=1),void 0===a&&(a=1),void 0===s&&(s=0),void 0===c&&(c=0),void 0===l&&(l=0),void 0===u&&(u=1),void 0===h&&(h=0),void 0===_&&(_=0),void 0===f&&(f=0),void 0===m&&(m=1),this.center=void 0,this.halfExtents=void 0,this.orientation=void 0,this._type=void 0,this._type=Lo.SHAPE_OBB,this.center=new Fn(e,t,n),this.halfExtents=new Fn(i,r,o),this.orientation=new Gn(a,s,c,l,u,h,_,f,m)}e.create=function(t,n,i,r,o,a,s,c,l,u,h,_,f,m,d){return new e(t,n,i,r,o,a,s,c,l,u,h,_,f,m,d)},e.clone=function(t){return new e(t.center.x,t.center.y,t.center.z,t.halfExtents.x,t.halfExtents.y,t.halfExtents.z,t.orientation.m00,t.orientation.m01,t.orientation.m02,t.orientation.m03,t.orientation.m04,t.orientation.m05,t.orientation.m06,t.orientation.m07,t.orientation.m08)},e.copy=function(e,t){return Fn.copy(e.center,t.center),Fn.copy(e.halfExtents,t.halfExtents),Gn.copy(e.orientation,t.orientation),e},e.fromPoints=function(e,t,n){return Fn.multiplyScalar(e.center,Fn.add(pl,t,n),.5),Fn.multiplyScalar(e.halfExtents,Fn.subtract(vl,n,t),.5),Gn.identity(e.orientation),e},e.set=function(e,t,n,i,r,o,a,s,c,l,u,h,_,f,m,d){return Fn.set(e.center,t,n,i),Fn.set(e.halfExtents,r,o,a),Gn.set(e.orientation,s,c,l,u,h,_,f,m,d),e},Z(e,[{key:"type",get:function(){return this._type}}]);var t=e.prototype;return t.getBoundary=function(e,t){!function(e,t,n){gl.m00=Math.abs(n.m00),gl.m01=Math.abs(n.m01),gl.m02=Math.abs(n.m02),gl.m03=Math.abs(n.m03),gl.m04=Math.abs(n.m04),gl.m05=Math.abs(n.m05),gl.m06=Math.abs(n.m06),gl.m07=Math.abs(n.m07),gl.m08=Math.abs(n.m08),Fn.transformMat3(e,t,gl)}(pl,this.halfExtents,this.orientation),Fn.subtract(e,this.center,pl),Fn.add(t,this.center,pl)},t.transform=function(e,t,n,i,r){Fn.transformMat4(r.center,this.center,e),Gn.fromQuat(r.orientation,n),Fn.multiply(r.halfExtents,this.halfExtents,i)},t.translateAndRotate=function(e,t,n){Fn.transformMat4(n.center,this.center,e),Gn.fromQuat(n.orientation,t)},t.setScale=function(e,t){Fn.multiply(t.halfExtents,this.halfExtents,e)},e}(),xl=function(){function e(e,t,n){void 0===e&&(e=.5),void 0===t&&(t=.5),void 0===n&&(n=1),this._type=void 0,this.radius=void 0,this.halfHeight=void 0,this.axis=void 0,this.center=void 0,this.rotation=void 0,this.ellipseCenter0=void 0,this.ellipseCenter1=void 0,this._type=Lo.SHAPE_CAPSULE,this.radius=e,this.halfHeight=t,this.axis=n,this.center=new Fn,this.rotation=new Vn,this.ellipseCenter0=new Fn(0,t,0),this.ellipseCenter1=new Fn(0,-t,0),this.updateCache()}Z(e,[{key:"type",get:function(){return this._type}}]);var t=e.prototype;return t.transform=function(e,t,n,i,r){var o=i,a=Pn(o);r.radius=this.radius*Math.abs(a);var s=(this.halfHeight+this.radius)*Math.abs(o.y)-r.radius;s<0&&(s=0),r.halfHeight=s,Fn.transformMat4(r.center,this.center,e),Vn.multiply(r.rotation,this.rotation,n),r.updateCache()},t.updateCache=function(){this.updateLocalCenter(),Fn.transformQuat(this.ellipseCenter0,this.ellipseCenter0,this.rotation),Fn.transformQuat(this.ellipseCenter1,this.ellipseCenter1,this.rotation),this.ellipseCenter0.add(this.center),this.ellipseCenter1.add(this.center)},t.updateLocalCenter=function(){var e=this.halfHeight;switch(this.axis){case 0:this.ellipseCenter0.set(e,0,0),this.ellipseCenter1.set(-e,0,0);break;case 1:this.ellipseCenter0.set(0,e,0),this.ellipseCenter1.set(0,-e,0);break;case 2:this.ellipseCenter0.set(0,0,e),this.ellipseCenter1.set(0,0,-e)}},e}(),El=new Array(8);El[0]=new Fn(1,1,1),El[1]=new Fn(-1,1,1),El[2]=new Fn(-1,-1,1),El[3]=new Fn(1,-1,1),El[4]=new Fn(1,1,-1),El[5]=new Fn(-1,1,-1),El[6]=new Fn(-1,-1,-1),El[7]=new Fn(1,-1,-1);var Sl,Tl,Al,Cl=function(){function e(){this._type=void 0,this.planes=void 0,this.vertices=void 0,this._type=Lo.SHAPE_FRUSTUM,this.planes=new Array(6);for(var e=0;e<6;++e)this.planes[e]=cl.create(0,0,0,0);this.vertices=new Array(8);for(var t=0;t<8;++t)this.vertices[t]=new Fn}e.create=function(){return new e},e.clone=function(t){return e.copy(new e,t)},e.copy=function(e,t){e._type=t._type;for(var n=0;n<6;++n)cl.copy(e.planes[n],t.planes[n]);for(var i=0;i<8;++i)Fn.copy(e.vertices[i],t.vertices[i]);return e},Z(e,[{key:"accurate",set:function(e){this._type=e?Lo.SHAPE_FRUSTUM_ACCURATE:Lo.SHAPE_FRUSTUM}},{key:"type",get:function(){return this._type}}]);var t=e.prototype;return t.update=function(e,t){if(Fn.set(this.planes[0].n,e.m03+e.m00,e.m07+e.m04,e.m11+e.m08),this.planes[0].d=-(e.m15+e.m12),Fn.set(this.planes[1].n,e.m03-e.m00,e.m07-e.m04,e.m11-e.m08),this.planes[1].d=-(e.m15-e.m12),Fn.set(this.planes[2].n,e.m03+e.m01,e.m07+e.m05,e.m11+e.m09),this.planes[2].d=-(e.m15+e.m13),Fn.set(this.planes[3].n,e.m03-e.m01,e.m07-e.m05,e.m11-e.m09),this.planes[3].d=-(e.m15-e.m13),Fn.set(this.planes[4].n,e.m03+e.m02,e.m07+e.m06,e.m11+e.m10),this.planes[4].d=-(e.m15+e.m14),Fn.set(this.planes[5].n,e.m03-e.m02,e.m07-e.m06,e.m11-e.m10),this.planes[5].d=-(e.m15-e.m14),this._type===Lo.SHAPE_FRUSTUM_ACCURATE){for(var n=0;n<6;n++){var i=this.planes[n],r=1/i.n.length();Fn.multiplyScalar(i.n,i.n,r),i.d*=r}for(var o=0;o<8;o++)Fn.transformMat4(this.vertices[o],El[o],t)}},t.transform=function(e){if(this._type===Lo.SHAPE_FRUSTUM_ACCURATE){for(var t=0;t<8;t++)Fn.transformMat4(this.vertices[t],this.vertices[t],e);cl.fromPoints(this.planes[0],this.vertices[1],this.vertices[5],this.vertices[6]),cl.fromPoints(this.planes[1],this.vertices[3],this.vertices[7],this.vertices[4]),cl.fromPoints(this.planes[2],this.vertices[6],this.vertices[7],this.vertices[3]),cl.fromPoints(this.planes[3],this.vertices[0],this.vertices[4],this.vertices[5]),cl.fromPoints(this.planes[4],this.vertices[2],this.vertices[3],this.vertices[0]),cl.fromPoints(this.planes[0],this.vertices[7],this.vertices[6],this.vertices[5])}},e}();function wl(e,t){if(t&&e!==Yi){for(var n=t.vertices,i=Lr.VERTICES,r=0;r<8;++r)Gr.setVec3(e,i,n[r]),i+=3;for(var o=t.planes,a=Lr.PLANES,s=0;s<6;s++,a+=4)Gr.setVec4(e,a,o[s])}}Cl.createOrtho=(Sl=new Fn,function(e,t,n,i,r,o){var a=t/2,s=n/2;Fn.set(Sl,a,s,i),Fn.transformMat4(e.vertices[0],Sl,o),Fn.set(Sl,-a,s,i),Fn.transformMat4(e.vertices[1],Sl,o),Fn.set(Sl,-a,-s,i),Fn.transformMat4(e.vertices[2],Sl,o),Fn.set(Sl,a,-s,i),Fn.transformMat4(e.vertices[3],Sl,o),Fn.set(Sl,a,s,r),Fn.transformMat4(e.vertices[4],Sl,o),Fn.set(Sl,-a,s,r),Fn.transformMat4(e.vertices[5],Sl,o),Fn.set(Sl,-a,-s,r),Fn.transformMat4(e.vertices[6],Sl,o),Fn.set(Sl,a,-s,r),Fn.transformMat4(e.vertices[7],Sl,o),cl.fromPoints(e.planes[0],e.vertices[1],e.vertices[6],e.vertices[5]),cl.fromPoints(e.planes[1],e.vertices[3],e.vertices[4],e.vertices[7]),cl.fromPoints(e.planes[2],e.vertices[6],e.vertices[3],e.vertices[7]),cl.fromPoints(e.planes[3],e.vertices[0],e.vertices[5],e.vertices[4]),cl.fromPoints(e.planes[4],e.vertices[2],e.vertices[0],e.vertices[3]),cl.fromPoints(e.planes[0],e.vertices[7],e.vertices[5],e.vertices[6])}),function(e){e[e.Default=0]="Default",e[e.Normal=1]="Normal",e[e.Loop=2]="Loop",e[e.ShouldWrap=4]="ShouldWrap",e[e.Clamp=8]="Clamp",e[e.PingPong=22]="PingPong",e[e.Reverse=36]="Reverse"}(Tl||(Tl={})),function(e){e[e.Default=Tl.Default]="Default",e[e.Normal=Tl.Normal]="Normal",e[e.Reverse=Tl.Reverse]="Reverse",e[e.Loop=Tl.Loop]="Loop",e[e.LoopReverse=Tl.Loop|Tl.Reverse]="LoopReverse",e[e.PingPong=Tl.PingPong]="PingPong",e[e.PingPongReverse=Tl.PingPong|Tl.Reverse]="PingPongReverse"}(Al||(Al={})),xt(Al);var Il=function(){function e(e){this.ratio=0,this.time=0,this.direction=1,this.stopped=!0,this.iterations=0,this.frameIndex=void 0,e&&this.set(e)}return e.prototype.set=function(e){this.ratio=e.ratio,this.time=e.time,this.direction=e.direction,this.stopped=e.stopped,this.iterations=e.iterations,this.frameIndex=e.frameIndex},e}(),bl=vt({Default:Tl.Default,Normal:Tl.Normal,Clamp:Tl.Clamp,Loop:Tl.Loop,PingPong:Tl.PingPong}),Rl=function(){this.time=0,this.value=0,this.inTangent=0,this.outTangent=0};ln.fastDefine("cc.Keyframe",Rl,{time:0,value:0,inTangent:0,outTangent:0});var Ol=function(){function e(){this.index=void 0,this.time=void 0,this.endTime=void 0,this.coefficient=void 0,this.index=-1,this.time=0,this.endTime=0,this.coefficient=new Float32Array(4)}return e.prototype.evaluate=function(e){return t=e-this.time,n=this.coefficient,t*(t*(t*n[0]+n[1])+n[2])+n[3];var t,n},e}(),Nl=e("cV",function(){function e(t){void 0===t&&(t=null),this.keyFrames=void 0,this.preWrapMode=bl.Loop,this.postWrapMode=bl.Clamp,this.cachedKey=void 0,this.keyFrames=t||[].concat(e.defaultKF),this.cachedKey=new Ol}var t=e.prototype;return t.addKey=function(e){null==this.keyFrames&&(this.keyFrames=[]),this.keyFrames.push(e)},t.evaluate_slow=function(e){var t=e,n=e<0?this.preWrapMode:this.postWrapMode,i=this.keyFrames[0].time,r=this.keyFrames[this.keyFrames.length-1].time;switch(n){case bl.Loop:t=Rn(e-i,r-i)+i;break;case bl.PingPong:t=On(e-i,r-i)+i;break;case bl.Default:case bl.Normal:case bl.Clamp:default:t=vn(e,i,r)}var o=0;if(t>this.keyFrames[0].time)if(t>=this.keyFrames[this.keyFrames.length-1].time)o=this.keyFrames.length-2;else for(var a=0;a<this.keyFrames.length-1;a++)if(t>=this.keyFrames[0].time&&t<=this.keyFrames[a+1].time){o=a;break}var s=this.keyFrames[o],c=this.keyFrames[o+1],l=Nn(s.time,c.time,t),u=c.time-s.time,h=s.outTangent*u,_=c.inTangent*u,f=l*l,m=f*l,d=m-2*f+l,p=m-f,v=-2*m+3*f;return(2*m-3*f+1)*s.value+d*h+p*_+v*c.value},t.evaluate=function(e){var t=e,n=e<0?this.preWrapMode:this.postWrapMode,i=this.keyFrames[0].time,r=this.keyFrames[this.keyFrames.length-1].time;switch(n){case bl.Loop:t=Rn(e-i,r-i)+i;break;case bl.PingPong:t=On(e-i,r-i)+i;break;case bl.Default:case bl.Normal:case bl.Clamp:default:t=vn(e,i,r)}if(t>=this.cachedKey.time&&t<this.cachedKey.endTime)return this.cachedKey.evaluate(t);var o=this.findIndex(this.cachedKey,t),a=Math.min(o+1,this.keyFrames.length-1);return this.calcOptimizedKey(this.cachedKey,o,a),this.cachedKey.evaluate(t)},t.calcOptimizedKey=function(e,t,n){var i=this.keyFrames[t],r=this.keyFrames[n];e.index=t,e.time=i.time,e.endTime=r.time;var o=r.time-i.time,a=r.value-i.value,s=1/(o*o),c=i.outTangent*o,l=r.inTangent*o;e.coefficient[0]=(c+l-a-a)*s/o,e.coefficient[1]=(a+a+a-c-c-l)*s,e.coefficient[2]=i.outTangent,e.coefficient[3]=i.value},t.findIndex=function(e,t){var n=e.index;if(-1!==n)if(t>this.keyFrames[n].time)for(var i=0;i<3;i++){var r=n+i;if(r+1<this.keyFrames.length&&this.keyFrames[r+1].time>t)return r}else for(var o=0;o<3;o++){var a=n-o;if(a>=0&&this.keyFrames[a-1].time<=t)return a-1}for(var s,c=0,l=this.keyFrames.length;l-c>1;)s=Math.floor((c+l)/2),this.keyFrames[s].time>=t?l=s:c=s;return c},e}());function Pl(e,t){console.warn(e+" is deprecated, please use "+t+" instead.")}Nl.defaultKF=[{time:0,value:1,inTangent:0,outTangent:0},{time:1,value:1,inTangent:0,outTangent:0}],ln.fastDefine("cc.AnimationCurve",Nl,{preWrapMode:bl.Default,postWrapMode:bl.Default,keyFrames:[]}),me(il,"intersect",[{name:"ray_aabb",newName:"rayAABB"},{name:"ray_plane",newName:"rayPlane"},{name:"ray_triangle",newName:"rayTriangle"},{name:"ray_sphere",newName:"raySphere"},{name:"ray_obb",newName:"rayOBB"},{name:"ray_capsule",newName:"rayCapsule"},{name:"ray_subMesh",newName:"raySubMesh"},{name:"ray_mesh",newName:"rayMesh"},{name:"ray_model",newName:"rayModel"},{name:"line_plane",newName:"linePlane"},{name:"line_triangle",newName:"lineTriangle"},{name:"line_aabb",newName:"lineAABB"},{name:"line_obb",newName:"lineOBB"},{name:"line_sphere",newName:"lineSphere"},{name:"aabb_aabb",newName:"aabbWithAABB"},{name:"aabb_obb",newName:"aabbWithOBB"},{name:"aabb_plane",newName:"aabbPlane"},{name:"aabb_frustum",newName:"aabbFrustum"},{name:"aabbFrustum_accurate",newName:"aabbFrustumAccurate"},{name:"obb_point",newName:"obbPoint"},{name:"obb_plane",newName:"obbPlane"},{name:"obb_frustum",newName:"obbFrustum"},{name:"obbFrustum_accurate",newName:"obbFrustumAccurate"},{name:"obb_obb",newName:"obbWithOBB"},{name:"obb_capsule",newName:"obbCapsule"},{name:"sphere_plane",newName:"spherePlane"},{name:"sphere_frustum",newName:"sphereFrustum"},{name:"sphereFrustum_accurate",newName:"sphereFrustumAccurate"},{name:"sphere_sphere",newName:"sphereWithSphere"},{name:"sphere_aabb",newName:"sphereAABB"},{name:"sphere_obb",newName:"sphereOBB"},{name:"sphere_capsule",newName:"sphereCapsule"},{name:"capsule_capsule",newName:"capsuleWithCapsule"}]);var Ml=function(e){function t(){var t;return t=e.call(this)||this,Pl("line","Line"),t}return $(t,e),t}(Fo),Dl=function(e){function t(){var t;return t=e.call(this)||this,Pl("plane","Plane"),t}return $(t,e),t}(cl),Ll=function(e){function t(){var t;return t=e.call(this)||this,Pl("ray","Ray"),t}return $(t,e),t}(zo),Fl=function(e){function t(){var t;return t=e.call(this)||this,Pl("triangle","Triangle"),t}return $(t,e),t}(Wo),zl=function(e){function t(){var t;return t=e.call(this)||this,Pl("sphere","Sphere"),t}return $(t,e),t}(jo),Bl=function(e){function t(){var t;return t=e.call(this)||this,Pl("aabb","AABB"),t}return $(t,e),t}(dl),Ul=function(e){function t(){var t;return t=e.call(this)||this,Pl("obb","OBB"),t}return $(t,e),t}(yl),Gl=function(e){function t(){var t;return t=e.call(this)||this,Pl("capsule","Capsule"),t}return $(t,e),t}(xl),Hl=function(e){function t(){var t;return t=e.call(this)||this,Pl("frustum","Frustum"),t}return $(t,e),t}(Cl),kl=Object.freeze({__proto__:null,distance:Do,enums:Lo,intersect:il,Line:Fo,Plane:cl,Ray:zo,Triangle:Wo,Sphere:jo,AABB:dl,OBB:yl,Capsule:xl,Frustum:Cl,Keyframe:Rl,AnimationCurve:Nl,get ERaycastMode(){return Zs},line:Ml,plane:Dl,ray:Ll,triangle:Fl,sphere:zl,aabb:Bl,obb:Ul,capsule:Gl,frustum:Hl});e("dy",kl);var Vl,jl,Wl={NONE:0,IGNORE_RAYCAST:1<<20,GIZMOS:1<<21,EDITOR:1<<22,UI_3D:1<<23,SCENE_GIZMO:1<<24,UI_2D:1<<25,PROFILER:1<<28,DEFAULT:1<<30,ALL:4294967295},ql=e("cn",function(){function e(){}return e.makeMaskInclude=function(e){for(var t,n=0,i=ne(e);!(t=i()).done;)n|=t.value;return n},e.makeMaskExclude=function(t){return~e.makeMaskInclude(t)},e.addLayer=function(t,n){void 0!==n?n>19||n<0?console.warn("maximum layers reached."):(e.Enum[t]=1<<n,e.Enum[n]=t,e.BitMask[t]=1<<n,e.BitMask[n]=t):console.warn("bitNum can't be undefined")},e.deleteLayer=function(t){t>19||t<0?console.warn("do not change buildin layers."):(delete e.Enum[e.Enum[t]],delete e.Enum[t],delete e.BitMask[e.BitMask[t]],delete e.BitMask[t])},e}());ql.Enum=vt(Wl),ql.BitMask=pt(J({},Wl)),c.Layers=ql,function(e){e[e.DEFAULT=100]="DEFAULT",e[e.UI=200]="UI"}(Vl||(Vl={})),c.RenderPassStage=Vl,function(e){e[e.MIN=0]="MIN",e[e.MAX=255]="MAX",e[e.DEFAULT=128]="DEFAULT"}(jl||(jl=e("cj",{})));var Yl,Xl={bindings:[],layouts:{}},Kl={bindings:[],layouts:{}};!function(e){e[e.UBO_GLOBAL=0]="UBO_GLOBAL",e[e.UBO_CAMERA=1]="UBO_CAMERA",e[e.UBO_SHADOW=2]="UBO_SHADOW",e[e.SAMPLER_SHADOWMAP=3]="SAMPLER_SHADOWMAP",e[e.SAMPLER_ENVIRONMENT=4]="SAMPLER_ENVIRONMENT",e[e.SAMPLER_SPOT_LIGHTING_MAP=5]="SAMPLER_SPOT_LIGHTING_MAP",e[e.COUNT=6]="COUNT"}(Yl||(Yl={}));var Ql,Zl=Yl.SAMPLER_SHADOWMAP,Jl=Yl.COUNT-Zl;!function(e){e[e.UBO_LOCAL=0]="UBO_LOCAL",e[e.UBO_FORWARD_LIGHTS=1]="UBO_FORWARD_LIGHTS",e[e.UBO_SKINNING_ANIMATION=2]="UBO_SKINNING_ANIMATION",e[e.UBO_SKINNING_TEXTURE=3]="UBO_SKINNING_TEXTURE",e[e.UBO_MORPH=4]="UBO_MORPH",e[e.SAMPLER_JOINTS=5]="SAMPLER_JOINTS",e[e.SAMPLER_MORPH_POSITION=6]="SAMPLER_MORPH_POSITION",e[e.SAMPLER_MORPH_NORMAL=7]="SAMPLER_MORPH_NORMAL",e[e.SAMPLER_MORPH_TANGENT=8]="SAMPLER_MORPH_TANGENT",e[e.SAMPLER_LIGHTMAP=9]="SAMPLER_LIGHTMAP",e[e.SAMPLER_SPRITE=10]="SAMPLER_SPRITE",e[e.COUNT=11]="COUNT"}(Ql||(Ql=e("cz",{})));var $l,eu=Ql.SAMPLER_JOINTS,tu=Ql.COUNT-eu;!function(e){e[e.GLOBAL=0]="GLOBAL",e[e.MATERIAL=1]="MATERIAL",e[e.LOCAL=2]="LOCAL"}($l||($l={}));var nu=new Ya;nu.bufferOffsets=[0,Zl+eu,Zl],nu.samplerOffsets=[-Zl,Jl+tu,Jl-eu],nu.flexibleSet=1;var iu=function(){};iu.SIZE=4*(iu.COUNT=4+(iu.SCREEN_SIZE_OFFSET=4+(iu.NATIVE_SIZE_OFFSET=4+(iu.TIME_OFFSET=0)))),iu.NAME="CCGlobal",iu.BINDING=Yl.UBO_GLOBAL,iu.DESCRIPTOR=new Vs(iu.BINDING,pa.UNIFORM_BUFFER,1,da.ALL),iu.LAYOUT=new Os($l.GLOBAL,iu.BINDING,iu.NAME,[new Rs("cc_time",Xo.FLOAT4,1),new Rs("cc_screenSize",Xo.FLOAT4,1),new Rs("cc_nativeSize",Xo.FLOAT4,1)],1),Xl.layouts[iu.NAME]=iu.LAYOUT,Xl.bindings[iu.BINDING]=iu.DESCRIPTOR;var ru=function(){};ru.SIZE=4*(ru.COUNT=4+(ru.GLOBAL_FOG_ADD_OFFSET=4+(ru.GLOBAL_FOG_BASE_OFFSET=4+(ru.GLOBAL_FOG_COLOR_OFFSET=4+(ru.AMBIENT_GROUND_OFFSET=4+(ru.AMBIENT_SKY_OFFSET=4+(ru.MAIN_LIT_COLOR_OFFSET=4+(ru.MAIN_LIT_DIR_OFFSET=4+(ru.EXPOSURE_OFFSET=4+(ru.SCREEN_SCALE_OFFSET=4+(ru.CAMERA_POS_OFFSET=16+(ru.MAT_VIEW_PROJ_INV_OFFSET=16+(ru.MAT_VIEW_PROJ_OFFSET=16+(ru.MAT_PROJ_INV_OFFSET=16+(ru.MAT_PROJ_OFFSET=16+(ru.MAT_VIEW_INV_OFFSET=16+(ru.MAT_VIEW_OFFSET=0))))))))))))))))),ru.NAME="CCCamera",ru.BINDING=Yl.UBO_CAMERA,ru.DESCRIPTOR=new Vs(ru.BINDING,pa.UNIFORM_BUFFER,1,da.ALL),ru.LAYOUT=new Os($l.GLOBAL,ru.BINDING,ru.NAME,[new Rs("cc_matView",Xo.MAT4,1),new Rs("cc_matViewInv",Xo.MAT4,1),new Rs("cc_matProj",Xo.MAT4,1),new Rs("cc_matProjInv",Xo.MAT4,1),new Rs("cc_matViewProj",Xo.MAT4,1),new Rs("cc_matViewProjInv",Xo.MAT4,1),new Rs("cc_cameraPos",Xo.FLOAT4,1),new Rs("cc_screenScale",Xo.FLOAT4,1),new Rs("cc_exposure",Xo.FLOAT4,1),new Rs("cc_mainLitDir",Xo.FLOAT4,1),new Rs("cc_mainLitColor",Xo.FLOAT4,1),new Rs("cc_ambientSky",Xo.FLOAT4,1),new Rs("cc_ambientGround",Xo.FLOAT4,1),new Rs("cc_fogColor",Xo.FLOAT4,1),new Rs("cc_fogBase",Xo.FLOAT4,1),new Rs("cc_fogAdd",Xo.FLOAT4,1)],1),Xl.layouts[ru.NAME]=ru.LAYOUT,Xl.bindings[ru.BINDING]=ru.DESCRIPTOR;var ou=function(){};ou.SIZE=4*(ou.COUNT=4+(ou.SHADOW_INFO_OFFSET=4+(ou.SHADOW_COLOR_OFFSET=16+(ou.MAT_LIGHT_VIEW_PROJ_OFFSET=16+(ou.MAT_LIGHT_PLANE_PROJ_OFFSET=0))))),ou.NAME="CCShadow",ou.BINDING=Yl.UBO_SHADOW,ou.DESCRIPTOR=new Vs(ou.BINDING,pa.UNIFORM_BUFFER,1,da.ALL),ou.LAYOUT=new Os($l.GLOBAL,ou.BINDING,ou.NAME,[new Rs("cc_matLightPlaneProj",Xo.MAT4,1),new Rs("cc_matLightViewProj",Xo.MAT4,1),new Rs("cc_shadowColor",Xo.FLOAT4,1),new Rs("cc_shadowInfo",Xo.FLOAT4,1)],1),Xl.layouts[ou.NAME]=ou.LAYOUT,Xl.bindings[ou.BINDING]=ou.DESCRIPTOR;var au=Yl.SAMPLER_SHADOWMAP,su=new Vs(au,pa.SAMPLER,1,da.FRAGMENT),cu=new Ns($l.GLOBAL,au,"cc_shadowMap",Xo.SAMPLER2D,1);Xl.layouts.cc_shadowMap=cu,Xl.bindings[au]=su;var lu=Yl.SAMPLER_ENVIRONMENT,uu=new Vs(lu,pa.SAMPLER,1,da.FRAGMENT),hu=new Ns($l.GLOBAL,lu,"cc_environment",Xo.SAMPLER_CUBE,1);Xl.layouts.cc_environment=hu,Xl.bindings[lu]=uu;var _u=Yl.SAMPLER_SPOT_LIGHTING_MAP,fu=new Vs(_u,pa.SAMPLER,1,da.FRAGMENT),mu=new Ns($l.GLOBAL,_u,"cc_spotLightingMap",Xo.SAMPLER2D,1);Xl.layouts.cc_spotLightingMap=mu,Xl.bindings[_u]=fu;var du=e("cx",(function(){}));du.MAT_WORLD_OFFSET=0,du.MAT_WORLD_IT_OFFSET=du.MAT_WORLD_OFFSET+16,du.LIGHTINGMAP_UVPARAM=du.MAT_WORLD_IT_OFFSET+16,du.COUNT=du.LIGHTINGMAP_UVPARAM+4,du.SIZE=4*du.COUNT,du.NAME="CCLocal",du.BINDING=Ql.UBO_LOCAL,du.DESCRIPTOR=new Vs(du.BINDING,pa.UNIFORM_BUFFER,1,da.VERTEX),du.LAYOUT=new Os($l.LOCAL,du.BINDING,du.NAME,[new Rs("cc_matWorld",Xo.MAT4,1),new Rs("cc_matWorldIT",Xo.MAT4,1),new Rs("cc_lightingMapUVParam",Xo.FLOAT4,1)],1),Kl.layouts[du.NAME]=du.LAYOUT,Kl.bindings[du.BINDING]=du.DESCRIPTOR;var pu=function(){};pu.BATCHING_COUNT=10,pu.MAT_WORLDS_OFFSET=0,pu.SIZE=4*(pu.COUNT=16*pu.BATCHING_COUNT),pu.NAME="CCLocalBatched",pu.BINDING=Ql.UBO_LOCAL,pu.DESCRIPTOR=new Vs(pu.BINDING,pa.UNIFORM_BUFFER,1,da.VERTEX),pu.LAYOUT=new Os($l.LOCAL,pu.BINDING,pu.NAME,[new Rs("cc_matWorlds",Xo.MAT4,pu.BATCHING_COUNT)],1),Kl.layouts[pu.NAME]=pu.LAYOUT,Kl.bindings[pu.BINDING]=pu.DESCRIPTOR;var vu=function(){};vu.LIGHTS_PER_PASS=1,vu.SIZE=4*(vu.COUNT=(vu.LIGHT_DIR_OFFSET=(vu.LIGHT_SIZE_RANGE_ANGLE_OFFSET=(vu.LIGHT_COLOR_OFFSET=(vu.LIGHT_POS_OFFSET=0)+4*vu.LIGHTS_PER_PASS)+4*vu.LIGHTS_PER_PASS)+4*vu.LIGHTS_PER_PASS)+4*vu.LIGHTS_PER_PASS),vu.NAME="CCForwardLight",vu.BINDING=Ql.UBO_FORWARD_LIGHTS,vu.DESCRIPTOR=new Vs(vu.BINDING,pa.DYNAMIC_UNIFORM_BUFFER,1,da.FRAGMENT),vu.LAYOUT=new Os($l.LOCAL,vu.BINDING,vu.NAME,[new Rs("cc_lightPos",Xo.FLOAT4,vu.LIGHTS_PER_PASS),new Rs("cc_lightColor",Xo.FLOAT4,vu.LIGHTS_PER_PASS),new Rs("cc_lightSizeRangeAngle",Xo.FLOAT4,vu.LIGHTS_PER_PASS),new Rs("cc_lightDir",Xo.FLOAT4,vu.LIGHTS_PER_PASS)],1),Kl.layouts[vu.NAME]=vu.LAYOUT,Kl.bindings[vu.BINDING]=vu.DESCRIPTOR;var gu=e("bG",(function(){}));gu.JOINTS_TEXTURE_INFO_OFFSET=0,gu.COUNT=gu.JOINTS_TEXTURE_INFO_OFFSET+4,gu.SIZE=4*gu.COUNT,gu.NAME="CCSkinningTexture",gu.BINDING=Ql.UBO_SKINNING_TEXTURE,gu.DESCRIPTOR=new Vs(gu.BINDING,pa.UNIFORM_BUFFER,1,da.VERTEX),gu.LAYOUT=new Os($l.LOCAL,gu.BINDING,gu.NAME,[new Rs("cc_jointTextureInfo",Xo.FLOAT4,1)],1),Kl.layouts[gu.NAME]=gu.LAYOUT,Kl.bindings[gu.BINDING]=gu.DESCRIPTOR;var yu=e("by",(function(){}));yu.JOINTS_ANIM_INFO_OFFSET=0,yu.COUNT=yu.JOINTS_ANIM_INFO_OFFSET+4,yu.SIZE=4*yu.COUNT,yu.NAME="CCSkinningAnimation",yu.BINDING=Ql.UBO_SKINNING_ANIMATION,yu.DESCRIPTOR=new Vs(yu.BINDING,pa.UNIFORM_BUFFER,1,da.VERTEX),yu.LAYOUT=new Os($l.LOCAL,yu.BINDING,yu.NAME,[new Rs("cc_jointAnimInfo",Xo.FLOAT4,1)],1),Kl.layouts[yu.NAME]=yu.LAYOUT,Kl.bindings[yu.BINDING]=yu.DESCRIPTOR;var xu=e("bI","a_jointAnimInfo"),Eu=e("bE",(function(){}));Eu.JOINTS_OFFSET=0,Eu.COUNT=Eu.JOINTS_OFFSET+360,Eu.SIZE=4*Eu.COUNT,Eu.NAME="CCSkinning",Eu.BINDING=Ql.UBO_SKINNING_TEXTURE,Eu.DESCRIPTOR=new Vs(Eu.BINDING,pa.UNIFORM_BUFFER,1,da.VERTEX),Eu.LAYOUT=new Os($l.LOCAL,Eu.BINDING,Eu.NAME,[new Rs("cc_joints",Xo.FLOAT4,90)],1),Kl.layouts[Eu.NAME]=Eu.LAYOUT,Kl.bindings[Eu.BINDING]=Eu.DESCRIPTOR;var Su=e("aw",(function(){}));Su.MAX_MORPH_TARGET_COUNT=60,Su.OFFSET_OF_WEIGHTS=0,Su.OFFSET_OF_DISPLACEMENT_TEXTURE_WIDTH=4*Su.MAX_MORPH_TARGET_COUNT,Su.OFFSET_OF_DISPLACEMENT_TEXTURE_HEIGHT=Su.OFFSET_OF_DISPLACEMENT_TEXTURE_WIDTH+4,Su.OFFSET_OF_VERTICES_COUNT=Su.OFFSET_OF_DISPLACEMENT_TEXTURE_HEIGHT+4,Su.COUNT_BASE_4_BYTES=4*Math.ceil(Su.MAX_MORPH_TARGET_COUNT/4)+4,Su.SIZE=4*Su.COUNT_BASE_4_BYTES,Su.NAME="CCMorph",Su.BINDING=Ql.UBO_MORPH,Su.DESCRIPTOR=new Vs(Su.BINDING,pa.UNIFORM_BUFFER,1,da.VERTEX),Su.LAYOUT=new Os($l.LOCAL,Su.BINDING,Su.NAME,[new Rs("cc_displacementWeights",Xo.FLOAT4,Su.MAX_MORPH_TARGET_COUNT/4),new Rs("cc_displacementTextureInfo",Xo.FLOAT4,1)],1),Kl.layouts[Su.NAME]=Su.LAYOUT,Kl.bindings[Su.BINDING]=Su.DESCRIPTOR;var Tu=e("bH",Ql.SAMPLER_JOINTS),Au=new Vs(Tu,pa.SAMPLER,1,da.VERTEX),Cu=new Ns($l.LOCAL,Tu,"cc_jointTexture",Xo.SAMPLER2D,1);Kl.layouts.cc_jointTexture=Cu,Kl.bindings[Tu]=Au;var wu=e("aG",Ql.SAMPLER_MORPH_POSITION),Iu=new Vs(wu,pa.SAMPLER,1,da.VERTEX),bu=new Ns($l.LOCAL,wu,"cc_PositionDisplacements",Xo.SAMPLER2D,1);Kl.layouts.cc_PositionDisplacements=bu,Kl.bindings[wu]=Iu;var Ru=e("aF",Ql.SAMPLER_MORPH_NORMAL),Ou=new Vs(Ru,pa.SAMPLER,1,da.VERTEX),Nu=new Ns($l.LOCAL,Ru,"cc_NormalDisplacements",Xo.SAMPLER2D,1);Kl.layouts.cc_NormalDisplacements=Nu,Kl.bindings[Ru]=Ou;var Pu=e("aE",Ql.SAMPLER_MORPH_TANGENT),Mu=new Vs(Pu,pa.SAMPLER,1,da.VERTEX),Du=new Ns($l.LOCAL,Pu,"cc_TangentDisplacements",Xo.SAMPLER2D,1);Kl.layouts.cc_TangentDisplacements=Du,Kl.bindings[Pu]=Mu;var Lu=Ql.SAMPLER_LIGHTMAP,Fu=new Vs(Lu,pa.SAMPLER,1,da.FRAGMENT),zu=new Ns($l.LOCAL,Lu,"cc_lightingMap",Xo.SAMPLER2D,1);Kl.layouts.cc_lightingMap=zu,Kl.bindings[Lu]=Fu;var Bu=Ql.SAMPLER_SPRITE,Uu=new Vs(Bu,pa.SAMPLER,1,da.FRAGMENT),Gu=new Ns($l.LOCAL,Bu,"cc_spriteTexture",Xo.SAMPLER2D,1);Kl.layouts.cc_spriteTexture=Gu,Kl.bindings[Bu]=Uu;var Hu,ku,Vu,ju,Wu,qu=ql.makeMaskExclude([ql.BitMask.UI_2D,ql.BitMask.GIZMOS,ql.BitMask.EDITOR,ql.BitMask.SCENE_GIZMO,ql.BitMask.PROFILER]),Yu=ql.makeMaskExclude([ql.BitMask.UI_2D,ql.BitMask.PROFILER]),Xu=ql.Enum.ALL;e("f7",Object.freeze({__proto__:null,PIPELINE_FLOW_FORWARD:"ForwardFlow",PIPELINE_FLOW_SHADOW:"ShadowFlow",PIPELINE_FLOW_SMAA:"SMAAFlow",PIPELINE_FLOW_TONEMAP:"ToneMapFlow",get RenderPassStage(){return Vl},get RenderPriority(){return jl},globalDescriptorSetLayout:Xl,localDescriptorSetLayout:Kl,get PipelineGlobalBindings(){return Yl},get ModelLocalBindings(){return Ql},get SetIndex(){return $l},bindingMappingInfo:nu,UBOGlobal:iu,UBOCamera:ru,UBOShadow:ou,UNIFORM_SHADOWMAP_BINDING:au,UNIFORM_ENVIRONMENT_BINDING:lu,UNIFORM_SPOT_LIGHTING_MAP_TEXTURE_BINDING:_u,UBOLocal:du,INST_MAT_WORLD:"a_matWorld0",UBOLocalBatched:pu,UBOForwardLight:vu,JOINT_UNIFORM_CAPACITY:30,UBOSkinningTexture:gu,UBOSkinningAnimation:yu,INST_JOINT_ANIM_INFO:xu,UBOSkinning:Eu,UBOMorph:Su,UNIFORM_JOINT_TEXTURE_BINDING:Tu,UNIFORM_POSITION_MORPH_TEXTURE_BINDING:wu,UNIFORM_NORMAL_MORPH_TEXTURE_BINDING:Ru,UNIFORM_TANGENT_MORPH_TEXTURE_BINDING:Pu,UNIFORM_LIGHTMAP_TEXTURE_BINDING:Lu,UNIFORM_SPRITE_TEXTURE_BINDING:Bu,CAMERA_DEFAULT_MASK:qu,CAMERA_EDITOR_MASK:Yu,MODEL_ALWAYS_MASK:Xu})),function(e){e[e.VERTICAL=0]="VERTICAL",e[e.HORIZONTAL=1]="HORIZONTAL"}(Hu||(Hu={})),function(e){e[e.ORTHO=0]="ORTHO",e[e.PERSPECTIVE=1]="PERSPECTIVE"}(ku||(ku={})),function(e){e[e.F1_8=0]="F1_8",e[e.F2_0=1]="F2_0",e[e.F2_2=2]="F2_2",e[e.F2_5=3]="F2_5",e[e.F2_8=4]="F2_8",e[e.F3_2=5]="F3_2",e[e.F3_5=6]="F3_5",e[e.F4_0=7]="F4_0",e[e.F4_5=8]="F4_5",e[e.F5_0=9]="F5_0",e[e.F5_6=10]="F5_6",e[e.F6_3=11]="F6_3",e[e.F7_1=12]="F7_1",e[e.F8_0=13]="F8_0",e[e.F9_0=14]="F9_0",e[e.F10_0=15]="F10_0",e[e.F11_0=16]="F11_0",e[e.F13_0=17]="F13_0",e[e.F14_0=18]="F14_0",e[e.F16_0=19]="F16_0",e[e.F18_0=20]="F18_0",e[e.F20_0=21]="F20_0",e[e.F22_0=22]="F22_0"}(Vu||(Vu={})),function(e){e[e.ISO100=0]="ISO100",e[e.ISO200=1]="ISO200",e[e.ISO400=2]="ISO400",e[e.ISO800=3]="ISO800"}(ju||(ju={})),function(e){e[e.D1=0]="D1",e[e.D2=1]="D2",e[e.D4=2]="D4",e[e.D8=3]="D8",e[e.D15=4]="D15",e[e.D30=5]="D30",e[e.D60=6]="D60",e[e.D125=7]="D125",e[e.D250=8]="D250",e[e.D500=9]="D500",e[e.D1000=10]="D1000",e[e.D2000=11]="D2000",e[e.D4000=12]="D4000"}(Wu||(Wu={}));var Ku,Qu,Zu=[1.8,2,2.2,2.5,2.8,3.2,3.5,4,4.5,5,5.6,6.3,7.1,8,9,10,11,13,14,16,18,20,22],Ju=[1,.5,1/4,1/8,1/15,1/30,1/60,.008,.004,.002,.001,5e-4,1/4e3],$u=[100,200,400,800],eh=new Fn,th=new Fn,nh=new Zn,ih=Ca.STENCIL<<1,rh=[],oh=function(){function e(e){if(this.isWindowSize=!0,this.screenScale=void 0,this._device=void 0,this._scene=null,this._node=null,this._name=null,this._enabled=!1,this._proj=-1,this._aspect=void 0,this._orthoHeight=10,this._fovAxis=Hu.VERTICAL,this._fov=xn(45),this._nearClip=1,this._farClip=1e3,this._clearColor=new as(.2,.2,.2,1),this._viewport=new ui(0,0,1,1),this._curTransform=ba.IDENTITY,this._isProjDirty=!0,this._matView=new Zn,this._matViewInv=null,this._matProj=new Zn,this._matProjInv=new Zn,this._matViewProj=new Zn,this._matViewProjInv=new Zn,this._frustum=new Cl,this._forward=new Fn,this._position=new Fn,this._priority=0,this._aperture=Vu.F16_0,this._apertureValue=void 0,this._shutter=Wu.D125,this._shutterValue=0,this._iso=ju.ISO100,this._isoValue=0,this._ec=0,this._poolHandle=Yi,this._frustumHandle=Yi,this._window=null,this._device=e,this._apertureValue=Zu[this._aperture],this._shutterValue=Ju[this._shutter],this._isoValue=$u[this._iso],this._aspect=this.screenScale=1,!rh.length){var t=e.screenSpaceSignY;rh[ba.IDENTITY]=new Zn(1,0,0,0,0,t),rh[ba.ROTATE_90]=new Zn(0,1,0,0,-t,0),rh[ba.ROTATE_180]=new Zn(-1,0,0,0,0,-t),rh[ba.ROTATE_270]=new Zn(0,-1,0,0,t,0)}}var t=e.prototype;return t.initialize=function(e){this._name=e.name,this._node=e.node,this._proj=e.projection,this._priority=e.priority||0,this._aspect=this.screenScale=1;var t=this._poolHandle=br.alloc();br.set(t,Tr.WIDTH,1),br.set(t,Tr.HEIGHT,1),br.set(t,Tr.CLEAR_FLAG,Ca.NONE),br.set(t,Tr.CLEAR_DEPTH,1),br.set(t,Tr.NODE,this._node.handle),br.set(t,Tr.VISIBILITY,qu),this._scene&&br.set(t,Tr.SCENE,this._scene.handle),this.updateExposure(),this.changeTargetWindow(e.window),console.log("Created Camera: "+this._name+" "+br.get(t,Tr.WIDTH)+"x"+br.get(t,Tr.HEIGHT))},t.destroy=function(){this._window&&this._window.detachCamera(this),this._name=null,this._poolHandle&&(br.free(this._poolHandle),this._poolHandle=Yi,this._frustumHandle&&(Gr.free(this._frustumHandle),this._frustumHandle=Yi))},t.attachToScene=function(e){this._scene=e,this._enabled=!0,br.set(this._poolHandle,Tr.SCENE,e.handle)},t.detachFromScene=function(){this._scene=null,this._enabled=!1,br.set(this._poolHandle,Tr.SCENE,0)},t.resize=function(e,t){var n=this._poolHandle;br.set(n,Tr.WIDTH,e),br.set(n,Tr.HEIGHT,t),this._aspect=e*this._viewport.width/(t*this._viewport.height),this._isProjDirty=!0},t.setFixedSize=function(e,t){var n=this._poolHandle;br.set(n,Tr.WIDTH,e),br.set(n,Tr.HEIGHT,t),this._aspect=e*this._viewport.width/(t*this._viewport.height),this.isWindowSize=!1},t.update=function(e){if(void 0===e&&(e=!1),this._node){var t=!1;(this._node.hasChangedFlags||e)&&(Zn.invert(this._matView,this._node.worldMatrix),br.setMat4(this._poolHandle,Tr.MAT_VIEW,this._matView),this._forward.x=-this._matView.m02,this._forward.y=-this._matView.m06,this._forward.z=-this._matView.m10,this._node.getWorldPosition(this._position),br.setVec3(this._poolHandle,Tr.POSITION,this._position),br.setVec3(this._poolHandle,Tr.FORWARD,this._forward),t=!0);var n=this._device.surfaceTransform;if(this._isProjDirty||this._curTransform!==n){this._curTransform=n;var i=this._device.screenSpaceSignY;if(this._window&&this._window.hasOffScreenAttachments&&(i*=this._device.UVSpaceSignY,n=ba.IDENTITY),this._proj===ku.PERSPECTIVE)Zn.perspective(this._matProj,this._fov,this._aspect,this._nearClip,this._farClip,this._fovAxis===Hu.VERTICAL,this._device.clipSpaceMinZ,i,n);else{var r=this._orthoHeight*this._aspect,o=this._orthoHeight;Zn.ortho(this._matProj,-r,r,-o,o,this._nearClip,this._farClip,this._device.clipSpaceMinZ,i,n)}Zn.invert(this._matProjInv,this._matProj),br.setMat4(this._poolHandle,Tr.MAT_PROJ,this._matProj),br.setMat4(this._poolHandle,Tr.MAT_PROJ_INV,this._matProjInv),t=!0,this._isProjDirty=!1}t&&(Zn.multiply(this._matViewProj,this._matProj,this._matView),Zn.invert(this._matViewProjInv,this._matViewProj),this._frustum.update(this._matViewProj,this._matViewProjInv),br.setMat4(this._poolHandle,Tr.MAT_VIEW_PROJ,this._matViewProj),br.setMat4(this._poolHandle,Tr.MAT_VIEW_PROJ_INV,this._matViewProjInv),wl(this._frustumHandle,this._frustum))}},t.changeTargetWindow=function(e){void 0===e&&(e=null),this._window&&this._window.detachCamera(this);var t=e||c.director.root.mainWindow;t&&(t.attachCamera(this),this.resize(t.width,t.height),this._window=t,br.set(this._poolHandle,Tr.WINDOW,t.handle))},t.detachCamera=function(){this._window&&this._window.detachCamera(this)},t.screenPointToRay=function(e,t,n){if(!this._node)return null;var i=this._poolHandle,r=br.get(i,Tr.WIDTH),o=br.get(i,Tr.HEIGHT),a=this._viewport.x*r,s=this._viewport.y*o,c=this._viewport.width*r,l=this._viewport.height*o,u=this._proj===ku.PERSPECTIVE,h=this._device.screenSpaceSignY,_=Qn[this._curTransform];Fn.set(eh,(t-a)/c*2-1,(n-s)/l*2-1,u?1:-1);var f=eh.x,m=eh.y;return eh.x=f*_[0]+m*_[2]*h,eh.y=f*_[1]+m*_[3]*h,Fn.transformMat4(u?eh:e.o,eh,this._matViewProjInv),u?(this._node.getWorldPosition(th),zo.fromPoints(e,th,eh)):Fn.transformQuat(e.d,Fn.FORWARD,this._node.worldRotation),e},t.screenToWorld=function(e,t){var n=this._poolHandle,i=br.get(n,Tr.WIDTH),r=br.get(n,Tr.HEIGHT),o=this._viewport.x*i,a=this._viewport.y*r,s=this._viewport.width*i,c=this._viewport.height*r,l=this._device.screenSpaceSignY,u=Qn[this._curTransform];if(this._proj===ku.PERSPECTIVE){Fn.set(e,(t.x-o)/s*2-1,(t.y-a)/c*2-1,1);var h=e.x,_=e.y;e.x=h*u[0]+_*u[2]*l,e.y=h*u[1]+_*u[3]*l,Fn.transformMat4(e,e,this._matViewProjInv),this._node&&this._node.getWorldPosition(eh),Fn.lerp(e,eh,e,yn(this._nearClip/this._farClip,1,t.z))}else{Fn.set(e,(t.x-o)/s*2-1,(t.y-a)/c*2-1,2*t.z-1);var f=e.x,m=e.y;e.x=f*u[0]+m*u[2]*l,e.y=f*u[1]+m*u[3]*l,Fn.transformMat4(e,e,this._matViewProjInv)}return e},t.worldToScreen=function(e,t){var n=this._poolHandle,i=br.get(n,Tr.WIDTH),r=br.get(n,Tr.HEIGHT),o=this._viewport.x*i,a=this._viewport.y*r,s=this._viewport.width*i,c=this._viewport.height*r,l=this._device.screenSpaceSignY,u=Qn[this._curTransform];Fn.transformMat4(e,t,this._matViewProj);var h=e.x,_=e.y;return e.x=h*u[0]+_*u[2]*l,e.y=h*u[1]+_*u[3]*l,e.x=o+.5*(e.x+1)*s,e.y=a+.5*(e.y+1)*c,e.z=.5*e.z+.5,e},t.worldMatrixToScreen=function(e,t,n,i){Zn.multiply(e,this._matViewProj,t),Zn.multiply(e,rh[this._curTransform],e);var r=n/2,o=i/2;return Zn.identity(nh),Zn.transform(nh,nh,Fn.set(eh,r,o,0)),Zn.scale(nh,nh,Fn.set(eh,r,o,1)),Zn.multiply(e,nh,e),e},t.updateExposure=function(){var e=Math.log2(this._apertureValue*this._apertureValue/this._shutterValue*100/this._isoValue);br.set(this._poolHandle,Tr.EXPOSURE,.833333/Math.pow(2,e))},Z(e,[{key:"node",set:function(e){this._node=e},get:function(){return this._node}},{key:"enabled",set:function(e){this._enabled=e},get:function(){return this._enabled}},{key:"orthoHeight",set:function(e){this._orthoHeight=e,this._isProjDirty=!0},get:function(){return this._orthoHeight}},{key:"projectionType",set:function(e){this._proj=e,this._isProjDirty=!0},get:function(){return this._proj}},{key:"fovAxis",set:function(e){this._fovAxis=e,this._isProjDirty=!0},get:function(){return this._fovAxis}},{key:"fov",set:function(e){this._fov=e,this._isProjDirty=!0},get:function(){return this._fov}},{key:"nearClip",set:function(e){this._nearClip=e,this._isProjDirty=!0},get:function(){return this._nearClip}},{key:"farClip",set:function(e){this._farClip=e,this._isProjDirty=!0},get:function(){return this._farClip}},{key:"clearColor",set:function(e){this._clearColor.x=e.x,this._clearColor.y=e.y,this._clearColor.z=e.z,this._clearColor.w=e.w,br.setVec4(this._poolHandle,Tr.CLEAR_COLOR,e)},get:function(){return this._clearColor}},{key:"viewport",get:function(){return this._viewport},set:function(e){var t=e.x,n=e.width,i=e.height,r=this._device.screenSpaceSignY<0?1-e.y-i:e.y;switch(this._device.surfaceTransform){case ba.ROTATE_90:this._viewport.x=1-r-i,this._viewport.y=t,this._viewport.width=i,this._viewport.height=n;break;case ba.ROTATE_180:this._viewport.x=1-t-n,this._viewport.y=1-r-i,this._viewport.width=n,this._viewport.height=i;break;case ba.ROTATE_270:this._viewport.x=r,this._viewport.y=1-t-n,this._viewport.width=i,this._viewport.height=n;break;case ba.IDENTITY:this._viewport.x=t,this._viewport.y=r,this._viewport.width=n,this._viewport.height=i}br.setVec4(this._poolHandle,Tr.VIEW_PORT,this._viewport),this.resize(this.width,this.height)}},{key:"scene",get:function(){return this._scene}},{key:"name",get:function(){return this._name}},{key:"width",get:function(){return br.get(this._poolHandle,Tr.WIDTH)}},{key:"height",get:function(){return br.get(this._poolHandle,Tr.HEIGHT)}},{key:"aspect",get:function(){return this._aspect}},{key:"matView",set:function(e){this._matView=e,br.setMat4(this._poolHandle,Tr.MAT_VIEW,this._matView)},get:function(){return this._matView}},{key:"matViewInv",set:function(e){this._matViewInv=e},get:function(){return this._matViewInv||this._node.worldMatrix}},{key:"matProj",set:function(e){this._matProj=e,br.setMat4(this._poolHandle,Tr.MAT_PROJ,this._matProj)},get:function(){return this._matProj}},{key:"matProjInv",set:function(e){this._matProjInv=e,br.setMat4(this._poolHandle,Tr.MAT_PROJ_INV,this._matProjInv)},get:function(){return this._matProjInv}},{key:"matViewProj",set:function(e){this._matViewProj=e,br.setMat4(this._poolHandle,Tr.MAT_VIEW_PROJ,this._matViewProj)},get:function(){return this._matViewProj}},{key:"matViewProjInv",set:function(e){this._matViewProjInv=e,br.setMat4(this._poolHandle,Tr.MAT_VIEW_PROJ_INV,this._matViewProjInv)},get:function(){return this._matViewProjInv}},{key:"frustum",set:function(e){this._frustum=e,wl(this._frustumHandle,e)},get:function(){return this._frustum}},{key:"window",set:function(e){this._window=e,e&&br.set(this._poolHandle,Tr.WINDOW,e.handle)},get:function(){return this._window}},{key:"forward",set:function(e){this._forward=e,br.setVec3(this._poolHandle,Tr.FORWARD,this._forward)},get:function(){return this._forward}},{key:"position",set:function(e){this._position=e,br.setVec3(this._poolHandle,Tr.POSITION,this._position)},get:function(){return this._position}},{key:"visibility",set:function(e){br.set(this._poolHandle,Tr.VISIBILITY,e)},get:function(){return br.get(this._poolHandle,Tr.VISIBILITY)}},{key:"priority",get:function(){return this._priority},set:function(e){this._priority=e}},{key:"aperture",set:function(e){this._aperture=e,this._apertureValue=Zu[this._aperture],this.updateExposure()},get:function(){return this._aperture}},{key:"apertureValue",get:function(){return this._apertureValue}},{key:"shutter",set:function(e){this._shutter=e,this._shutterValue=Ju[this._shutter],this.updateExposure()},get:function(){return this._shutter}},{key:"shutterValue",get:function(){return this._shutterValue}},{key:"iso",set:function(e){this._iso=e,this._isoValue=$u[this._iso],this.updateExposure()},get:function(){return this._iso}},{key:"isoValue",get:function(){return this._isoValue}},{key:"ec",set:function(e){this._ec=e},get:function(){return this._ec}},{key:"exposure",get:function(){return br.get(this._poolHandle,Tr.EXPOSURE)}},{key:"clearFlag",get:function(){return br.get(this._poolHandle,Tr.CLEAR_FLAG)},set:function(e){br.set(this._poolHandle,Tr.CLEAR_FLAG,e)}},{key:"clearDepth",get:function(){return br.get(this._poolHandle,Tr.CLEAR_DEPTH)},set:function(e){br.set(this._poolHandle,Tr.CLEAR_DEPTH,e)}},{key:"clearStencil",get:function(){return br.get(this._poolHandle,Tr.CLEAR_STENCIL)},set:function(e){br.set(this._poolHandle,Tr.CLEAR_STENCIL,e)}},{key:"handle",get:function(){return this._poolHandle}}]),e}();!function(e){e[e.LOCAL=0]="LOCAL",e[e.WORLD=1]="WORLD"}(Ku||(Ku={})),function(e){e[e.NONE=0]="NONE",e[e.POSITION=1]="POSITION",e[e.ROTATION=2]="ROTATION",e[e.SCALE=4]="SCALE",e[e.RS=e.ROTATION|e.SCALE]="RS",e[e.TRS=e.POSITION|e.ROTATION|e.SCALE]="TRS",e[e.TRS_MASK=~e.TRS]="TRS_MASK"}(Qu||(Qu=e("b2",{}))),c.internal.TransformBit=Qu;var ah=function(){function e(e){this._root=void 0,this._name="",this._cameras=[],this._models=[],this._batches=[],this._directionalLights=[],this._sphereLights=[],this._spotLights=[],this._mainLight=null,this._modelId=0,this._scenePoolHandle=Yi,this._modelArrayHandle=Yi,this._batchArrayHandle=Yi,this._sphereLightsHandle=Yi,this._spotLightsHandle=Yi,this._root=e,this._createHandles()}e.registerCreateFunc=function(t){t._createSceneFun=function(t){return new e(t)}},Z(e,[{key:"root",get:function(){return this._root}},{key:"name",get:function(){return this._name}},{key:"cameras",get:function(){return this._cameras}},{key:"mainLight",get:function(){return this._mainLight}},{key:"sphereLights",get:function(){return this._sphereLights}},{key:"spotLights",get:function(){return this._spotLights}},{key:"models",get:function(){return this._models}},{key:"handle",get:function(){return this._scenePoolHandle}},{key:"batches",get:function(){return this._batches}}]);var t=e.prototype;return t.initialize=function(e){return this._name=e.name,this._createHandles(),!0},t.update=function(e){var t=this._mainLight;t&&t.update();for(var n=this._sphereLights,i=0;i<n.length;i++)n[i].update();for(var r=this._spotLights,o=0;o<r.length;o++)r[o].update();for(var a=this._models,s=0;s<a.length;s++){var c=a[s];c.enabled&&(c.updateTransform(e),c.updateUBOs(e))}},t.destroy=function(){this.removeCameras(),this.removeSphereLights(),this.removeSpotLights(),this.removeModels(),this._modelArrayHandle&&(er.free(this._modelArrayHandle),this._modelArrayHandle=Yi),this._scenePoolHandle&&(Cr.free(this._scenePoolHandle),this._scenePoolHandle=Yi),this._sphereLightsHandle&&(ir.free(this._sphereLightsHandle),this._sphereLightsHandle=Yi),this._spotLightsHandle&&(ir.free(this._spotLightsHandle),this._spotLightsHandle=Yi),this._batchArrayHandle&&(or.free(this._batchArrayHandle),this._batchArrayHandle=Yi)},t.addCamera=function(e){e.attachToScene(this),this._cameras.push(e)},t.removeCamera=function(e){for(var t=0;t<this._cameras.length;++t)if(this._cameras[t]===e)return this._cameras.splice(t,1),void e.detachFromScene()},t.removeCameras=function(){for(var e,t=ne(this._cameras);!(e=t()).done;)e.value.detachFromScene();this._cameras.splice(0)},t.setMainLight=function(e){this._mainLight=e,Cr.set(this._scenePoolHandle,xr.MAIN_LIGHT,e.handle)},t.unsetMainLight=function(e){if(this._mainLight===e){var t=this._directionalLights;t.length?(this._mainLight=t[t.length-1],this._mainLight.node&&(this._mainLight.node.hasChangedFlags|=Qu.ROTATION)):this._mainLight=null}},t.addDirectionalLight=function(e){e.attachToScene(this),this._directionalLights.push(e)},t.removeDirectionalLight=function(e){for(var t=0;t<this._directionalLights.length;++t)if(this._directionalLights[t]===e)return e.detachFromScene(),void this._directionalLights.splice(t,1)},t.addSphereLight=function(e){e.attachToScene(this),this._sphereLights.push(e),ir.push(this._sphereLightsHandle,e.handle)},t.removeSphereLight=function(e){for(var t=0;t<this._sphereLights.length;++t)if(this._sphereLights[t]===e)return e.detachFromScene(),this._sphereLights.splice(t,1),void ir.erase(this._sphereLightsHandle,t)},t.addSpotLight=function(e){e.attachToScene(this),this._spotLights.push(e),ir.push(this._spotLightsHandle,e.handle)},t.removeSpotLight=function(e){for(var t=0;t<this._spotLights.length;++t)if(this._spotLights[t]===e)return e.detachFromScene(),this._spotLights.splice(t,1),void ir.erase(this._spotLightsHandle,t)},t.removeSphereLights=function(){for(var e=0;e<this._sphereLights.length;++e)this._sphereLights[e].detachFromScene();this._sphereLights.length=0,ir.clear(this._sphereLightsHandle)},t.removeSpotLights=function(){for(var e=0;e<this._spotLights.length;++e)this._spotLights[e].detachFromScene();this._spotLights=[],ir.clear(this._spotLightsHandle)},t.addModel=function(e){e.attachToScene(this),this._models.push(e),er.push(this._modelArrayHandle,e.handle)},t.removeModel=function(e){for(var t=0;t<this._models.length;++t)if(this._models[t]===e)return e.detachFromScene(),this._models.splice(t,1),void er.erase(this._modelArrayHandle,t)},t.removeModels=function(){for(var e,t=ne(this._models);!(e=t()).done;){var n=e.value;n.detachFromScene(),n.destroy()}this._models.length=0,er.clear(this._modelArrayHandle)},t.addBatch=function(e){this._batches.push(e),or.push(this._batchArrayHandle,e.handle)},t.removeBatch=function(e){for(var t=0;t<this._batches.length;++t)if(this._batches[t]===e)return this._batches.splice(t,1),void or.erase(this._batchArrayHandle,t)},t.removeBatches=function(){this._batches.length=0,or.clear(this._batchArrayHandle)},t.onGlobalPipelineStateChanged=function(){for(var e,t=ne(this._models);!(e=t()).done;)e.value.onGlobalPipelineStateChanged()},t.generateModelId=function(){return this._modelId++},t._createHandles=function(){this._modelArrayHandle||(this._modelArrayHandle=er.alloc(),this._scenePoolHandle=Cr.alloc(),Cr.set(this._scenePoolHandle,xr.MODEL_ARRAY,this._modelArrayHandle),this._spotLightsHandle=ir.alloc(),Cr.set(this._scenePoolHandle,xr.SPOT_LIGHT_ARRAY,this._spotLightsHandle),this._sphereLightsHandle=ir.alloc(),Cr.set(this._scenePoolHandle,xr.SPHERE_LIGHT_ARRAY,this._sphereLightsHandle)),this._batchArrayHandle||(this._batchArrayHandle=or.alloc(),Cr.set(this._scenePoolHandle,xr.BATCH_ARRAY_2D,this._batchArrayHandle))},e}(),sh=function(){},ch=function(){return sh},lh=uh((function(){}));function uh(e){return function(t){return"function"==typeof t?e(t):function(n){return e(n,t)}}}function hh(e){return function(t){return function(n){!function(e,t,n){var i=_h(e);if(i){var r=fh(i,"proto");fh(r,"editor")[t]=n}}(n,e,t)}}}function _h(e){return fh(e,"__ccclassCache__")}function fh(e,t){return e[t]||(e[t]={})}var mh=e("aI",uh((function(e,t){var n=dt.getSuper(e);n===Object&&(n=null);var i={name:t,extends:n,ctor:e},r=e.__ccclassCache__;if(r){var o=r.proto;o&&dt.mixin(i,o),e.__ccclassCache__=void 0}return ln(i)}))),dh=e("c6",hh("requireComponent")),ph=e("b8",hh("executionOrder")),vh=e("b_",lh);function gh(e,t,n){var i=null;function r(e,t,n){var r=_h(e.constructor);if(r){var o=fh(r,"proto"),a=fh(o,"properties");!function(e,t,n,i,r,o){var a,s=r&&(r.get||r.set);i&&(a=$t(i,s));var c=t[n],l=dt.mixin(c||{},a||i||{});if(s)r.get&&(l.get=r.get),r.set&&(l.set=r.set);else if(r)r.initializer&&(l.default=function(e){var t;try{t=e()}catch(t){return e}return"object"!=typeof t||null===t?t:e}(r.initializer));else{var u=o.default||(o.default=function(e){var t;try{t=new e}catch(e){return{}}return t}(e));u.hasOwnProperty(n)&&(l.default=u[n])}t[n]=l}(e.constructor,a,t,i,n,r)}}return void 0===e?gh({type:void 0}):void 0===t?(i=e,r):void r(e,t,n)}var yh=e("aT",(function(e,t,n){return gh(Eh({}))(e,t,n)})),xh=e("cQ",(function(e,t,n){return gh({editorOnly:!0})(e,t,n)}));function Eh(e){return e.__noImplicit=!0,"serializable"in e||(e.serializable=!0),e}var Sh=e("b1",lh),Th=e("b9",ch),Ah=e("di",lh),Ch=ch,wh=ch,Ih=e("b7",ch),bh=e("a$",sh),Rh=e("bb",ch),Oh=(e("da",sh),e("c7",ch)),Nh=e("ba",ch),Ph=e("bl",ch),Mh=e("cF",ch),Dh=e("cG",ch),Lh=ch,Fh=e("bk",sh),zh=e("c0",ch),Bh=(e("bo",ch),e("d2",sh),e("c8",sh),e("b5",sh)),Uh=Vh(Vt),Gh=Vh(jt),Hh=Vh(Wt),kh=e("bU",Vh(qt));function Vh(e){return gh({type:e})}var jh=e("bN",(function(e,t,n){return gh({__noImplicit:!0,override:!0})(e,t,n)})),Wh=function(){function e(e){this._map=null,this._count=0,e?(this._map=e,this._count=Object.keys(e).length):(this._map=dt.createMap(!0),this._count=0)}var t=e.prototype;return t.add=function(e,t){return e in this._map||this._count++,this._map[e]=t},t.get=function(e){return this._map[e]},t.has=function(e){return e in this._map},t.remove=function(e){var t=this._map[e];return e in this._map&&(delete this._map[e],this._count--),t},t.clear=function(){0!==this._count&&(this._map=dt.createMap(!0),this._count=0)},t.forEach=function(e){for(var t in this._map)e(this._map[t],t)},t.find=function(e){for(var t in this._map)if(e(this._map[t],t))return this._map[t];return null},t.destroy=function(){this._map=null},Z(e,[{key:"count",get:function(){return this._count}}]),e}(),qh=function(){function e(t,n){this.id=e._pipelineId++,this.name="",this.pipes=[],this.name=t;for(var i=0,r=n.length;i<r;i++)this.pipes.push(n[i])}var t=e.prototype;return t.insert=function(e,t){return t>this.pipes.length?(I(4921),this):(this.pipes.splice(t,0,e),this)},t.append=function(e){return this.pipes.push(e),this},t.remove=function(e){return this.pipes.splice(e,1),this},t.sync=function(e){var t=this.pipes;if(0===t.length)return null;e.isFinish=!1;for(var n=0,i=t.length;n<i;){var r=(0,t[n])(e);if(r)return e.isFinish=!0,r;++n!==i&&(e.input=e.output,e.output=null)}return e.isFinish=!0,e.output},t.async=function(e){0!==this.pipes.length&&(e.isFinish=!1,this._flow(0,e))},t._flow=function(e,t){var n=this;(0,this.pipes[e])(t,(function(i){i?(t.isFinish=!0,t.dispatch("complete",i)):++e<n.pipes.length?(t.input=t.output,t.output=null,n._flow(e,t)):(t.isFinish=!0,t.dispatch("complete",i,t.output))}))},e}();qh._pipelineId=0;var Yh,Xh=new Wh,Kh=new Wh,Qh=new Wh,Zh=new Wh,Jh=new qh("normal load",[]),$h=new qh("fetch",[]),e_=new qh("transform url",[]);!function(e){e.UUID="uuid",e.PATH="path",e.DIR="dir",e.URL="url",e.SCENE="scene"}(Yh||(Yh={}));var t_,n_={default:{priority:0},preload:{maxConcurrency:6,maxRequestsPerFrame:2,priority:-1},scene:{maxConcurrency:20,maxRequestsPerFrame:20,priority:1},bundle:{maxConcurrency:20,maxRequestsPerFrame:20,priority:2},remote:{maxRetryCount:4}};!function(e){e.RESOURCES="resources",e.MAIN="main",e.START_SCENE="start-scene"}(t_||(t_={}));var i_=function(){function e(t){this.id=e._taskId++,this.onComplete=null,this.onProgress=null,this.onError=null,this.source=null,this.output=null,this.input=null,this.progress=null,this.options=null,this.isFinish=!0,this.set(t)}e.create=function(t){var n;return 0!==e._deadPool.length?(n=e._deadPool.pop()).set(t):n=new e(t),n};var t=e.prototype;return t.set=function(e){void 0===e&&(e=Object.create(null)),this.onComplete=e.onComplete||null,this.onProgress=e.onProgress||null,this.onError=e.onError||null,this.source=this.input=e.input,this.output=null,this.progress=e.progress,this.options=e.options||Object.create(null)},t.dispatch=function(e,t,n,i,r){switch(e){case"complete":this.onComplete&&this.onComplete(t,n);break;case"progress":this.onProgress&&this.onProgress(t,n,i,r);break;case"error":this.onError&&this.onError(t,n,i,r);break;default:var o="on"+e[0].toUpperCase()+e.substr(1);"function"==typeof this[o]&&this[o](t,n,i,r)}},t.recycle=function(){e._deadPool.length!==e.MAX_DEAD_NUM&&(this.onComplete=null,this.onProgress=null,this.onError=null,this.source=this.output=this.input=null,this.progress=null,this.options=null,e._deadPool.push(this))},e}();i_.MAX_DEAD_NUM=500,i_._taskId=0,i_._deadPool=[];var r_="0123456789abcdef".split(""),o_=["","","",""],a_=o_.concat(o_,"-",o_,"-",o_,"-",o_,"-",o_,o_,o_),s_=a_.map((function(e,t){return"-"===e?NaN:t})).filter(isFinite);function c_(e){var t=e.split("@")[0];if(22!==t.length)return e;a_[0]=e[0],a_[1]=e[1];for(var n=2,i=2;n<22;n+=2){var r=It[e.charCodeAt(n)],o=It[e.charCodeAt(n+1)];a_[s_[i++]]=r_[r>>2],a_[s_[i++]]=r_[(3&r)<<2|o>>4],a_[s_[i++]]=r_[15&o]}return e.replace(t,a_.join(""))}var l_=/.*[/\\][0-9a-fA-F]{2}[/\\]([0-9a-fA-F-@]{8,}).*/;function u_(e){var t=l_.exec(e);return t?t[1]:""}function h_(e,t){(t=t||Object.create(null)).__isNative__=t.isNative,t.ext=t.nativeExt;var n=Zh.find((function(t){return!!t.getAssetInfo(e)}));return n&&(t.bundle=n.name),m_(e,t)}function __(e){return e&&(e instanceof c.SceneAsset||e instanceof c.Scene)}function f_(e){return e&&(46===e.charCodeAt(0)&&47===e.charCodeAt(1)?e=e.slice(2):47===e.charCodeAt(0)&&(e=e.slice(1))),e}function m_(e,t){var n=i_.create({input:e,options:t}),i=[];try{for(var r,o=ne(e_.sync(n));!(r=o()).done;){var a=r.value,s=a.url;a.recycle(),i.push(s)}}catch(e){for(var c,l=ne(n.output);!(c=l()).done;)c.value.recycle();y(e.message,e.stack)}return n.recycle(),i.length>1?i:i[0]}var d_=Object.freeze({__proto__:null,getUuidFromURL:u_,getUrlWithUuid:h_,isScene:__,normalize:f_,transform:m_,decodeUuid:c_}),p_=e("cO",function(){function e(e,t){this.type=void 0,this.bubbles=void 0,this.target=null,this.currentTarget=null,this.eventPhase=0,this.propagationStopped=!1,this.propagationImmediateStopped=!1,this.type=e,this.bubbles=!!t}var t=e.prototype;return t.unuse=function(){this.type=e.NO_TYPE,this.target=null,this.currentTarget=null,this.eventPhase=e.NONE,this.propagationStopped=!1,this.propagationImmediateStopped=!1},t.reuse=function(e,t){this.type=e,this.bubbles=t||!1},t.isStopped=function(){return this.propagationStopped||this.propagationImmediateStopped},t.getCurrentTarget=function(){return this.currentTarget},t.getType=function(){return this.type},e}());p_.NO_TYPE="no_type",p_.TOUCH="touch",p_.MOUSE="mouse",p_.KEYBOARD="keyboard",p_.ACCELERATION="acceleration",p_.NONE=0,p_.CAPTURING_PHASE=1,p_.AT_TARGET=2,p_.BUBBLING_PHASE=3,c.Event=p_;var v_=e("P",function(){function e(e,t){this._ctor=void 0,this._elementsPerBatch=void 0,this._nextAvail=void 0,this._freepool=[],this._ctor=e,this._elementsPerBatch=Math.max(t,1),this._nextAvail=this._elementsPerBatch-1;for(var n=0;n<this._elementsPerBatch;++n)this._freepool.push(e())}var t=e.prototype;return t.alloc=function(){if(this._nextAvail<0){for(var e=this._elementsPerBatch,t=0;t<e;t++)this._freepool.push(this._ctor());this._nextAvail=e-1}var n=this._freepool[this._nextAvail--];return this._freepool.length--,n},t.free=function(e){this._freepool.push(e),this._nextAvail++},t.freeArray=function(e){Array.prototype.push.apply(this._freepool,e),this._nextAvail+=e.length},t.destroy=function(e){if(e)for(var t=0;t<=this._nextAvail;t++)e(this._freepool[t]);this._freepool.length=0,this._nextAvail=-1},e}()),g_=e("R",function(){function e(e,t){this._fn=void 0,this._count=0,this._data=void 0,this._fn=e,this._data=new Array(t);for(var n=0;n<t;++n)this._data[n]=e()}var t=e.prototype;return t.reset=function(){this._count=0},t.resize=function(e){if(e>this._data.length)for(var t=this._data.length;t<e;++t)this._data[t]=this._fn()},t.add=function(){return this._count>=this._data.length&&this.resize(2*this._data.length),this._data[this._count++]},t.removeAt=function(e){if(!(e>=this._count)){var t=this._count-1,n=this._data[e];this._data[e]=this._data[t],this._data[t]=n,this._count-=1}},Z(e,[{key:"length",get:function(){return this._count}},{key:"data",get:function(){return this._data}}]),e}()),y_=e("C",function(){function e(e,t){this.array=void 0,this.length=0,this._compareFn=void 0,this.array=new Array(e),this.length=0,this._compareFn=void 0!==t?t:function(e,t){return e-t}}var t=e.prototype;return t.push=function(e){this.array[this.length++]=e},t.pop=function(){return this.array[--this.length]},t.get=function(e){return this.array[e]},t.clear=function(){this.length=0},t.destroy=function(){this.length=0,this.array.length=0},t.sort=function(){this.array.length=this.length,this.array.sort(this._compareFn)},t.concat=function(e){for(var t=0;t<e.length;++t)this.array[this.length++]=e[t]},t.fastRemove=function(e){if(!(e>=this.length||e<0)){var t=--this.length;this.array[e]=this.array[t]}},t.indexOf=function(e){return this.array.indexOf(e)},e}()),x_=[],E_=e("dn",function(){function e(e){void 0===e&&(e=""),this._objFlags=void 0,this._name=void 0,this._name=e,this._objFlags=0}e._deferredDestroy=function(){for(var e=x_.length,t=0;t<e;++t){var n=x_[t];1&n._objFlags||n._destroyImmediate()}e===x_.length?x_.length=0:x_.splice(0,e)};var t=e.prototype;return t.destroy=function(){return 1&this._objFlags?(I(5e3),!1):!(4&this._objFlags||(this._objFlags|=4,x_.push(this),0))},t._destruct=function(){var e=this.constructor,t=e.__destruct__;t||(t=function(e,t){var n,i=e instanceof c._BaseNode||e instanceof c.Component,r=i?"_id":null,o={};for(n in e)if(e.hasOwnProperty(n)){if(n===r)continue;switch(typeof e[n]){case"string":o[n]="";break;case"object":case"function":o[n]=null}}if(ln._isCCClass(t))for(var a=c.Class.Attr.getClassAttrs(t),s=t.__props__,l=0;l<s.length;l++){var u=(n=s[l])+c.Class.Attr.DELIMETER+"default";if(u in a){if(i&&"_id"===n)continue;switch(typeof a[u]){case"string":o[n]="";break;case"object":case"function":o[n]=null;break;case"undefined":o[n]=void 0}}}var h="";for(n in o){var _;_=ln.IDENTIFIER_RE.test(n)?"o."+n+"=":"o["+ln.escapeForJS(n)+"]=";var f=o[n];""===f&&(f='""'),h+=_+f+";\n"}return Function("o",h)}(this,e),Le(e,"__destruct__",t,!0)),t(this)},t._destroyImmediate=function(){1&this._objFlags?R(5e3):(this._onPreDestroy&&this._onPreDestroy(),this._destruct(),this._objFlags|=1)},Z(e,[{key:"name",get:function(){return this._name},set:function(e){this._name=e}},{key:"isValid",get:function(){return!(1&this._objFlags)}}]),e}()),S_=E_.prototype;function T_(e,t){return"object"==typeof e?!(!e||e._objFlags&(t?5:1)):void 0!==e}S_._deserialize=null,S_._onPreDestroy=null,ln.fastDefine("cc.Object",E_,{_name:"",_objFlags:0}),Le(E_,"Flags",{Destroyed:1,DontSave:8,EditorOnly:16,Dirty:32,DontDestroy:64,PersistentMask:-4192741,Destroying:128,Deactivating:256,LockedInEditor:512,HideInHierarchy:1024,IsPreloadStarted:8192,IsOnLoadStarted:32768,IsOnLoadCalled:16384,IsOnEnableCalled:2048,IsStartCalled:65536,IsEditorOnEnableCalled:4096,IsPositionLocked:1<<21,IsRotationLocked:1<<17,IsScaleLocked:1<<18,IsAnchorLocked:1<<19,IsSizeLocked:1<<20}),c.isValid=T_,c.Object=E_;var A_=mt.fastRemoveAt;function C_(){}var w_=function(){function e(){this.callback=C_,this.target=void 0,this.once=!1}var t=e.prototype;return t.set=function(e,t,n){this.callback=e||C_,this.target=t,this.once=!!n},t.reset=function(){this.target=void 0,this.callback=C_,this.once=!1},t.check=function(){return!(this.target instanceof E_&&!T_(this.target,!0))},e}(),I_=new v_((function(){return new w_}),32),b_=function(){function e(){this.callbackInfos=[],this.isInvoking=!1,this.containCanceled=!1}var t=e.prototype;return t.removeByCallback=function(e){for(var t=0;t<this.callbackInfos.length;++t){var n=this.callbackInfos[t];n&&n.callback===e&&(n.reset(),I_.free(n),A_(this.callbackInfos,t),--t)}},t.removeByTarget=function(e){for(var t=0;t<this.callbackInfos.length;++t){var n=this.callbackInfos[t];n&&n.target===e&&(n.reset(),I_.free(n),A_(this.callbackInfos,t),--t)}},t.cancel=function(e){var t=this.callbackInfos[e];t&&(t.reset(),this.isInvoking?this.callbackInfos[e]=null:A_(this.callbackInfos,e),I_.free(t)),this.containCanceled=!0},t.cancelAll=function(){for(var e=0;e<this.callbackInfos.length;e++){var t=this.callbackInfos[e];t&&(t.reset(),I_.free(t),this.callbackInfos[e]=null)}this.containCanceled=!0},t.purgeCanceled=function(){for(var e=this.callbackInfos.length-1;e>=0;--e)this.callbackInfos[e]||A_(this.callbackInfos,e);this.containCanceled=!1},t.clear=function(){this.cancelAll(),this.callbackInfos.length=0,this.isInvoking=!1,this.containCanceled=!1},e}(),R_=new v_((function(){return new b_}),16),O_=function(){function e(){this._callbackTable=Ue(!0)}var t=e.prototype;return t.on=function(e,t,n,i){if(!this.hasEventListener(e,t,n)){var r=this._callbackTable[e];r||(r=this._callbackTable[e]=R_.alloc());var o=I_.alloc();o.set(t,n,i),r.callbackInfos.push(o)}return t},t.hasEventListener=function(e,t,n){var i=this._callbackTable&&this._callbackTable[e];if(!i)return!1;var r=i.callbackInfos;if(!t){if(i.isInvoking){for(var o=0;o<r.length;++o)if(r[o])return!0;return!1}return r.length>0}for(var a=0;a<r.length;++a){var s=r[a];if(s&&s.check()&&s.callback===t&&s.target===n)return!0}return!1},t.removeAll=function(e){if("string"==typeof e){var t=this._callbackTable&&this._callbackTable[e];t&&(t.isInvoking?t.cancelAll():(t.clear(),R_.free(t),delete this._callbackTable[e]))}else if(e)for(var n in this._callbackTable){var i=this._callbackTable[n];if(i.isInvoking)for(var r=i.callbackInfos,o=0;o<r.length;++o){var a=r[o];a&&a.target===e&&i.cancel(o)}else i.removeByTarget(e)}},t.off=function(e,t,n){var i=this._callbackTable&&this._callbackTable[e];if(i){var r=i.callbackInfos;if(t)for(var o=0;o<r.length;++o){var a=r[o];if(a&&a.callback===t&&a.target===n){i.cancel(o);break}}else this.removeAll(e)}},t.emit=function(e,t,n,i,r,o){var a=this._callbackTable&&this._callbackTable[e];if(a){var s=!a.isInvoking;a.isInvoking=!0;for(var c=a.callbackInfos,l=0,u=c.length;l<u;++l){var h=c[l];if(h){var _=h.callback,f=h.target;h.once&&this.off(e,_,f),h.check()?f?_.call(f,t,n,i,r,o):_(t,n,i,r,o):this.off(e,_,f)}}s&&(a.isInvoking=!1,a.containCanceled&&a.purgeCanceled())}},t.clear=function(){for(var e in this._callbackTable){var t=this._callbackTable[e];t&&(t.clear(),R_.free(t),delete this._callbackTable[e])}},e}();function N_(e){for(var t=function(e){function t(){for(var t,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return(t=e.call.apply(e,[this].concat(i))||this)._callbackTable=Ue(!0),t}$(t,e);var n=t.prototype;return n.once=function(e,t,n){return this.on(e,t,n,!0)},n.targetOff=function(e){this.removeAll(e)},t}(e),n=O_.prototype,i=Object.getOwnPropertyNames(n).concat(Object.getOwnPropertySymbols(n)),r=0;r<i.length;++r){var o=i[r];if(!(o in t.prototype)){var a=Object.getOwnPropertyDescriptor(n,o);a&&Object.defineProperty(t.prototype,o,a)}}return t}var P_,M_,D_,L_,F_,z_=e("dt",N_((function(){})));c.EventTarget=z_;var B_=e("aN",mh("cc.Asset")((F_=L_=function(e){function t(){for(var t,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return(t=e.call.apply(e,[this].concat(i))||this).loaded=!0,ie(t,"_native",D_,ee(t)),t._nativeUrl="",t.__onLoadedInvoked__=!1,t.__nativeDepend__=null,t.__asyncLoadAssets__=!1,t.__depends__=null,t._file=null,t._ref=0,Object.defineProperty(ee(t),"_uuid",{value:"",writable:!0}),t}$(t,e),t.deserialize=function(e){return c.deserialize(e)},Z(t,[{key:"nativeUrl",get:function(){if(!this._nativeUrl){if(!this._native)return"";var e=this._native;if(47===e.charCodeAt(0))return e.slice(1);46===e.charCodeAt(0)?this._nativeUrl=h_(this._uuid,{nativeExt:e,isNative:!0}):this._nativeUrl=h_(this._uuid,{__nativeName__:e,nativeExt:H(e),isNative:!0})}return this._nativeUrl}},{key:"_nativeAsset",get:function(){return this._file},set:function(e){this._file=e}}]);var n=t.prototype;return n.toString=function(){return this.nativeUrl},n.serialize=function(){},n._setRawAsset=function(e,t){void 0===t&&(t=!0),this._native=!1!==t?e||"":"/"+e},n.addRef=function(){return this._ref++,this},n.decRef=function(e){return void 0===e&&(e=!0),this._ref>0&&this._ref--,e&&c.assetManager._releaseManager.tryRelease(this),this},n.onLoaded=function(){},Z(t,[{key:"_nativeDep",get:function(){if(this._native)return{__isNative__:!0,uuid:this._uuid,ext:this._native}}},{key:"refCount",get:function(){return this._ref}}]),t}(N_(E_)),L_.preventDeferredLoadDependents=!1,L_.preventPreloadNativeObject=!1,D_=re((M_=F_).prototype,"_native",[yh],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),re(M_.prototype,"_nativeAsset",[gh],Object.getOwnPropertyDescriptor(M_.prototype,"_nativeAsset"),M_.prototype),P_=M_))||P_);B_.prototype.createNode=null,c.Asset=B_;var U_,G_,H_,k_,V_,j_,W_,q_=1024;function Y_(e){return c.sys.capabilities.imageBitmap&&e instanceof ImageBitmap}!function(e){e[e.RGB565=Ko.R5G6B5]="RGB565",e[e.RGB5A1=Ko.RGB5A1]="RGB5A1",e[e.RGBA4444=Ko.RGBA4]="RGBA4444",e[e.RGB888=Ko.RGB8]="RGB888",e[e.RGB32F=Ko.RGB32F]="RGB32F",e[e.RGBA8888=Ko.RGBA8]="RGBA8888",e[e.RGBA32F=Ko.RGBA32F]="RGBA32F",e[e.A8=Ko.A8]="A8",e[e.I8=Ko.L8]="I8",e[e.AI8=Ko.LA8]="AI8",e[e.RGB_PVRTC_2BPPV1=Ko.PVRTC_RGB2]="RGB_PVRTC_2BPPV1",e[e.RGBA_PVRTC_2BPPV1=Ko.PVRTC_RGBA2]="RGBA_PVRTC_2BPPV1",e[e.RGB_A_PVRTC_2BPPV1=q_++]="RGB_A_PVRTC_2BPPV1",e[e.RGB_PVRTC_4BPPV1=Ko.PVRTC_RGB4]="RGB_PVRTC_4BPPV1",e[e.RGBA_PVRTC_4BPPV1=Ko.PVRTC_RGBA4]="RGBA_PVRTC_4BPPV1",e[e.RGB_A_PVRTC_4BPPV1=q_++]="RGB_A_PVRTC_4BPPV1",e[e.RGB_ETC1=Ko.ETC_RGB8]="RGB_ETC1",e[e.RGBA_ETC1=q_++]="RGBA_ETC1",e[e.RGB_ETC2=Ko.ETC2_RGB8]="RGB_ETC2",e[e.RGBA_ETC2=Ko.ETC2_RGBA8]="RGBA_ETC2",e[e.RGBA_ASTC_4x4=Ko.ASTC_RGBA_4x4]="RGBA_ASTC_4x4",e[e.RGBA_ASTC_5x4=Ko.ASTC_RGBA_5x4]="RGBA_ASTC_5x4",e[e.RGBA_ASTC_5x5=Ko.ASTC_RGBA_5x5]="RGBA_ASTC_5x5",e[e.RGBA_ASTC_6x5=Ko.ASTC_RGBA_6x5]="RGBA_ASTC_6x5",e[e.RGBA_ASTC_6x6=Ko.ASTC_RGBA_6x6]="RGBA_ASTC_6x6",e[e.RGBA_ASTC_8x5=Ko.ASTC_RGBA_8x5]="RGBA_ASTC_8x5",e[e.RGBA_ASTC_8x6=Ko.ASTC_RGBA_8x6]="RGBA_ASTC_8x6",e[e.RGBA_ASTC_8x8=Ko.ASTC_RGBA_8x8]="RGBA_ASTC_8x8",e[e.RGBA_ASTC_10x5=Ko.ASTC_RGBA_10x5]="RGBA_ASTC_10x5",e[e.RGBA_ASTC_10x6=Ko.ASTC_RGBA_10x6]="RGBA_ASTC_10x6",e[e.RGBA_ASTC_10x8=Ko.ASTC_RGBA_10x8]="RGBA_ASTC_10x8",e[e.RGBA_ASTC_10x10=Ko.ASTC_RGBA_10x10]="RGBA_ASTC_10x10",e[e.RGBA_ASTC_12x10=Ko.ASTC_RGBA_12x10]="RGBA_ASTC_12x10",e[e.RGBA_ASTC_12x12=Ko.ASTC_RGBA_12x12]="RGBA_ASTC_12x12"}(U_||(U_=e("bM",{}))),function(e){e[e.REPEAT=ua.WRAP]="REPEAT",e[e.CLAMP_TO_EDGE=ua.CLAMP]="CLAMP_TO_EDGE",e[e.MIRRORED_REPEAT=ua.MIRROR]="MIRRORED_REPEAT",e[e.CLAMP_TO_BORDER=ua.BORDER]="CLAMP_TO_BORDER"}(G_||(G_=e("cX",{}))),function(e){e[e.NONE=la.NONE]="NONE",e[e.LINEAR=la.LINEAR]="LINEAR",e[e.NEAREST=la.POINT]="NEAREST"}(H_||(H_=e("bL",{})));var X_,K_=e("ax",mh("cc.ImageAsset")((W_=j_=function(e){function t(t){var n;return(n=e.call(this)||this)._nativeData=void 0,n._tex=void 0,n._exportedExts=void 0,n._format=U_.RGBA8888,n._width=0,n._height=0,n.loaded=!1,n._nativeData={_data:null,width:0,height:0,format:0,_compressed:!1},void 0!==t&&n.reset(t),n}$(t,e),Z(t,[{key:"_nativeAsset",get:function(){return this._nativeData},set:function(e){e instanceof HTMLElement||Y_(e)||(e.format=e.format||this._format),this.reset(e)}},{key:"data",get:function(){return this._nativeData&&((e=this._nativeData)instanceof HTMLImageElement||e instanceof HTMLCanvasElement||Y_(e))?this._nativeData:this._nativeData&&this._nativeData._data;var e}},{key:"width",get:function(){return this._nativeData.width||this._width}},{key:"height",get:function(){return this._nativeData.height||this._height}},{key:"format",get:function(){return this._format}},{key:"isCompressed",get:function(){return this._format>=U_.RGB_ETC1&&this._format<=U_.RGBA_ASTC_12x12||this._format>=U_.RGB_A_PVRTC_2BPPV1&&this._format<=U_.RGBA_ETC1}},{key:"url",get:function(){return this.nativeUrl}},{key:"_texture",set:function(e){this._tex=e},get:function(){if(!this._tex){var e=new c.Texture2D;e.name=this.nativeUrl,e.image=this,this._tex=e}return this._tex}}]);var n=t.prototype;return n.reset=function(e){var t=this;Y_(e)?(this._nativeData=e,this._onDataComplete()):e instanceof HTMLElement?(this._nativeData=e,e.complete||e instanceof HTMLCanvasElement?this._onDataComplete():(this.loaded=!1,e.addEventListener("load",(function(){t._onDataComplete()})),e.addEventListener("error",(function(e){I(3119,e.message)})))):(this._nativeData=e,this._format=e.format,this._onDataComplete())},n.destroy=function(){return this.data&&this.data instanceof HTMLImageElement?(this.data.src="",this._setRawAsset("")):Y_(this.data)&&this.data.close&&this.data.close(),e.prototype.destroy.call(this)},n._serialize=function(){},n._deserialize=function(e){var n="";"string"==typeof e?n=e:(this._width=e.w,this._height=e.h,n=e.fmt);for(var i,r=c.director.root?c.director.root.device:null,o=n.split("_"),a="",s=Number.MAX_VALUE,l=this._format,u="",h=c.macro.SUPPORT_TEXTURE_FORMATS,_=ne(o);!(i=_()).done;){var f=i.value.split("@"),m=parseInt(f[0],void 0),d=t.extnames[m]||f[0],p=h.indexOf(d);if(-1!==p&&p<s){var v=f[1]?parseInt(f[1]):this._format;if(!(".astc"!==d||r&&r.hasFeature(Ra.FORMAT_ASTC)))continue;if(!(".pvr"!==d||r&&r.hasFeature(Ra.FORMAT_PVRTC)))continue;if(!(v!==U_.RGB_ETC1&&v!==U_.RGBA_ETC1||r&&r.hasFeature(Ra.FORMAT_ETC1)))continue;if(!(v!==U_.RGB_ETC2&&v!==U_.RGBA_ETC2||r&&r.hasFeature(Ra.FORMAT_ETC2)))continue;if(".webp"===d&&!c.sys.capabilities.webp)continue;s=p,u=d,l=v}else a||(a=d)}u?(this._setRawAsset(u),this._format=l):a?(this._setRawAsset(a),I(3120,a,a)):I(3121)},n._onDataComplete=function(){this.loaded=!0,this.emit("load")},t}(B_),j_.extnames=[".png",".jpg",".jpeg",".bmp",".webp",".pvr",".pkm",".astc"],re((V_=W_).prototype,"_nativeAsset",[jh],Object.getOwnPropertyDescriptor(V_.prototype,"_nativeAsset"),V_.prototype),k_=V_))||k_);c.ImageAsset=K_,function(e){e[e.minFilter=0]="minFilter",e[e.magFilter=1]="magFilter",e[e.mipFilter=2]="mipFilter",e[e.addressU=3]="addressU",e[e.addressV=4]="addressV",e[e.addressW=5]="addressW",e[e.maxAnisotropy=6]="maxAnisotropy",e[e.cmpFunc=7]="cmpFunc",e[e.minLOD=8]="minLOD",e[e.maxLOD=9]="maxLOD",e[e.mipLODBias=10]="mipLODBias",e[e.total=11]="total"}(X_||(X_={}));var Q_=[la.LINEAR,la.LINEAR,la.NONE,ua.WRAP,ua.WRAP,ua.WRAP,8,ra.NEVER,0,0,0],Z_=ef(Q_),J_=new as,$_=new ws;function ef(e){for(var t=0,n=0,i=0;i<Q_.length;i++)switch(t=e[i]||Q_[i],i){case X_.minFilter:n|=t;break;case X_.magFilter:n|=t<<2;break;case X_.mipFilter:n|=t<<4;break;case X_.addressU:n|=t<<6;break;case X_.addressV:n|=t<<8;break;case X_.addressW:n|=t<<10;break;case X_.maxAnisotropy:n|=t<<12;break;case X_.cmpFunc:n|=t<<16;break;case X_.minLOD:n|=t<<20;break;case X_.maxLOD:n|=t<<24;break;case X_.mipLODBias:n|=t<<28}return n}var tf,nf,rf,of,af,sf,cf,lf,uf,hf,_f,ff,mf=function(){function e(){this._cache={}}return e.prototype.getSampler=function(e,t){return t||(t=Z_),this._cache[t]||($_.minFilter=3&t,$_.magFilter=t>>2&3,$_.mipFilter=t>>4&3,$_.addressU=t>>6&3,$_.addressV=t>>8&3,$_.addressW=t>>10&3,$_.maxAnisotropy=t>>12&15,$_.cmpFunc=t>>16&15,$_.minLOD=t>>20&15,$_.maxLOD=t>>24&15,$_.mipLODBias=t>>28&15,$_.borderColor=J_,this._cache[t]=e.createSampler($_))},e}(),df=e("az",new mf);c.samplerLib=df;var pf=new be("Tex"),vf=e("cc",mh("cc.TextureBase")((ff=_f=function(e){function t(){var t;return ie(t=e.call(this)||this,"_format",rf,ee(t)),ie(t,"_minFilter",of,ee(t)),ie(t,"_magFilter",af,ee(t)),ie(t,"_mipFilter",sf,ee(t)),ie(t,"_wrapS",cf,ee(t)),ie(t,"_wrapT",lf,ee(t)),ie(t,"_wrapR",uf,ee(t)),ie(t,"_anisotropy",hf,ee(t)),t._width=1,t._height=1,t._id=void 0,t._samplerInfo=[],t._samplerHash=0,t._gfxSampler=null,t._gfxDevice=null,t._textureHash=0,t._id=pf.getNewId(),t.loaded=!1,t._gfxDevice=t._getGFXDevice(),t._textureHash=es(t._id,666),t}$(t,e),Z(t,[{key:"isCompressed",get:function(){return this._format>=U_.RGB_ETC1&&this._format<=U_.RGBA_ASTC_12x12||this._format>=U_.RGB_A_PVRTC_2BPPV1&&this._format<=U_.RGBA_ETC1}},{key:"width",get:function(){return this._width}},{key:"height",get:function(){return this._height}}]);var n=t.prototype;return n.getId=function(){return this._id},n.getPixelFormat=function(){return this._format},n.getAnisotropy=function(){return this._anisotropy},n.setWrapMode=function(e,t,n){this._wrapS=e,this._samplerInfo[X_.addressU]=e,this._wrapT=t,this._samplerInfo[X_.addressV]=t,void 0!==n&&(this._wrapR=n,this._samplerInfo[X_.addressW]=n),this._samplerHash=ef(this._samplerInfo),this._gfxDevice&&(this._gfxSampler=df.getSampler(this._gfxDevice,this._samplerHash))},n.setFilters=function(e,t){this._minFilter=e,this._samplerInfo[X_.minFilter]=e,this._magFilter=t,this._samplerInfo[X_.magFilter]=t,this._samplerHash=ef(this._samplerInfo),this._gfxDevice&&(this._gfxSampler=df.getSampler(this._gfxDevice,this._samplerHash))},n.setMipFilter=function(e){this._mipFilter=e,this._samplerInfo[X_.mipFilter]=e,this._samplerInfo[X_.maxLOD]=e===H_.NONE?0:15,this._samplerHash=ef(this._samplerInfo),this._gfxDevice&&(this._gfxSampler=df.getSampler(this._gfxDevice,this._samplerHash))},n.setAnisotropy=function(e){this._anisotropy=e,this._samplerInfo[X_.maxAnisotropy]=e,this._samplerHash=ef(this._samplerInfo),this._gfxDevice&&(this._gfxSampler=df.getSampler(this._gfxDevice,this._samplerHash))},n.destroy=function(){var t=e.prototype.destroy.call(this);return t&&c.director.root&&c.director.root.batcher2D&&c.director.root.batcher2D._releaseDescriptorSetCache(this._textureHash),t},n.getHash=function(){return this._textureHash},n.getGFXTexture=function(){return null},n.getSamplerHash=function(){return this._samplerHash},n.getGFXSampler=function(){return this._gfxSampler||(this._gfxDevice?this._gfxSampler=df.getSampler(this._gfxDevice,this._samplerHash):R(9302)),this._gfxSampler},n._serialize=function(){return""},n._deserialize=function(e){var t=e.split(",");t.unshift(""),t.length>=5&&(this.setFilters(parseInt(t[1]),parseInt(t[2])),this.setWrapMode(parseInt(t[3]),parseInt(t[4]))),t.length>=7&&(this.setMipFilter(parseInt(t[5])),this.setAnisotropy(parseInt(t[6])))},n._getGFXDevice=function(){return c.director.root?c.director.root.device:null},n._getGFXFormat=function(){return this._getGFXPixelFormat(this._format)},n._setGFXFormat=function(e){this._format=void 0===e?U_.RGBA8888:e},n._getGFXPixelFormat=function(e){return e===U_.RGBA_ETC1?e=U_.RGB_ETC1:e===U_.RGB_A_PVRTC_4BPPV1?e=U_.RGB_PVRTC_4BPPV1:e===U_.RGB_A_PVRTC_2BPPV1&&(e=U_.RGB_PVRTC_2BPPV1),e},t}(B_),_f.PixelFormat=U_,_f.WrapMode=G_,_f.Filter=H_,rf=re((nf=ff).prototype,"_format",[yh],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return U_.RGBA8888}}),of=re(nf.prototype,"_minFilter",[yh],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return H_.LINEAR}}),af=re(nf.prototype,"_magFilter",[yh],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return H_.LINEAR}}),sf=re(nf.prototype,"_mipFilter",[yh],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return H_.NONE}}),cf=re(nf.prototype,"_wrapS",[yh],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return G_.REPEAT}}),lf=re(nf.prototype,"_wrapT",[yh],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return G_.REPEAT}}),uf=re(nf.prototype,"_wrapR",[yh],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return G_.REPEAT}}),hf=re(nf.prototype,"_anisotropy",[yh],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 8}}),tf=nf))||tf);c.TextureBase=vf;var gf=[ti,Fn,oi,Vn,Dn,ci,ui,Zn];function yf(e,t){e.x=t[1],e.y=t[2],e.z=t[3],e.w=t[4]}var xf=[function(e,t){e.x=t[1],e.y=t[2]},function(e,t){e.x=t[1],e.y=t[2],e.z=t[3]},yf,yf,function(e,t){e._val=t[1]},function(e,t){e.width=t[1],e.height=t[2]},function(e,t){e.x=t[1],e.y=t[2],e.width=t[3],e.height=t[4]},function(e,t){Zn.fromArray(e,t,1)}],Ef=e("e3",function(){function e(){this.uuidObjList=null,this.uuidPropList=null,this.uuidList=null}var t=e.prototype;return t.init=function(e){this.uuidObjList=e[8],this.uuidPropList=e[9],this.uuidList=e[10]},t.reset=function(){this.uuidList=null,this.uuidObjList=null,this.uuidPropList=null},t.push=function(e,t,n){this.uuidObjList.push(e),this.uuidPropList.push(t),this.uuidList.push(n)},e}());function Sf(e,t){for(var n=e[4][t[0]],i=n[0],r=new(0,i[0]),o=i[1],a=i[2],s=n[n.length-1],c=1;c<s;++c)r[o[n[c]]]=t[c];for(;c<t.length;++c){var l=o[n[c]],u=i[n[c]+a];(0,bf[u])(e,r,l,t[c])}return r}function Tf(e,t,n){var i=new t;return i._deserialize?i._deserialize(n,e[0]):R(5303,Ge(t)),i}function Af(e,t,n,i){i>=0?t[n]=e[5][i]:e[7][3*~i]=t}function Cf(e){return function(t,n,i,r){n[i]=r;for(var o=0;o<r.length;++o)e(t,r,o,r[o])}}function wf(e,t,n,i){t[n]=null,e[8][i]=t}function If(e,t,n,i){t[n]=Sf(e,i)}Ef.pool=new ft((function(e){e.reset()}),5),Ef.pool.get=function(){return this._get()||new Ef};var bf=new Array(13);function Rf(e,t){return e||Mf.reportMissingClass(t),Object}function Of(e,t,n,i,r,o){var a=e(t);if(!a){if(r)return void(n[i]=function(t,n,i){return function(){var r=e(i)||Rf(o,i);return t[n]=r,new r}}(n,i,t));a=Rf(o,t)}n[i]=a}function Nf(e,t,n){for(var i=n||ut,r=e[3],o=0;o<r.length;++o){var a=r[o];"string"!=typeof a?Of(i,a[0],a,0,t,n):Of(i,a,r,o,t,n)}}function Pf(e){var t=e[4];if(t)for(var n=e[3],i=0;i<t.length;++i){var r=t[i];r[0]=n[r[0]]}}function Mf(e,t,n){"string"==typeof e&&(e=JSON.parse(e));var i,r=!t;(t=t||Ef.pool.get()).init(e),n=n||{};var o=e[0],a=!1;if("object"==typeof o&&(a=o.preprocessed,o=o.version),o<1)throw new Error(M(5304,o));n._version=o,n.result=t,e[0]=n,a||(Nf(e,!1,n.classFinder),Pf(e)),c.game._isCloning=!0;var s=e[5],l=function(e){var t=e[5],n=e[6],i=0===n?0:n.length,r=t[t.length-1],o=t.length-i;"number"!=typeof r?r=0:(r<0&&(r=~r),--o);for(var a=0;a<o;++a)t[a]=Sf(e,t[a]);for(var s=e[3],c=0;c<i;++c,++a){var l=n[c],u=t[a];if(l>=0){var h=s[l];t[a]=Tf(e,h,u)}else(0,bf[l=~l])(e,t,a,u)}return r}(e);return c.game._isCloning=!1,e[7]&&function(e,t,n){for(var i=e.length-1,r=0,o=3*e[i];r<o;r+=3){var a=e[r],s=t[e[r+2]],c=e[r+1];c>=0?a[n[c]]=s:a[~c]=s}for(;r<i;r+=3){var l=t[e[r]],u=t[e[r+2]],h=e[r+1];h>=0?l[n[h]]=u:l[~h]=u}}(e[7],s,e[2]),function(e){for(var t=e[5],n=e[2],i=e[1],r=e[8],o=e[9],a=e[10],s=0;s<r.length;++s){var c=r[s];"number"==typeof c&&(r[s]=t[c]);var l=o[s];"number"==typeof l&&(l=l>=0?n[l]:~l,o[s]=l);var u=a[s];"number"==typeof u&&(a[s]=i[u])}}(e),i=s[l],r&&Ef.pool.put(t),i}bf[0]=function(e,t,n,i){t[n]=i},bf[1]=Af,bf[2]=Cf(Af),bf[3]=Cf(wf),bf[4]=If,bf[5]=function(e,t,n,i){xf[i[0]](t[n],i)},bf[6]=wf,bf[7]=function(e,t,n,i){t[n].set(i)},bf[8]=function(e,t,n,i){var r=new gf[i[0]];xf[i[0]](r,i),t[n]=r},bf[9]=Cf(If),bf[10]=function(e,t,n,i){var r=e[3][i[0]];t[n]=Tf(e,r,i[1])},bf[11]=function(e,t,n,i){var r=i[0];t[n]=r;for(var o=1;o<i.length;o+=3){var a=i[o],s=i[o+1],c=i[o+2];(0,bf[s])(e,r,a,c)}},bf[12]=function(e,t,n,i){var r=i[0];t[n]=r;for(var o=0;o<r.length;++o){var a=r[o],s=i[o+1];0!==s&&(0,bf[s])(e,r,o,a)}},Mf.Details=Ef,Mf.reportMissingClass=function(e){I(5302,e)};var Df,Lf,Ff,zf=function(e){this.preprocessed=!0,this.version=e};function Bf(e,t,n){return[1,0,0,[e],0,n?[t,-1]:[t],[0],0,[],[],[]]}c.deserialize=Mf;var Uf=e("eg",mh("cc.Script")(Df=function(e){function t(){return e.apply(this,arguments)||this}return $(t,e),t}(B_))||Df);c._Script=Uf;var Gf=e("eh",mh("cc.JavaScript")(Lf=function(e){function t(){return e.apply(this,arguments)||this}return $(t,e),t}(Uf))||Lf);c._JavaScript=Gf;var Hf,kf,Vf,jf,Wf,qf,Yf,Xf,Kf,Qf,Zf,Jf=e("ei",mh("cc.TypeScript")(Ff=function(e){function t(){return e.apply(this,arguments)||this}return $(t,e),t}(Uf))||Ff);c._TypeScript=Jf;var $f,em,tm,nm,im=new be("Comp"),rm=E_.Flags.IsOnLoadCalled,om=e("bj",(Hf=mh("cc.Component"),kf=Oh(),Vf=Vh(Uf),jf=Nh(),Hf((Zf=Qf=function(e){function t(){for(var t,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return ie(t=e.call.apply(e,[this].concat(i))||this,"node",Yf,ee(t)),ie(t,"_enabled",Xf,ee(t)),ie(t,"__prefab",Kf,ee(t)),t._sceneGetter=null,t._id=im.getNewId(),t}$(t,e);var n=t.prototype;return n._getRenderScene=function(){return this._sceneGetter?this._sceneGetter():this.node.scene._renderScene},n.addComponent=function(e){return this.node.addComponent(e)},n.getComponent=function(e){return this.node.getComponent(e)},n.getComponents=function(e){return this.node.getComponents(e)},n.getComponentInChildren=function(e){return this.node.getComponentInChildren(e)},n.getComponentsInChildren=function(e){return this.node.getComponentsInChildren(e)},n.destroy=function(){return!!e.prototype.destroy.call(this)&&(this._enabled&&this.node.activeInHierarchy&&c.director._compScheduler.disableComp(this),!0)},n._onPreDestroy=function(){this.unscheduleAllCallbacks(),c.director._nodeActivator.destroyComp(this),this.node._removeComponent(this)},n._instantiate=function(e){return e||(e=c.instantiate._clone(this,this)),e.node=null,e},n.schedule=function(e,t,n,i){void 0===t&&(t=0),void 0===n&&(n=c.macro.REPEAT_FOREVER),void 0===i&&(i=0),P(e,1619),P((t=t||0)>=0,1620),n=isNaN(n)?c.macro.REPEAT_FOREVER:n,i=i||0;var r=c.director.getScheduler(),o=r.isTargetPaused(this);r.schedule(e,this,t,n,i,o)},n.scheduleOnce=function(e,t){void 0===t&&(t=0),this.schedule(e,0,0,t)},n.unschedule=function(e){e&&c.director.getScheduler().unschedule(e,this)},n.unscheduleAllCallbacks=function(){c.director.getScheduler().unscheduleAllForTarget(this)},Z(t,[{key:"name",get:function(){if(this._name)return this._name;var e=Ge(this),t=e.lastIndexOf(".");return t>=0&&(e=e.slice(t+1)),this.node.name+"<"+e+">"},set:function(e){this._name=e}},{key:"uuid",get:function(){return this._id}},{key:"__scriptAsset",get:function(){return null}},{key:"enabled",get:function(){return this._enabled},set:function(e){if(this._enabled!==e&&(this._enabled=e,this.node.activeInHierarchy)){var t=c.director._compScheduler;e?t.enableComp(this):t.disableComp(this)}}},{key:"enabledInHierarchy",get:function(){return this._enabled&&this.node&&this.node.activeInHierarchy}},{key:"_isOnLoadCalled",get:function(){return this._objFlags&rm}}]),t}(E_),Qf.system=null,re((qf=Zf).prototype,"__scriptAsset",[kf,Vf,jf,Bh],Object.getOwnPropertyDescriptor(qf.prototype,"__scriptAsset"),qf.prototype),Yf=re(qf.prototype,"node",[yh],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Xf=re(qf.prototype,"_enabled",[yh],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),Kf=re(qf.prototype,"__prefab",[yh],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Wf=qf))||Wf)),am=om.prototype;am.update=null,am.lateUpdate=null,am.__preload=null,am.onLoad=null,am.start=null,am.onEnable=null,am.onDisable=null,am.onDestroy=null,am.onFocusInEditor=null,am.onLostFocusInEditor=null,am.resetInEditor=null,am._getLocalBounds=null,am.onRestore=null,om._requireComponent=null,om._executionOrder=0,Le(om,"_registerEditorProps",(function(e,t){var n=t.requireComponent;n&&(e._requireComponent=n);var i=t.executionOrder;i&&"number"==typeof i&&(e._executionOrder=i)})),c.Component=om;var sm=e("fr",mh("cc.MissingScript")($f=Ch()((nm=function(e){function t(){var t;return ie(t=e.call(this)||this,"_$erialized",tm,ee(t)),t}return $(t,e),t.safeFindClass=function(e){var t=ut(e);if(t)return t;c.deserialize.reportMissingClass(e)},t.prototype.onLoad=function(){I(4600,this.node.name)},t}(om),tm=re((em=nm).prototype,"_$erialized",[yh,xh],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),$f=em))||$f)||$f);function cm(e,t){var n;n=sm.safeFindClass;var i,r=Ef.pool.get();try{i=Mf(e,r,{classFinder:n,customEnv:t})}catch(e){throw y(e),Ef.pool.put(r),e}i._uuid=t.__uuid__||"";for(var o=r.uuidList,a=r.uuidObjList,s=r.uuidPropList,c=[],l=0;l<o.length;l++){var u=o[l];c[l]={uuid:c_(u),owner:a[l],prop:s[l]}}return i.__depends__=c,i._native&&(i.__nativeDepend__=!0),Ef.pool.put(r),i}c._MissingScript=sm;var lm,um=new(function(){function e(){this._depends=new Wh}var t=e.prototype;return t.init=function(){this._depends.clear()},t.getNativeDep=function(e){var t=this._depends.get(e);return t&&t.nativeDep?J({},t.nativeDep):null},t.getDeps=function(e){return this._depends.has(e)?this._depends.get(e).deps:[]},t.getDepsRecursively=function(e){var t=Object.create(null),n=[];return this._descend(e,t,n),n},t.remove=function(e){this._depends.remove(e)},t.parse=function(e,t){var n,i,r=null;if(Array.isArray(t)||t.__type__){if(this._depends.has(e))return this._depends.get(e);if(!Array.isArray(t)||"number"==typeof(i=(n=t[5])[n.length-1])&&i<0)try{var o=cm(t,{__uuid__:e});(r=this._parseDepsFromAsset(o)).nativeDep&&(r.nativeDep.uuid=e),Qh.add(e+"@import",o)}catch(t){Kh.remove(e+"@import"),r={deps:[]}}else r={deps:this._parseDepsFromJson(t)}}else{if(this._depends.has(e)&&(r=this._depends.get(e)).parsedFromExistAsset)return r;r=this._parseDepsFromAsset(t)}return this._depends.add(e,r),r},t._parseDepsFromAsset=function(e){for(var t={deps:[],parsedFromExistAsset:!0,preventPreloadNativeObject:e.constructor.preventPreloadNativeObject,preventDeferredLoadDependents:e.constructor.preventDeferredLoadDependents},n=e.__depends__,i=0,r=n.length;i<r;i++)t.deps.push(n[i].uuid);return e.__nativeDepend__&&(t.nativeDep=e._nativeDep),t},t._parseDepsFromJson=function(e){var t=null;return(t=function(e){var t=e[1];return e[10].map((function(e){return t[e]}))}(e)).forEach((function(e,n){return t[n]=c_(e)})),t},t._descend=function(e,t,n){for(var i=this.getDeps(e),r=0;r<i.length;r++){var o=i[r];t[o]||(t[o]=!0,n.push(o),this._descend(o,t,n))}},e}()),hm=[new hs];function _m(e){return e&&0==(e&e-1)}var fm,mm,dm,pm,vm,gm,ym=mh("cc.SimpleTexture")(lm=function(e){function t(){for(var t,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return(t=e.call.apply(e,[this].concat(i))||this)._gfxTexture=null,t._mipmapLevel=1,t._textureWidth=0,t._textureHeight=0,t}$(t,e);var n=t.prototype;return n.getGFXTexture=function(){return this._gfxTexture},n.destroy=function(){return this._tryDestroyTexture(),e.prototype.destroy.call(this)},n.updateImage=function(){this.updateMipmaps(0)},n.updateMipmaps=function(){},n.uploadData=function(e,t,n){if(void 0===t&&(t=0),void 0===n&&(n=0),this._gfxTexture&&!(this._mipmapLevel<=t)){var i=this._getGFXDevice();if(i){var r=hm[0];r.texExtent.width=this._textureWidth>>t,r.texExtent.height=this._textureHeight>>t,r.texSubres.mipLevel=t,r.texSubres.baseArrayLayer=n,ArrayBuffer.isView(e)?i.copyBuffersToTexture([e],this._gfxTexture,hm):i.copyTexImagesToTexture([e],this._gfxTexture,hm)}}},n._assignImage=function(e,t,n){var i=this,r=function(){var r=e.data;if(r&&(i.uploadData(r,t,n),i._checkTextureLoaded(),St.CLEANUP_IMAGE_CACHE)){var o=um.getDeps(i._uuid),a=o.indexOf(e._uuid);-1!==a&&(Ae(o,a),e.decRef())}};if(e.loaded)r();else{if(e.once("load",(function(){r()})),!this.isCompressed){var o=c.builtinResMgr.get("black-texture").image;this.uploadData(o.data,t,n)}c.assetManager.postLoadNative(e)}},n._checkTextureLoaded=function(){this._textureReady()},n._textureReady=function(){this.loaded=!0,this.emit("load")},n._setMipmapLevel=function(e){this._mipmapLevel=e<1?1:e},n._getGfxTextureCreateInfo=function(){return null},n._tryReset=function(){if(this._tryDestroyTexture(),0!==this._mipmapLevel){var e=this._getGFXDevice();e&&this._createTexture(e)}},n._createTexture=function(e){if(0!==this._width&&0!==this._height){var t=ma.NONE;this._mipFilter!==H_.NONE&&function(e,t,n){return!(e.gfxAPI===Ia.WEBGL)||_m(t)&&_m(n)}(e,this._width,this._height)&&(this._mipmapLevel=function(e,t){for(var n=Math.max(e,t),i=0;n;)n>>=1,i++;return i}(this._width,this._height),t=ma.GEN_MIPMAP);var n=this._getGfxTextureCreateInfo({usage:_a.SAMPLED|_a.TRANSFER_DST,format:this._getGFXFormat(),levelCount:this._mipmapLevel,flags:t|ma.IMMUTABLE});if(n){var i=e.createTexture(n);this._textureWidth=n.width,this._textureHeight=n.height,this._gfxTexture=i}}},n._tryDestroyTexture=function(){this._gfxTexture&&(this._gfxTexture.destroy(),this._gfxTexture=null)},Z(t,[{key:"mipmapLevel",get:function(){return this._mipmapLevel}}]),t}(vf))||lm;c.SimpleTexture=ym;var xm,Em,Sm,Tm,Am,Cm,wm=e("ay",(fm=mh("cc.Texture2D"),mm=Vh([K_]),fm((gm=function(e){function t(){for(var t,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return ie(t=e.call.apply(e,[this].concat(i))||this,"_mipmaps",vm,ee(t)),t}$(t,e);var n=t.prototype;return n.initialize=function(){this.mipmaps=this._mipmaps},n.onLoaded=function(){this.initialize()},n.reset=function(e){this._width=e.width,this._height=e.height,this._setGFXFormat(e.format),this._setMipmapLevel(e.mipmapLevel||1),this._tryReset()},n.create=function(e,t,n,i){void 0===n&&(n=U_.RGBA8888),void 0===i&&(i=1),this.reset({width:e,height:t,format:n,mipmapLevel:i})},n.toString=function(){return 0!==this._mipmaps.length?this._mipmaps[0].url:""},n.updateMipmaps=function(e,t){if(void 0===e&&(e=0),!(e>=this._mipmaps.length))for(var n=Math.min(void 0===t?this._mipmaps.length:t,this._mipmaps.length-e),i=0;i<n;++i){var r=e+i;this._assignImage(this._mipmaps[r],r)}},n.getHtmlElementObj=function(){return this._mipmaps[0]&&this._mipmaps[0].data instanceof HTMLElement?this._mipmaps[0].data:null},n.destroy=function(){return this._mipmaps=[],e.prototype.destroy.call(this)},n.description=function(){return"<cc.Texture2D | Name = "+(this._mipmaps[0]?this._mipmaps[0].url:"")+" | Dimension = "+this.width+" x "+this.height+">"},n.releaseTexture=function(){this.destroy()},n._serialize=function(){},n._deserialize=function(t,n){var i=t;e.prototype._deserialize.call(this,i.base,n),this._mipmaps=new Array(i.mipmaps.length);for(var r=0;r<i.mipmaps.length;++r)if(this._mipmaps[r]=new K_,i.mipmaps[r]){var o=i.mipmaps[r];n.result.push(this._mipmaps,""+r,o),this._mipmaps[r]._texture=this}},n._getGfxTextureCreateInfo=function(e){var t=new Ds(ha.TEX2D);return t.width=this._width,t.height=this._height,Object.assign(t,e)},n._checkTextureLoaded=function(){for(var t=!0,n=0;n<this._mipmaps.length;++n)if(!this._mipmaps[n].loaded){t=!1;break}t&&e.prototype._textureReady.call(this)},Z(t,[{key:"mipmaps",get:function(){return this._mipmaps},set:function(e){var t=this;if(this._mipmaps=e,this._setMipmapLevel(this._mipmaps.length),this._mipmaps.length>0){var n=this._mipmaps[0];this.reset({width:n.width,height:n.height,format:n.format,mipmapLevel:this._mipmaps.length}),this._mipmaps.forEach((function(e,n){t._assignImage(e,n)}))}else this.reset({width:0,height:0,mipmapLevel:this._mipmaps.length})}},{key:"image",get:function(){return 0===this._mipmaps.length?null:this._mipmaps[0]},set:function(e){this.mipmaps=e?[e]:[]}}]),t}(ym),vm=re((pm=gm).prototype,"_mipmaps",[mm],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),dm=pm))||dm));c.Texture2D=wm,function(e){e[e.right=0]="right",e[e.left=1]="left",e[e.top=2]="top",e[e.bottom=3]="bottom",e[e.front=4]="front",e[e.back=5]="back"}(Cm||(Cm={}));var Im=e("ed",mh("cc.TextureCube")((Am=Tm=function(e){function t(){for(var t,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return ie(t=e.call.apply(e,[this].concat(i))||this,"_mipmaps",Sm,ee(t)),t}$(t,e),t.fromTexture2DArray=function(e,n){for(var i=[],r=e.length/6,o=0;o<r;o++){var a=6*o;i.push({front:e[a+Cm.front].image,back:e[a+Cm.back].image,left:e[a+Cm.left].image,right:e[a+Cm.right].image,top:e[a+Cm.top].image,bottom:e[a+Cm.bottom].image})}return(n=n||new t).mipmaps=i,n};var n=t.prototype;return n.onLoaded=function(){this.mipmaps=this._mipmaps,this.loaded=!0,this.emit("load")},n.reset=function(e){this._width=e.width,this._height=e.height,this._setGFXFormat(e.format),this._setMipmapLevel(e.mipmapLevel||1),this._tryReset()},n.updateMipmaps=function(e,t){var n=this;if(void 0===e&&(e=0),!(e>=this._mipmaps.length))for(var i=Math.min(void 0===t?this._mipmaps.length:t,this._mipmaps.length-e),r=function(t){var i=e+t;bm(n._mipmaps[i],(function(e,t){n._assignImage(e,i,t)}))},o=0;o<i;++o)r(o)},n.destroy=function(){return this._mipmaps=[],e.prototype.destroy.call(this)},n.releaseTexture=function(){this.mipmaps=[]},n._serialize=function(){},n._deserialize=function(t,n){var i=t;e.prototype._deserialize.call(this,i.base,n),this._mipmaps=new Array(i.mipmaps.length);for(var r=0;r<i.mipmaps.length;++r){this._mipmaps[r]={front:new K_,back:new K_,left:new K_,right:new K_,top:new K_,bottom:new K_};var o=i.mipmaps[r];n.result.push(this._mipmaps[r],"front",o.front),n.result.push(this._mipmaps[r],"back",o.back),n.result.push(this._mipmaps[r],"left",o.left),n.result.push(this._mipmaps[r],"right",o.right),n.result.push(this._mipmaps[r],"top",o.top),n.result.push(this._mipmaps[r],"bottom",o.bottom)}},n._getGfxTextureCreateInfo=function(e){var t=new Ds(ha.CUBE);return t.width=this._width,t.height=this._height,t.layerCount=6,Object.assign(t,e),t.flags|=ma.CUBEMAP,t},Z(t,[{key:"mipmaps",get:function(){return this._mipmaps},set:function(e){var t=this;if(this._mipmaps=e,this._setMipmapLevel(this._mipmaps.length),this._mipmaps.length>0){var n=this._mipmaps[0].front;this.reset({width:n.width,height:n.height,format:n.format,mipmapLevel:this._mipmaps.length}),this._mipmaps.forEach((function(e,n){bm(e,(function(e,i){t._assignImage(e,n,i)}))}))}else this.reset({width:0,height:0,mipmapLevel:this._mipmaps.length})}},{key:"image",get:function(){return 0===this._mipmaps.length?null:this._mipmaps[0]},set:function(e){this.mipmaps=e?[e]:[]}}]),t}(ym),Tm.FaceIndex=Cm,Sm=re((Em=Am).prototype,"_mipmaps",[yh],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),xm=Em))||xm);function bm(e,t){t(e.front,Cm.front),t(e.back,Cm.back),t(e.left,Cm.left),t(e.right,Cm.right),t(e.top,Cm.top),t(e.bottom,Cm.bottom)}c.TextureCube=Im;var Rm,Om,Nm,Pm=e("fs",[{name:"billboard",techniques:[{name:"add",passes:[{rasterizerState:{cullMode:0},blendState:{targets:[{blend:!0,blendSrc:2,blendDst:1,blendSrcAlpha:2,blendDstAlpha:1}]},program:"billboard|vert:vs_main|tinted-fs:add",depthStencilState:{depthTest:!0,depthWrite:!1},properties:{mainTexture:{value:"grey",type:28},mainTiling_Offset:{value:[1,1,0,0],type:16},tintColor:{value:[.5,.5,.5,.5],type:16}}}]}],shaders:[{name:"billboard|vert:vs_main|tinted-fs:add",hash:2143664850,builtins:{globals:{blocks:[{name:"CCGlobal",defines:[]},{name:"CCCamera",defines:[]}],samplers:[]},locals:{blocks:[{name:"CCLocal",defines:[]}],samplers:[]}},defines:[{name:"CC_USE_HDR",type:"boolean"}],blocks:[{name:"Constants",defines:[],binding:0,stageFlags:1,members:[{name:"mainTiling_Offset",type:16,count:1},{name:"frameTile_velLenScale",type:16,count:1},{name:"scale",type:16,count:1}]},{name:"builtin",defines:[],binding:1,stageFlags:1,members:[{name:"cc_size_rotation",type:16,count:1}]},{name:"FragConstants",defines:[],binding:2,stageFlags:16,members:[{name:"tintColor",type:16,count:1}]}],samplers:[{name:"mainTexture",type:28,count:1,defines:[],stageFlags:16,binding:3}],attributes:[{name:"a_position",type:15,count:1,defines:[],stageFlags:1,format:32,location:0},{name:"a_texCoord",type:14,count:1,defines:[],stageFlags:1,format:21,location:1},{name:"a_color",type:16,count:1,defines:[],stageFlags:1,format:44,location:2}]}]},{name:"clear-stencil",techniques:[{passes:[{blendState:{targets:[{blend:!0}]},rasterizerState:{cullMode:0},program:"clear-stencil|sprite-vs:vert|sprite-fs:frag",depthStencilState:{depthTest:!1,depthWrite:!1}}]}],shaders:[{name:"clear-stencil|sprite-vs:vert|sprite-fs:frag",hash:1062464958,builtins:{globals:{blocks:[],samplers:[]},locals:{blocks:[],samplers:[]}},defines:[],blocks:[],samplers:[],attributes:[{name:"a_position",type:15,count:1,defines:[],stageFlags:1,format:32,location:0}]}]},{name:"graphics",techniques:[{passes:[{blendState:{targets:[{blend:!0,blendSrc:1,blendDst:4,blendSrcAlpha:1,blendDstAlpha:4}]},rasterizerState:{cullMode:0},program:"graphics|vs:vert|fs:frag",depthStencilState:{depthTest:!1,depthWrite:!1}}]}],shaders:[{name:"graphics|vs:vert|fs:frag",hash:3946667351,builtins:{globals:{blocks:[{name:"CCGlobal",defines:[]},{name:"CCCamera",defines:[]}],samplers:[]},locals:{blocks:[{name:"CCLocal",defines:[]}],samplers:[]}},defines:[],blocks:[],samplers:[],attributes:[{name:"a_position",type:15,count:1,defines:[],stageFlags:1,format:32,location:0},{name:"a_color",type:16,count:1,defines:[],stageFlags:1,format:44,location:1},{name:"a_dist",type:13,count:1,defines:[],stageFlags:1,format:11,location:2}]}]},{name:"particle-gpu",techniques:[{name:"add",passes:[{rasterizerState:{cullMode:0},blendState:{targets:[{blend:!0,blendSrc:2,blendDst:1,blendSrcAlpha:2,blendDstAlpha:1}]},program:"particle-gpu|particle-vs-gpu:gpvs_main|tinted-fs:add",depthStencilState:{depthTest:!0,depthWrite:!1},properties:{mainTexture:{value:"grey",type:28},mainTiling_Offset:{value:[1,1,0,0],type:16},tintColor:{value:[.5,.5,.5,.5],type:16}}}]}],shaders:[{name:"particle-gpu|particle-vs-gpu:gpvs_main|tinted-fs:add",hash:3696836305,builtins:{globals:{blocks:[{name:"CCGlobal",defines:[]},{name:"CCCamera",defines:[]}],samplers:[]},locals:{blocks:[{name:"CCLocal",defines:[]}],samplers:[]}},defines:[{name:"CC_RENDER_MODE",type:"number",range:[0,4]},{name:"COLOR_OVER_TIME_MODULE_ENABLE",type:"boolean"},{name:"ROTATION_OVER_TIME_MODULE_ENABLE",type:"boolean"},{name:"SIZE_OVER_TIME_MODULE_ENABLE",type:"boolean"},{name:"FORCE_OVER_TIME_MODULE_ENABLE",type:"boolean"},{name:"VELOCITY_OVER_TIME_MODULE_ENABLE",type:"boolean"},{name:"TEXTURE_ANIMATION_MODULE_ENABLE",type:"boolean"},{name:"CC_USE_WORLD_SPACE",type:"boolean"},{name:"CC_USE_HDR",type:"boolean"}],blocks:[{name:"Constants",defines:[],binding:0,stageFlags:1,members:[{name:"mainTiling_Offset",type:16,count:1},{name:"frameTile_velLenScale",type:16,count:1},{name:"scale",type:16,count:1}]},{name:"SampleConstants",defines:[],binding:1,stageFlags:1,members:[{name:"u_sampleInfo",type:16,count:1}]},{name:"TickConstants",defines:[],binding:2,stageFlags:1,members:[{name:"u_worldRot",type:16,count:1},{name:"u_timeDelta",type:16,count:1}]},{name:"ColorConstant",defines:["COLOR_OVER_TIME_MODULE_ENABLE"],binding:3,stageFlags:1,members:[{name:"u_color_mode",type:5,count:1}]},{name:"RotationConstant",defines:["ROTATION_OVER_TIME_MODULE_ENABLE"],binding:4,stageFlags:1,members:[{name:"u_rotation_mode",type:5,count:1}]},{name:"SizeConstant",defines:["SIZE_OVER_TIME_MODULE_ENABLE"],binding:5,stageFlags:1,members:[{name:"u_size_mode",type:5,count:1}]},{name:"ForceConstant",defines:["FORCE_OVER_TIME_MODULE_ENABLE"],binding:6,stageFlags:1,members:[{name:"u_force_mode",type:5,count:1},{name:"u_force_space",type:5,count:1}]},{name:"VelocityConstant",defines:["VELOCITY_OVER_TIME_MODULE_ENABLE"],binding:7,stageFlags:1,members:[{name:"u_velocity_mode",type:5,count:1},{name:"u_velocity_space",type:5,count:1}]},{name:"AnimationConstant",defines:["TEXTURE_ANIMATION_MODULE_ENABLE"],binding:8,stageFlags:1,members:[{name:"u_anim_info",type:16,count:1}]},{name:"FragConstants",defines:[],binding:9,stageFlags:16,members:[{name:"tintColor",type:16,count:1}]}],samplers:[{name:"color_over_time_tex0",type:28,count:1,defines:["COLOR_OVER_TIME_MODULE_ENABLE"],stageFlags:1,binding:10},{name:"rotation_over_time_tex0",type:28,count:1,defines:["ROTATION_OVER_TIME_MODULE_ENABLE"],stageFlags:1,binding:11},{name:"size_over_time_tex0",type:28,count:1,defines:["SIZE_OVER_TIME_MODULE_ENABLE"],stageFlags:1,binding:12},{name:"force_over_time_tex0",type:28,count:1,defines:["FORCE_OVER_TIME_MODULE_ENABLE"],stageFlags:1,binding:13},{name:"velocity_over_time_tex0",type:28,count:1,defines:["VELOCITY_OVER_TIME_MODULE_ENABLE"],stageFlags:1,binding:14},{name:"texture_animation_tex0",type:28,count:1,defines:["TEXTURE_ANIMATION_MODULE_ENABLE"],stageFlags:1,binding:15},{name:"mainTexture",type:28,count:1,defines:[],stageFlags:16,binding:16}],attributes:[{name:"a_position_starttime",type:16,count:1,defines:[],stageFlags:1,format:44,location:0},{name:"a_size_uv",type:16,count:1,defines:[],stageFlags:1,format:44,location:1},{name:"a_rotation_uv",type:16,count:1,defines:[],stageFlags:1,format:44,location:2},{name:"a_color",type:16,count:1,defines:[],stageFlags:1,format:44,location:3},{name:"a_dir_life",type:16,count:1,defines:[],stageFlags:1,format:44,location:4},{name:"a_rndSeed",type:13,count:1,defines:[],stageFlags:1,format:11,location:5},{name:"a_texCoord",type:15,count:1,defines:["CC_RENDER_MODE"],stageFlags:1,format:32,location:6},{name:"a_texCoord3",type:15,count:1,defines:["CC_RENDER_MODE"],stageFlags:1,format:32,location:7},{name:"a_normal",type:15,count:1,defines:["CC_RENDER_MODE"],stageFlags:1,format:32,location:8},{name:"a_color1",type:16,count:1,defines:["CC_RENDER_MODE"],stageFlags:1,format:44,location:9}]}]},{name:"particle-trail",techniques:[{name:"add",passes:[{rasterizerState:{cullMode:0},blendState:{targets:[{blend:!0,blendSrc:2,blendDst:1,blendSrcAlpha:2,blendDstAlpha:1}]},program:"particle-trail|particle-trail:vs_main|tinted-fs:add",depthStencilState:{depthTest:!0,depthWrite:!1},properties:{mainTexture:{value:"grey",type:28},mainTiling_Offset:{value:[1,1,0,0],type:16},frameTile_velLenScale:{value:[1,1,0,0],type:16},tintColor:{value:[.5,.5,.5,.5],type:16}}}]}],shaders:[{name:"particle-trail|particle-trail:vs_main|tinted-fs:add",hash:4115155772,builtins:{globals:{blocks:[{name:"CCGlobal",defines:[]},{name:"CCCamera",defines:[]}],samplers:[]},locals:{blocks:[{name:"CCLocal",defines:[]}],samplers:[]}},defines:[{name:"CC_RENDER_MODE",type:"number",range:[0,4]},{name:"CC_DRAW_WIRE_FRAME",type:"boolean"},{name:"CC_USE_WORLD_SPACE",type:"boolean"},{name:"CC_USE_HDR",type:"boolean"}],blocks:[{name:"Constants",defines:[],binding:0,stageFlags:1,members:[{name:"mainTiling_Offset",type:16,count:1},{name:"frameTile_velLenScale",type:16,count:1},{name:"scale",type:16,count:1}]},{name:"FragConstants",defines:[],binding:1,stageFlags:16,members:[{name:"tintColor",type:16,count:1}]}],samplers:[{name:"mainTexture",type:28,count:1,defines:[],stageFlags:16,binding:2}],attributes:[{name:"a_position",type:15,count:1,defines:[],stageFlags:1,format:32,location:0},{name:"a_texCoord",type:16,count:1,defines:[],stageFlags:1,format:44,location:1},{name:"a_texCoord1",type:15,count:1,defines:[],stageFlags:1,format:32,location:2},{name:"a_texCoord2",type:15,count:1,defines:[],stageFlags:1,format:32,location:3},{name:"a_color",type:16,count:1,defines:[],stageFlags:1,format:44,location:4}]}]},{name:"particle",techniques:[{name:"add",passes:[{rasterizerState:{cullMode:0},blendState:{targets:[{blend:!0,blendSrc:2,blendDst:1,blendSrcAlpha:2,blendDstAlpha:1}]},program:"particle|particle-vs-legacy:lpvs_main|tinted-fs:add",depthStencilState:{depthTest:!0,depthWrite:!1},properties:{mainTexture:{value:"grey",type:28},mainTiling_Offset:{value:[1,1,0,0],type:16},tintColor:{value:[.5,.5,.5,.5],type:16}}}]}],shaders:[{name:"particle|particle-vs-legacy:lpvs_main|tinted-fs:add",hash:66662317,builtins:{globals:{blocks:[{name:"CCGlobal",defines:[]},{name:"CCCamera",defines:[]}],samplers:[]},locals:{blocks:[{name:"CCLocal",defines:[]}],samplers:[]}},defines:[{name:"CC_RENDER_MODE",type:"number",range:[0,4]},{name:"CC_USE_WORLD_SPACE",type:"boolean"},{name:"CC_USE_HDR",type:"boolean"}],blocks:[{name:"Constants",defines:[],binding:0,stageFlags:1,members:[{name:"mainTiling_Offset",type:16,count:1},{name:"frameTile_velLenScale",type:16,count:1},{name:"scale",type:16,count:1}]},{name:"FragConstants",defines:[],binding:1,stageFlags:16,members:[{name:"tintColor",type:16,count:1}]}],samplers:[{name:"mainTexture",type:28,count:1,defines:[],stageFlags:16,binding:2}],attributes:[{name:"a_position",type:15,count:1,defines:[],stageFlags:1,format:32,location:0},{name:"a_texCoord",type:15,count:1,defines:[],stageFlags:1,format:32,location:1},{name:"a_texCoord1",type:15,count:1,defines:[],stageFlags:1,format:32,location:2},{name:"a_texCoord2",type:15,count:1,defines:[],stageFlags:1,format:32,location:3},{name:"a_color",type:16,count:1,defines:[],stageFlags:1,format:44,location:4},{name:"a_color1",type:15,count:1,defines:["CC_RENDER_MODE"],stageFlags:1,format:32,location:8},{name:"a_texCoord3",type:15,count:1,defines:["CC_RENDER_MODE"],stageFlags:1,format:32,location:6},{name:"a_normal",type:15,count:1,defines:["CC_RENDER_MODE"],stageFlags:1,format:32,location:7}]}]},{name:"spine",techniques:[{passes:[{blendState:{targets:[{blend:!0,blendSrc:2,blendDst:4,blendDstAlpha:4}]},rasterizerState:{cullMode:0},program:"spine|sprite-vs:vert|sprite-fs:frag",depthStencilState:{depthTest:!1,depthWrite:!1},properties:{alphaThreshold:{value:[.5],type:13}}}]}],shaders:[{name:"spine|sprite-vs:vert|sprite-fs:frag",hash:4078504952,builtins:{globals:{blocks:[{name:"CCGlobal",defines:[]},{name:"CCCamera",defines:[]}],samplers:[]},locals:{blocks:[{name:"CCLocal",defines:["USE_LOCAL"]}],samplers:[{name:"cc_spriteTexture",defines:[]}]}},defines:[{name:"USE_LOCAL",type:"boolean"},{name:"TWO_COLORED",type:"boolean"},{name:"USE_ALPHA_TEST",type:"boolean"}],blocks:[{name:"ALPHA_TEST_DATA",defines:["USE_ALPHA_TEST"],binding:0,stageFlags:16,members:[{name:"alphaThreshold",type:13,count:1}]}],samplers:[],attributes:[{name:"a_position",type:15,count:1,defines:[],stageFlags:1,format:32,location:0},{name:"a_texCoord",type:14,count:1,defines:[],stageFlags:1,format:21,location:1},{name:"a_color",type:16,count:1,defines:[],stageFlags:1,format:44,location:2},{name:"a_color2",type:16,count:1,defines:["TWO_COLORED"],stageFlags:1,format:44,location:3}]}]},{name:"sprite",techniques:[{passes:[{blendState:{targets:[{blend:!0,blendSrc:2,blendDst:4,blendDstAlpha:4}]},rasterizerState:{cullMode:0},program:"sprite|sprite-vs:vert|sprite-fs:frag",depthStencilState:{depthTest:!1,depthWrite:!1},properties:{alphaThreshold:{value:[.5],type:13}}}]}],shaders:[{name:"sprite|sprite-vs:vert|sprite-fs:frag",hash:3990469549,builtins:{globals:{blocks:[{name:"CCGlobal",defines:[]},{name:"CCCamera",defines:[]}],samplers:[]},locals:{blocks:[{name:"CCLocal",defines:["USE_LOCAL"]}],samplers:[{name:"cc_spriteTexture",defines:["USE_TEXTURE"]}]}},defines:[{name:"USE_LOCAL",type:"boolean"},{name:"USE_PIXEL_ALIGNMENT",type:"boolean"},{name:"CC_USE_EMBEDDED_ALPHA",type:"boolean"},{name:"USE_ALPHA_TEST",type:"boolean"},{name:"USE_TEXTURE",type:"boolean"},{name:"IS_GRAY",type:"boolean"}],blocks:[{name:"ALPHA_TEST_DATA",defines:["USE_ALPHA_TEST"],binding:0,stageFlags:16,members:[{name:"alphaThreshold",type:13,count:1}]}],samplers:[],attributes:[{name:"a_position",type:15,count:1,defines:[],stageFlags:1,format:32,location:0},{name:"a_texCoord",type:14,count:1,defines:[],stageFlags:1,format:21,location:1},{name:"a_color",type:16,count:1,defines:[],stageFlags:1,format:44,location:2}]}]},{name:"standard",techniques:[{name:"opaque",passes:[{program:"standard|standard-vs:vert|standard-fs:frag",properties:{tilingOffset:{value:[1,1,0,0],type:16},mainColor:{value:[1,1,1,1],type:16,handleInfo:["albedo",0,16]},albedoScale:{value:[1,1,1],type:15,handleInfo:["albedoScaleAndCutoff",0,15]},alphaThreshold:{value:[.5],type:13,handleInfo:["albedoScaleAndCutoff",3,13]},occlusion:{value:[1],type:13,handleInfo:["pbrParams",0,13]},roughness:{value:[.8],type:13,handleInfo:["pbrParams",1,13]},metallic:{value:[.6],type:13,handleInfo:["pbrParams",2,13]},normalStrenth:{value:[1],type:13,handleInfo:["pbrParams",3,13]},emissive:{value:[0,0,0,1],type:16},emissiveScale:{value:[1,1,1],type:15,handleInfo:["emissiveScaleParam",0,15]},mainTexture:{value:"grey",type:28,handleInfo:["albedoMap",0,28]},normalMap:{value:"normal",type:28},pbrMap:{value:"grey",type:28},metallicRoughnessMap:{value:"grey",type:28},occlusionMap:{value:"white",type:28},emissiveMap:{value:"grey",type:28},albedo:{type:16,value:[1,1,1,1]},albedoScaleAndCutoff:{type:16,value:[1,1,1,.5]},pbrParams:{type:16,value:[1,.8,.6,1]},emissiveScaleParam:{type:16,value:[1,1,1,0]},albedoMap:{type:28,value:"grey"}}},{phase:"forward-add",propertyIndex:0,embeddedMacros:{CC_FORWARD_ADD:!0},blendState:{targets:[{blend:!0,blendSrc:1,blendDst:1,blendSrcAlpha:0,blendDstAlpha:1}]},program:"standard|standard-vs:vert|standard-fs:frag",depthStencilState:{depthFunc:2,depthTest:!0,depthWrite:!1},properties:{tilingOffset:{value:[1,1,0,0],type:16},mainColor:{value:[1,1,1,1],type:16,handleInfo:["albedo",0,16]},albedoScale:{value:[1,1,1],type:15,handleInfo:["albedoScaleAndCutoff",0,15]},alphaThreshold:{value:[.5],type:13,handleInfo:["albedoScaleAndCutoff",3,13]},occlusion:{value:[1],type:13,handleInfo:["pbrParams",0,13]},roughness:{value:[.8],type:13,handleInfo:["pbrParams",1,13]},metallic:{value:[.6],type:13,handleInfo:["pbrParams",2,13]},normalStrenth:{value:[1],type:13,handleInfo:["pbrParams",3,13]},emissive:{value:[0,0,0,1],type:16},emissiveScale:{value:[1,1,1],type:15,handleInfo:["emissiveScaleParam",0,15]},mainTexture:{value:"grey",type:28,handleInfo:["albedoMap",0,28]},normalMap:{value:"normal",type:28},pbrMap:{value:"grey",type:28},metallicRoughnessMap:{value:"grey",type:28},occlusionMap:{value:"white",type:28},emissiveMap:{value:"grey",type:28},albedo:{type:16,value:[1,1,1,1]},albedoScaleAndCutoff:{type:16,value:[1,1,1,.5]},pbrParams:{type:16,value:[1,.8,.6,1]},emissiveScaleParam:{type:16,value:[1,1,1,0]},albedoMap:{type:28,value:"grey"}}},{phase:"shadow-caster",propertyIndex:0,rasterizerState:{cullMode:1},program:"standard|shadow-caster-vs:vert|shadow-caster-fs:frag",properties:{tilingOffset:{value:[1,1,0,0],type:16},mainColor:{value:[1,1,1,1],type:16,handleInfo:["albedo",0,16]},albedoScale:{value:[1,1,1],type:15,handleInfo:["albedoScaleAndCutoff",0,15]},alphaThreshold:{value:[.5],type:13,handleInfo:["albedoScaleAndCutoff",3,13]},occlusion:{value:[1],type:13,handleInfo:["pbrParams",0,13]},roughness:{value:[.8],type:13,handleInfo:["pbrParams",1,13]},metallic:{value:[.6],type:13,handleInfo:["pbrParams",2,13]},normalStrenth:{value:[1],type:13,handleInfo:["pbrParams",3,13]},emissive:{value:[0,0,0,1],type:16},emissiveScale:{value:[1,1,1],type:15,handleInfo:["emissiveScaleParam",0,15]},mainTexture:{value:"grey",type:28,handleInfo:["albedoMap",0,28]},albedo:{type:16,value:[1,1,1,1]},albedoScaleAndCutoff:{type:16,value:[1,1,1,.5]},pbrParams:{type:16,value:[1,.8,.6,1]},emissiveScaleParam:{type:16,value:[1,1,1,0]},albedoMap:{type:28,value:"grey"}}}]}],shaders:[{name:"standard|standard-vs:vert|standard-fs:frag",hash:2668109714,builtins:{globals:{blocks:[{name:"CCGlobal",defines:[]},{name:"CCCamera",defines:[]},{name:"CCShadow",defines:[]}],samplers:[{name:"cc_environment",defines:["CC_USE_IBL"]},{name:"cc_shadowMap",defines:["CC_RECEIVE_SHADOW"]},{name:"cc_spotLightingMap",defines:["CC_RECEIVE_SHADOW"]}]},locals:{blocks:[{name:"CCMorph",defines:["CC_USE_MORPH"]},{name:"CCSkinningTexture",defines:["CC_USE_SKINNING","CC_USE_BAKED_ANIMATION"]},{name:"CCSkinningAnimation",defines:["CC_USE_SKINNING","CC_USE_BAKED_ANIMATION"]},{name:"CCSkinning",defines:["CC_USE_SKINNING","!CC_USE_BAKED_ANIMATION"]},{name:"CCLocalBatched",defines:["!USE_INSTANCING","USE_BATCHING"]},{name:"CCLocal",defines:["!USE_INSTANCING","!USE_BATCHING"]},{name:"CCForwardLight",defines:["CC_FORWARD_ADD"]}],samplers:[{name:"cc_PositionDisplacements",defines:["CC_USE_MORPH","CC_MORPH_TARGET_HAS_POSITION"]},{name:"cc_NormalDisplacements",defines:["CC_USE_MORPH","CC_MORPH_TARGET_HAS_NORMAL"]},{name:"cc_TangentDisplacements",defines:["CC_USE_MORPH","CC_MORPH_TARGET_HAS_TANGENT"]},{name:"cc_jointTexture",defines:["CC_USE_SKINNING","CC_USE_BAKED_ANIMATION"]},{name:"cc_lightingMap",defines:["USE_LIGHTMAP","!USE_BATCHING","!CC_FORWARD_ADD"]}]}},defines:[{name:"CC_USE_MORPH",type:"boolean"},{name:"CC_MORPH_TARGET_COUNT",type:"number",range:[2,8]},{name:"CC_SUPPORT_FLOAT_TEXTURE",type:"boolean"},{name:"CC_MORPH_PRECOMPUTED",type:"boolean"},{name:"CC_MORPH_TARGET_HAS_POSITION",type:"boolean"},{name:"CC_MORPH_TARGET_HAS_NORMAL",type:"boolean"},{name:"CC_MORPH_TARGET_HAS_TANGENT",type:"boolean"},{name:"CC_USE_SKINNING",type:"boolean"},{name:"CC_USE_BAKED_ANIMATION",type:"boolean"},{name:"USE_INSTANCING",type:"boolean"},{name:"USE_BATCHING",type:"boolean"},{name:"USE_LIGHTMAP",type:"boolean"},{name:"CC_USE_FOG",type:"number",range:[0,4]},{name:"CC_FORWARD_ADD",type:"boolean"},{name:"USE_VERTEX_COLOR",type:"boolean"},{name:"USE_NORMAL_MAP",type:"boolean"},{name:"HAS_SECOND_UV",type:"boolean"},{name:"CC_USE_IBL",type:"number",range:[0,2]},{name:"CC_RECEIVE_SHADOW",type:"boolean"},{name:"CC_USE_HDR",type:"boolean"},{name:"USE_ALBEDO_MAP",type:"boolean"},{name:"ALBEDO_UV",type:"string",options:["v_uv","v_uv1"]},{name:"NORMAL_UV",type:"string",options:["v_uv","v_uv1"]},{name:"PBR_UV",type:"string",options:["v_uv","v_uv1"]},{name:"USE_PBR_MAP",type:"boolean"},{name:"USE_METALLIC_ROUGHNESS_MAP",type:"boolean"},{name:"USE_OCCLUSION_MAP",type:"boolean"},{name:"USE_EMISSIVE_MAP",type:"boolean"},{name:"EMISSIVE_UV",type:"string",options:["v_uv","v_uv1"]},{name:"USE_ALPHA_TEST",type:"boolean"},{name:"ALPHA_TEST_CHANNEL",type:"string",options:["a","r"]}],blocks:[{name:"Constants",defines:[],binding:0,stageFlags:17,members:[{name:"tilingOffset",type:16,count:1},{name:"albedo",type:16,count:1},{name:"albedoScaleAndCutoff",type:16,count:1},{name:"pbrParams",type:16,count:1},{name:"emissive",type:16,count:1},{name:"emissiveScaleParam",type:16,count:1}]}],samplers:[{name:"albedoMap",type:28,count:1,defines:["USE_ALBEDO_MAP"],stageFlags:16,binding:1},{name:"normalMap",type:28,count:1,defines:["USE_NORMAL_MAP"],stageFlags:16,binding:2},{name:"pbrMap",type:28,count:1,defines:["USE_PBR_MAP"],stageFlags:16,binding:3},{name:"metallicRoughnessMap",type:28,count:1,defines:["USE_METALLIC_ROUGHNESS_MAP"],stageFlags:16,binding:4},{name:"occlusionMap",type:28,count:1,defines:["USE_OCCLUSION_MAP"],stageFlags:16,binding:5},{name:"emissiveMap",type:28,count:1,defines:["USE_EMISSIVE_MAP"],stageFlags:16,binding:6}],attributes:[{name:"a_position",type:15,count:1,defines:[],stageFlags:1,format:32,location:0},{name:"a_normal",type:15,count:1,defines:[],stageFlags:1,format:32,location:1},{name:"a_texCoord",type:14,count:1,defines:[],stageFlags:1,format:21,location:2},{name:"a_tangent",type:16,count:1,defines:[],stageFlags:1,format:44,location:3},{name:"a_vertexId",type:13,count:1,defines:["CC_USE_MORPH"],stageFlags:1,format:11,location:6},{name:"a_joints",type:12,count:1,defines:["CC_USE_SKINNING"],stageFlags:1,format:42,location:4},{name:"a_weights",type:16,count:1,defines:["CC_USE_SKINNING"],stageFlags:1,format:44,location:5},{name:"a_jointAnimInfo",type:16,count:1,defines:["CC_USE_SKINNING","CC_USE_BAKED_ANIMATION","USE_INSTANCING"],stageFlags:1,format:44,isInstanced:!0,location:7},{name:"a_matWorld0",type:16,count:1,defines:["USE_INSTANCING"],stageFlags:1,format:44,isInstanced:!0,location:8},{name:"a_matWorld1",type:16,count:1,defines:["USE_INSTANCING"],stageFlags:1,format:44,isInstanced:!0,location:9},{name:"a_matWorld2",type:16,count:1,defines:["USE_INSTANCING"],stageFlags:1,format:44,isInstanced:!0,location:10},{name:"a_lightingMapUVParam",type:16,count:1,defines:["USE_INSTANCING","USE_LIGHTMAP"],stageFlags:1,format:44,isInstanced:!0,location:11},{name:"a_dyn_batch_id",type:13,count:1,defines:["!USE_INSTANCING","USE_BATCHING"],stageFlags:1,format:11,location:12},{name:"a_color",type:16,count:1,defines:["USE_VERTEX_COLOR"],stageFlags:1,format:44,location:13},{name:"a_texCoord1",type:14,count:1,defines:[],stageFlags:1,format:21,location:14}]},{name:"standard|shadow-caster-vs:vert|shadow-caster-fs:frag",hash:3020491,builtins:{globals:{blocks:[{name:"CCShadow",defines:[]}],samplers:[]},locals:{blocks:[{name:"CCMorph",defines:["CC_USE_MORPH"]},{name:"CCSkinningTexture",defines:["CC_USE_SKINNING","CC_USE_BAKED_ANIMATION"]},{name:"CCSkinningAnimation",defines:["CC_USE_SKINNING","CC_USE_BAKED_ANIMATION"]},{name:"CCSkinning",defines:["CC_USE_SKINNING","!CC_USE_BAKED_ANIMATION"]},{name:"CCLocalBatched",defines:["!USE_INSTANCING","USE_BATCHING"]},{name:"CCLocal",defines:["!USE_INSTANCING","!USE_BATCHING"]}],samplers:[{name:"cc_PositionDisplacements",defines:["CC_USE_MORPH","CC_MORPH_TARGET_HAS_POSITION"]},{name:"cc_NormalDisplacements",defines:["CC_USE_MORPH","CC_MORPH_TARGET_HAS_NORMAL"]},{name:"cc_TangentDisplacements",defines:["CC_USE_MORPH","CC_MORPH_TARGET_HAS_TANGENT"]},{name:"cc_jointTexture",defines:["CC_USE_SKINNING","CC_USE_BAKED_ANIMATION"]}]}},defines:[{name:"CC_USE_MORPH",type:"boolean"},{name:"CC_MORPH_TARGET_COUNT",type:"number",range:[2,8]},{name:"CC_SUPPORT_FLOAT_TEXTURE",type:"boolean"},{name:"CC_MORPH_PRECOMPUTED",type:"boolean"},{name:"CC_MORPH_TARGET_HAS_POSITION",type:"boolean"},{name:"CC_MORPH_TARGET_HAS_NORMAL",type:"boolean"},{name:"CC_MORPH_TARGET_HAS_TANGENT",type:"boolean"},{name:"CC_USE_SKINNING",type:"boolean"},{name:"CC_USE_BAKED_ANIMATION",type:"boolean"},{name:"USE_INSTANCING",type:"boolean"},{name:"USE_BATCHING",type:"boolean"},{name:"USE_LIGHTMAP",type:"boolean"},{name:"HAS_SECOND_UV",type:"boolean"},{name:"USE_ALBEDO_MAP",type:"boolean"},{name:"ALBEDO_UV",type:"string",options:["v_uv","v_uv1"]},{name:"USE_ALPHA_TEST",type:"boolean"},{name:"ALPHA_TEST_CHANNEL",type:"string",options:["a","r"]}],blocks:[{name:"Constants",defines:[],binding:0,stageFlags:17,members:[{name:"tilingOffset",type:16,count:1},{name:"albedo",type:16,count:1},{name:"albedoScaleAndCutoff",type:16,count:1},{name:"pbrParams",type:16,count:1},{name:"emissive",type:16,count:1},{name:"emissiveScaleParam",type:16,count:1}]}],samplers:[{name:"albedoMap",type:28,count:1,defines:["USE_ALBEDO_MAP"],stageFlags:16,binding:1}],attributes:[{name:"a_position",type:15,count:1,defines:[],stageFlags:1,format:32,location:0},{name:"a_normal",type:15,count:1,defines:[],stageFlags:1,format:32,location:1},{name:"a_texCoord",type:14,count:1,defines:[],stageFlags:1,format:21,location:2},{name:"a_tangent",type:16,count:1,defines:[],stageFlags:1,format:44,location:3},{name:"a_vertexId",type:13,count:1,defines:["CC_USE_MORPH"],stageFlags:1,format:11,location:6},{name:"a_joints",type:12,count:1,defines:["CC_USE_SKINNING"],stageFlags:1,format:42,location:4},{name:"a_weights",type:16,count:1,defines:["CC_USE_SKINNING"],stageFlags:1,format:44,location:5},{name:"a_jointAnimInfo",type:16,count:1,defines:["CC_USE_SKINNING","CC_USE_BAKED_ANIMATION","USE_INSTANCING"],stageFlags:1,format:44,isInstanced:!0,location:7},{name:"a_matWorld0",type:16,count:1,defines:["USE_INSTANCING"],stageFlags:1,format:44,isInstanced:!0,location:8},{name:"a_matWorld1",type:16,count:1,defines:["USE_INSTANCING"],stageFlags:1,format:44,isInstanced:!0,location:9},{name:"a_matWorld2",type:16,count:1,defines:["USE_INSTANCING"],stageFlags:1,format:44,isInstanced:!0,location:10},{name:"a_lightingMapUVParam",type:16,count:1,defines:["USE_INSTANCING","USE_LIGHTMAP"],stageFlags:1,format:44,isInstanced:!0,location:11},{name:"a_dyn_batch_id",type:13,count:1,defines:["!USE_INSTANCING","USE_BATCHING"],stageFlags:1,format:11,location:12},{name:"a_texCoord1",type:14,count:1,defines:[],stageFlags:1,format:21,location:13}]}]},{name:"terrain",techniques:[{name:"opaque",passes:[{program:"terrain|terrain-vs:vert|terrain-fs:frag",properties:{UVScale:{value:[1,1,1,1],type:16},lightMapUVParam:{value:[0,0,0,0],type:16},metallic:{value:[0,0,0,0],type:16},roughness:{value:[1,1,1,1],type:16},weightMap:{value:"black",type:28},detailMap0:{value:"grey",type:28},detailMap1:{value:"grey",type:28},detailMap2:{value:"grey",type:28},detailMap3:{value:"grey",type:28},normalMap0:{value:"normal-texture",type:28},normalMap1:{value:"normal-texture",type:28},normalMap2:{value:"normal-texture",type:28},normalMap3:{value:"normal-texture",type:28},lightMap:{value:"grey",type:28}}},{phase:"forward-add",propertyIndex:0,embeddedMacros:{CC_FORWARD_ADD:!0},blendState:{targets:[{blend:!0,blendSrc:1,blendDst:1,blendSrcAlpha:0,blendDstAlpha:1}]},program:"terrain|terrain-vs:vert|terrain-fs:frag",depthStencilState:{depthFunc:2,depthTest:!0,depthWrite:!1},properties:{UVScale:{value:[1,1,1,1],type:16},lightMapUVParam:{value:[0,0,0,0],type:16},metallic:{value:[0,0,0,0],type:16},roughness:{value:[1,1,1,1],type:16},weightMap:{value:"black",type:28},detailMap0:{value:"grey",type:28},detailMap1:{value:"grey",type:28},detailMap2:{value:"grey",type:28},detailMap3:{value:"grey",type:28},normalMap0:{value:"normal-texture",type:28},normalMap1:{value:"normal-texture",type:28},normalMap2:{value:"normal-texture",type:28},normalMap3:{value:"normal-texture",type:28},lightMap:{value:"grey",type:28}}},{phase:"shadow-add",propertyIndex:0,rasterizerState:{cullMode:2},program:"terrain|shadow-caster-vs:vert|shadow-caster-fs:frag"}]}],shaders:[{name:"terrain|terrain-vs:vert|terrain-fs:frag",hash:2952542850,builtins:{globals:{blocks:[{name:"CCGlobal",defines:[]},{name:"CCCamera",defines:[]},{name:"CCShadow",defines:[]}],samplers:[{name:"cc_environment",defines:["CC_USE_IBL"]},{name:"cc_shadowMap",defines:["CC_RECEIVE_SHADOW"]},{name:"cc_spotLightingMap",defines:["CC_RECEIVE_SHADOW"]}]},locals:{blocks:[{name:"CCLocal",defines:[]},{name:"CCForwardLight",defines:["CC_FORWARD_ADD"]}],samplers:[]}},defines:[{name:"CC_USE_FOG",type:"number",range:[0,4]},{name:"CC_FORWARD_ADD",type:"boolean"},{name:"USE_NORMALMAP",type:"boolean"},{name:"USE_LIGHTMAP",type:"boolean"},{name:"CC_USE_IBL",type:"number",range:[0,2]},{name:"CC_RECEIVE_SHADOW",type:"boolean"},{name:"USE_BATCHING",type:"boolean"},{name:"CC_USE_HDR",type:"boolean"},{name:"LAYERS",type:"number",range:[0,4]},{name:"USE_PBR",type:"boolean"}],blocks:[{name:"TexCoords",defines:[],binding:0,stageFlags:1,members:[{name:"UVScale",type:16,count:1},{name:"lightMapUVParam",type:16,count:1}]},{name:"PbrParams",defines:[],binding:1,stageFlags:16,members:[{name:"metallic",type:16,count:1},{name:"roughness",type:16,count:1}]}],samplers:[{name:"weightMap",type:28,count:1,defines:[],stageFlags:16,binding:2},{name:"detailMap0",type:28,count:1,defines:[],stageFlags:16,binding:3},{name:"detailMap1",type:28,count:1,defines:[],stageFlags:16,binding:4},{name:"detailMap2",type:28,count:1,defines:[],stageFlags:16,binding:5},{name:"detailMap3",type:28,count:1,defines:[],stageFlags:16,binding:6},{name:"normalMap0",type:28,count:1,defines:[],stageFlags:16,binding:7},{name:"normalMap1",type:28,count:1,defines:[],stageFlags:16,binding:8},{name:"normalMap2",type:28,count:1,defines:[],stageFlags:16,binding:9},{name:"normalMap3",type:28,count:1,defines:[],stageFlags:16,binding:10},{name:"lightMap",type:28,count:1,defines:[],stageFlags:16,binding:11}],attributes:[{name:"a_position",type:15,count:1,defines:[],stageFlags:1,format:32,location:0},{name:"a_normal",type:15,count:1,defines:[],stageFlags:1,format:32,location:1},{name:"a_texCoord",type:14,count:1,defines:[],stageFlags:1,format:21,location:2}]},{name:"terrain|shadow-caster-vs:vert|shadow-caster-fs:frag",hash:3874167763,builtins:{globals:{blocks:[{name:"CCGlobal",defines:[]},{name:"CCCamera",defines:[]},{name:"CCShadow",defines:[]}],samplers:[]},locals:{blocks:[{name:"CCLocal",defines:[]}],samplers:[]}},defines:[],blocks:[],samplers:[],attributes:[{name:"a_position",type:15,count:1,defines:[],stageFlags:1,format:32,location:0},{name:"a_normal",type:15,count:1,defines:[],stageFlags:1,format:32,location:1},{name:"a_texCoord",type:14,count:1,defines:[],stageFlags:1,format:21,location:2}]}]},{name:"unlit",techniques:[{name:"opaque",passes:[{program:"unlit|unlit-vs:vert|unlit-fs:frag",properties:{mainTexture:{value:"grey",type:28},tilingOffset:{value:[1,1,0,0],type:16},mainColor:{value:[1,1,1,1],type:16},colorScale:{value:[1,1,1],type:15,handleInfo:["colorScaleAndCutoff",0,15]},alphaThreshold:{value:[.5],type:13,handleInfo:["colorScaleAndCutoff",3,13]},color:{type:16,handleInfo:["mainColor",0,16]},colorScaleAndCutoff:{type:16,value:[1,1,1,.5]}}}]}],shaders:[{name:"unlit|unlit-vs:vert|unlit-fs:frag",hash:3822871803,builtins:{globals:{blocks:[{name:"CCGlobal",defines:[]},{name:"CCCamera",defines:[]}],samplers:[]},locals:{blocks:[{name:"CCMorph",defines:["CC_USE_MORPH"]},{name:"CCSkinningTexture",defines:["CC_USE_SKINNING","CC_USE_BAKED_ANIMATION"]},{name:"CCSkinningAnimation",defines:["CC_USE_SKINNING","CC_USE_BAKED_ANIMATION"]},{name:"CCSkinning",defines:["CC_USE_SKINNING","!CC_USE_BAKED_ANIMATION"]},{name:"CCLocalBatched",defines:["!USE_INSTANCING","USE_BATCHING"]},{name:"CCLocal",defines:["!USE_INSTANCING","!USE_BATCHING"]}],samplers:[{name:"cc_PositionDisplacements",defines:["CC_USE_MORPH","CC_MORPH_TARGET_HAS_POSITION"]},{name:"cc_NormalDisplacements",defines:["CC_USE_MORPH","CC_MORPH_TARGET_HAS_NORMAL"]},{name:"cc_TangentDisplacements",defines:["CC_USE_MORPH","CC_MORPH_TARGET_HAS_TANGENT"]},{name:"cc_jointTexture",defines:["CC_USE_SKINNING","CC_USE_BAKED_ANIMATION"]}]}},defines:[{name:"CC_USE_MORPH",type:"boolean"},{name:"CC_MORPH_TARGET_COUNT",type:"number",range:[2,8]},{name:"CC_SUPPORT_FLOAT_TEXTURE",type:"boolean"},{name:"CC_MORPH_PRECOMPUTED",type:"boolean"},{name:"CC_MORPH_TARGET_HAS_POSITION",type:"boolean"},{name:"CC_MORPH_TARGET_HAS_NORMAL",type:"boolean"},{name:"CC_MORPH_TARGET_HAS_TANGENT",type:"boolean"},{name:"CC_USE_SKINNING",type:"boolean"},{name:"CC_USE_BAKED_ANIMATION",type:"boolean"},{name:"USE_INSTANCING",type:"boolean"},{name:"USE_BATCHING",type:"boolean"},{name:"USE_LIGHTMAP",type:"boolean"},{name:"CC_USE_FOG",type:"number",range:[0,4]},{name:"CC_FORWARD_ADD",type:"boolean"},{name:"USE_VERTEX_COLOR",type:"boolean"},{name:"USE_TEXTURE",type:"boolean"},{name:"CC_USE_HDR",type:"boolean"},{name:"USE_ALPHA_TEST",type:"boolean"},{name:"ALPHA_TEST_CHANNEL",type:"string",options:["a","r","g","b"]}],blocks:[{name:"TexCoords",defines:["USE_TEXTURE"],binding:0,stageFlags:1,members:[{name:"tilingOffset",type:16,count:1}]},{name:"Constant",defines:[],binding:1,stageFlags:16,members:[{name:"mainColor",type:16,count:1},{name:"colorScaleAndCutoff",type:16,count:1}]}],samplers:[{name:"mainTexture",type:28,count:1,defines:["USE_TEXTURE"],stageFlags:16,binding:2}],attributes:[{name:"a_position",type:15,count:1,defines:[],stageFlags:1,format:32,location:0},{name:"a_normal",type:15,count:1,defines:[],stageFlags:1,format:32,location:1},{name:"a_texCoord",type:14,count:1,defines:[],stageFlags:1,format:21,location:2},{name:"a_tangent",type:16,count:1,defines:[],stageFlags:1,format:44,location:3},{name:"a_vertexId",type:13,count:1,defines:["CC_USE_MORPH"],stageFlags:1,format:11,location:6},{name:"a_joints",type:12,count:1,defines:["CC_USE_SKINNING"],stageFlags:1,format:42,location:4},{name:"a_weights",type:16,count:1,defines:["CC_USE_SKINNING"],stageFlags:1,format:44,location:5},{name:"a_jointAnimInfo",type:16,count:1,defines:["CC_USE_SKINNING","CC_USE_BAKED_ANIMATION","USE_INSTANCING"],stageFlags:1,format:44,isInstanced:!0,location:7},{name:"a_matWorld0",type:16,count:1,defines:["USE_INSTANCING"],stageFlags:1,format:44,isInstanced:!0,location:8},{name:"a_matWorld1",type:16,count:1,defines:["USE_INSTANCING"],stageFlags:1,format:44,isInstanced:!0,location:9},{name:"a_matWorld2",type:16,count:1,defines:["USE_INSTANCING"],stageFlags:1,format:44,isInstanced:!0,location:10},{name:"a_lightingMapUVParam",type:16,count:1,defines:["USE_INSTANCING","USE_LIGHTMAP"],stageFlags:1,format:44,isInstanced:!0,location:11},{name:"a_dyn_batch_id",type:13,count:1,defines:["!USE_INSTANCING","USE_BATCHING"],stageFlags:1,format:11,location:12},{name:"a_color",type:16,count:1,defines:["USE_VERTEX_COLOR"],stageFlags:1,format:44,location:13}]}]},{name:"planar-shadow",techniques:[{passes:[{phase:"planarShadow",blendState:{targets:[{blend:!0,blendSrc:2,blendDst:4,blendDstAlpha:4}]},program:"planar-shadow|planar-shadow-vs:vert|planar-shadow-fs:frag",depthStencilState:{depthTest:!0,depthWrite:!1,stencilTestFront:!0,stencilFuncFront:5,stencilPassOpFront:2,stencilRefBack:128,stencilRefFront:128,stencilReadMaskBack:128,stencilReadMaskFront:128,stencilWriteMaskBack:128,stencilWriteMaskFront:128}}]}],shaders:[{name:"planar-shadow|planar-shadow-vs:vert|planar-shadow-fs:frag",hash:2901856202,builtins:{globals:{blocks:[{name:"CCGlobal",defines:[]},{name:"CCCamera",defines:[]},{name:"CCShadow",defines:[]}],samplers:[]},locals:{blocks:[{name:"CCMorph",defines:["CC_USE_MORPH"]},{name:"CCSkinningTexture",defines:["CC_USE_SKINNING","CC_USE_BAKED_ANIMATION"]},{name:"CCSkinningAnimation",defines:["CC_USE_SKINNING","CC_USE_BAKED_ANIMATION"]},{name:"CCSkinning",defines:["CC_USE_SKINNING","!CC_USE_BAKED_ANIMATION"]},{name:"CCLocalBatched",defines:["!USE_INSTANCING","USE_BATCHING"]},{name:"CCLocal",defines:["!USE_INSTANCING","!USE_BATCHING"]}],samplers:[{name:"cc_PositionDisplacements",defines:["CC_USE_MORPH","CC_MORPH_TARGET_HAS_POSITION"]},{name:"cc_NormalDisplacements",defines:["CC_USE_MORPH","CC_MORPH_TARGET_HAS_NORMAL"]},{name:"cc_TangentDisplacements",defines:["CC_USE_MORPH","CC_MORPH_TARGET_HAS_TANGENT"]},{name:"cc_jointTexture",defines:["CC_USE_SKINNING","CC_USE_BAKED_ANIMATION"]}]}},defines:[{name:"CC_USE_MORPH",type:"boolean"},{name:"CC_MORPH_TARGET_COUNT",type:"number",range:[2,8]},{name:"CC_SUPPORT_FLOAT_TEXTURE",type:"boolean"},{name:"CC_MORPH_PRECOMPUTED",type:"boolean"},{name:"CC_MORPH_TARGET_HAS_POSITION",type:"boolean"},{name:"CC_MORPH_TARGET_HAS_NORMAL",type:"boolean"},{name:"CC_MORPH_TARGET_HAS_TANGENT",type:"boolean"},{name:"CC_USE_SKINNING",type:"boolean"},{name:"CC_USE_BAKED_ANIMATION",type:"boolean"},{name:"USE_INSTANCING",type:"boolean"},{name:"USE_BATCHING",type:"boolean"},{name:"USE_LIGHTMAP",type:"boolean"},{name:"CC_USE_HDR",type:"boolean"}],blocks:[],samplers:[],attributes:[{name:"a_position",type:15,count:1,defines:[],stageFlags:1,format:32,location:0},{name:"a_normal",type:15,count:1,defines:[],stageFlags:1,format:32,location:1},{name:"a_texCoord",type:14,count:1,defines:[],stageFlags:1,format:21,location:2},{name:"a_tangent",type:16,count:1,defines:[],stageFlags:1,format:44,location:3},{name:"a_vertexId",type:13,count:1,defines:["CC_USE_MORPH"],stageFlags:1,format:11,location:6},{name:"a_joints",type:12,count:1,defines:["CC_USE_SKINNING"],stageFlags:1,format:42,location:4},{name:"a_weights",type:16,count:1,defines:["CC_USE_SKINNING"],stageFlags:1,format:44,location:5},{name:"a_jointAnimInfo",type:16,count:1,defines:["CC_USE_SKINNING","CC_USE_BAKED_ANIMATION","USE_INSTANCING"],stageFlags:1,format:44,isInstanced:!0,location:7},{name:"a_matWorld0",type:16,count:1,defines:["USE_INSTANCING"],stageFlags:1,format:44,isInstanced:!0,location:8},{name:"a_matWorld1",type:16,count:1,defines:["USE_INSTANCING"],stageFlags:1,format:44,isInstanced:!0,location:9},{name:"a_matWorld2",type:16,count:1,defines:["USE_INSTANCING"],stageFlags:1,format:44,isInstanced:!0,location:10},{name:"a_lightingMapUVParam",type:16,count:1,defines:["USE_INSTANCING","USE_LIGHTMAP"],stageFlags:1,format:44,isInstanced:!0,location:11},{name:"a_dyn_batch_id",type:13,count:1,defines:["!USE_INSTANCING","USE_BATCHING"],stageFlags:1,format:11,location:12}]}]},{name:"skybox",techniques:[{passes:[{rasterizerState:{cullMode:0},program:"skybox|sky-vs:vert|sky-fs:frag",priority:245,depthStencilState:{depthTest:!0,depthWrite:!1}}]}],shaders:[{name:"skybox|sky-vs:vert|sky-fs:frag",hash:2319917655,builtins:{globals:{blocks:[{name:"CCGlobal",defines:[]},{name:"CCCamera",defines:[]}],samplers:[{name:"cc_environment",defines:[]}]},locals:{blocks:[],samplers:[]}},defines:[{name:"CC_USE_IBL",type:"number",range:[0,2]},{name:"CC_USE_HDR",type:"boolean"},{name:"USE_RGBE_CUBEMAP",type:"boolean"}],blocks:[],samplers:[],attributes:[{name:"a_position",type:15,count:1,defines:[],stageFlags:1,format:32,location:0},{name:"a_normal",type:15,count:1,defines:[],stageFlags:1,format:32,location:1},{name:"a_texCoord",type:14,count:1,defines:[],stageFlags:1,format:21,location:2},{name:"a_tangent",type:16,count:1,defines:[],stageFlags:1,format:44,location:3}]}]},{name:"profiler",techniques:[{passes:[{blendState:{targets:[{blend:!0,blendSrc:2,blendDst:4,blendDstAlpha:4}]},rasterizerState:{cullMode:0},program:"profiler|profiler-vs:vert|profiler-fs:frag",depthStencilState:{depthTest:!1,depthWrite:!1}}]}],shaders:[{name:"profiler|profiler-vs:vert|profiler-fs:frag",hash:2029303284,builtins:{globals:{blocks:[{name:"CCGlobal",defines:[]},{name:"CCCamera",defines:[]}],samplers:[]},locals:{blocks:[],samplers:[]}},defines:[{name:"CC_USE_HDR",type:"boolean"}],blocks:[{name:"Constants",defines:[],binding:0,stageFlags:1,members:[{name:"offset",type:16,count:1}]},{name:"PerFrameInfo",defines:[],binding:1,stageFlags:1,members:[{name:"digits",type:16,count:20}]}],samplers:[{name:"mainTexture",type:28,count:1,defines:[],stageFlags:16,binding:2}],attributes:[{name:"a_position",type:15,count:1,defines:[],stageFlags:1,format:32,location:0},{name:"a_color",type:16,count:1,defines:[],stageFlags:1,format:44,location:1}]}]},{name:"splash-screen",techniques:[{passes:[{blendState:{targets:[{blend:!0,blendSrc:2,blendDst:4,blendDstAlpha:4}]},rasterizerState:{cullMode:0},program:"splash-screen|splash-screen-vs:vert|splash-screen-fs:frag",depthStencilState:{depthTest:!1,depthWrite:!1}}]}],shaders:[{name:"splash-screen|splash-screen-vs:vert|splash-screen-fs:frag",hash:2106901053,builtins:{globals:{blocks:[],samplers:[]},locals:{blocks:[],samplers:[]}},defines:[],blocks:[{name:"splashFrag",defines:[],binding:0,stageFlags:16,members:[{name:"u_precent",type:13,count:1}]}],samplers:[{name:"mainTexture",type:28,count:1,defines:[],stageFlags:16,binding:1}],attributes:[{name:"a_position",type:14,count:1,defines:[],stageFlags:1,format:21,location:0},{name:"a_texCoord",type:14,count:1,defines:[],stageFlags:1,format:21,location:1}]}]}]);!function(e){e[e.UBO=0]="UBO",e[e.SAMPLER=1]="SAMPLER"}(Nm||(Nm={}));var Mm=function(e,t,n,i,r){return void 0===r&&(r=0),e<<28&4026531840|i<<22&264241152|t<<20&3145728|n<<14&1032192|16383&r},Dm=function(e){return(4026531840&e)>>>28},Lm=function(e){return(264241152&e)>>>22},Fm=function(e){return(1032192&e)>>>14},zm=function(e){return 16383&e},Bm=function(e,t){return-264241153&e|t<<22&264241152},Um=((Rm={})[Xo.UNKNOWN]=function(){return console.warn("illegal uniform handle")},Rm[Xo.INT]=function(e,t,n){return void 0===n&&(n=0),e[n]},Rm[Xo.INT2]=function(e,t,n){return void 0===n&&(n=0),ti.fromArray(t,e,n)},Rm[Xo.INT3]=function(e,t,n){return void 0===n&&(n=0),Fn.fromArray(t,e,n)},Rm[Xo.INT4]=function(e,t,n){return void 0===n&&(n=0),oi.fromArray(t,e,n)},Rm[Xo.FLOAT]=function(e,t,n){return void 0===n&&(n=0),e[n]},Rm[Xo.FLOAT2]=function(e,t,n){return void 0===n&&(n=0),ti.fromArray(t,e,n)},Rm[Xo.FLOAT3]=function(e,t,n){return void 0===n&&(n=0),Fn.fromArray(t,e,n)},Rm[Xo.FLOAT4]=function(e,t,n){return void 0===n&&(n=0),oi.fromArray(t,e,n)},Rm[Xo.MAT3]=function(e,t,n){return void 0===n&&(n=0),Gn.fromArray(t,e,n)},Rm[Xo.MAT4]=function(e,t,n){return void 0===n&&(n=0),Zn.fromArray(t,e,n)},Rm),Gm=((Om={})[Xo.UNKNOWN]=function(){return console.warn("illegal uniform handle")},Om[Xo.INT]=function(e,t,n){return void 0===n&&(n=0),e[n]=t},Om[Xo.INT2]=function(e,t,n){return void 0===n&&(n=0),ti.toArray(e,t,n)},Om[Xo.INT3]=function(e,t,n){return void 0===n&&(n=0),Fn.toArray(e,t,n)},Om[Xo.INT4]=function(e,t,n){return void 0===n&&(n=0),oi.toArray(e,t,n)},Om[Xo.FLOAT]=function(e,t,n){return void 0===n&&(n=0),e[n]=t},Om[Xo.FLOAT2]=function(e,t,n){return void 0===n&&(n=0),ti.toArray(e,t,n)},Om[Xo.FLOAT3]=function(e,t,n){return void 0===n&&(n=0),Fn.toArray(e,t,n)},Om[Xo.FLOAT4]=function(e,t,n){return void 0===n&&(n=0),oi.toArray(e,t,n)},Om[Xo.MAT3]=function(e,t,n){return void 0===n&&(n=0),Gn.toArray(e,t,n)},Om[Xo.MAT4]=function(e,t,n){return void 0===n&&(n=0),Zn.toArray(e,t,n)},Om),Hm=[Object.freeze([0]),Object.freeze([0,0]),Object.freeze([0,0,0,0]),Object.freeze([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])];function km(e){switch(e){case Xo.BOOL:case Xo.INT:case Xo.UINT:case Xo.FLOAT:return Hm[0];case Xo.BOOL2:case Xo.INT2:case Xo.UINT2:case Xo.FLOAT2:return Hm[1];case Xo.BOOL4:case Xo.INT4:case Xo.UINT4:case Xo.FLOAT4:return Hm[2];case Xo.MAT4:return Hm[3];case Xo.SAMPLER2D:return"default-texture";case Xo.SAMPLER_CUBE:return"default-cube-texture"}return Hm[0]}function Vm(e,t){for(var n=Object.entries(t),i=!1,r=0;r<n.length;r++)e[n[r][0]]!==n[r][1]&&(e[n[r][0]]=n[r][1],i=!0);return i}var jm=new js;function Wm(e){return Math.ceil(Math.log2(Math.max(e,2)))}function qm(e,t){switch(e.type){case"boolean":return"number"==typeof t?t.toString():t?"1":"0";case"string":return void 0!==t?t:e.options[0];case"number":return void 0!==t?t.toString():e.range[0].toString();default:return console.warn("unknown define type '"+e.type+"'"),"-1"}}function Ym(e,t,n,i,r){for(var o=e.builtins[i],a=[],s=function(e){var t=o.blocks[e],i=n.layouts[t.name],s=i&&n.bindings.find((function(e){return e.binding===i.binding}));if(!(i&&s&&s.descriptorType&Us))return console.warn("builtin UBO '"+t.name+"' not available!"),"continue";a.push(i),r&&!r.includes(s)&&r.push(s)},c=0;c<o.blocks.length;c++)s(c);Array.prototype.unshift.apply(t.gfxBlocks,a);for(var l=[],u=function(e){var t=o.samplers[e],i=n.layouts[t.name],a=i&&n.bindings.find((function(e){return e.binding===i.binding}));if(!(i&&a&&a.descriptorType&Gs))return console.warn("builtin sampler '"+t.name+"' not available!"),"continue";l.push(i),r&&!r.includes(a)&&r.push(a)},h=0;h<o.samplers.length;h++)u(h);Array.prototype.unshift.apply(t.gfxSamplers,l),r&&r.sort((function(e,t){return e.binding-t.binding}))}function Xm(e){return e.members.reduce((function(e,t){return e+za(t.type)*t.count}),0)}function Km(e,t){for(var n=0;n<e.length;n++){var i=e[n];if("!"===i[0]){if(t[i.slice(1)])return!1}else if(!t[i])return!1}return!0}function Qm(e){switch(e.gfxAPI){case Ia.GLES2:case Ia.WEBGL:return"glsl1";case Ia.GLES3:case Ia.WEBGL2:return"glsl3";default:return"glsl4"}}var Zm=new(function(){function e(){this._templates={},this._cache={},this._templateInfos={}}var t=e.prototype;return t.register=function(e){for(var t=0;t<e.shaders.length;t++)this.define(e.shaders[t]).effectName=e.name},t.define=function(e){var t=this._templates[e.name];if(t&&t.hash===e.hash)return t;for(var n=J({},e),i=0,r=function(e){var t=n.defines[e],r=1;if("number"===t.type){var o=t.range;r=Wm(o[1]-o[0]+1),t._map=function(e){return e-o[0]}}else"string"===t.type?(r=Wm(t.options.length),t._map=function(e){return Math.max(0,t.options.findIndex((function(t){return t===e})))}):"boolean"===t.type&&(t._map=function(e){return e?1:0});t._offset=i,i+=r},o=0;o<n.defines.length;o++)r(o);if(i>31&&(n.uber=!0),this._templates[e.name]=n,!this._templateInfos[n.hash]){var a={};a.samplerStartBinding=n.blocks.length,a.gfxBlocks=[],a.gfxSamplers=[],a.bindings=[],a.blockSizes=[];for(var s=0;s<n.blocks.length;s++){var c=n.blocks[s];a.blockSizes.push(Xm(c)),a.bindings.push(new Vs(c.binding,c.descriptorType||pa.UNIFORM_BUFFER,1,c.stageFlags)),a.gfxBlocks.push(new Os($l.MATERIAL,c.binding,c.name,c.members.map((function(e){return new Rs(e.name,e.type,e.count)})),1))}for(var l=0;l<n.samplers.length;l++){var u=n.samplers[l];a.bindings.push(new Vs(u.binding,u.descriptorType||pa.SAMPLER,u.count,u.stageFlags)),a.gfxSamplers.push(new Ns($l.MATERIAL,u.binding,u.name,u.type,u.count))}a.gfxAttributes=[];for(var h=0;h<n.attributes.length;h++){var _=n.attributes[h];a.gfxAttributes.push(new ts(_.name,_.format,_.isNormalized,0,_.isInstanced,_.location))}Ym(n,a,Kl,"locals"),a.gfxStages=[],a.gfxStages.push(new bs(da.VERTEX,"")),a.gfxStages.push(new bs(da.FRAGMENT,"")),a.handleMap=function(e){for(var t={},n=0;n<e.blocks.length;n++)for(var i=e.blocks[n],r=i.members,o=0,a=0;a<r.length;a++){var s=r[a];t[s.name]=Mm(Nm.UBO,$l.MATERIAL,i.binding,s.type,o),o+=(za(s.type)>>2)*s.count}for(var c=0;c<e.samplers.length;c++){var l=e.samplers[c];t[l.name]=Mm(Nm.SAMPLER,$l.MATERIAL,l.binding,l.type)}return t}(n),a.hPipelineLayout=Yi,a.setLayouts=[],this._templateInfos[n.hash]=a}return n},t.getTemplate=function(e){return this._templates[e]},t.getTemplateInfo=function(e){var t=this._templates[e].hash;return this._templateInfos[t]},t.getDescriptorSetLayout=function(e,t,n){void 0===n&&(n=!1);var i=this._templates[t],r=this._templateInfos[i.hash];return r.setLayouts.length||(jm.bindings=r.bindings,r.setLayouts[$l.MATERIAL]=e.createDescriptorSetLayout(jm),jm.bindings=Kl.bindings,r.setLayouts[$l.LOCAL]=e.createDescriptorSetLayout(jm)),r.setLayouts[n?$l.LOCAL:$l.MATERIAL]},t.hasProgram=function(e){return void 0!==this._templates[e]},t.getKey=function(e,t){var n=this._templates[e],i=n.defines;if(n.uber){for(var r="",o=0;o<i.length;o++){var a=i[o],s=t[a.name];if(s&&a._map){var c=a._map(s);r+=""+a._offset+c+"|"}}return""+r+n.hash}for(var l=0,u=0;u<i.length;u++){var h=i[u],_=t[h.name];_&&h._map&&(l|=h._map(_)<<h._offset)}return l.toString(16)+"|"+n.hash},t.destroyShaderByDefines=function(e){var t=this,n=Object.keys(e);if(n.length)for(var i=n.map((function(t){var n=e[t];return"boolean"==typeof n&&(n=n?"1":"0"),new RegExp(""+t+n)})),r=Object.keys(this._cache).filter((function(e){return i.every((function(n){return n.test(Xi.get(t._cache[e]).name)}))})),o=0;o<r.length;o++){var a=r[o],s=Xi.get(this._cache[a]);console.log("destroyed shader "+s.name),s.destroy(),delete this._cache[a]}},t.getGFXShader=function(e,t,n,i,r){Object.assign(n,i.macros),r||(r=this.getKey(t,n));var o=this._cache[r];if(o)return o;var a=this._templates[t],s=this._templateInfos[a.hash];s.hPipelineLayout||(this.getDescriptorSetLayout(e,t),Ym(a,s,Xl,"globals"),s.setLayouts[$l.GLOBAL]=i.descriptorSetLayout,s.hPipelineLayout=Zi.alloc(e,new Ys(s.setLayouts)));var c=function(e,t){for(var n=[],i=0;i<t.length;i++){var r=t[i],o=r.name,a=e[o],s=qm(r,a),c=!a||"0"===a;n.push({name:o,value:s,isDefault:c})}return n}(n,a.defines),l=c.reduce((function(e,t){return e+"#define "+t.name+" "+t.value+"\n"}),"")+"\n",u=a.glsl3,h=Qm(e);h?u=a[h]:console.error("Invalid GFX API!"),s.gfxStages[0].source=l+u.vert,s.gfxStages[1].source=l+u.frag;var _=function(e,t,n){for(var i=[],r=e.attributes,o=t.gfxAttributes,a=0;a<r.length;a++)Km(r[a].defines,n)&&i.push(o[a]);return i}(a,s,n),f=function(e,t){return e+t.reduce((function(e,t){return t.isDefault?e:e+"|"+t.name+t.value}),"")}(t,c),m=new Ps(f,s.gfxStages,_,s.gfxBlocks,s.gfxSamplers);return this._cache[r]=Xi.alloc(e,m)},e}());c.programLib=Zm;var Jm,$m,ed,td={glsl1:[[{vert:"\nprecision mediump float;\nuniform highp mat4 cc_matView;\nuniform highp mat4 cc_matViewInv;\nuniform highp mat4 cc_matViewProj;\nuniform highp mat4 cc_matWorld;\nvec4 quaternionFromAxis (vec3 xAxis,vec3 yAxis,vec3 zAxis){\n  mat3 m = mat3(xAxis,yAxis,zAxis);\n  float trace = m[0][0] + m[1][1] + m[2][2];\n  vec4 quat;\n  if (trace > 0.) {\n    float s = 0.5 / sqrt(trace + 1.0);\n    quat.w = 0.25 / s;\n    quat.x = (m[2][1] - m[1][2]) * s;\n    quat.y = (m[0][2] - m[2][0]) * s;\n    quat.z = (m[1][0] - m[0][1]) * s;\n  } else if ((m[0][0] > m[1][1]) && (m[0][0] > m[2][2])) {\n    float s = 2.0 * sqrt(1.0 + m[0][0] - m[1][1] - m[2][2]);\n    quat.w = (m[2][1] - m[1][2]) / s;\n    quat.x = 0.25 * s;\n    quat.y = (m[0][1] + m[1][0]) / s;\n    quat.z = (m[0][2] + m[2][0]) / s;\n  } else if (m[1][1] > m[2][2]) {\n    float s = 2.0 * sqrt(1.0 + m[1][1] - m[0][0] - m[2][2]);\n    quat.w = (m[0][2] - m[2][0]) / s;\n    quat.x = (m[0][1] + m[1][0]) / s;\n    quat.y = 0.25 * s;\n    quat.z = (m[1][2] + m[2][1]) / s;\n  } else {\n    float s = 2.0 * sqrt(1.0 + m[2][2] - m[0][0] - m[1][1]);\n    quat.w = (m[1][0] - m[0][1]) / s;\n    quat.x = (m[0][2] + m[2][0]) / s;\n    quat.y = (m[1][2] + m[2][1]) / s;\n    quat.z = 0.25 * s;\n  }\n  float len = quat.x * quat.x + quat.y * quat.y + quat.z * quat.z + quat.w * quat.w;\n  if (len > 0.) {\n    len = 1. / sqrt(len);\n    quat.x = quat.x * len;\n    quat.y = quat.y * len;\n    quat.z = quat.z * len;\n    quat.w = quat.w * len;\n  }\n  return quat;\n}\nvec4 quaternionFromEuler (vec3 angle){\n  float x = angle.x / 2.;\n  float y = angle.y / 2.;\n  float z = angle.z / 2.;\n  float sx = sin(x);\n  float cx = cos(x);\n  float sy = sin(y);\n  float cy = cos(y);\n  float sz = sin(z);\n  float cz = cos(z);\n  vec4 quat = vec4(0);\n  quat.x = sx * cy * cz + cx * sy * sz;\n  quat.y = cx * sy * cz + sx * cy * sz;\n  quat.z = cx * cy * sz - sx * sy * cz;\n  quat.w = cx * cy * cz - sx * sy * sz;\n  return quat;\n}\nvec4 quatMultiply (vec4 a, vec4 b){\n  vec4 quat;\n  quat.x = a.x * b.w + a.w * b.x + a.y * b.z - a.z * b.y;\n  quat.y = a.y * b.w + a.w * b.y + a.z * b.x - a.x * b.z;\n  quat.z = a.z * b.w + a.w * b.z + a.x * b.y - a.y * b.x;\n  quat.w = a.w * b.w - a.x * b.x - a.y * b.y - a.z * b.z;\n  return quat;\n}\nvoid rotateVecFromQuat (inout vec3 v, vec4 q){\n  float ix = q.w * v.x + q.y * v.z - q.z * v.y;\n  float iy = q.w * v.y + q.z * v.x - q.x * v.z;\n  float iz = q.w * v.z + q.x * v.y - q.y * v.x;\n  float iw = -q.x * v.x - q.y * v.y - q.z * v.z;\n  v.x = ix * q.w + iw * -q.x + iy * -q.z - iz * -q.y;\n  v.y = iy * q.w + iw * -q.y + iz * -q.x - ix * -q.z;\n  v.z = iz * q.w + iw * -q.z + ix * -q.y - iy * -q.x;\n}\nvec3 rotateInLocalSpace (vec3 pos, vec3 xAxis, vec3 yAxis, vec3 zAxis, vec4 q){\n  vec4 viewQuat = quaternionFromAxis(xAxis, yAxis, zAxis);\n  vec4 rotQuat = quatMultiply(viewQuat, q);\n  rotateVecFromQuat(pos, rotQuat);\n  return pos;\n}\nvoid rotateCorner (inout vec2 corner, float angle){\n  float xOS = cos(angle) * corner.x - sin(angle) * corner.y;\n  float yOS = sin(angle) * corner.x + cos(angle) * corner.y;\n  corner.x = xOS;\n  corner.y = yOS;\n}\nvarying mediump vec2 uv;\nvarying mediump vec4 color;\nvoid computeVertPos (inout vec4 pos, vec2 vertOffset, vec4 q, vec3 s\n  , mat4 viewInv\n) {\n  vec3 viewSpaceVert = vec3(vertOffset.x * s.x, vertOffset.y * s.y, 0.);\n  vec3 camX = normalize(vec3(viewInv[0][0], viewInv[1][0], viewInv[2][0]));\n  vec3 camY = normalize(vec3(viewInv[0][1], viewInv[1][1], viewInv[2][1]));\n  vec3 camZ = normalize(vec3(viewInv[0][2], viewInv[1][2], viewInv[2][2]));\n  pos.xyz += rotateInLocalSpace(viewSpaceVert, camX, camY, camZ, q);\n}\nattribute vec3 a_position;\nattribute vec2 a_texCoord;\nattribute vec4 a_color;\nuniform vec4 cc_size_rotation;\nvec4 vs_main() {\n  vec4 pos = vec4(a_position, 1);\n  pos = cc_matWorld * pos;\n  vec2 vertOffset = a_texCoord.xy - 0.5;\n  computeVertPos(pos, vertOffset, quaternionFromEuler(vec3(0., 0., cc_size_rotation.z)), vec3(cc_size_rotation.xy, 0.), cc_matViewInv);\n  pos = cc_matViewProj * pos;\n  uv = a_texCoord.xy;\n  color = a_color;\n  return pos;\n}\nvoid main() { gl_Position = vs_main(); }",frag:"\nprecision mediump float;\nuniform mediump vec4 cc_exposure;\nvec3 SRGBToLinear (vec3 gamma) {\n  return gamma * gamma;\n}\nvec4 CCFragOutput (vec4 color) {\n  #if CC_USE_HDR\n    color.rgb = mix(color.rgb, SRGBToLinear(color.rgb) * cc_exposure.w, vec3(cc_exposure.z));\n  #endif\n  return color;\n}\nvarying vec2 uv;\nvarying vec4 color;\nuniform sampler2D mainTexture;\nuniform vec4 tintColor;\nvec4 add () {\n  vec4 col = 2.0 * color * tintColor * texture2D(mainTexture, uv);\n  return CCFragOutput(col);\n}\nvoid main() { gl_FragColor = add(); }"}],[{vert:"\nprecision highp float;\nattribute vec3 a_position;\nvec4 vert () {\n  vec4 pos = vec4(a_position, 1);\n  return pos;\n}\nvoid main() { gl_Position = vert(); }",frag:"\nprecision highp float;\nvec4 frag () {\n  vec4 o = vec4(1.0);\n  return o;\n}\nvoid main() { gl_FragColor = frag(); }"}],[{vert:"\nprecision highp float;\nuniform highp mat4 cc_matViewProj;\nuniform highp mat4 cc_matWorld;\nattribute vec3 a_position;\nattribute vec4 a_color;\nvarying vec4 v_color;\nattribute float a_dist;\nvarying float v_dist;\nvec4 vert () {\n  vec4 pos = vec4(a_position, 1);\n  pos = cc_matViewProj * cc_matWorld * pos;\n  v_color = a_color;\n  v_dist = a_dist;\n  return pos;\n}\nvoid main() { gl_Position = vert(); }",frag:"\n#ifdef GL_OES_standard_derivatives\n#extension GL_OES_standard_derivatives: enable\n#endif\nprecision highp float;\nvarying vec4 v_color;\nvarying float v_dist;\nvec4 frag () {\n  vec4 o = v_color;\n    #ifdef GL_OES_standard_derivatives\n      float aa = fwidth(v_dist);\n    #else\n      float aa = 0.05;\n    #endif\n  float alpha = 1. - smoothstep(-aa, 0., abs(v_dist) - 1.0);\n  o.rgb *= o.a;\n  o *= alpha;\n  return o;\n}\nvoid main() { gl_FragColor = frag(); }"}],[{vert:"\nprecision mediump float;\nvec4 quaternionFromAxis (vec3 xAxis,vec3 yAxis,vec3 zAxis){\n  mat3 m = mat3(xAxis,yAxis,zAxis);\n  float trace = m[0][0] + m[1][1] + m[2][2];\n  vec4 quat;\n  if (trace > 0.) {\n    float s = 0.5 / sqrt(trace + 1.0);\n    quat.w = 0.25 / s;\n    quat.x = (m[2][1] - m[1][2]) * s;\n    quat.y = (m[0][2] - m[2][0]) * s;\n    quat.z = (m[1][0] - m[0][1]) * s;\n  } else if ((m[0][0] > m[1][1]) && (m[0][0] > m[2][2])) {\n    float s = 2.0 * sqrt(1.0 + m[0][0] - m[1][1] - m[2][2]);\n    quat.w = (m[2][1] - m[1][2]) / s;\n    quat.x = 0.25 * s;\n    quat.y = (m[0][1] + m[1][0]) / s;\n    quat.z = (m[0][2] + m[2][0]) / s;\n  } else if (m[1][1] > m[2][2]) {\n    float s = 2.0 * sqrt(1.0 + m[1][1] - m[0][0] - m[2][2]);\n    quat.w = (m[0][2] - m[2][0]) / s;\n    quat.x = (m[0][1] + m[1][0]) / s;\n    quat.y = 0.25 * s;\n    quat.z = (m[1][2] + m[2][1]) / s;\n  } else {\n    float s = 2.0 * sqrt(1.0 + m[2][2] - m[0][0] - m[1][1]);\n    quat.w = (m[1][0] - m[0][1]) / s;\n    quat.x = (m[0][2] + m[2][0]) / s;\n    quat.y = (m[1][2] + m[2][1]) / s;\n    quat.z = 0.25 * s;\n  }\n  float len = quat.x * quat.x + quat.y * quat.y + quat.z * quat.z + quat.w * quat.w;\n  if (len > 0.) {\n    len = 1. / sqrt(len);\n    quat.x = quat.x * len;\n    quat.y = quat.y * len;\n    quat.z = quat.z * len;\n    quat.w = quat.w * len;\n  }\n  return quat;\n}\nvec4 quaternionFromEuler (vec3 angle){\n  float x = angle.x / 2.;\n  float y = angle.y / 2.;\n  float z = angle.z / 2.;\n  float sx = sin(x);\n  float cx = cos(x);\n  float sy = sin(y);\n  float cy = cos(y);\n  float sz = sin(z);\n  float cz = cos(z);\n  vec4 quat = vec4(0);\n  quat.x = sx * cy * cz + cx * sy * sz;\n  quat.y = cx * sy * cz + sx * cy * sz;\n  quat.z = cx * cy * sz - sx * sy * cz;\n  quat.w = cx * cy * cz - sx * sy * sz;\n  return quat;\n}\nmat4 matrixFromRT (vec4 q, vec3 p){\n  float x2 = q.x + q.x;\n  float y2 = q.y + q.y;\n  float z2 = q.z + q.z;\n  float xx = q.x * x2;\n  float xy = q.x * y2;\n  float xz = q.x * z2;\n  float yy = q.y * y2;\n  float yz = q.y * z2;\n  float zz = q.z * z2;\n  float wx = q.w * x2;\n  float wy = q.w * y2;\n  float wz = q.w * z2;\n  return mat4(\n    1. - (yy + zz), xy + wz, xz - wy, 0,\n    xy - wz, 1. - (xx + zz), yz + wx, 0,\n    xz + wy, yz - wx, 1. - (xx + yy), 0,\n    p.x, p.y, p.z, 1\n  );\n}\nmat4 matFromRTS (vec4 q, vec3 t, vec3 s){\n  float x = q.x, y = q.y, z = q.z, w = q.w;\n  float x2 = x + x;\n  float y2 = y + y;\n  float z2 = z + z;\n  float xx = x * x2;\n  float xy = x * y2;\n  float xz = x * z2;\n  float yy = y * y2;\n  float yz = y * z2;\n  float zz = z * z2;\n  float wx = w * x2;\n  float wy = w * y2;\n  float wz = w * z2;\n  float sx = s.x;\n  float sy = s.y;\n  float sz = s.z;\n  return mat4((1. - (yy + zz)) * sx, (xy + wz) * sx, (xz - wy) * sx, 0,\n    (xy - wz) * sy, (1. - (xx + zz)) * sy, (yz + wx) * sy, 0,\n    (xz + wy) * sz, (yz - wx) * sz, (1. - (xx + yy)) * sz, 0,\n    t.x, t.y, t.z, 1);\n}\nvec4 quatMultiply (vec4 a, vec4 b){\n  vec4 quat;\n  quat.x = a.x * b.w + a.w * b.x + a.y * b.z - a.z * b.y;\n  quat.y = a.y * b.w + a.w * b.y + a.z * b.x - a.x * b.z;\n  quat.z = a.z * b.w + a.w * b.z + a.x * b.y - a.y * b.x;\n  quat.w = a.w * b.w - a.x * b.x - a.y * b.y - a.z * b.z;\n  return quat;\n}\nvoid rotateVecFromQuat (inout vec3 v, vec4 q){\n  float ix = q.w * v.x + q.y * v.z - q.z * v.y;\n  float iy = q.w * v.y + q.z * v.x - q.x * v.z;\n  float iz = q.w * v.z + q.x * v.y - q.y * v.x;\n  float iw = -q.x * v.x - q.y * v.y - q.z * v.z;\n  v.x = ix * q.w + iw * -q.x + iy * -q.z - iz * -q.y;\n  v.y = iy * q.w + iw * -q.y + iz * -q.x - ix * -q.z;\n  v.z = iz * q.w + iw * -q.z + ix * -q.y - iy * -q.x;\n}\nvec3 rotateInLocalSpace (vec3 pos, vec3 xAxis, vec3 yAxis, vec3 zAxis, vec4 q){\n  vec4 viewQuat = quaternionFromAxis(xAxis, yAxis, zAxis);\n  vec4 rotQuat = quatMultiply(viewQuat, q);\n  rotateVecFromQuat(pos, rotQuat);\n  return pos;\n}\nvoid rotateCorner (inout vec2 corner, float angle){\n  float xOS = cos(angle) * corner.x - sin(angle) * corner.y;\n  float yOS = sin(angle) * corner.x + cos(angle) * corner.y;\n  corner.x = xOS;\n  corner.y = yOS;\n}\nuniform vec4 mainTiling_Offset;\nuniform vec4 frameTile_velLenScale;\nuniform vec4 scale;\nuniform highp mat4 cc_matView;\nuniform highp mat4 cc_matViewInv;\nuniform highp mat4 cc_matViewProj;\nuniform highp vec4 cc_cameraPos;\nuniform highp mat4 cc_matWorld;\nvarying mediump vec2 uv;\nvarying mediump vec4 color;\nvoid computeVertPos (inout vec4 pos, vec2 vertOffset, vec4 q, vec3 s\n#if CC_RENDER_MODE == 0 || CC_RENDER_MODE == 3\n  , mat4 viewInv\n#endif\n#if CC_RENDER_MODE == 1\n  , vec3 eye\n  , vec4 velocity\n  , float velocityScale\n  , float lengthScale\n  , float xIndex\n#endif\n) {\n#if CC_RENDER_MODE == 0\n  vec3 viewSpaceVert = vec3(vertOffset.x * s.x, vertOffset.y * s.y, 0.);\n  vec3 camX = normalize(vec3(viewInv[0][0], viewInv[1][0], viewInv[2][0]));\n  vec3 camY = normalize(vec3(viewInv[0][1], viewInv[1][1], viewInv[2][1]));\n  vec3 camZ = normalize(vec3(viewInv[0][2], viewInv[1][2], viewInv[2][2]));\n  pos.xyz += rotateInLocalSpace(viewSpaceVert, camX, camY, camZ, q);\n#elif CC_RENDER_MODE == 1\n  vec3 camRight = normalize(cross(pos.xyz - eye, velocity.xyz)) * s.x;\n  vec3 camUp = velocity.xyz * velocityScale + normalize(velocity.xyz) * lengthScale * s.y;\n  pos.xyz += (camRight * abs(vertOffset.x) * sign(vertOffset.y)) - camUp * xIndex;\n#elif CC_RENDER_MODE == 2\n  vec3 viewSpaceVert = vec3(vertOffset.x * s.x, vertOffset.y * s.y, 0.);\n  vec3 camX = vec3(1, 0, 0);\n  vec3 camY = vec3(0, 0, -1);\n  pos.xyz += rotateInLocalSpace(viewSpaceVert, camX, camY, cross(camX, camY), q);\n#elif CC_RENDER_MODE == 3\n  vec2 viewSpaceVert = vec2(vertOffset.x * s.x, vertOffset.y * s.y);\n  rotateCorner(viewSpaceVert, q.z);\n  vec3 camX = normalize(vec3(cc_matView[0][0], cc_matView[1][0], cc_matView[2][0]));\n  vec3 camY = vec3(0, 1, 0);\n  vec3 offset = camX * viewSpaceVert.x + camY * viewSpaceVert.y;\n  pos.xyz += offset;\n#else\n  pos.x += vertOffset.x;\n  pos.y += vertOffset.y;\n#endif\n}\nvec2 computeUV (float frameIndex, vec2 vertIndex, vec2 frameTile){\n  vec2 aniUV = vec2(0, floor(frameIndex * frameTile.y));\n  aniUV.x = floor(frameIndex * frameTile.x * frameTile.y - aniUV.y * frameTile.x);\n#if CC_RENDER_MODE != 4\n  vertIndex.y = 1. - vertIndex.y;\n#endif\n  return (aniUV.xy + vertIndex) / vec2(frameTile.x, frameTile.y);\n}\nuniform vec4 u_sampleInfo;\nuniform vec4 u_worldRot;\nuniform vec4 u_timeDelta;\nattribute vec4 a_position_starttime;\nattribute vec4 a_size_uv;\nattribute vec4 a_rotation_uv;\nattribute vec4 a_color;\nattribute vec4 a_dir_life;\nattribute float a_rndSeed;\n#if CC_RENDER_MODE == 4\n  attribute vec3 a_texCoord;\n  attribute vec3 a_texCoord3;\n  attribute vec3 a_normal;\n  attribute vec4 a_color1;\n#endif\nvec3 unpackCurveData (sampler2D tex, vec2 coord) {\n    vec4 a = texture2D(tex, coord);\n    vec4 b = texture2D(tex, coord + u_sampleInfo.y);\n    float c = fract(coord.x * u_sampleInfo.x);\n    return mix(a.xyz, b.xyz, c);\n}\nvec3 unpackCurveData (sampler2D tex, vec2 coord, out float w) {\n    vec4 a = texture2D(tex, coord);\n    vec4 b = texture2D(tex, coord + u_sampleInfo.y);\n    float c = fract(coord.x * u_sampleInfo.x);\n    w = mix(a.w, b.w, c);\n    return mix(a.xyz, b.xyz, c);\n}\nfloat pseudoRandom (float seed) {\n  seed = mod(seed, 233280.);\n  float q = (seed * 9301. + 49297.) / 233280.;\n  return fract(q);\n}\n#if COLOR_OVER_TIME_MODULE_ENABLE\n  uniform sampler2D color_over_time_tex0;\n  uniform int u_color_mode;\n#endif\n#if ROTATION_OVER_TIME_MODULE_ENABLE\n  uniform sampler2D rotation_over_time_tex0;\n  uniform int u_rotation_mode;\n#endif\n#if SIZE_OVER_TIME_MODULE_ENABLE\n  uniform sampler2D size_over_time_tex0;\n  uniform int u_size_mode;\n#endif\n#if FORCE_OVER_TIME_MODULE_ENABLE\n  uniform sampler2D force_over_time_tex0;\n  uniform int u_force_mode;\nuniform int u_force_space;\n#endif\n#if VELOCITY_OVER_TIME_MODULE_ENABLE\n  uniform sampler2D velocity_over_time_tex0;\n  uniform int u_velocity_mode;\nuniform int u_velocity_space;\n#endif\n#if TEXTURE_ANIMATION_MODULE_ENABLE\n  uniform sampler2D texture_animation_tex0;\n  uniform vec4 u_anim_info;\n#endif\nfloat repeat (float t, float length) {\n  return t - floor(t / length) * length;\n}\nvec4 rotateQuat (vec4 p, vec4 q) {\n  vec3 iv = cross(q.xyz, p.xyz) + q.w * p.xyz;\n  vec3 res = p.xyz + 2.0 * cross(q.xyz, iv);\n  return vec4(res.xyz, p.w);\n}\nvec4 gpvs_main () {\n  float activeTime = u_timeDelta.x - a_position_starttime.w;\n  float normalizedTime = clamp(activeTime / a_dir_life.w, 0.0, 1.0);\n  vec2 timeCoord0 = vec2(normalizedTime, 0.);\n  vec2 timeCoord1 = vec2(normalizedTime, 1.);\n  #if CC_RENDER_MODE == 4\n    vec2 vertIdx = vec2(a_texCoord.x, a_texCoord.y);\n  #else\n    vec2 vertIdx = vec2(a_size_uv.w, a_rotation_uv.w);\n  #endif\n  vec4 velocity = vec4(a_dir_life.xyz, 0.);\n  vec4 pos = vec4(a_position_starttime.xyz, 1.);\n  vec3 size = a_size_uv.xyz;\n  #if SIZE_OVER_TIME_MODULE_ENABLE\n    if (u_size_mode == 1) {\n      size *= unpackCurveData(size_over_time_tex0, timeCoord0);\n    } else {\n      vec3 size_0 = unpackCurveData(size_over_time_tex0, timeCoord0);\n      vec3 size_1 = unpackCurveData(size_over_time_tex0, timeCoord1);\n      float factor_s = pseudoRandom(a_rndSeed + 39825.);\n      size *= mix(size_0, size_1, factor_s);\n    }\n  #endif\n  vec3 compScale = scale.xyz * size;\n  #if FORCE_OVER_TIME_MODULE_ENABLE\n    vec3 forceAnim = vec3(0.);\n    if (u_force_mode == 1) {\n      forceAnim = unpackCurveData(force_over_time_tex0, timeCoord0);\n    } else {\n      vec3 force_0 = unpackCurveData(force_over_time_tex0, timeCoord0);\n      vec3 force_1 = unpackCurveData(force_over_time_tex0, timeCoord1);\n      float factor_f =  pseudoRandom(a_rndSeed + 212165.);\n      forceAnim = mix(force_0, force_1, factor_f);\n    }\n    vec4 forceTrack = vec4(forceAnim, 0.);\n    if (u_force_space == 0) {\n      forceTrack = rotateQuat(forceTrack, u_worldRot);\n    }\n    velocity.xyz += forceTrack.xyz;\n  #endif\n  #if VELOCITY_OVER_TIME_MODULE_ENABLE\n    float speedModifier0 = 1.;\n    float speedModifier1 = 1.;\n    vec3 velocityAnim = vec3(0.);\n    if (u_velocity_mode == 1) {\n      velocityAnim = unpackCurveData(velocity_over_time_tex0, timeCoord0, speedModifier0);\n    } else {\n      vec3 vectory_0 = unpackCurveData(velocity_over_time_tex0, timeCoord0, speedModifier0);\n      vec3 vectory_1 = unpackCurveData(velocity_over_time_tex0, timeCoord1, speedModifier1);\n      float factor_v = pseudoRandom(a_rndSeed + 197866.);\n      velocityAnim = mix(vectory_0, vectory_1, factor_v);\n      speedModifier0 = mix(speedModifier0, speedModifier1, factor_v);\n    }\n    vec4 velocityTrack = vec4(velocityAnim, 0.);\n    if (u_velocity_space == 0) {\n      velocityTrack = rotateQuat(velocityTrack, u_worldRot);\n    }\n    velocity.xyz += velocityTrack.xyz;\n    velocity.xyz *= speedModifier0;\n  #endif\n  pos.xyz += velocity.xyz * normalizedTime * a_dir_life.w;\n  #if !CC_USE_WORLD_SPACE\n    pos = cc_matWorld * pos;\n    #if CC_RENDER_MODE == 1\n      velocity = rotateQuat(velocity, u_worldRot);\n    #endif\n  #endif\n  vec3 rotation = a_rotation_uv.xyz;\n  #if ROTATION_OVER_TIME_MODULE_ENABLE\n    if (u_rotation_mode == 1) {\n      rotation += unpackCurveData(rotation_over_time_tex0, timeCoord0) * normalizedTime * a_dir_life.w;\n    } else {\n      vec3 rotation_0 = unpackCurveData(rotation_over_time_tex0, timeCoord0);\n      vec3 rotation_1 = unpackCurveData(rotation_over_time_tex0, timeCoord1);\n      float factor_r = pseudoRandom(a_rndSeed + 125292.);\n      rotation += mix(rotation_0, rotation_1, factor_r) * normalizedTime * a_dir_life.w;\n    }\n  #endif\n  #if COLOR_OVER_TIME_MODULE_ENABLE\n    if (u_color_mode == 1) {\n      color = a_color * texture2D(color_over_time_tex0, timeCoord0);\n    } else {\n      vec4 color_0 = texture2D(color_over_time_tex0, timeCoord0);\n      vec4 color_1 = texture2D(color_over_time_tex0, timeCoord1);\n      float factor_c = pseudoRandom(a_rndSeed + 91041.);\n      color = a_color * mix(color_0, color_1, factor_c);\n    }\n  #else\n    color = a_color;\n  #endif\n  #if CC_RENDER_MODE != 4\n    vec2 cornerOffset = vec2((vertIdx - 0.5));\n    #if CC_RENDER_MODE == 0\n      vec3 rotEuler = rotation.xyz;\n    #elif CC_RENDER_MODE == 1\n      vec3 rotEuler = vec3(0.);\n    #else\n      vec3 rotEuler = vec3(0., 0., rotation.z);\n    #endif\n    computeVertPos(pos, cornerOffset, quaternionFromEuler(rotEuler), compScale\n      #if CC_RENDER_MODE == 0 || CC_RENDER_MODE == 3\n        , cc_matViewInv\n      #endif\n      #if CC_RENDER_MODE == 1\n        , cc_cameraPos.xyz\n        , velocity\n        , frameTile_velLenScale.z\n        , frameTile_velLenScale.w\n        , a_size_uv.w\n      #endif\n    );\n  #else\n    mat4 xformNoScale = matrixFromRT(quaternionFromEuler(rotation), pos.xyz);\n    mat4 xform = matFromRTS(quaternionFromEuler(rotation), pos.xyz, compScale);\n    pos = xform * vec4(a_texCoord3, 1);\n    vec4 normal = xformNoScale * vec4(a_normal, 0);\n    color *= a_color1;\n  #endif\n  pos = cc_matViewProj * pos;\n  float frameIndex = 0.;\n  #if TEXTURE_ANIMATION_MODULE_ENABLE\n    float startFrame = 0.;\n    vec3 frameInfo = vec3(0.);\n    if (int(u_anim_info.x) == 1) {\n      frameInfo = unpackCurveData(texture_animation_tex0, timeCoord0);\n    } else {\n      vec3 frameInfo0 = unpackCurveData(texture_animation_tex0, timeCoord0);\n      vec3 frameInfo1 = unpackCurveData(texture_animation_tex0, timeCoord1);\n      float factor_t = pseudoRandom(a_rndSeed + 90794.);\n      frameInfo = mix(frameInfo0, frameInfo1, factor_t);\n    }\n    startFrame = frameInfo.x / u_anim_info.y;\n    frameIndex = repeat(u_anim_info.z * (frameInfo.y + startFrame), 1.);\n  #endif\n  uv = computeUV(frameIndex, vertIdx, frameTile_velLenScale.xy) * mainTiling_Offset.xy + mainTiling_Offset.zw;\n  return pos;\n}\nvoid main() { gl_Position = gpvs_main(); }",frag:"\nprecision mediump float;\nuniform mediump vec4 cc_exposure;\nvec3 SRGBToLinear (vec3 gamma) {\n  return gamma * gamma;\n}\nvec4 CCFragOutput (vec4 color) {\n  #if CC_USE_HDR\n    color.rgb = mix(color.rgb, SRGBToLinear(color.rgb) * cc_exposure.w, vec3(cc_exposure.z));\n  #endif\n  return color;\n}\nvarying vec2 uv;\nvarying vec4 color;\nuniform sampler2D mainTexture;\nuniform vec4 tintColor;\nvec4 add () {\n  vec4 col = 2.0 * color * tintColor * texture2D(mainTexture, uv);\n  return CCFragOutput(col);\n}\nvoid main() { gl_FragColor = add(); }"}],[{vert:"\nprecision mediump float;\nuniform vec4 mainTiling_Offset;\nuniform highp mat4 cc_matViewProj;\nuniform highp vec4 cc_cameraPos;\nuniform highp mat4 cc_matWorld;\nvarying mediump vec2 uv;\nvarying mediump vec4 color;\nattribute vec3 a_position;\nattribute vec4 a_texCoord;\nattribute vec3 a_texCoord1;\nattribute vec3 a_texCoord2;\nattribute vec4 a_color;\n#if CC_DRAW_WIRE_FRAME\n  varying vec3 vBarycentric;\n#endif\nvec4 vs_main() {\n  highp vec4 pos = vec4(a_position, 1);\n  vec4 velocity = vec4(a_texCoord1.xyz, 0);\n  #if !CC_USE_WORLD_SPACE\n    pos = cc_matWorld * pos;\n    velocity = cc_matWorld * velocity;\n  #endif\n  float vertOffset = (a_texCoord.x - 0.5) * a_texCoord.y;\n  vec3 camUp = normalize(cross(pos.xyz - cc_cameraPos.xyz, velocity.xyz));\n  pos.xyz += camUp * vertOffset;\n  pos = cc_matViewProj * pos;\n  uv = a_texCoord.zw * mainTiling_Offset.xy + mainTiling_Offset.zw;;\n  color = a_color;\n  #if CC_DRAW_WIRE_FRAME\n    vBarycentric = a_texCoord2;\n  #endif\n  return pos;\n}\nvoid main() { gl_Position = vs_main(); }",frag:"\n  precision mediump float;\nuniform mediump vec4 cc_exposure;\nvec3 SRGBToLinear (vec3 gamma) {\n  return gamma * gamma;\n}\nvec4 CCFragOutput (vec4 color) {\n  #if CC_USE_HDR\n    color.rgb = mix(color.rgb, SRGBToLinear(color.rgb) * cc_exposure.w, vec3(cc_exposure.z));\n  #endif\n  return color;\n}\n  varying vec2 uv;\n  varying vec4 color;\n  #if CC_DRAW_WIRE_FRAME\n    varying vec3 vBarycentric;\n  #endif\n  uniform sampler2D mainTexture;\n  uniform vec4 tintColor;\n  vec4 add () {\n    vec4 col = 2.0 * color * tintColor * texture2D(mainTexture, uv);\n#if CC_DRAW_WIRE_FRAME\n    if (any(lessThan(vBarycentric, vec3(0.02)))) {\n        col = vec4(0., 1., 1., 1.);\n    }\n#endif\n    return CCFragOutput(col);\n  }\nvoid main() { gl_FragColor = add(); }"}],[{vert:"\nprecision highp float;\nvec4 quaternionFromAxis (vec3 xAxis,vec3 yAxis,vec3 zAxis){\n  mat3 m = mat3(xAxis,yAxis,zAxis);\n  float trace = m[0][0] + m[1][1] + m[2][2];\n  vec4 quat;\n  if (trace > 0.) {\n    float s = 0.5 / sqrt(trace + 1.0);\n    quat.w = 0.25 / s;\n    quat.x = (m[2][1] - m[1][2]) * s;\n    quat.y = (m[0][2] - m[2][0]) * s;\n    quat.z = (m[1][0] - m[0][1]) * s;\n  } else if ((m[0][0] > m[1][1]) && (m[0][0] > m[2][2])) {\n    float s = 2.0 * sqrt(1.0 + m[0][0] - m[1][1] - m[2][2]);\n    quat.w = (m[2][1] - m[1][2]) / s;\n    quat.x = 0.25 * s;\n    quat.y = (m[0][1] + m[1][0]) / s;\n    quat.z = (m[0][2] + m[2][0]) / s;\n  } else if (m[1][1] > m[2][2]) {\n    float s = 2.0 * sqrt(1.0 + m[1][1] - m[0][0] - m[2][2]);\n    quat.w = (m[0][2] - m[2][0]) / s;\n    quat.x = (m[0][1] + m[1][0]) / s;\n    quat.y = 0.25 * s;\n    quat.z = (m[1][2] + m[2][1]) / s;\n  } else {\n    float s = 2.0 * sqrt(1.0 + m[2][2] - m[0][0] - m[1][1]);\n    quat.w = (m[1][0] - m[0][1]) / s;\n    quat.x = (m[0][2] + m[2][0]) / s;\n    quat.y = (m[1][2] + m[2][1]) / s;\n    quat.z = 0.25 * s;\n  }\n  float len = quat.x * quat.x + quat.y * quat.y + quat.z * quat.z + quat.w * quat.w;\n  if (len > 0.) {\n    len = 1. / sqrt(len);\n    quat.x = quat.x * len;\n    quat.y = quat.y * len;\n    quat.z = quat.z * len;\n    quat.w = quat.w * len;\n  }\n  return quat;\n}\nvec4 quaternionFromEuler (vec3 angle){\n  float x = angle.x / 2.;\n  float y = angle.y / 2.;\n  float z = angle.z / 2.;\n  float sx = sin(x);\n  float cx = cos(x);\n  float sy = sin(y);\n  float cy = cos(y);\n  float sz = sin(z);\n  float cz = cos(z);\n  vec4 quat = vec4(0);\n  quat.x = sx * cy * cz + cx * sy * sz;\n  quat.y = cx * sy * cz + sx * cy * sz;\n  quat.z = cx * cy * sz - sx * sy * cz;\n  quat.w = cx * cy * cz - sx * sy * sz;\n  return quat;\n}\nmat4 matrixFromRT (vec4 q, vec3 p){\n  float x2 = q.x + q.x;\n  float y2 = q.y + q.y;\n  float z2 = q.z + q.z;\n  float xx = q.x * x2;\n  float xy = q.x * y2;\n  float xz = q.x * z2;\n  float yy = q.y * y2;\n  float yz = q.y * z2;\n  float zz = q.z * z2;\n  float wx = q.w * x2;\n  float wy = q.w * y2;\n  float wz = q.w * z2;\n  return mat4(\n    1. - (yy + zz), xy + wz, xz - wy, 0,\n    xy - wz, 1. - (xx + zz), yz + wx, 0,\n    xz + wy, yz - wx, 1. - (xx + yy), 0,\n    p.x, p.y, p.z, 1\n  );\n}\nmat4 matFromRTS (vec4 q, vec3 t, vec3 s){\n  float x = q.x, y = q.y, z = q.z, w = q.w;\n  float x2 = x + x;\n  float y2 = y + y;\n  float z2 = z + z;\n  float xx = x * x2;\n  float xy = x * y2;\n  float xz = x * z2;\n  float yy = y * y2;\n  float yz = y * z2;\n  float zz = z * z2;\n  float wx = w * x2;\n  float wy = w * y2;\n  float wz = w * z2;\n  float sx = s.x;\n  float sy = s.y;\n  float sz = s.z;\n  return mat4((1. - (yy + zz)) * sx, (xy + wz) * sx, (xz - wy) * sx, 0,\n    (xy - wz) * sy, (1. - (xx + zz)) * sy, (yz + wx) * sy, 0,\n    (xz + wy) * sz, (yz - wx) * sz, (1. - (xx + yy)) * sz, 0,\n    t.x, t.y, t.z, 1);\n}\nvec4 quatMultiply (vec4 a, vec4 b){\n  vec4 quat;\n  quat.x = a.x * b.w + a.w * b.x + a.y * b.z - a.z * b.y;\n  quat.y = a.y * b.w + a.w * b.y + a.z * b.x - a.x * b.z;\n  quat.z = a.z * b.w + a.w * b.z + a.x * b.y - a.y * b.x;\n  quat.w = a.w * b.w - a.x * b.x - a.y * b.y - a.z * b.z;\n  return quat;\n}\nvoid rotateVecFromQuat (inout vec3 v, vec4 q){\n  float ix = q.w * v.x + q.y * v.z - q.z * v.y;\n  float iy = q.w * v.y + q.z * v.x - q.x * v.z;\n  float iz = q.w * v.z + q.x * v.y - q.y * v.x;\n  float iw = -q.x * v.x - q.y * v.y - q.z * v.z;\n  v.x = ix * q.w + iw * -q.x + iy * -q.z - iz * -q.y;\n  v.y = iy * q.w + iw * -q.y + iz * -q.x - ix * -q.z;\n  v.z = iz * q.w + iw * -q.z + ix * -q.y - iy * -q.x;\n}\nvec3 rotateInLocalSpace (vec3 pos, vec3 xAxis, vec3 yAxis, vec3 zAxis, vec4 q){\n  vec4 viewQuat = quaternionFromAxis(xAxis, yAxis, zAxis);\n  vec4 rotQuat = quatMultiply(viewQuat, q);\n  rotateVecFromQuat(pos, rotQuat);\n  return pos;\n}\nvoid rotateCorner (inout vec2 corner, float angle){\n  float xOS = cos(angle) * corner.x - sin(angle) * corner.y;\n  float yOS = sin(angle) * corner.x + cos(angle) * corner.y;\n  corner.x = xOS;\n  corner.y = yOS;\n}\nuniform vec4 mainTiling_Offset;\nuniform vec4 frameTile_velLenScale;\nuniform vec4 scale;\nuniform highp mat4 cc_matView;\nuniform highp mat4 cc_matViewInv;\nuniform highp mat4 cc_matViewProj;\nuniform highp vec4 cc_cameraPos;\nuniform highp mat4 cc_matWorld;\nvarying mediump vec2 uv;\nvarying mediump vec4 color;\nvoid computeVertPos (inout vec4 pos, vec2 vertOffset, vec4 q, vec3 s\n#if CC_RENDER_MODE == 0 || CC_RENDER_MODE == 3\n  , mat4 viewInv\n#endif\n#if CC_RENDER_MODE == 1\n  , vec3 eye\n  , vec4 velocity\n  , float velocityScale\n  , float lengthScale\n  , float xIndex\n#endif\n) {\n#if CC_RENDER_MODE == 0\n  vec3 viewSpaceVert = vec3(vertOffset.x * s.x, vertOffset.y * s.y, 0.);\n  vec3 camX = normalize(vec3(viewInv[0][0], viewInv[1][0], viewInv[2][0]));\n  vec3 camY = normalize(vec3(viewInv[0][1], viewInv[1][1], viewInv[2][1]));\n  vec3 camZ = normalize(vec3(viewInv[0][2], viewInv[1][2], viewInv[2][2]));\n  pos.xyz += rotateInLocalSpace(viewSpaceVert, camX, camY, camZ, q);\n#elif CC_RENDER_MODE == 1\n  vec3 camRight = normalize(cross(pos.xyz - eye, velocity.xyz)) * s.x;\n  vec3 camUp = velocity.xyz * velocityScale + normalize(velocity.xyz) * lengthScale * s.y;\n  pos.xyz += (camRight * abs(vertOffset.x) * sign(vertOffset.y)) - camUp * xIndex;\n#elif CC_RENDER_MODE == 2\n  vec3 viewSpaceVert = vec3(vertOffset.x * s.x, vertOffset.y * s.y, 0.);\n  vec3 camX = vec3(1, 0, 0);\n  vec3 camY = vec3(0, 0, -1);\n  pos.xyz += rotateInLocalSpace(viewSpaceVert, camX, camY, cross(camX, camY), q);\n#elif CC_RENDER_MODE == 3\n  vec2 viewSpaceVert = vec2(vertOffset.x * s.x, vertOffset.y * s.y);\n  rotateCorner(viewSpaceVert, q.z);\n  vec3 camX = normalize(vec3(cc_matView[0][0], cc_matView[1][0], cc_matView[2][0]));\n  vec3 camY = vec3(0, 1, 0);\n  vec3 offset = camX * viewSpaceVert.x + camY * viewSpaceVert.y;\n  pos.xyz += offset;\n#else\n  pos.x += vertOffset.x;\n  pos.y += vertOffset.y;\n#endif\n}\nvec2 computeUV (float frameIndex, vec2 vertIndex, vec2 frameTile){\n  vec2 aniUV = vec2(0, floor(frameIndex * frameTile.y));\n  aniUV.x = floor(frameIndex * frameTile.x * frameTile.y - aniUV.y * frameTile.x);\n#if CC_RENDER_MODE != 4\n  vertIndex.y = 1. - vertIndex.y;\n#endif\n  return (aniUV.xy + vertIndex) / vec2(frameTile.x, frameTile.y);\n}\nattribute vec3 a_position;\nattribute vec3 a_texCoord;\nattribute vec3 a_texCoord1;\nattribute vec3 a_texCoord2;\nattribute vec4 a_color;\n#if CC_RENDER_MODE == 1\n  attribute vec3 a_color1;\n#endif\n#if CC_RENDER_MODE == 4\n  attribute vec3 a_texCoord3;\n  attribute vec3 a_normal;\n  attribute vec4 a_color1;\n#endif\nvec4 lpvs_main () {\n  vec3 compScale = scale.xyz * a_texCoord1;\n  vec4 pos = vec4(a_position, 1);\n  #if CC_RENDER_MODE == 1\n    vec4 velocity = vec4(a_color1.xyz, 0);\n  #endif\n  #if !CC_USE_WORLD_SPACE\n    pos = cc_matWorld * pos;\n    #if CC_RENDER_MODE == 1\n      velocity = cc_matWorld * velocity;\n    #endif\n  #endif\n  #if CC_RENDER_MODE != 4\n    vec2 cornerOffset = vec2((a_texCoord.xy - 0.5));\n    #if CC_RENDER_MODE == 0\n      vec3 rotEuler = a_texCoord2;\n    #elif CC_RENDER_MODE == 1\n      vec3 rotEuler = vec3(0.);\n    #else\n      vec3 rotEuler = vec3(0., 0., a_texCoord2.z);\n    #endif\n    computeVertPos(pos, cornerOffset, quaternionFromEuler(rotEuler), compScale\n    #if CC_RENDER_MODE == 0 || CC_RENDER_MODE == 3\n      , cc_matViewInv\n    #endif\n    #if CC_RENDER_MODE == 1\n      , cc_cameraPos.xyz\n      , velocity\n      , frameTile_velLenScale.z\n      , frameTile_velLenScale.w\n      , a_texCoord.x\n    #endif\n    );\n    color = a_color;\n  #else\n    mat4 xformNoScale = matrixFromRT(quaternionFromEuler(a_texCoord2), pos.xyz);\n    mat4 xform = matFromRTS(quaternionFromEuler(a_texCoord2), pos.xyz, compScale);\n    pos = xform * vec4(a_texCoord3, 1);\n    vec4 normal = xformNoScale * vec4(a_normal, 0);\n    color = a_color * a_color1;\n  #endif\n  uv = computeUV(a_texCoord.z, a_texCoord.xy, frameTile_velLenScale.xy) * mainTiling_Offset.xy + mainTiling_Offset.zw;\n  pos = cc_matViewProj * pos;\n  return pos;\n}\nvoid main() { gl_Position = lpvs_main(); }",frag:"\nprecision mediump float;\nuniform mediump vec4 cc_exposure;\nvec3 SRGBToLinear (vec3 gamma) {\n  return gamma * gamma;\n}\nvec4 CCFragOutput (vec4 color) {\n  #if CC_USE_HDR\n    color.rgb = mix(color.rgb, SRGBToLinear(color.rgb) * cc_exposure.w, vec3(cc_exposure.z));\n  #endif\n  return color;\n}\nvarying vec2 uv;\nvarying vec4 color;\nuniform sampler2D mainTexture;\nuniform vec4 tintColor;\nvec4 add () {\n  vec4 col = 2.0 * color * tintColor * texture2D(mainTexture, uv);\n  return CCFragOutput(col);\n}\nvoid main() { gl_FragColor = add(); }"}],[{vert:"\nprecision highp float;\nuniform highp mat4 cc_matViewProj;\n#if USE_LOCAL\nuniform highp mat4 cc_matWorld;\n#endif\nattribute vec3 a_position;\nattribute vec2 a_texCoord;\nattribute vec4 a_color;\nvarying vec4 v_light;\nvarying vec2 uv0;\n#if TWO_COLORED\n  attribute vec4 a_color2;\n  varying vec4 v_dark;\n#endif\nvec4 vert () {\n  vec4 pos = vec4(a_position, 1);\n  #if USE_LOCAL\n    pos = cc_matWorld * pos;\n  #endif\n  pos = cc_matViewProj * pos;\n  uv0 = a_texCoord;\n  v_light = a_color;\n  #if TWO_COLORED\n    v_dark = a_color2;\n  #endif\n  return pos;\n}\nvoid main() { gl_Position = vert(); }",frag:"\nprecision highp float;\n#if USE_ALPHA_TEST\n  uniform float alphaThreshold;\n#endif\nvoid ALPHA_TEST (in vec4 color) {\n  #if USE_ALPHA_TEST\n      if (color.a < alphaThreshold) discard;\n  #endif\n}\nvoid ALPHA_TEST (in float alpha) {\n  #if USE_ALPHA_TEST\n      if (alpha < alphaThreshold) discard;\n  #endif\n}\nvarying vec4 v_light;\n#if TWO_COLORED\n  varying vec4 v_dark;\n#endif\nvarying vec2 uv0;\nuniform sampler2D cc_spriteTexture;\nvec4 frag () {\n  vec4 o = vec4(1, 1, 1, 1);\n  #if TWO_COLORED\n    vec4 texColor = vec4(1, 1, 1, 1);\n    texColor *= texture2D(cc_spriteTexture, uv0);\n     o.a = texColor.a * v_light.a;\n    o.rgb = ((texColor.a - 1.0) * v_dark.a + 1.0 - texColor.rgb) * v_dark.rgb + texColor.rgb * v_light.rgb;\n  #else\n    o *= texture2D(cc_spriteTexture, uv0);\n    o *= v_light;\n  #endif\n  ALPHA_TEST(o);\n  return o;\n}\nvoid main() { gl_FragColor = frag(); }"}],[{vert:"\nprecision highp float;\nuniform highp mat4 cc_matView;\nuniform highp mat4 cc_matProj;\nuniform highp mat4 cc_matViewProj;\n#if USE_LOCAL\nuniform highp mat4 cc_matWorld;\n#endif\nattribute vec3 a_position;\nattribute vec2 a_texCoord;\nattribute vec4 a_color;\nvarying vec4 color;\nvarying vec2 uv0;\nvec4 vert () {\n  vec4 pos = vec4(a_position, 1);\n  #if USE_LOCAL\n    pos = cc_matWorld * pos;\n  #endif\n  #if USE_PIXEL_ALIGNMENT\n    pos = cc_matView * pos;\n    pos.xyz = floor(pos.xyz);\n    pos = cc_matProj * pos;\n  #else\n    pos = cc_matViewProj * pos;\n  #endif\n  uv0 = a_texCoord;\n  color = a_color;\n  return pos;\n}\nvoid main() { gl_Position = vert(); }",frag:"\nprecision highp float;\nvec4 CCSampleWithAlphaSeparated(sampler2D tex, vec2 uv) {\n#if CC_USE_EMBEDDED_ALPHA\n    return vec4(texture2D(tex, uv).rgb, texture2D(tex, uv + vec2(0.0, 0.5)).r);\n#else\n    return texture2D(tex, uv);\n#endif\n}\n#if USE_ALPHA_TEST\n  uniform float alphaThreshold;\n#endif\nvoid ALPHA_TEST (in vec4 color) {\n  #if USE_ALPHA_TEST\n      if (color.a < alphaThreshold) discard;\n  #endif\n}\nvoid ALPHA_TEST (in float alpha) {\n  #if USE_ALPHA_TEST\n      if (alpha < alphaThreshold) discard;\n  #endif\n}\nvarying vec4 color;\n#if USE_TEXTURE\n  varying vec2 uv0;\n  uniform sampler2D cc_spriteTexture;\n#endif\nvec4 frag () {\n  vec4 o = vec4(1, 1, 1, 1);\n  #if USE_TEXTURE\n    o *= CCSampleWithAlphaSeparated(cc_spriteTexture, uv0);\n    #if IS_GRAY\n      float gray  = 0.2126 * o.r + 0.7152 * o.g + 0.0722 * o.b;\n      o.r = o.g = o.b = gray;\n    #endif\n  #endif\n  o *= color;\n  ALPHA_TEST(o);\n  return o;\n}\nvoid main() { gl_FragColor = frag(); }"}],[{vert:"\nprecision highp float;\nhighp float decode32 (highp vec4 rgba) {\n  rgba = rgba * 255.0;\n  highp float Sign = 1.0 - (step(128.0, (rgba[3]) + 0.5)) * 2.0;\n  highp float Exponent = 2.0 * (mod(float(int((rgba[3]) + 0.5)), 128.0)) + (step(128.0, (rgba[2]) + 0.5)) - 127.0;\n  highp float Mantissa = (mod(float(int((rgba[2]) + 0.5)), 128.0)) * 65536.0 + rgba[1] * 256.0 + rgba[0] + 8388608.0;\n  return Sign * exp2(Exponent - 23.0) * Mantissa;\n}\nstruct StandardVertInput {\n  highp vec4 position;\n  vec3 normal;\n  vec4 tangent;\n};\nattribute vec3 a_position;\nattribute vec3 a_normal;\nattribute vec2 a_texCoord;\nattribute vec4 a_tangent;\n#if CC_USE_MORPH\n    attribute float a_vertexId;\n    int getVertexId() {\n        return int(a_vertexId);\n    }\nuniform vec4 cc_displacementWeights[15];\nuniform vec4 cc_displacementTextureInfo;\nvec2 getPixelLocation(vec2 textureResolution, int pixelIndex) {\n    float pixelIndexF = float(pixelIndex);\n    float x = mod(pixelIndexF, textureResolution.x);\n    float y = floor(pixelIndexF / textureResolution.x);\n    return vec2(x, y);\n}\nvec2 getPixelCoordFromLocation(vec2 location, vec2 textureResolution) {\n    return (vec2(location.x, location.y) + .5) / textureResolution;\n}\n#if CC_SUPPORT_FLOAT_TEXTURE\n        vec4 fetchVec3ArrayFromTexture(sampler2D tex, int elementIndex) {\n            int pixelIndex = elementIndex;\n            vec2 location = getPixelLocation(cc_displacementTextureInfo.xy, pixelIndex);\n            vec2 uv = getPixelCoordFromLocation(location, cc_displacementTextureInfo.xy);\n            return texture2D(tex, uv);\n        }\n#else\n    vec4 fetchVec3ArrayFromTexture(sampler2D tex, int elementIndex) {\n        int pixelIndex = elementIndex * 4;\n        vec2 location = getPixelLocation(cc_displacementTextureInfo.xy, pixelIndex);\n        vec2 x = getPixelCoordFromLocation(location + vec2(0.0, 0.0), cc_displacementTextureInfo.xy);\n        vec2 y = getPixelCoordFromLocation(location + vec2(1.0, 0.0), cc_displacementTextureInfo.xy);\n        vec2 z = getPixelCoordFromLocation(location + vec2(2.0, 0.0), cc_displacementTextureInfo.xy);\n        return vec4(\n            decode32(texture2D(tex, x)),\n            decode32(texture2D(tex, y)),\n            decode32(texture2D(tex, z)),\n            1.0\n        );\n    }\n#endif\nfloat getDisplacementWeight(int index) {\n    int quot = index / 4;\n    int remainder = index - quot * 4;\n    if (remainder == 0) {\n        return cc_displacementWeights[quot].x;\n    } else if (remainder == 1) {\n        return cc_displacementWeights[quot].y;\n    } else if (remainder == 2) {\n        return cc_displacementWeights[quot].z;\n    } else {\n        return cc_displacementWeights[quot].w;\n    }\n}\nvec3 getVec3DisplacementFromTexture(sampler2D tex, int vertexIndex) {\n#if CC_MORPH_PRECOMPUTED\n    return fetchVec3ArrayFromTexture(tex, vertexIndex).rgb;\n#else\n    vec3 result = vec3(0, 0, 0);\n    int nVertices = int(cc_displacementTextureInfo.z);\n    for (int iTarget = 0; iTarget < CC_MORPH_TARGET_COUNT; ++iTarget) {\n        result += (fetchVec3ArrayFromTexture(tex, nVertices * iTarget + vertexIndex).rgb * getDisplacementWeight(iTarget));\n    }\n    return result;\n#endif\n}\n#if CC_MORPH_TARGET_HAS_POSITION\n    uniform sampler2D cc_PositionDisplacements;\n    vec3 getPositionDisplacement(int vertexId) {\n        return getVec3DisplacementFromTexture(cc_PositionDisplacements, vertexId);\n    }\n#endif\n#if CC_MORPH_TARGET_HAS_NORMAL\n    uniform sampler2D cc_NormalDisplacements;\n    vec3 getNormalDisplacement(int vertexId) {\n        return getVec3DisplacementFromTexture(cc_NormalDisplacements, vertexId);\n    }\n#endif\n#if CC_MORPH_TARGET_HAS_TANGENT\n    uniform sampler2D cc_TangentDisplacements;\n    vec3 getTangentDisplacement(int vertexId) {\n        return getVec3DisplacementFromTexture(cc_TangentDisplacements, vertexId);\n    }\n#endif\nvoid applyMorph (inout StandardVertInput attr) {\n    int vertexId = getVertexId();\n#if CC_MORPH_TARGET_HAS_POSITION\n    attr.position.xyz = attr.position.xyz + getPositionDisplacement(vertexId);\n#endif\n#if CC_MORPH_TARGET_HAS_NORMAL\n    attr.normal.xyz = attr.normal.xyz + getNormalDisplacement(vertexId);\n#endif\n#if CC_MORPH_TARGET_HAS_TANGENT\n    attr.tangent.xyz = attr.tangent.xyz + getTangentDisplacement(vertexId);\n#endif\n}\nvoid applyMorph (inout vec4 position) {\n#if CC_MORPH_TARGET_HAS_POSITION\n    position.xyz = position.xyz + getPositionDisplacement(getVertexId());\n#endif\n}\n#endif\n#if CC_USE_SKINNING\n  attribute vec4 a_joints;\nattribute vec4 a_weights;\n#if CC_USE_BAKED_ANIMATION\n  #if USE_INSTANCING\n    attribute highp vec4 a_jointAnimInfo;\n  #endif\n  uniform highp vec4 cc_jointTextureInfo;\n  uniform highp vec4 cc_jointAnimInfo;\n  uniform highp sampler2D cc_jointTexture;\n  #else\n  uniform highp vec4 cc_joints[90];\n#endif\n#if CC_USE_BAKED_ANIMATION\n  #if CC_SUPPORT_FLOAT_TEXTURE\n    mat4 getJointMatrix (float i) {\n    #if USE_INSTANCING\n      highp float j = 3.0 * (a_jointAnimInfo.x * a_jointAnimInfo.y + i) + a_jointAnimInfo.z;\n    #else\n      highp float j = 3.0 * (cc_jointAnimInfo.x * cc_jointTextureInfo.y + i) + cc_jointTextureInfo.z;\n    #endif\n    highp float invSize = cc_jointTextureInfo.w;\n    highp float y = floor(j * invSize);\n    highp float x = j - y * cc_jointTextureInfo.x;\n    y = (y + 0.5) * invSize;\n      vec4 v1 = texture2D(cc_jointTexture, vec2((x + 0.5) * invSize, y));\n      vec4 v2 = texture2D(cc_jointTexture, vec2((x + 1.5) * invSize, y));\n      vec4 v3 = texture2D(cc_jointTexture, vec2((x + 2.5) * invSize, y));\n      return mat4(vec4(v1.xyz, 0.0), vec4(v2.xyz, 0.0), vec4(v3.xyz, 0.0), vec4(v1.w, v2.w, v3.w, 1.0));\n    }\n  #else\n    mat4 getJointMatrix (float i) {\n    #if USE_INSTANCING\n      highp float j = 12.0 * (a_jointAnimInfo.x * a_jointAnimInfo.y + i) + a_jointAnimInfo.z;\n    #else\n      highp float j = 12.0 * (cc_jointAnimInfo.x * cc_jointTextureInfo.y + i) + cc_jointTextureInfo.z;\n    #endif\n    highp float invSize = cc_jointTextureInfo.w;\n    highp float y = floor(j * invSize);\n    highp float x = j - y * cc_jointTextureInfo.x;\n    y = (y + 0.5) * invSize;\n      vec4 v1 = vec4(\n        decode32(texture2D(cc_jointTexture, vec2((x + 0.5) * invSize, y))),\n        decode32(texture2D(cc_jointTexture, vec2((x + 1.5) * invSize, y))),\n        decode32(texture2D(cc_jointTexture, vec2((x + 2.5) * invSize, y))),\n        decode32(texture2D(cc_jointTexture, vec2((x + 3.5) * invSize, y)))\n      );\n      vec4 v2 = vec4(\n        decode32(texture2D(cc_jointTexture, vec2((x + 4.5) * invSize, y))),\n        decode32(texture2D(cc_jointTexture, vec2((x + 5.5) * invSize, y))),\n        decode32(texture2D(cc_jointTexture, vec2((x + 6.5) * invSize, y))),\n        decode32(texture2D(cc_jointTexture, vec2((x + 7.5) * invSize, y)))\n      );\n      vec4 v3 = vec4(\n        decode32(texture2D(cc_jointTexture, vec2((x + 8.5) * invSize, y))),\n        decode32(texture2D(cc_jointTexture, vec2((x + 9.5) * invSize, y))),\n        decode32(texture2D(cc_jointTexture, vec2((x + 10.5) * invSize, y))),\n        decode32(texture2D(cc_jointTexture, vec2((x + 11.5) * invSize, y)))\n      );\n      return mat4(vec4(v1.xyz, 0.0), vec4(v2.xyz, 0.0), vec4(v3.xyz, 0.0), vec4(v1.w, v2.w, v3.w, 1.0));\n    }\n  #endif\n#else\n  mat4 getJointMatrix (float i) {\n    int idx = int(i);\n    vec4 v1 = cc_joints[idx * 3];\n    vec4 v2 = cc_joints[idx * 3 + 1];\n    vec4 v3 = cc_joints[idx * 3 + 2];\n    return mat4(vec4(v1.xyz, 0.0), vec4(v2.xyz, 0.0), vec4(v3.xyz, 0.0), vec4(v1.w, v2.w, v3.w, 1.0));\n  }\n#endif\nmat4 skinMatrix () {\n  vec4 joints = vec4(a_joints);\n  return getJointMatrix(joints.x) * a_weights.x\n       + getJointMatrix(joints.y) * a_weights.y\n       + getJointMatrix(joints.z) * a_weights.z\n       + getJointMatrix(joints.w) * a_weights.w;\n}\nvoid CCSkin (inout vec4 position) {\n  mat4 m = skinMatrix();\n  position = m * position;\n}\nvoid CCSkin (inout StandardVertInput attr) {\n  mat4 m = skinMatrix();\n  attr.position = m * attr.position;\n  attr.normal = (m * vec4(attr.normal, 0.0)).xyz;\n  attr.tangent.xyz = (m * vec4(attr.tangent.xyz, 0.0)).xyz;\n}\n#endif\nuniform highp mat4 cc_matView;\nuniform highp mat4 cc_matProj;\nuniform highp vec4 cc_cameraPos;\nuniform mediump vec4 cc_fogBase;\nuniform mediump vec4 cc_fogAdd;\n#if USE_INSTANCING\n  attribute vec4 a_matWorld0;\n  attribute vec4 a_matWorld1;\n  attribute vec4 a_matWorld2;\n  #if USE_LIGHTMAP\n    attribute vec4 a_lightingMapUVParam;\n  #endif\n#elif USE_BATCHING\n  attribute float a_dyn_batch_id;\n  uniform highp mat4 cc_matWorlds[10];\n#else\nuniform highp mat4 cc_matWorld;\nuniform highp mat4 cc_matWorldIT;\nuniform highp vec4 cc_lightingMapUVParam;\n#endif\nuniform vec4 tilingOffset;\nfloat LinearFog(vec4 pos) {\n    vec4 wPos = pos;\n    float cam_dis = distance(cc_cameraPos, wPos);\n    float fogStart = cc_fogBase.x;\n    float fogEnd = cc_fogBase.y;\n    return clamp((fogEnd - cam_dis) / (fogEnd - fogStart), 0., 1.);\n}\nfloat ExpFog(vec4 pos) {\n    vec4 wPos = pos;\n    float fogAtten = cc_fogAdd.z;\n    float fogDensity = cc_fogBase.z;\n    float cam_dis = distance(cc_cameraPos, wPos) / fogAtten * 4.;\n    float f = exp(-cam_dis * fogDensity);\n    return f;\n}\nfloat ExpSquaredFog(vec4 pos) {\n    vec4 wPos = pos;\n    float fogAtten = cc_fogAdd.z;\n    float fogDensity = cc_fogBase.z;\n    float cam_dis = distance(cc_cameraPos, wPos) / fogAtten * 4.;\n    float f = exp(-cam_dis * cam_dis * fogDensity * fogDensity);\n    return f;\n}\nfloat LayeredFog(vec4 pos) {\n    vec4 wPos = pos;\n    float fogAtten = cc_fogAdd.z;\n    float _FogTop = cc_fogAdd.x;\n    float _FogRange = cc_fogAdd.y;\n    vec3 camWorldProj = cc_cameraPos.xyz;\n    camWorldProj.y = 0.;\n    vec3 worldPosProj = wPos.xyz;\n    worldPosProj.y = 0.;\n    float fDeltaD = distance(worldPosProj, camWorldProj) / fogAtten * 2.0;\n    float fDeltaY, fDensityIntegral;\n    if (cc_cameraPos.y > _FogTop) {\n        if (wPos.y < _FogTop) {\n            fDeltaY = (_FogTop - wPos.y) / _FogRange * 2.0;\n            fDensityIntegral = fDeltaY * fDeltaY * 0.5;\n        } else {\n            fDeltaY = 0.;\n            fDensityIntegral = 0.;\n        }\n    } else {\n        if (wPos.y < _FogTop) {\n            float fDeltaA = (_FogTop - cc_cameraPos.y) / _FogRange * 2.;\n            float fDeltaB = (_FogTop - wPos.y) / _FogRange * 2.;\n            fDeltaY = abs(fDeltaA - fDeltaB);\n            fDensityIntegral = abs((fDeltaA * fDeltaA * 0.5) - (fDeltaB * fDeltaB * 0.5));\n        } else {\n            fDeltaY = abs(_FogTop - cc_cameraPos.y) / _FogRange * 2.;\n            fDensityIntegral = abs(fDeltaY * fDeltaY * 0.5);\n        }\n    }\n    float fDensity;\n    if (fDeltaY != 0.) {\n        fDensity = (sqrt(1.0 + ((fDeltaD / fDeltaY) * (fDeltaD / fDeltaY)))) * fDensityIntegral;\n    } else {\n        fDensity = 0.;\n    }\n    float f = exp(-fDensity);\n    return f;\n}\nfloat CC_TRANSFER_FOG(vec4 pos) {\n    #if CC_USE_FOG == 0\n        return LinearFog(pos);\n\t#elif CC_USE_FOG == 1\n        return ExpFog(pos);\n    #elif CC_USE_FOG == 2\n        return ExpSquaredFog(pos);\n    #elif CC_USE_FOG == 3\n        return LayeredFog(pos);\n    #endif\n    return 1.;\n}\nvarying highp vec4 v_shadowPos;\nuniform highp mat4 cc_matLightViewProj;\n#if USE_VERTEX_COLOR\n  attribute vec4 a_color;\n  varying vec4 v_color;\n#endif\nvarying vec3 v_position;\nvarying vec3 v_normal;\nvarying vec2 v_uv;\nvarying vec2 v_uv1;\nvarying float v_fog_factor;\n#if USE_NORMAL_MAP\n  varying vec3 v_tangent;\n  varying vec3 v_bitangent;\n#endif\n#if HAS_SECOND_UV || USE_LIGHTMAP\n  attribute vec2 a_texCoord1;\n#endif\n#if USE_LIGHTMAP && !USE_BATCHING && !CC_FORWARD_ADD\n  varying vec2 v_luv;\nvoid CCLightingMapCaclUV()\n{\n#if !USE_INSTANCING\n      v_luv = cc_lightingMapUVParam.xy + a_texCoord1 * cc_lightingMapUVParam.zw;\n#else\n      v_luv = a_lightingMapUVParam.xy + a_texCoord1 * a_lightingMapUVParam.zw;\n#endif\n}\n#endif\nvec4 vert () {\n  StandardVertInput In;\n  In.position = vec4(a_position, 1.0);\n  In.normal = a_normal;\n  In.tangent = a_tangent;\n  #if CC_USE_MORPH\n    applyMorph(In);\n  #endif\n  #if CC_USE_SKINNING\n    CCSkin(In);\n  #endif\n  mat4 matWorld, matWorldIT;\n  #if USE_INSTANCING\n    matWorld = mat4(\n      vec4(a_matWorld0.xyz, 0.0),\n      vec4(a_matWorld1.xyz, 0.0),\n      vec4(a_matWorld2.xyz, 0.0),\n      vec4(a_matWorld0.w, a_matWorld1.w, a_matWorld2.w, 1.0)\n    );\n    matWorldIT = matWorld;\n  #elif USE_BATCHING\n    matWorld = cc_matWorlds[int(a_dyn_batch_id)];\n    matWorldIT = matWorld;\n  #else\n    matWorld = cc_matWorld;\n    matWorldIT = cc_matWorldIT;\n  #endif\n  vec4 pos = matWorld * In.position;\n  v_position = pos.xyz;\n  v_normal = normalize((matWorldIT * vec4(In.normal, 0.0)).xyz);\n  #if USE_NORMAL_MAP\n    v_tangent = normalize((matWorld * vec4(In.tangent.xyz, 0.0)).xyz);\n    v_bitangent = cross(v_normal, v_tangent) * In.tangent.w;\n  #endif\n  v_uv = a_texCoord * tilingOffset.xy + tilingOffset.zw;\n  #if HAS_SECOND_UV\n    v_uv1 = a_texCoord1 * tilingOffset.xy + tilingOffset.zw;\n  #endif\n  #if USE_VERTEX_COLOR\n    v_color = a_color;\n  #endif\n  v_fog_factor = CC_TRANSFER_FOG(pos);\n  #if USE_LIGHTMAP && !USE_BATCHING && !CC_FORWARD_ADD\n    CCLightingMapCaclUV();\n  #endif\n    v_shadowPos = cc_matLightViewProj * pos;\n  return cc_matProj * (cc_matView * matWorld) * In.position;\n}\nvoid main() { gl_Position = vert(); }",frag:"\n#ifdef GL_EXT_shader_texture_lod\n#extension GL_EXT_shader_texture_lod: enable\n#endif\nprecision highp float;\nuniform highp vec4 cc_cameraPos;\nuniform mediump vec4 cc_exposure;\nuniform mediump vec4 cc_mainLitDir;\nuniform mediump vec4 cc_mainLitColor;\nuniform mediump vec4 cc_ambientSky;\nuniform mediump vec4 cc_ambientGround;\nuniform mediump vec4 cc_fogColor;\nuniform lowp vec4 cc_shadowColor;\nuniform lowp vec4 cc_shadowInfo;\n#if CC_USE_IBL\nuniform samplerCube cc_environment;\nvec3 unpackRGBE (vec4 rgbe) {\n  return rgbe.rgb * pow(2.0, rgbe.a * 255.0 - 128.0);\n}\nvec4 fragTextureLod (sampler2D tex, vec2 coord, float lod) {\n    #ifdef GL_EXT_shader_texture_lod\n      return texture2DLodEXT(tex, coord, lod);\n    #else\n      return texture2D(tex, coord, lod);\n    #endif\n}\nvec4 fragTextureLod (samplerCube tex, vec3 coord, float lod) {\n    #ifdef GL_EXT_shader_texture_lod\n      return textureCubeLodEXT(tex, coord, lod);\n    #else\n      return textureCube(tex, coord, lod);\n    #endif\n}\n#endif\n#if CC_RECEIVE_SHADOW\nvarying highp vec4 v_shadowPos;\n#if CC_RECEIVE_SHADOW\n  uniform sampler2D cc_shadowMap;\n  uniform sampler2D cc_spotLightingMap;\n  float CCGetShadowFactorX1 () {\n    vec3 clipPos = v_shadowPos.xyz / v_shadowPos.w * 0.5 + 0.5;\n    if (clipPos.x < 0.0 || clipPos.x > 1.0 ||\n        clipPos.y < 0.0 || clipPos.y > 1.0 ||\n        clipPos.z <-1.0 || clipPos.z > 1.0) { return 0.0; }\n    float closestDepth = dot(texture2D(cc_shadowMap, clipPos.xy), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 160581375.0));\n    float shadow = step(closestDepth, clipPos.z - cc_shadowInfo.w);\n    return shadow;\n  }\n  float CCGetShadowFactorX5 () {\n    vec3 clipPos = v_shadowPos.xyz / v_shadowPos.w * 0.5 + 0.5;\n    if (clipPos.x < 0.0 || clipPos.x > 1.0 ||\n        clipPos.y < 0.0 || clipPos.y > 1.0 ||\n        clipPos.z <-1.0 || clipPos.z > 1.0) { return 0.0; }\n    float offsetx = 1.0 / cc_shadowInfo.x;\n    float offsety = 1.0 / cc_shadowInfo.y;\n    float shadow = 0.0;\n    float closestDepth = 0.0;\n    closestDepth = dot(texture2D(cc_shadowMap, vec2(clipPos.x - offsetx, clipPos.y - offsety)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 160581375.0));\n    shadow += step(closestDepth, clipPos.z - cc_shadowInfo.w);\n    closestDepth = dot(texture2D(cc_shadowMap, vec2(clipPos.x - offsetx, clipPos.y + offsety)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 160581375.0));\n    shadow += step(closestDepth, clipPos.z - cc_shadowInfo.w);\n    closestDepth = dot(texture2D(cc_shadowMap, vec2(clipPos.x, clipPos.y)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 160581375.0));\n    shadow += step(closestDepth, clipPos.z - cc_shadowInfo.w);\n    closestDepth = dot(texture2D(cc_shadowMap, vec2(clipPos.x + offsetx, clipPos.y - offsety)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 160581375.0));\n    shadow += step(closestDepth, clipPos.z - cc_shadowInfo.w);\n    closestDepth = dot(texture2D(cc_shadowMap, vec2(clipPos.x + offsetx, clipPos.y + offsety)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 160581375.0));\n    shadow += step(closestDepth, clipPos.z - cc_shadowInfo.w);\n    return shadow / 5.0;\n  }\n  float CCGetShadowFactorX9 () {\n    vec3 clipPos = v_shadowPos.xyz / v_shadowPos.w * 0.5 + 0.5;\n    if (clipPos.x < 0.0 || clipPos.x > 1.0 ||\n        clipPos.y < 0.0 || clipPos.y > 1.0 ||\n        clipPos.z <-1.0 || clipPos.z > 1.0) { return 0.0; }\n    float offsetx = 1.0 / cc_shadowInfo.x;\n    float offsety = 1.0 / cc_shadowInfo.y;\n    float shadow = 0.0;\n    for (int i = -1; i <= 1; i++) {\n      for (int j = -1; j <= 1; j++) {\n        float closestDepth = dot(texture2D(cc_shadowMap, clipPos.xy + vec2(i, j) * vec2(offsetx, offsety)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 160581375.0));\n        shadow += step(closestDepth, clipPos.z - cc_shadowInfo.w);\n      }\n    }\n    return shadow / 9.0;\n  }\n  float CCGetShadowFactorX25 () {\n    vec3 clipPos = v_shadowPos.xyz / v_shadowPos.w * 0.5 + 0.5;\n    if (clipPos.x < 0.0 || clipPos.x > 1.0 ||\n        clipPos.y < 0.0 || clipPos.y > 1.0 ||\n        clipPos.z <-1.0 || clipPos.z > 1.0) { return 0.0; }\n    float offsetx = 1.0 / cc_shadowInfo.x;\n    float offsety = 1.0 / cc_shadowInfo.y;\n    float shadow = 0.0;\n    for (int i = -2; i <= 2; i++) {\n      for (int j = -2; j <= 2; j++) {\n        float closestDepth = dot(texture2D(cc_shadowMap, clipPos.xy + vec2(i, j) * vec2(offsetx, offsety)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 160581375.0));\n        shadow += step(closestDepth, clipPos.z - cc_shadowInfo.w);\n      }\n    }\n    return shadow / 25.0;\n  }\n  float CCGetDirLightShadowFactorX1 () {\n    vec3 clipPos = v_shadowPos.xyz / v_shadowPos.w * 0.5 + 0.5;\n    if (clipPos.x < 0.0 || clipPos.x > 1.0 ||\n        clipPos.y < 0.0 || clipPos.y > 1.0 ||\n        clipPos.z <-1.0 || clipPos.z > 1.0) { return 0.0; }\n    float closestDepth = dot(texture2D(cc_spotLightingMap, clipPos.xy), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 160581375.0));\n    float shadow = step(closestDepth, clipPos.z - cc_shadowInfo.w);\n    return shadow;\n  }\n  float CCGetDirLightShadowFactorX5 () {\n    vec3 clipPos = v_shadowPos.xyz / v_shadowPos.w * 0.5 + 0.5;\n    if (clipPos.x < 0.0 || clipPos.x > 1.0 ||\n        clipPos.y < 0.0 || clipPos.y > 1.0 ||\n        clipPos.z <-1.0 || clipPos.z > 1.0) { return 0.0; }\n    float offsetx = 1.0 / cc_shadowInfo.x;\n    float offsety = 1.0 / cc_shadowInfo.y;\n    float shadow = 0.0;\n    float closestDepth = 0.0;\n    closestDepth = dot(texture2D(cc_spotLightingMap, vec2(clipPos.x - offsetx, clipPos.y - offsety)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 160581375.0));\n    shadow += step(closestDepth, clipPos.z - cc_shadowInfo.w);\n    closestDepth = dot(texture2D(cc_spotLightingMap, vec2(clipPos.x - offsetx, clipPos.y + offsety)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 160581375.0));\n    shadow += step(closestDepth, clipPos.z - cc_shadowInfo.w);\n    closestDepth = dot(texture2D(cc_spotLightingMap, vec2(clipPos.x, clipPos.y)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 160581375.0));\n    shadow += step(closestDepth, clipPos.z - cc_shadowInfo.w);\n    closestDepth = dot(texture2D(cc_spotLightingMap, vec2(clipPos.x + offsetx, clipPos.y - offsety)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 160581375.0));\n    shadow += step(closestDepth, clipPos.z - cc_shadowInfo.w);\n    closestDepth = dot(texture2D(cc_spotLightingMap, vec2(clipPos.x + offsetx, clipPos.y + offsety)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 160581375.0));\n    return shadow / 5.0;\n  }\n  float CCGetDirLightShadowFactorX9 () {\n    vec3 clipPos = v_shadowPos.xyz / v_shadowPos.w * 0.5 + 0.5;\n    if (clipPos.x < 0.0 || clipPos.x > 1.0 ||\n        clipPos.y < 0.0 || clipPos.y > 1.0 ||\n        clipPos.z <-1.0 || clipPos.z > 1.0) { return 0.0; }\n    float offsetx = 1.0 / cc_shadowInfo.x;\n    float offsety = 1.0 / cc_shadowInfo.y;\n    float shadow = 0.0;\n    for (int i = -1; i <= 1; i++) {\n      for (int j = -1; j <= 1; j++) {\n        float closestDepth = dot(texture2D(cc_spotLightingMap, clipPos.xy + vec2(i, j) * vec2(offsetx, offsety)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 160581375.0));\n        shadow += step(closestDepth, clipPos.z - cc_shadowInfo.w);\n      }\n    }\n    return shadow / 9.0;\n  }\n  float CCGetDirLightShadowFactorX25 () {\n    vec3 clipPos = v_shadowPos.xyz / v_shadowPos.w * 0.5 + 0.5;\n    if (clipPos.x < 0.0 || clipPos.x > 1.0 ||\n        clipPos.y < 0.0 || clipPos.y > 1.0 ||\n        clipPos.z <-1.0 || clipPos.z > 1.0) { return 0.0; }\n    float offsetx = 1.0 / cc_shadowInfo.x;\n    float offsety = 1.0 / cc_shadowInfo.y;\n    float shadow = 0.0;\n    for (int i = -2; i <= 2; i++) {\n      for (int j = -2; j <= 2; j++) {\n        float closestDepth = dot(texture2D(cc_spotLightingMap, clipPos.xy + vec2(i, j) * vec2(offsetx, offsety)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 160581375.0));\n        shadow += step(closestDepth, clipPos.z - cc_shadowInfo.w);\n      }\n    }\n    return shadow / 25.0;\n  }\n#endif\n#endif\nvec3 SRGBToLinear (vec3 gamma) {\n  return gamma * gamma;\n}\nfloat GGXMobile (float roughness, float NoH, vec3 H, vec3 N) {\n  vec3 NxH = cross(N, H);\n  float OneMinusNoHSqr = dot(NxH, NxH);\n  float a = roughness * roughness;\n  float n = NoH * a;\n  float p = a / (OneMinusNoHSqr + n * n);\n  return p * p;\n}\nfloat CalcSpecular (float roughness, float NoH, vec3 H, vec3 N) {\n  return (roughness*0.25 + 0.25) * GGXMobile(roughness, NoH, H, N);\n}\nvec3 BRDFApprox (vec3 specular, float roughness, float NoV) {\n  const vec4 c0 = vec4(-1.0, -0.0275, -0.572, 0.022);\n  const vec4 c1 = vec4(1.0, 0.0425, 1.04, -0.04);\n  vec4 r = roughness * c0 + c1;\n  float a004 = min( r.x * r.x, exp2( -9.28 * NoV ) ) * r.x + r.y;\n  vec2 AB = vec2( -1.04, 1.04 ) * a004 + r.zw;\n  AB.y *= clamp(50.0 * specular.g, 0.0, 1.0);\n  return specular * AB.x + AB.y;\n}\nstruct StandardSurface {\n  vec4 albedo;\n  vec3 position;\n  vec3 normal;\n  vec3 emissive;\n  vec4 lightmap;\n  float roughness;\n  float metallic;\n  float occlusion;\n};\n#if CC_FORWARD_ADD\nuniform highp vec4 cc_lightPos[1];\nuniform vec4 cc_lightColor[1];\nuniform vec4 cc_lightSizeRangeAngle[1];\nuniform vec4 cc_lightDir[1];\nfloat SmoothDistAtt (float distSqr, float invSqrAttRadius) {\n  float factor = distSqr * invSqrAttRadius;\n  float smoothFactor = clamp(1.0 - factor * factor, 0.0, 1.0);\n  return smoothFactor * smoothFactor;\n}\nfloat GetDistAtt (float distSqr, float invSqrAttRadius) {\n  float attenuation = 1.0 / max(distSqr, 0.01*0.01);\n  attenuation *= SmoothDistAtt(distSqr , invSqrAttRadius);\n  return attenuation;\n}\nfloat GetAngleAtt (vec3 L, vec3 litDir, float litAngleScale, float litAngleOffset) {\n  float cd = dot(litDir, L);\n  float attenuation = clamp(cd * litAngleScale + litAngleOffset, 0.0, 1.0);\n  return (attenuation * attenuation);\n}\n  vec4 CCStandardShading (StandardSurface s) {\n    vec3 diffuse = s.albedo.rgb * (1.0 - s.metallic);\n    vec3 specular = mix(vec3(0.04), s.albedo.rgb, s.metallic);\n    vec3 diffuseContrib = diffuse / 3.14159265359;\n    vec3 N = normalize(s.normal);\n    vec3 V = normalize(cc_cameraPos.xyz - s.position);\n    float NV = max(abs(dot(N, V)), 0.001);\n    specular = BRDFApprox(specular, s.roughness, NV);\n    vec3 finalColor = vec3(0.0);\n    for (int i = 0; i < 1; i++) {\n      vec3 SLU = cc_lightPos[i].xyz - s.position;\n      vec3 SL = normalize(SLU);\n      vec3 SH = normalize(SL + V);\n      float SNL = max(dot(N, SL), 0.001);\n      float SNH = max(dot(N, SH), 0.0);\n      float distSqr = dot(SLU, SLU);\n      float litRadius = cc_lightSizeRangeAngle[i].x;\n      float litRadiusSqr = litRadius * litRadius;\n      float illum = 3.14159265359 * (litRadiusSqr / max(litRadiusSqr , distSqr));\n      float attRadiusSqrInv = 1.0 / max(cc_lightSizeRangeAngle[i].y, 0.01);\n      attRadiusSqrInv *= attRadiusSqrInv;\n      float att = GetDistAtt(distSqr, attRadiusSqrInv);\n      vec3 lspec = specular * CalcSpecular(s.roughness, SNH, SH, N);\n      if (cc_lightPos[i].w > 0.0) {\n        float cosInner = max(dot(-cc_lightDir[i].xyz, SL), 0.01);\n        float cosOuter = cc_lightSizeRangeAngle[i].z;\n        float litAngleScale = 1.0 / max(0.001, cosInner - cosOuter);\n        float litAngleOffset = -cosOuter * litAngleScale;\n        att *= GetAngleAtt(SL, -cc_lightDir[i].xyz, litAngleScale, litAngleOffset);\n      }\n      vec3 lightColor = cc_lightColor[i].rgb;\n    #if CC_RECEIVE_SHADOW\n      if (cc_lightPos[i].w > 0.0) {\n    {\n      float pcf = cc_shadowInfo.z + 0.001;\n      float shadowAttenuation = 0.0;\n      if (pcf > 3.0) shadowAttenuation = CCGetDirLightShadowFactorX25();\n      else if (3.0 > pcf && pcf > 2.0) shadowAttenuation = CCGetDirLightShadowFactorX9();\n      else if (2.0 > pcf && pcf > 1.0) shadowAttenuation = CCGetDirLightShadowFactorX5();\n      else shadowAttenuation = CCGetDirLightShadowFactorX1();\n      lightColor *= 1.0 - shadowAttenuation;\n    }\n      }\n    #endif\n      finalColor += SNL * lightColor * cc_lightColor[i].w * illum * att * (diffuseContrib + lspec);\n    }\n    finalColor = finalColor * s.occlusion;\n    return vec4(finalColor, 0.0);\n  }\n#else\n  vec4 CCStandardShading (StandardSurface s) {\n    vec3 diffuse = s.albedo.rgb * (1.0 - s.metallic);\n    vec3 specular = mix(vec3(0.04), s.albedo.rgb, s.metallic);\n    vec3 N = normalize(s.normal);\n    vec3 V = normalize(cc_cameraPos.xyz - s.position);\n    float NV = max(abs(dot(N, V)), 0.001);\n    specular = BRDFApprox(specular, s.roughness, NV);\n    vec3 L = normalize(-cc_mainLitDir.xyz);\n    vec3 H = normalize(L+V);\n    float NH = max(dot(N, H), 0.0);\n    float NL = max(dot(N, L), 0.001);\n    vec3 finalColor = NL * cc_mainLitColor.rgb * cc_mainLitColor.w;\n    #if USE_LIGHTMAP && !USE_BATCHING && !CC_FORWARD_ADD\n      finalColor = s.lightmap.a * s.lightmap.rgb + (1.0 - s.lightmap.a) * finalColor;\n    #endif\n    vec3 diffuseContrib = diffuse / 3.14159265359;\n    vec3 specularContrib = specular * CalcSpecular(s.roughness, NH, H, N);\n    finalColor *= (diffuseContrib + specularContrib);\n    float fAmb = 0.5 - N.y * 0.5;\n    vec3 ambDiff = mix(cc_ambientSky.rgb, cc_ambientGround.rgb, fAmb) * cc_ambientSky.w;\n    finalColor += (ambDiff.rgb * diffuse);\n    #if CC_USE_IBL\n      vec3 R = normalize(reflect(-V, N));\n      vec4 envmap = fragTextureLod(cc_environment, R, s.roughness * cc_ambientGround.w);\n      #if CC_USE_IBL == 2\n        vec3 env = unpackRGBE(envmap);\n      #else\n        vec3 env = SRGBToLinear(envmap.rgb);\n      #endif\n      finalColor += env * cc_ambientSky.w * specular;\n    #endif\n    finalColor = finalColor * s.occlusion;\n    #if CC_USE_HDR\n      s.emissive *= cc_exposure.w;\n    #endif\n    finalColor += s.emissive;\n    #if CC_RECEIVE_SHADOW\n    {\n      float pcf = cc_shadowInfo.z + 0.001;\n      float shadowAttenuation = 0.0;\n      if (pcf > 3.0) shadowAttenuation = CCGetShadowFactorX25();\n      else if (3.0 > pcf && pcf > 2.0) shadowAttenuation = CCGetShadowFactorX9();\n      else if (2.0 > pcf && pcf > 1.0) shadowAttenuation = CCGetShadowFactorX5();\n      else shadowAttenuation = CCGetShadowFactorX1();\n      vec3 shadowColor = cc_shadowColor.rgb * cc_shadowColor.a + finalColor.rgb * (1.0 - cc_shadowColor.a);\n      finalColor.rgb = shadowColor.rgb * shadowAttenuation * NL + finalColor.rgb * (1.0 - shadowAttenuation * NL);\n    }\n    #endif\n    return vec4(finalColor, s.albedo.a);\n  }\n#endif\nvec3 ACESToneMap (vec3 color) {\n  color = min(color, vec3(8.0));\n  const float A = 2.51;\n  const float B = 0.03;\n  const float C = 2.43;\n  const float D = 0.59;\n  const float E = 0.14;\n  return (color * (A * color + B)) / (color * (C * color + D) + E);\n}\nvec4 CCFragOutput (vec4 color) {\n  #if !CC_USE_HDR\n    color.rgb = sqrt(ACESToneMap(color.rgb));\n  #endif\n  return color;\n}\nuniform vec4 albedo;\nuniform vec4 albedoScaleAndCutoff;\nuniform vec4 pbrParams;\nuniform vec4 emissive;\nuniform vec4 emissiveScaleParam;\n#if USE_LIGHTMAP && !USE_BATCHING && !CC_FORWARD_ADD\n  varying vec2 v_luv;\nuniform sampler2D cc_lightingMap;\n#endif\nvarying vec3 v_position;\nvarying vec2 v_uv;\nvarying vec2 v_uv1;\nvarying vec3 v_normal;\nvarying float v_fog_factor;\n#if USE_VERTEX_COLOR\n  varying vec4 v_color;\n#endif\n#if USE_ALBEDO_MAP\n  uniform sampler2D albedoMap;\n#endif\n#if USE_NORMAL_MAP\n  varying vec3 v_tangent;\n  varying vec3 v_bitangent;\n  uniform sampler2D normalMap;\n#endif\n#if USE_PBR_MAP\n  uniform sampler2D pbrMap;\n#endif\n#if USE_METALLIC_ROUGHNESS_MAP\n  uniform sampler2D metallicRoughnessMap;\n#endif\n#if USE_OCCLUSION_MAP\n  uniform sampler2D occlusionMap;\n#endif\n#if USE_EMISSIVE_MAP\n  uniform sampler2D emissiveMap;\n#endif\n#if USE_ALPHA_TEST\n#endif\nvoid surf (out StandardSurface s) {\n  vec4 baseColor = albedo;\n  #if USE_VERTEX_COLOR\n    baseColor *= v_color;\n  #endif\n  #if USE_ALBEDO_MAP\n    vec4 texColor = texture2D(albedoMap, ALBEDO_UV);\n    texColor.rgb = SRGBToLinear(texColor.rgb);\n    baseColor *= texColor;\n  #endif\n  s.albedo = baseColor;\n  s.albedo.rgb *= albedoScaleAndCutoff.xyz;\n  #if USE_ALPHA_TEST\n    if (s.albedo.ALPHA_TEST_CHANNEL < albedoScaleAndCutoff.w) discard;\n  #endif\n  #if USE_LIGHTMAP && !USE_BATCHING && !CC_FORWARD_ADD\n    s.lightmap = texture2D(cc_lightingMap, v_luv);\n  #endif\n  s.normal = v_normal;\n  #if USE_NORMAL_MAP\n    vec3 nmmp = texture2D(normalMap, NORMAL_UV).xyz - vec3(0.5);\n    s.normal =\n      (nmmp.x * pbrParams.w) * normalize(v_tangent) +\n      (nmmp.y * pbrParams.w) * normalize(v_bitangent) +\n      nmmp.z * normalize(s.normal);\n  #endif\n  s.position = v_position;\n  vec4 pbr = pbrParams;\n  #if USE_PBR_MAP\n    vec4 res = texture2D(pbrMap, PBR_UV);\n    pbr.x *= res.r;\n    pbr.y *= res.g;\n    pbr.z *= res.b;\n  #endif\n  #if USE_METALLIC_ROUGHNESS_MAP\n    vec4 metallicRoughness = texture2D(metallicRoughnessMap, PBR_UV);\n    pbr.z *= metallicRoughness.b;\n    pbr.y *= metallicRoughness.g;\n  #endif\n  #if USE_OCCLUSION_MAP\n    pbr.x *= texture2D(occlusionMap, PBR_UV).r;\n  #endif\n  s.occlusion = clamp(pbr.x, 0.0, 0.96);\n  s.roughness = clamp(pbr.y, 0.04, 1.0);\n  s.metallic = pbr.z;\n  s.emissive = emissive.rgb * emissiveScaleParam.xyz;\n  #if USE_EMISSIVE_MAP\n    s.emissive *= SRGBToLinear(texture2D(emissiveMap, EMISSIVE_UV).rgb);\n  #endif\n}\nvec4 frag () {\n  StandardSurface s; surf(s);\n  vec4 color = CCStandardShading(s);\n  color = vec4(mix(CC_FORWARD_ADD > 0 ? vec3(0.0) : cc_fogColor.rgb, color.rgb, v_fog_factor), color.a);\n  return CCFragOutput(color);\n}\nvoid main() { gl_FragColor = frag(); }"},{vert:"\nprecision highp float;\nhighp float decode32 (highp vec4 rgba) {\n  rgba = rgba * 255.0;\n  highp float Sign = 1.0 - (step(128.0, (rgba[3]) + 0.5)) * 2.0;\n  highp float Exponent = 2.0 * (mod(float(int((rgba[3]) + 0.5)), 128.0)) + (step(128.0, (rgba[2]) + 0.5)) - 127.0;\n  highp float Mantissa = (mod(float(int((rgba[2]) + 0.5)), 128.0)) * 65536.0 + rgba[1] * 256.0 + rgba[0] + 8388608.0;\n  return Sign * exp2(Exponent - 23.0) * Mantissa;\n}\nstruct StandardVertInput {\n  highp vec4 position;\n  vec3 normal;\n  vec4 tangent;\n};\nattribute vec3 a_position;\nattribute vec3 a_normal;\nattribute vec2 a_texCoord;\nattribute vec4 a_tangent;\n#if CC_USE_MORPH\n    attribute float a_vertexId;\n    int getVertexId() {\n        return int(a_vertexId);\n    }\nuniform vec4 cc_displacementWeights[15];\nuniform vec4 cc_displacementTextureInfo;\nvec2 getPixelLocation(vec2 textureResolution, int pixelIndex) {\n    float pixelIndexF = float(pixelIndex);\n    float x = mod(pixelIndexF, textureResolution.x);\n    float y = floor(pixelIndexF / textureResolution.x);\n    return vec2(x, y);\n}\nvec2 getPixelCoordFromLocation(vec2 location, vec2 textureResolution) {\n    return (vec2(location.x, location.y) + .5) / textureResolution;\n}\n#if CC_SUPPORT_FLOAT_TEXTURE\n        vec4 fetchVec3ArrayFromTexture(sampler2D tex, int elementIndex) {\n            int pixelIndex = elementIndex;\n            vec2 location = getPixelLocation(cc_displacementTextureInfo.xy, pixelIndex);\n            vec2 uv = getPixelCoordFromLocation(location, cc_displacementTextureInfo.xy);\n            return texture2D(tex, uv);\n        }\n#else\n    vec4 fetchVec3ArrayFromTexture(sampler2D tex, int elementIndex) {\n        int pixelIndex = elementIndex * 4;\n        vec2 location = getPixelLocation(cc_displacementTextureInfo.xy, pixelIndex);\n        vec2 x = getPixelCoordFromLocation(location + vec2(0.0, 0.0), cc_displacementTextureInfo.xy);\n        vec2 y = getPixelCoordFromLocation(location + vec2(1.0, 0.0), cc_displacementTextureInfo.xy);\n        vec2 z = getPixelCoordFromLocation(location + vec2(2.0, 0.0), cc_displacementTextureInfo.xy);\n        return vec4(\n            decode32(texture2D(tex, x)),\n            decode32(texture2D(tex, y)),\n            decode32(texture2D(tex, z)),\n            1.0\n        );\n    }\n#endif\nfloat getDisplacementWeight(int index) {\n    int quot = index / 4;\n    int remainder = index - quot * 4;\n    if (remainder == 0) {\n        return cc_displacementWeights[quot].x;\n    } else if (remainder == 1) {\n        return cc_displacementWeights[quot].y;\n    } else if (remainder == 2) {\n        return cc_displacementWeights[quot].z;\n    } else {\n        return cc_displacementWeights[quot].w;\n    }\n}\nvec3 getVec3DisplacementFromTexture(sampler2D tex, int vertexIndex) {\n#if CC_MORPH_PRECOMPUTED\n    return fetchVec3ArrayFromTexture(tex, vertexIndex).rgb;\n#else\n    vec3 result = vec3(0, 0, 0);\n    int nVertices = int(cc_displacementTextureInfo.z);\n    for (int iTarget = 0; iTarget < CC_MORPH_TARGET_COUNT; ++iTarget) {\n        result += (fetchVec3ArrayFromTexture(tex, nVertices * iTarget + vertexIndex).rgb * getDisplacementWeight(iTarget));\n    }\n    return result;\n#endif\n}\n#if CC_MORPH_TARGET_HAS_POSITION\n    uniform sampler2D cc_PositionDisplacements;\n    vec3 getPositionDisplacement(int vertexId) {\n        return getVec3DisplacementFromTexture(cc_PositionDisplacements, vertexId);\n    }\n#endif\n#if CC_MORPH_TARGET_HAS_NORMAL\n    uniform sampler2D cc_NormalDisplacements;\n    vec3 getNormalDisplacement(int vertexId) {\n        return getVec3DisplacementFromTexture(cc_NormalDisplacements, vertexId);\n    }\n#endif\n#if CC_MORPH_TARGET_HAS_TANGENT\n    uniform sampler2D cc_TangentDisplacements;\n    vec3 getTangentDisplacement(int vertexId) {\n        return getVec3DisplacementFromTexture(cc_TangentDisplacements, vertexId);\n    }\n#endif\nvoid applyMorph (inout StandardVertInput attr) {\n    int vertexId = getVertexId();\n#if CC_MORPH_TARGET_HAS_POSITION\n    attr.position.xyz = attr.position.xyz + getPositionDisplacement(vertexId);\n#endif\n#if CC_MORPH_TARGET_HAS_NORMAL\n    attr.normal.xyz = attr.normal.xyz + getNormalDisplacement(vertexId);\n#endif\n#if CC_MORPH_TARGET_HAS_TANGENT\n    attr.tangent.xyz = attr.tangent.xyz + getTangentDisplacement(vertexId);\n#endif\n}\nvoid applyMorph (inout vec4 position) {\n#if CC_MORPH_TARGET_HAS_POSITION\n    position.xyz = position.xyz + getPositionDisplacement(getVertexId());\n#endif\n}\n#endif\n#if CC_USE_SKINNING\n  attribute vec4 a_joints;\nattribute vec4 a_weights;\n#if CC_USE_BAKED_ANIMATION\n  #if USE_INSTANCING\n    attribute highp vec4 a_jointAnimInfo;\n  #endif\n  uniform highp vec4 cc_jointTextureInfo;\n  uniform highp vec4 cc_jointAnimInfo;\n  uniform highp sampler2D cc_jointTexture;\n  #else\n  uniform highp vec4 cc_joints[90];\n#endif\n#if CC_USE_BAKED_ANIMATION\n  #if CC_SUPPORT_FLOAT_TEXTURE\n    mat4 getJointMatrix (float i) {\n    #if USE_INSTANCING\n      highp float j = 3.0 * (a_jointAnimInfo.x * a_jointAnimInfo.y + i) + a_jointAnimInfo.z;\n    #else\n      highp float j = 3.0 * (cc_jointAnimInfo.x * cc_jointTextureInfo.y + i) + cc_jointTextureInfo.z;\n    #endif\n    highp float invSize = cc_jointTextureInfo.w;\n    highp float y = floor(j * invSize);\n    highp float x = j - y * cc_jointTextureInfo.x;\n    y = (y + 0.5) * invSize;\n      vec4 v1 = texture2D(cc_jointTexture, vec2((x + 0.5) * invSize, y));\n      vec4 v2 = texture2D(cc_jointTexture, vec2((x + 1.5) * invSize, y));\n      vec4 v3 = texture2D(cc_jointTexture, vec2((x + 2.5) * invSize, y));\n      return mat4(vec4(v1.xyz, 0.0), vec4(v2.xyz, 0.0), vec4(v3.xyz, 0.0), vec4(v1.w, v2.w, v3.w, 1.0));\n    }\n  #else\n    mat4 getJointMatrix (float i) {\n    #if USE_INSTANCING\n      highp float j = 12.0 * (a_jointAnimInfo.x * a_jointAnimInfo.y + i) + a_jointAnimInfo.z;\n    #else\n      highp float j = 12.0 * (cc_jointAnimInfo.x * cc_jointTextureInfo.y + i) + cc_jointTextureInfo.z;\n    #endif\n    highp float invSize = cc_jointTextureInfo.w;\n    highp float y = floor(j * invSize);\n    highp float x = j - y * cc_jointTextureInfo.x;\n    y = (y + 0.5) * invSize;\n      vec4 v1 = vec4(\n        decode32(texture2D(cc_jointTexture, vec2((x + 0.5) * invSize, y))),\n        decode32(texture2D(cc_jointTexture, vec2((x + 1.5) * invSize, y))),\n        decode32(texture2D(cc_jointTexture, vec2((x + 2.5) * invSize, y))),\n        decode32(texture2D(cc_jointTexture, vec2((x + 3.5) * invSize, y)))\n      );\n      vec4 v2 = vec4(\n        decode32(texture2D(cc_jointTexture, vec2((x + 4.5) * invSize, y))),\n        decode32(texture2D(cc_jointTexture, vec2((x + 5.5) * invSize, y))),\n        decode32(texture2D(cc_jointTexture, vec2((x + 6.5) * invSize, y))),\n        decode32(texture2D(cc_jointTexture, vec2((x + 7.5) * invSize, y)))\n      );\n      vec4 v3 = vec4(\n        decode32(texture2D(cc_jointTexture, vec2((x + 8.5) * invSize, y))),\n        decode32(texture2D(cc_jointTexture, vec2((x + 9.5) * invSize, y))),\n        decode32(texture2D(cc_jointTexture, vec2((x + 10.5) * invSize, y))),\n        decode32(texture2D(cc_jointTexture, vec2((x + 11.5) * invSize, y)))\n      );\n      return mat4(vec4(v1.xyz, 0.0), vec4(v2.xyz, 0.0), vec4(v3.xyz, 0.0), vec4(v1.w, v2.w, v3.w, 1.0));\n    }\n  #endif\n#else\n  mat4 getJointMatrix (float i) {\n    int idx = int(i);\n    vec4 v1 = cc_joints[idx * 3];\n    vec4 v2 = cc_joints[idx * 3 + 1];\n    vec4 v3 = cc_joints[idx * 3 + 2];\n    return mat4(vec4(v1.xyz, 0.0), vec4(v2.xyz, 0.0), vec4(v3.xyz, 0.0), vec4(v1.w, v2.w, v3.w, 1.0));\n  }\n#endif\nmat4 skinMatrix () {\n  vec4 joints = vec4(a_joints);\n  return getJointMatrix(joints.x) * a_weights.x\n       + getJointMatrix(joints.y) * a_weights.y\n       + getJointMatrix(joints.z) * a_weights.z\n       + getJointMatrix(joints.w) * a_weights.w;\n}\nvoid CCSkin (inout vec4 position) {\n  mat4 m = skinMatrix();\n  position = m * position;\n}\nvoid CCSkin (inout StandardVertInput attr) {\n  mat4 m = skinMatrix();\n  attr.position = m * attr.position;\n  attr.normal = (m * vec4(attr.normal, 0.0)).xyz;\n  attr.tangent.xyz = (m * vec4(attr.tangent.xyz, 0.0)).xyz;\n}\n#endif\n#if USE_INSTANCING\n  attribute vec4 a_matWorld0;\n  attribute vec4 a_matWorld1;\n  attribute vec4 a_matWorld2;\n  #if USE_LIGHTMAP\n    attribute vec4 a_lightingMapUVParam;\n  #endif\n#elif USE_BATCHING\n  attribute float a_dyn_batch_id;\n  uniform highp mat4 cc_matWorlds[10];\n#else\nuniform highp mat4 cc_matWorld;\nuniform highp mat4 cc_matWorldIT;\n#endif\nuniform vec4 tilingOffset;\nuniform highp mat4 cc_matLightViewProj;\n#if HAS_SECOND_UV || USE_LIGHTMAP\n  attribute vec2 a_texCoord1;\n#endif\nvarying vec2 v_uv;\nvarying vec2 v_uv1;\nvarying float v_clip_depth;\nvec4 vert () {\n  StandardVertInput In;\n  In.position = vec4(a_position, 1.0);\n  In.normal = a_normal;\n  In.tangent = a_tangent;\n  #if CC_USE_MORPH\n    applyMorph(In);\n  #endif\n  #if CC_USE_SKINNING\n    CCSkin(In);\n  #endif\n  mat4 matWorld, matWorldIT;\n  #if USE_INSTANCING\n    matWorld = mat4(\n      vec4(a_matWorld0.xyz, 0.0),\n      vec4(a_matWorld1.xyz, 0.0),\n      vec4(a_matWorld2.xyz, 0.0),\n      vec4(a_matWorld0.w, a_matWorld1.w, a_matWorld2.w, 1.0)\n    );\n    matWorldIT = matWorld;\n  #elif USE_BATCHING\n    matWorld = cc_matWorlds[int(a_dyn_batch_id)];\n    matWorldIT = matWorld;\n  #else\n    matWorld = cc_matWorld;\n    matWorldIT = cc_matWorldIT;\n  #endif\n  vec4 worldPos = matWorld * In.position;\n  vec4 clipPos = cc_matLightViewProj * worldPos;\n  v_uv = a_texCoord * tilingOffset.xy + tilingOffset.zw;\n  #if HAS_SECOND_UV\n    v_uv1 = a_texCoord1 * tilingOffset.xy + tilingOffset.zw;\n  #endif\n  v_clip_depth = clipPos.z / clipPos.w * 0.5 + 0.5;\n  return clipPos;\n}\nvoid main() { gl_Position = vert(); }",frag:"\nprecision highp float;\nuniform vec4 albedo;\nuniform vec4 albedoScaleAndCutoff;\nvec4 packDepthToRGBA (float depth) {\n  vec4 ret = vec4(1.0, 255.0, 65025.0, 160581375.0) * depth;\n  ret = fract(ret);\n  ret -= ret.yzww * vec4(1.0 / 255.0, 1.0 / 255.0, 1.0 / 255.0, 0.0);\n  return ret;\n}\nvarying vec2 v_uv;\nvarying vec2 v_uv1;\nvarying float v_clip_depth;\n#if USE_ALBEDO_MAP\n  uniform sampler2D albedoMap;\n#endif\n#if USE_ALPHA_TEST\n#endif\nvec4 frag () {\n  vec4 baseColor = albedo;\n  #if USE_ALBEDO_MAP\n    baseColor *= texture2D(albedoMap, ALBEDO_UV);\n  #endif\n  #if USE_ALPHA_TEST\n    if (baseColor.ALPHA_TEST_CHANNEL < albedoScaleAndCutoff.w) discard;\n  #endif\n  return packDepthToRGBA(v_clip_depth);\n}\nvoid main() { gl_FragColor = frag(); }"}],[{vert:"\nprecision mediump float;\nuniform highp mat4 cc_matViewProj;\nuniform highp vec4 cc_cameraPos;\nuniform mediump vec4 cc_fogBase;\nuniform mediump vec4 cc_fogAdd;\nuniform highp mat4 cc_matWorld;\nfloat LinearFog(vec4 pos) {\n    vec4 wPos = pos;\n    float cam_dis = distance(cc_cameraPos, wPos);\n    float fogStart = cc_fogBase.x;\n    float fogEnd = cc_fogBase.y;\n    return clamp((fogEnd - cam_dis) / (fogEnd - fogStart), 0., 1.);\n}\nfloat ExpFog(vec4 pos) {\n    vec4 wPos = pos;\n    float fogAtten = cc_fogAdd.z;\n    float fogDensity = cc_fogBase.z;\n    float cam_dis = distance(cc_cameraPos, wPos) / fogAtten * 4.;\n    float f = exp(-cam_dis * fogDensity);\n    return f;\n}\nfloat ExpSquaredFog(vec4 pos) {\n    vec4 wPos = pos;\n    float fogAtten = cc_fogAdd.z;\n    float fogDensity = cc_fogBase.z;\n    float cam_dis = distance(cc_cameraPos, wPos) / fogAtten * 4.;\n    float f = exp(-cam_dis * cam_dis * fogDensity * fogDensity);\n    return f;\n}\nfloat LayeredFog(vec4 pos) {\n    vec4 wPos = pos;\n    float fogAtten = cc_fogAdd.z;\n    float _FogTop = cc_fogAdd.x;\n    float _FogRange = cc_fogAdd.y;\n    vec3 camWorldProj = cc_cameraPos.xyz;\n    camWorldProj.y = 0.;\n    vec3 worldPosProj = wPos.xyz;\n    worldPosProj.y = 0.;\n    float fDeltaD = distance(worldPosProj, camWorldProj) / fogAtten * 2.0;\n    float fDeltaY, fDensityIntegral;\n    if (cc_cameraPos.y > _FogTop) {\n        if (wPos.y < _FogTop) {\n            fDeltaY = (_FogTop - wPos.y) / _FogRange * 2.0;\n            fDensityIntegral = fDeltaY * fDeltaY * 0.5;\n        } else {\n            fDeltaY = 0.;\n            fDensityIntegral = 0.;\n        }\n    } else {\n        if (wPos.y < _FogTop) {\n            float fDeltaA = (_FogTop - cc_cameraPos.y) / _FogRange * 2.;\n            float fDeltaB = (_FogTop - wPos.y) / _FogRange * 2.;\n            fDeltaY = abs(fDeltaA - fDeltaB);\n            fDensityIntegral = abs((fDeltaA * fDeltaA * 0.5) - (fDeltaB * fDeltaB * 0.5));\n        } else {\n            fDeltaY = abs(_FogTop - cc_cameraPos.y) / _FogRange * 2.;\n            fDensityIntegral = abs(fDeltaY * fDeltaY * 0.5);\n        }\n    }\n    float fDensity;\n    if (fDeltaY != 0.) {\n        fDensity = (sqrt(1.0 + ((fDeltaD / fDeltaY) * (fDeltaD / fDeltaY)))) * fDensityIntegral;\n    } else {\n        fDensity = 0.;\n    }\n    float f = exp(-fDensity);\n    return f;\n}\nfloat CC_TRANSFER_FOG(vec4 pos) {\n    #if CC_USE_FOG == 0\n        return LinearFog(pos);\n\t#elif CC_USE_FOG == 1\n        return ExpFog(pos);\n    #elif CC_USE_FOG == 2\n        return ExpSquaredFog(pos);\n    #elif CC_USE_FOG == 3\n        return LayeredFog(pos);\n    #endif\n    return 1.;\n}\nvarying highp vec4 v_shadowPos;\nuniform highp mat4 cc_matLightViewProj;\nattribute vec3 a_position;\nattribute vec3 a_normal;\nattribute vec2 a_texCoord;\nvarying highp vec3 v_position;\nvarying mediump vec3 v_normal;\n#if USE_NORMALMAP\n  varying mediump vec3 v_tangent;\n  varying mediump vec3 v_binormal;\n#endif\nvarying mediump vec2 uvw;\nvarying mediump vec2 uv0;\nvarying mediump vec2 uv1;\nvarying mediump vec2 uv2;\nvarying mediump vec2 uv3;\nvarying mediump vec2 luv;\nvarying mediump vec3 diffuse;\nvarying mediump float v_fog_factor;\nuniform vec4 UVScale;\nuniform vec4 lightMapUVParam;\nvec4 vert () {\n  vec3 worldPos;\n  worldPos.x = cc_matWorld[3][0] + a_position.x;\n  worldPos.y = cc_matWorld[3][1] + a_position.y;\n  worldPos.z = cc_matWorld[3][2] + a_position.z;\n  vec4 pos = vec4(worldPos, 1.0);\n  pos = cc_matViewProj * pos;\n  uvw = a_texCoord;\n  uv0 = a_position.xz * UVScale.x;\n  uv1 = a_position.xz * UVScale.y;\n  uv2 = a_position.xz * UVScale.z;\n  uv3 = a_position.xz * UVScale.w;\n  #if USE_LIGHTMAP\n    luv = lightMapUVParam.xy + a_texCoord * lightMapUVParam.zw;\n  #endif\n  v_position = worldPos;\n  v_normal = a_normal;\n  v_fog_factor = CC_TRANSFER_FOG(vec4(worldPos, 1.0));\n  #if USE_NORMALMAP\n    v_tangent = vec3(1.0, 0.0, 0.0);\n    v_binormal = vec3(0.0, 0.0, 1.0);\n    v_binormal = cross(v_tangent, a_normal);\n    v_tangent = cross(a_normal, v_binormal);\n  #endif\n    v_shadowPos = cc_matLightViewProj * vec4(worldPos, 1.0);\n  return pos;\n}\nvoid main() { gl_Position = vert(); }",frag:"\n#ifdef GL_EXT_shader_texture_lod\n#extension GL_EXT_shader_texture_lod: enable\n#endif\nprecision highp float;\nuniform highp vec4 cc_cameraPos;\nuniform mediump vec4 cc_exposure;\nuniform mediump vec4 cc_mainLitDir;\nuniform mediump vec4 cc_mainLitColor;\nuniform mediump vec4 cc_ambientSky;\nuniform mediump vec4 cc_ambientGround;\nuniform mediump vec4 cc_fogColor;\nuniform lowp vec4 cc_shadowColor;\nuniform lowp vec4 cc_shadowInfo;\n#if CC_USE_IBL\nuniform samplerCube cc_environment;\nvec3 unpackRGBE (vec4 rgbe) {\n  return rgbe.rgb * pow(2.0, rgbe.a * 255.0 - 128.0);\n}\nvec4 fragTextureLod (sampler2D tex, vec2 coord, float lod) {\n    #ifdef GL_EXT_shader_texture_lod\n      return texture2DLodEXT(tex, coord, lod);\n    #else\n      return texture2D(tex, coord, lod);\n    #endif\n}\nvec4 fragTextureLod (samplerCube tex, vec3 coord, float lod) {\n    #ifdef GL_EXT_shader_texture_lod\n      return textureCubeLodEXT(tex, coord, lod);\n    #else\n      return textureCube(tex, coord, lod);\n    #endif\n}\n#endif\n#if CC_RECEIVE_SHADOW\nvarying highp vec4 v_shadowPos;\n#if CC_RECEIVE_SHADOW\n  uniform sampler2D cc_shadowMap;\n  uniform sampler2D cc_spotLightingMap;\n  float CCGetShadowFactorX1 () {\n    vec3 clipPos = v_shadowPos.xyz / v_shadowPos.w * 0.5 + 0.5;\n    if (clipPos.x < 0.0 || clipPos.x > 1.0 ||\n        clipPos.y < 0.0 || clipPos.y > 1.0 ||\n        clipPos.z <-1.0 || clipPos.z > 1.0) { return 0.0; }\n    float closestDepth = dot(texture2D(cc_shadowMap, clipPos.xy), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 160581375.0));\n    float shadow = step(closestDepth, clipPos.z - cc_shadowInfo.w);\n    return shadow;\n  }\n  float CCGetShadowFactorX5 () {\n    vec3 clipPos = v_shadowPos.xyz / v_shadowPos.w * 0.5 + 0.5;\n    if (clipPos.x < 0.0 || clipPos.x > 1.0 ||\n        clipPos.y < 0.0 || clipPos.y > 1.0 ||\n        clipPos.z <-1.0 || clipPos.z > 1.0) { return 0.0; }\n    float offsetx = 1.0 / cc_shadowInfo.x;\n    float offsety = 1.0 / cc_shadowInfo.y;\n    float shadow = 0.0;\n    float closestDepth = 0.0;\n    closestDepth = dot(texture2D(cc_shadowMap, vec2(clipPos.x - offsetx, clipPos.y - offsety)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 160581375.0));\n    shadow += step(closestDepth, clipPos.z - cc_shadowInfo.w);\n    closestDepth = dot(texture2D(cc_shadowMap, vec2(clipPos.x - offsetx, clipPos.y + offsety)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 160581375.0));\n    shadow += step(closestDepth, clipPos.z - cc_shadowInfo.w);\n    closestDepth = dot(texture2D(cc_shadowMap, vec2(clipPos.x, clipPos.y)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 160581375.0));\n    shadow += step(closestDepth, clipPos.z - cc_shadowInfo.w);\n    closestDepth = dot(texture2D(cc_shadowMap, vec2(clipPos.x + offsetx, clipPos.y - offsety)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 160581375.0));\n    shadow += step(closestDepth, clipPos.z - cc_shadowInfo.w);\n    closestDepth = dot(texture2D(cc_shadowMap, vec2(clipPos.x + offsetx, clipPos.y + offsety)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 160581375.0));\n    shadow += step(closestDepth, clipPos.z - cc_shadowInfo.w);\n    return shadow / 5.0;\n  }\n  float CCGetShadowFactorX9 () {\n    vec3 clipPos = v_shadowPos.xyz / v_shadowPos.w * 0.5 + 0.5;\n    if (clipPos.x < 0.0 || clipPos.x > 1.0 ||\n        clipPos.y < 0.0 || clipPos.y > 1.0 ||\n        clipPos.z <-1.0 || clipPos.z > 1.0) { return 0.0; }\n    float offsetx = 1.0 / cc_shadowInfo.x;\n    float offsety = 1.0 / cc_shadowInfo.y;\n    float shadow = 0.0;\n    for (int i = -1; i <= 1; i++) {\n      for (int j = -1; j <= 1; j++) {\n        float closestDepth = dot(texture2D(cc_shadowMap, clipPos.xy + vec2(i, j) * vec2(offsetx, offsety)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 160581375.0));\n        shadow += step(closestDepth, clipPos.z - cc_shadowInfo.w);\n      }\n    }\n    return shadow / 9.0;\n  }\n  float CCGetShadowFactorX25 () {\n    vec3 clipPos = v_shadowPos.xyz / v_shadowPos.w * 0.5 + 0.5;\n    if (clipPos.x < 0.0 || clipPos.x > 1.0 ||\n        clipPos.y < 0.0 || clipPos.y > 1.0 ||\n        clipPos.z <-1.0 || clipPos.z > 1.0) { return 0.0; }\n    float offsetx = 1.0 / cc_shadowInfo.x;\n    float offsety = 1.0 / cc_shadowInfo.y;\n    float shadow = 0.0;\n    for (int i = -2; i <= 2; i++) {\n      for (int j = -2; j <= 2; j++) {\n        float closestDepth = dot(texture2D(cc_shadowMap, clipPos.xy + vec2(i, j) * vec2(offsetx, offsety)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 160581375.0));\n        shadow += step(closestDepth, clipPos.z - cc_shadowInfo.w);\n      }\n    }\n    return shadow / 25.0;\n  }\n  float CCGetDirLightShadowFactorX1 () {\n    vec3 clipPos = v_shadowPos.xyz / v_shadowPos.w * 0.5 + 0.5;\n    if (clipPos.x < 0.0 || clipPos.x > 1.0 ||\n        clipPos.y < 0.0 || clipPos.y > 1.0 ||\n        clipPos.z <-1.0 || clipPos.z > 1.0) { return 0.0; }\n    float closestDepth = dot(texture2D(cc_spotLightingMap, clipPos.xy), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 160581375.0));\n    float shadow = step(closestDepth, clipPos.z - cc_shadowInfo.w);\n    return shadow;\n  }\n  float CCGetDirLightShadowFactorX5 () {\n    vec3 clipPos = v_shadowPos.xyz / v_shadowPos.w * 0.5 + 0.5;\n    if (clipPos.x < 0.0 || clipPos.x > 1.0 ||\n        clipPos.y < 0.0 || clipPos.y > 1.0 ||\n        clipPos.z <-1.0 || clipPos.z > 1.0) { return 0.0; }\n    float offsetx = 1.0 / cc_shadowInfo.x;\n    float offsety = 1.0 / cc_shadowInfo.y;\n    float shadow = 0.0;\n    float closestDepth = 0.0;\n    closestDepth = dot(texture2D(cc_spotLightingMap, vec2(clipPos.x - offsetx, clipPos.y - offsety)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 160581375.0));\n    shadow += step(closestDepth, clipPos.z - cc_shadowInfo.w);\n    closestDepth = dot(texture2D(cc_spotLightingMap, vec2(clipPos.x - offsetx, clipPos.y + offsety)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 160581375.0));\n    shadow += step(closestDepth, clipPos.z - cc_shadowInfo.w);\n    closestDepth = dot(texture2D(cc_spotLightingMap, vec2(clipPos.x, clipPos.y)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 160581375.0));\n    shadow += step(closestDepth, clipPos.z - cc_shadowInfo.w);\n    closestDepth = dot(texture2D(cc_spotLightingMap, vec2(clipPos.x + offsetx, clipPos.y - offsety)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 160581375.0));\n    shadow += step(closestDepth, clipPos.z - cc_shadowInfo.w);\n    closestDepth = dot(texture2D(cc_spotLightingMap, vec2(clipPos.x + offsetx, clipPos.y + offsety)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 160581375.0));\n    return shadow / 5.0;\n  }\n  float CCGetDirLightShadowFactorX9 () {\n    vec3 clipPos = v_shadowPos.xyz / v_shadowPos.w * 0.5 + 0.5;\n    if (clipPos.x < 0.0 || clipPos.x > 1.0 ||\n        clipPos.y < 0.0 || clipPos.y > 1.0 ||\n        clipPos.z <-1.0 || clipPos.z > 1.0) { return 0.0; }\n    float offsetx = 1.0 / cc_shadowInfo.x;\n    float offsety = 1.0 / cc_shadowInfo.y;\n    float shadow = 0.0;\n    for (int i = -1; i <= 1; i++) {\n      for (int j = -1; j <= 1; j++) {\n        float closestDepth = dot(texture2D(cc_spotLightingMap, clipPos.xy + vec2(i, j) * vec2(offsetx, offsety)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 160581375.0));\n        shadow += step(closestDepth, clipPos.z - cc_shadowInfo.w);\n      }\n    }\n    return shadow / 9.0;\n  }\n  float CCGetDirLightShadowFactorX25 () {\n    vec3 clipPos = v_shadowPos.xyz / v_shadowPos.w * 0.5 + 0.5;\n    if (clipPos.x < 0.0 || clipPos.x > 1.0 ||\n        clipPos.y < 0.0 || clipPos.y > 1.0 ||\n        clipPos.z <-1.0 || clipPos.z > 1.0) { return 0.0; }\n    float offsetx = 1.0 / cc_shadowInfo.x;\n    float offsety = 1.0 / cc_shadowInfo.y;\n    float shadow = 0.0;\n    for (int i = -2; i <= 2; i++) {\n      for (int j = -2; j <= 2; j++) {\n        float closestDepth = dot(texture2D(cc_spotLightingMap, clipPos.xy + vec2(i, j) * vec2(offsetx, offsety)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 160581375.0));\n        shadow += step(closestDepth, clipPos.z - cc_shadowInfo.w);\n      }\n    }\n    return shadow / 25.0;\n  }\n#endif\n#endif\nvec3 SRGBToLinear (vec3 gamma) {\n  return gamma * gamma;\n}\nfloat GGXMobile (float roughness, float NoH, vec3 H, vec3 N) {\n  vec3 NxH = cross(N, H);\n  float OneMinusNoHSqr = dot(NxH, NxH);\n  float a = roughness * roughness;\n  float n = NoH * a;\n  float p = a / (OneMinusNoHSqr + n * n);\n  return p * p;\n}\nfloat CalcSpecular (float roughness, float NoH, vec3 H, vec3 N) {\n  return (roughness*0.25 + 0.25) * GGXMobile(roughness, NoH, H, N);\n}\nvec3 BRDFApprox (vec3 specular, float roughness, float NoV) {\n  const vec4 c0 = vec4(-1.0, -0.0275, -0.572, 0.022);\n  const vec4 c1 = vec4(1.0, 0.0425, 1.04, -0.04);\n  vec4 r = roughness * c0 + c1;\n  float a004 = min( r.x * r.x, exp2( -9.28 * NoV ) ) * r.x + r.y;\n  vec2 AB = vec2( -1.04, 1.04 ) * a004 + r.zw;\n  AB.y *= clamp(50.0 * specular.g, 0.0, 1.0);\n  return specular * AB.x + AB.y;\n}\nstruct StandardSurface {\n  vec4 albedo;\n  vec3 position;\n  vec3 normal;\n  vec3 emissive;\n  vec4 lightmap;\n  float roughness;\n  float metallic;\n  float occlusion;\n};\n#if CC_FORWARD_ADD\nuniform highp vec4 cc_lightPos[1];\nuniform vec4 cc_lightColor[1];\nuniform vec4 cc_lightSizeRangeAngle[1];\nuniform vec4 cc_lightDir[1];\nfloat SmoothDistAtt (float distSqr, float invSqrAttRadius) {\n  float factor = distSqr * invSqrAttRadius;\n  float smoothFactor = clamp(1.0 - factor * factor, 0.0, 1.0);\n  return smoothFactor * smoothFactor;\n}\nfloat GetDistAtt (float distSqr, float invSqrAttRadius) {\n  float attenuation = 1.0 / max(distSqr, 0.01*0.01);\n  attenuation *= SmoothDistAtt(distSqr , invSqrAttRadius);\n  return attenuation;\n}\nfloat GetAngleAtt (vec3 L, vec3 litDir, float litAngleScale, float litAngleOffset) {\n  float cd = dot(litDir, L);\n  float attenuation = clamp(cd * litAngleScale + litAngleOffset, 0.0, 1.0);\n  return (attenuation * attenuation);\n}\n  vec4 CCStandardShading (StandardSurface s) {\n    vec3 diffuse = s.albedo.rgb * (1.0 - s.metallic);\n    vec3 specular = mix(vec3(0.04), s.albedo.rgb, s.metallic);\n    vec3 diffuseContrib = diffuse / 3.14159265359;\n    vec3 N = normalize(s.normal);\n    vec3 V = normalize(cc_cameraPos.xyz - s.position);\n    float NV = max(abs(dot(N, V)), 0.001);\n    specular = BRDFApprox(specular, s.roughness, NV);\n    vec3 finalColor = vec3(0.0);\n    for (int i = 0; i < 1; i++) {\n      vec3 SLU = cc_lightPos[i].xyz - s.position;\n      vec3 SL = normalize(SLU);\n      vec3 SH = normalize(SL + V);\n      float SNL = max(dot(N, SL), 0.001);\n      float SNH = max(dot(N, SH), 0.0);\n      float distSqr = dot(SLU, SLU);\n      float litRadius = cc_lightSizeRangeAngle[i].x;\n      float litRadiusSqr = litRadius * litRadius;\n      float illum = 3.14159265359 * (litRadiusSqr / max(litRadiusSqr , distSqr));\n      float attRadiusSqrInv = 1.0 / max(cc_lightSizeRangeAngle[i].y, 0.01);\n      attRadiusSqrInv *= attRadiusSqrInv;\n      float att = GetDistAtt(distSqr, attRadiusSqrInv);\n      vec3 lspec = specular * CalcSpecular(s.roughness, SNH, SH, N);\n      if (cc_lightPos[i].w > 0.0) {\n        float cosInner = max(dot(-cc_lightDir[i].xyz, SL), 0.01);\n        float cosOuter = cc_lightSizeRangeAngle[i].z;\n        float litAngleScale = 1.0 / max(0.001, cosInner - cosOuter);\n        float litAngleOffset = -cosOuter * litAngleScale;\n        att *= GetAngleAtt(SL, -cc_lightDir[i].xyz, litAngleScale, litAngleOffset);\n      }\n      vec3 lightColor = cc_lightColor[i].rgb;\n    #if CC_RECEIVE_SHADOW\n      if (cc_lightPos[i].w > 0.0) {\n    {\n      float pcf = cc_shadowInfo.z + 0.001;\n      float shadowAttenuation = 0.0;\n      if (pcf > 3.0) shadowAttenuation = CCGetDirLightShadowFactorX25();\n      else if (3.0 > pcf && pcf > 2.0) shadowAttenuation = CCGetDirLightShadowFactorX9();\n      else if (2.0 > pcf && pcf > 1.0) shadowAttenuation = CCGetDirLightShadowFactorX5();\n      else shadowAttenuation = CCGetDirLightShadowFactorX1();\n      lightColor *= 1.0 - shadowAttenuation;\n    }\n      }\n    #endif\n      finalColor += SNL * lightColor * cc_lightColor[i].w * illum * att * (diffuseContrib + lspec);\n    }\n    finalColor = finalColor * s.occlusion;\n    return vec4(finalColor, 0.0);\n  }\n#else\n  vec4 CCStandardShading (StandardSurface s) {\n    vec3 diffuse = s.albedo.rgb * (1.0 - s.metallic);\n    vec3 specular = mix(vec3(0.04), s.albedo.rgb, s.metallic);\n    vec3 N = normalize(s.normal);\n    vec3 V = normalize(cc_cameraPos.xyz - s.position);\n    float NV = max(abs(dot(N, V)), 0.001);\n    specular = BRDFApprox(specular, s.roughness, NV);\n    vec3 L = normalize(-cc_mainLitDir.xyz);\n    vec3 H = normalize(L+V);\n    float NH = max(dot(N, H), 0.0);\n    float NL = max(dot(N, L), 0.001);\n    vec3 finalColor = NL * cc_mainLitColor.rgb * cc_mainLitColor.w;\n    #if USE_LIGHTMAP && !USE_BATCHING && !CC_FORWARD_ADD\n      finalColor = s.lightmap.a * s.lightmap.rgb + (1.0 - s.lightmap.a) * finalColor;\n    #endif\n    vec3 diffuseContrib = diffuse / 3.14159265359;\n    vec3 specularContrib = specular * CalcSpecular(s.roughness, NH, H, N);\n    finalColor *= (diffuseContrib + specularContrib);\n    float fAmb = 0.5 - N.y * 0.5;\n    vec3 ambDiff = mix(cc_ambientSky.rgb, cc_ambientGround.rgb, fAmb) * cc_ambientSky.w;\n    finalColor += (ambDiff.rgb * diffuse);\n    #if CC_USE_IBL\n      vec3 R = normalize(reflect(-V, N));\n      vec4 envmap = fragTextureLod(cc_environment, R, s.roughness * cc_ambientGround.w);\n      #if CC_USE_IBL == 2\n        vec3 env = unpackRGBE(envmap);\n      #else\n        vec3 env = SRGBToLinear(envmap.rgb);\n      #endif\n      finalColor += env * cc_ambientSky.w * specular;\n    #endif\n    finalColor = finalColor * s.occlusion;\n    #if CC_USE_HDR\n      s.emissive *= cc_exposure.w;\n    #endif\n    finalColor += s.emissive;\n    #if CC_RECEIVE_SHADOW\n    {\n      float pcf = cc_shadowInfo.z + 0.001;\n      float shadowAttenuation = 0.0;\n      if (pcf > 3.0) shadowAttenuation = CCGetShadowFactorX25();\n      else if (3.0 > pcf && pcf > 2.0) shadowAttenuation = CCGetShadowFactorX9();\n      else if (2.0 > pcf && pcf > 1.0) shadowAttenuation = CCGetShadowFactorX5();\n      else shadowAttenuation = CCGetShadowFactorX1();\n      vec3 shadowColor = cc_shadowColor.rgb * cc_shadowColor.a + finalColor.rgb * (1.0 - cc_shadowColor.a);\n      finalColor.rgb = shadowColor.rgb * shadowAttenuation * NL + finalColor.rgb * (1.0 - shadowAttenuation * NL);\n    }\n    #endif\n    return vec4(finalColor, s.albedo.a);\n  }\n#endif\nvec3 ACESToneMap (vec3 color) {\n  color = min(color, vec3(8.0));\n  const float A = 2.51;\n  const float B = 0.03;\n  const float C = 2.43;\n  const float D = 0.59;\n  const float E = 0.14;\n  return (color * (A * color + B)) / (color * (C * color + D) + E);\n}\nvec4 CCFragOutput (vec4 color) {\n  #if !CC_USE_HDR\n    color.rgb = sqrt(ACESToneMap(color.rgb));\n  #endif\n  return color;\n}\nvarying highp vec3 v_position;\nvarying mediump vec3 v_normal;\n#if USE_NORMALMAP\n  varying mediump vec3 v_tangent;\n  varying mediump vec3 v_binormal;\n#endif\nvarying mediump vec2 uvw;\nvarying mediump vec2 uv0;\nvarying mediump vec2 uv1;\nvarying mediump vec2 uv2;\nvarying mediump vec2 uv3;\nvarying mediump vec3 diffuse;\nvarying mediump vec2 luv;\nvarying mediump float v_fog_factor;\nuniform vec4 metallic;\nuniform vec4 roughness;\nuniform sampler2D weightMap;\nuniform sampler2D detailMap0;\nuniform sampler2D detailMap1;\nuniform sampler2D detailMap2;\nuniform sampler2D detailMap3;\nuniform sampler2D normalMap0;\nuniform sampler2D normalMap1;\nuniform sampler2D normalMap2;\nuniform sampler2D normalMap3;\nuniform sampler2D lightMap;\nvoid surf (out StandardSurface s) {\n  #if LAYERS > 1\n    vec4 w = texture2D(weightMap, uvw);\n  #endif\n  vec4 baseColor = vec4(0, 0, 0, 0);\n  #if LAYERS == 1\n    baseColor = texture2D(detailMap0, uv0);\n  #elif LAYERS == 2\n    baseColor += texture2D(detailMap0, uv0) * w.r;\n    baseColor += texture2D(detailMap1, uv1) * w.g;\n  #elif LAYERS == 3\n    baseColor += texture2D(detailMap0, uv0) * w.r;\n    baseColor += texture2D(detailMap1, uv1) * w.g;\n    baseColor += texture2D(detailMap2, uv2) * w.b;\n  #elif LAYERS == 4\n    baseColor += texture2D(detailMap0, uv0) * w.r;\n    baseColor += texture2D(detailMap1, uv1) * w.g;\n    baseColor += texture2D(detailMap2, uv2) * w.b;\n    baseColor += texture2D(detailMap3, uv3) * w.a;\n  #else\n    baseColor = texture2D(detailMap0, uv0);\n  #endif\n  s.position = v_position;\n  #if USE_NORMALMAP\n    vec4 baseNormal = vec4(0, 0, 0, 0);\n    #if LAYERS == 1\n      baseNormal = texture2D(normalMap0, uv0);\n    #elif LAYERS == 2\n      baseNormal += texture2D(normalMap0, uv0) * w.r;\n      baseNormal += texture2D(normalMap1, uv1) * w.g;\n    #elif LAYERS == 3\n      baseNormal += texture2D(normalMap0, uv0) * w.r;\n      baseNormal += texture2D(normalMap1, uv1) * w.g;\n      baseNormal += texture2D(normalMap2, uv2) * w.b;\n    #elif LAYERS == 4\n      baseNormal += texture2D(normalMap0, uv0) * w.r;\n      baseNormal += texture2D(normalMap1, uv1) * w.g;\n      baseNormal += texture2D(normalMap2, uv2) * w.b;\n      baseNormal += texture2D(normalMap3, uv3) * w.a;\n    #else\n      baseNormal = texture2D(normalMap0, uv0);\n    #endif\n    vec3 nmmp = baseNormal.xyz - vec3(0.5);\n    s.normal =\n      nmmp.x * normalize(v_tangent) +\n      nmmp.y * normalize(v_binormal) +\n      nmmp.z * normalize(v_normal);\n  #else\n    s.normal = v_normal;\n  #endif\n  s.albedo = vec4(SRGBToLinear(baseColor.rgb), 1.0);\n  s.occlusion = 1.0;\n  #if USE_PBR\n    s.roughness = 0.0;\n    #if LAYERS == 1\n      s.roughness = roughness.x;\n    #elif LAYERS == 2\n      s.roughness += roughness.x * w.r;\n      s.roughness += roughness.y * w.g;\n    #elif LAYERS == 3\n      s.roughness += roughness.x * w.r;\n      s.roughness += roughness.y * w.g;\n      s.roughness += roughness.z * w.b;\n    #elif LAYERS == 4\n      s.roughness += roughness.x * w.r;\n      s.roughness += roughness.y * w.g;\n      s.roughness += roughness.z * w.b;\n      s.roughness += roughness.w * w.a;\n    #else\n      s.roughness = 1.0;\n    #endif\n    s.metallic = 0.0;\n    #if LAYERS == 1\n      s.metallic = metallic.x;\n    #elif LAYERS == 2\n      s.metallic += metallic.x * w.r;\n      s.metallic += metallic.y * w.g;\n    #elif LAYERS == 3\n      s.metallic += metallic.x * w.r;\n      s.metallic += metallic.y * w.g;\n      s.metallic += metallic.z * w.b;\n    #elif LAYERS == 4\n      s.metallic += metallic.x * w.r;\n      s.metallic += metallic.y * w.g;\n      s.metallic += metallic.z * w.b;\n      s.metallic += metallic.w * w.a;\n    #else\n      s.metallic = 0.0;\n    #endif\n  #else\n    s.roughness = 1.0;\n    s.metallic = 0.0;\n  #endif\n  s.emissive = vec3(0.0, 0.0, 0.0);\n  #if USE_LIGHTMAP && !USE_BATCHING && !CC_FORWARD_ADD\n    s.lightmap = texture2D(lightMap, luv);\n  #else\n    s.lightmap = vec4(0.0, 0.0, 0.0, 0.0);\n  #endif\n}\nvec4 frag () {\n  StandardSurface s; surf(s);\n  vec4 color = CCStandardShading(s);\n  color = vec4(mix(CC_FORWARD_ADD > 0 ? vec3(0.0) : cc_fogColor.rgb, color.rgb, v_fog_factor), color.a);\n  return CCFragOutput(color);\n}\nvoid main() { gl_FragColor = frag(); }"},{vert:"\nprecision highp float;\nuniform highp mat4 cc_matWorld;\nuniform highp mat4 cc_matLightViewProj;\nattribute vec3 a_position;\nattribute vec3 a_normal;\nattribute vec2 a_texCoord;\nvarying vec2 v_clip_depth;\nvec4 vert () {\n  vec4 worldPos;\n  worldPos.x = cc_matWorld[3][0] + a_position.x;\n  worldPos.y = cc_matWorld[3][1] + a_position.y;\n  worldPos.z = cc_matWorld[3][2] + a_position.z;\n  worldPos.w = 1.0;\n  vec4 clipPos = cc_matLightViewProj * worldPos;\n  v_clip_depth = clipPos.zw;\n  return clipPos;\n}\nvoid main() { gl_Position = vert(); }",frag:"\nprecision highp float;\nvec4 packDepthToRGBA (float depth) {\n  vec4 ret = vec4(1.0, 255.0, 65025.0, 160581375.0) * depth;\n  ret = fract(ret);\n  ret -= ret.yzww * vec4(1.0 / 255.0, 1.0 / 255.0, 1.0 / 255.0, 0.0);\n  return ret;\n}\nvarying vec2 v_clip_depth;\nvec4 frag () {\n  return packDepthToRGBA(v_clip_depth.x / v_clip_depth.y * 0.5 + 0.5);\n}\nvoid main() { gl_FragColor = frag(); }"}],[{vert:"\nprecision highp float;\nhighp float decode32 (highp vec4 rgba) {\n  rgba = rgba * 255.0;\n  highp float Sign = 1.0 - (step(128.0, (rgba[3]) + 0.5)) * 2.0;\n  highp float Exponent = 2.0 * (mod(float(int((rgba[3]) + 0.5)), 128.0)) + (step(128.0, (rgba[2]) + 0.5)) - 127.0;\n  highp float Mantissa = (mod(float(int((rgba[2]) + 0.5)), 128.0)) * 65536.0 + rgba[1] * 256.0 + rgba[0] + 8388608.0;\n  return Sign * exp2(Exponent - 23.0) * Mantissa;\n}\nstruct StandardVertInput {\n  highp vec4 position;\n  vec3 normal;\n  vec4 tangent;\n};\nattribute vec3 a_position;\nattribute vec3 a_normal;\nattribute vec2 a_texCoord;\nattribute vec4 a_tangent;\n#if CC_USE_MORPH\n    attribute float a_vertexId;\n    int getVertexId() {\n        return int(a_vertexId);\n    }\nuniform vec4 cc_displacementWeights[15];\nuniform vec4 cc_displacementTextureInfo;\nvec2 getPixelLocation(vec2 textureResolution, int pixelIndex) {\n    float pixelIndexF = float(pixelIndex);\n    float x = mod(pixelIndexF, textureResolution.x);\n    float y = floor(pixelIndexF / textureResolution.x);\n    return vec2(x, y);\n}\nvec2 getPixelCoordFromLocation(vec2 location, vec2 textureResolution) {\n    return (vec2(location.x, location.y) + .5) / textureResolution;\n}\n#if CC_SUPPORT_FLOAT_TEXTURE\n        vec4 fetchVec3ArrayFromTexture(sampler2D tex, int elementIndex) {\n            int pixelIndex = elementIndex;\n            vec2 location = getPixelLocation(cc_displacementTextureInfo.xy, pixelIndex);\n            vec2 uv = getPixelCoordFromLocation(location, cc_displacementTextureInfo.xy);\n            return texture2D(tex, uv);\n        }\n#else\n    vec4 fetchVec3ArrayFromTexture(sampler2D tex, int elementIndex) {\n        int pixelIndex = elementIndex * 4;\n        vec2 location = getPixelLocation(cc_displacementTextureInfo.xy, pixelIndex);\n        vec2 x = getPixelCoordFromLocation(location + vec2(0.0, 0.0), cc_displacementTextureInfo.xy);\n        vec2 y = getPixelCoordFromLocation(location + vec2(1.0, 0.0), cc_displacementTextureInfo.xy);\n        vec2 z = getPixelCoordFromLocation(location + vec2(2.0, 0.0), cc_displacementTextureInfo.xy);\n        return vec4(\n            decode32(texture2D(tex, x)),\n            decode32(texture2D(tex, y)),\n            decode32(texture2D(tex, z)),\n            1.0\n        );\n    }\n#endif\nfloat getDisplacementWeight(int index) {\n    int quot = index / 4;\n    int remainder = index - quot * 4;\n    if (remainder == 0) {\n        return cc_displacementWeights[quot].x;\n    } else if (remainder == 1) {\n        return cc_displacementWeights[quot].y;\n    } else if (remainder == 2) {\n        return cc_displacementWeights[quot].z;\n    } else {\n        return cc_displacementWeights[quot].w;\n    }\n}\nvec3 getVec3DisplacementFromTexture(sampler2D tex, int vertexIndex) {\n#if CC_MORPH_PRECOMPUTED\n    return fetchVec3ArrayFromTexture(tex, vertexIndex).rgb;\n#else\n    vec3 result = vec3(0, 0, 0);\n    int nVertices = int(cc_displacementTextureInfo.z);\n    for (int iTarget = 0; iTarget < CC_MORPH_TARGET_COUNT; ++iTarget) {\n        result += (fetchVec3ArrayFromTexture(tex, nVertices * iTarget + vertexIndex).rgb * getDisplacementWeight(iTarget));\n    }\n    return result;\n#endif\n}\n#if CC_MORPH_TARGET_HAS_POSITION\n    uniform sampler2D cc_PositionDisplacements;\n    vec3 getPositionDisplacement(int vertexId) {\n        return getVec3DisplacementFromTexture(cc_PositionDisplacements, vertexId);\n    }\n#endif\n#if CC_MORPH_TARGET_HAS_NORMAL\n    uniform sampler2D cc_NormalDisplacements;\n    vec3 getNormalDisplacement(int vertexId) {\n        return getVec3DisplacementFromTexture(cc_NormalDisplacements, vertexId);\n    }\n#endif\n#if CC_MORPH_TARGET_HAS_TANGENT\n    uniform sampler2D cc_TangentDisplacements;\n    vec3 getTangentDisplacement(int vertexId) {\n        return getVec3DisplacementFromTexture(cc_TangentDisplacements, vertexId);\n    }\n#endif\nvoid applyMorph (inout StandardVertInput attr) {\n    int vertexId = getVertexId();\n#if CC_MORPH_TARGET_HAS_POSITION\n    attr.position.xyz = attr.position.xyz + getPositionDisplacement(vertexId);\n#endif\n#if CC_MORPH_TARGET_HAS_NORMAL\n    attr.normal.xyz = attr.normal.xyz + getNormalDisplacement(vertexId);\n#endif\n#if CC_MORPH_TARGET_HAS_TANGENT\n    attr.tangent.xyz = attr.tangent.xyz + getTangentDisplacement(vertexId);\n#endif\n}\nvoid applyMorph (inout vec4 position) {\n#if CC_MORPH_TARGET_HAS_POSITION\n    position.xyz = position.xyz + getPositionDisplacement(getVertexId());\n#endif\n}\n#endif\n#if CC_USE_SKINNING\n  attribute vec4 a_joints;\nattribute vec4 a_weights;\n#if CC_USE_BAKED_ANIMATION\n  #if USE_INSTANCING\n    attribute highp vec4 a_jointAnimInfo;\n  #endif\n  uniform highp vec4 cc_jointTextureInfo;\n  uniform highp vec4 cc_jointAnimInfo;\n  uniform highp sampler2D cc_jointTexture;\n  #else\n  uniform highp vec4 cc_joints[90];\n#endif\n#if CC_USE_BAKED_ANIMATION\n  #if CC_SUPPORT_FLOAT_TEXTURE\n    mat4 getJointMatrix (float i) {\n    #if USE_INSTANCING\n      highp float j = 3.0 * (a_jointAnimInfo.x * a_jointAnimInfo.y + i) + a_jointAnimInfo.z;\n    #else\n      highp float j = 3.0 * (cc_jointAnimInfo.x * cc_jointTextureInfo.y + i) + cc_jointTextureInfo.z;\n    #endif\n    highp float invSize = cc_jointTextureInfo.w;\n    highp float y = floor(j * invSize);\n    highp float x = j - y * cc_jointTextureInfo.x;\n    y = (y + 0.5) * invSize;\n      vec4 v1 = texture2D(cc_jointTexture, vec2((x + 0.5) * invSize, y));\n      vec4 v2 = texture2D(cc_jointTexture, vec2((x + 1.5) * invSize, y));\n      vec4 v3 = texture2D(cc_jointTexture, vec2((x + 2.5) * invSize, y));\n      return mat4(vec4(v1.xyz, 0.0), vec4(v2.xyz, 0.0), vec4(v3.xyz, 0.0), vec4(v1.w, v2.w, v3.w, 1.0));\n    }\n  #else\n    mat4 getJointMatrix (float i) {\n    #if USE_INSTANCING\n      highp float j = 12.0 * (a_jointAnimInfo.x * a_jointAnimInfo.y + i) + a_jointAnimInfo.z;\n    #else\n      highp float j = 12.0 * (cc_jointAnimInfo.x * cc_jointTextureInfo.y + i) + cc_jointTextureInfo.z;\n    #endif\n    highp float invSize = cc_jointTextureInfo.w;\n    highp float y = floor(j * invSize);\n    highp float x = j - y * cc_jointTextureInfo.x;\n    y = (y + 0.5) * invSize;\n      vec4 v1 = vec4(\n        decode32(texture2D(cc_jointTexture, vec2((x + 0.5) * invSize, y))),\n        decode32(texture2D(cc_jointTexture, vec2((x + 1.5) * invSize, y))),\n        decode32(texture2D(cc_jointTexture, vec2((x + 2.5) * invSize, y))),\n        decode32(texture2D(cc_jointTexture, vec2((x + 3.5) * invSize, y)))\n      );\n      vec4 v2 = vec4(\n        decode32(texture2D(cc_jointTexture, vec2((x + 4.5) * invSize, y))),\n        decode32(texture2D(cc_jointTexture, vec2((x + 5.5) * invSize, y))),\n        decode32(texture2D(cc_jointTexture, vec2((x + 6.5) * invSize, y))),\n        decode32(texture2D(cc_jointTexture, vec2((x + 7.5) * invSize, y)))\n      );\n      vec4 v3 = vec4(\n        decode32(texture2D(cc_jointTexture, vec2((x + 8.5) * invSize, y))),\n        decode32(texture2D(cc_jointTexture, vec2((x + 9.5) * invSize, y))),\n        decode32(texture2D(cc_jointTexture, vec2((x + 10.5) * invSize, y))),\n        decode32(texture2D(cc_jointTexture, vec2((x + 11.5) * invSize, y)))\n      );\n      return mat4(vec4(v1.xyz, 0.0), vec4(v2.xyz, 0.0), vec4(v3.xyz, 0.0), vec4(v1.w, v2.w, v3.w, 1.0));\n    }\n  #endif\n#else\n  mat4 getJointMatrix (float i) {\n    int idx = int(i);\n    vec4 v1 = cc_joints[idx * 3];\n    vec4 v2 = cc_joints[idx * 3 + 1];\n    vec4 v3 = cc_joints[idx * 3 + 2];\n    return mat4(vec4(v1.xyz, 0.0), vec4(v2.xyz, 0.0), vec4(v3.xyz, 0.0), vec4(v1.w, v2.w, v3.w, 1.0));\n  }\n#endif\nmat4 skinMatrix () {\n  vec4 joints = vec4(a_joints);\n  return getJointMatrix(joints.x) * a_weights.x\n       + getJointMatrix(joints.y) * a_weights.y\n       + getJointMatrix(joints.z) * a_weights.z\n       + getJointMatrix(joints.w) * a_weights.w;\n}\nvoid CCSkin (inout vec4 position) {\n  mat4 m = skinMatrix();\n  position = m * position;\n}\nvoid CCSkin (inout StandardVertInput attr) {\n  mat4 m = skinMatrix();\n  attr.position = m * attr.position;\n  attr.normal = (m * vec4(attr.normal, 0.0)).xyz;\n  attr.tangent.xyz = (m * vec4(attr.tangent.xyz, 0.0)).xyz;\n}\n#endif\nuniform highp mat4 cc_matView;\nuniform highp mat4 cc_matProj;\nuniform highp vec4 cc_cameraPos;\nuniform mediump vec4 cc_fogBase;\nuniform mediump vec4 cc_fogAdd;\n#if USE_INSTANCING\n  attribute vec4 a_matWorld0;\n  attribute vec4 a_matWorld1;\n  attribute vec4 a_matWorld2;\n  #if USE_LIGHTMAP\n    attribute vec4 a_lightingMapUVParam;\n  #endif\n#elif USE_BATCHING\n  attribute float a_dyn_batch_id;\n  uniform highp mat4 cc_matWorlds[10];\n#else\nuniform highp mat4 cc_matWorld;\n#endif\nfloat LinearFog(vec4 pos) {\n    vec4 wPos = pos;\n    float cam_dis = distance(cc_cameraPos, wPos);\n    float fogStart = cc_fogBase.x;\n    float fogEnd = cc_fogBase.y;\n    return clamp((fogEnd - cam_dis) / (fogEnd - fogStart), 0., 1.);\n}\nfloat ExpFog(vec4 pos) {\n    vec4 wPos = pos;\n    float fogAtten = cc_fogAdd.z;\n    float fogDensity = cc_fogBase.z;\n    float cam_dis = distance(cc_cameraPos, wPos) / fogAtten * 4.;\n    float f = exp(-cam_dis * fogDensity);\n    return f;\n}\nfloat ExpSquaredFog(vec4 pos) {\n    vec4 wPos = pos;\n    float fogAtten = cc_fogAdd.z;\n    float fogDensity = cc_fogBase.z;\n    float cam_dis = distance(cc_cameraPos, wPos) / fogAtten * 4.;\n    float f = exp(-cam_dis * cam_dis * fogDensity * fogDensity);\n    return f;\n}\nfloat LayeredFog(vec4 pos) {\n    vec4 wPos = pos;\n    float fogAtten = cc_fogAdd.z;\n    float _FogTop = cc_fogAdd.x;\n    float _FogRange = cc_fogAdd.y;\n    vec3 camWorldProj = cc_cameraPos.xyz;\n    camWorldProj.y = 0.;\n    vec3 worldPosProj = wPos.xyz;\n    worldPosProj.y = 0.;\n    float fDeltaD = distance(worldPosProj, camWorldProj) / fogAtten * 2.0;\n    float fDeltaY, fDensityIntegral;\n    if (cc_cameraPos.y > _FogTop) {\n        if (wPos.y < _FogTop) {\n            fDeltaY = (_FogTop - wPos.y) / _FogRange * 2.0;\n            fDensityIntegral = fDeltaY * fDeltaY * 0.5;\n        } else {\n            fDeltaY = 0.;\n            fDensityIntegral = 0.;\n        }\n    } else {\n        if (wPos.y < _FogTop) {\n            float fDeltaA = (_FogTop - cc_cameraPos.y) / _FogRange * 2.;\n            float fDeltaB = (_FogTop - wPos.y) / _FogRange * 2.;\n            fDeltaY = abs(fDeltaA - fDeltaB);\n            fDensityIntegral = abs((fDeltaA * fDeltaA * 0.5) - (fDeltaB * fDeltaB * 0.5));\n        } else {\n            fDeltaY = abs(_FogTop - cc_cameraPos.y) / _FogRange * 2.;\n            fDensityIntegral = abs(fDeltaY * fDeltaY * 0.5);\n        }\n    }\n    float fDensity;\n    if (fDeltaY != 0.) {\n        fDensity = (sqrt(1.0 + ((fDeltaD / fDeltaY) * (fDeltaD / fDeltaY)))) * fDensityIntegral;\n    } else {\n        fDensity = 0.;\n    }\n    float f = exp(-fDensity);\n    return f;\n}\nfloat CC_TRANSFER_FOG(vec4 pos) {\n    #if CC_USE_FOG == 0\n        return LinearFog(pos);\n\t#elif CC_USE_FOG == 1\n        return ExpFog(pos);\n    #elif CC_USE_FOG == 2\n        return ExpSquaredFog(pos);\n    #elif CC_USE_FOG == 3\n        return LayeredFog(pos);\n    #endif\n    return 1.;\n}\n#if USE_VERTEX_COLOR\n  attribute lowp vec4 a_color;\n  varying lowp vec4 v_color;\n#endif\n#if USE_TEXTURE\n  varying vec2 v_uv;\n  uniform vec4 tilingOffset;\n#endif\nvarying float factor_fog;\nvec4 vert () {\n  vec4 position;\n  position = vec4(a_position, 1.0);\n  #if CC_USE_MORPH\n    applyMorph(position);\n  #endif\n  #if CC_USE_SKINNING\n    CCSkin(position);\n  #endif\n  mat4 matWorld;\n  #if USE_INSTANCING\n    matWorld = mat4(\n      vec4(a_matWorld0.xyz, 0.0),\n      vec4(a_matWorld1.xyz, 0.0),\n      vec4(a_matWorld2.xyz, 0.0),\n      vec4(a_matWorld0.w, a_matWorld1.w, a_matWorld2.w, 1.0)\n    );\n  #elif USE_BATCHING\n    matWorld = cc_matWorlds[int(a_dyn_batch_id)];\n  #else\n    matWorld = cc_matWorld;\n  #endif\n  #if USE_TEXTURE\n    v_uv = a_texCoord * tilingOffset.xy + tilingOffset.zw;\n  #endif\n  #if USE_VERTEX_COLOR\n    v_color = a_color;\n  #endif\n  factor_fog = CC_TRANSFER_FOG(matWorld * position);\n  return cc_matProj * (cc_matView * matWorld) * position;\n}\nvoid main() { gl_Position = vert(); }",frag:"\nprecision highp float;\nuniform mediump vec4 cc_exposure;\nuniform mediump vec4 cc_fogColor;\nvec3 SRGBToLinear (vec3 gamma) {\n  return gamma * gamma;\n}\nvec4 CCFragOutput (vec4 color) {\n  #if CC_USE_HDR\n    color.rgb = mix(color.rgb, SRGBToLinear(color.rgb) * cc_exposure.w, vec3(cc_exposure.z));\n  #endif\n  return color;\n}\n#if USE_ALPHA_TEST\n#endif\n#if USE_TEXTURE\n  varying vec2 v_uv;\n  uniform sampler2D mainTexture;\n#endif\nuniform vec4 mainColor;\nuniform vec4 colorScaleAndCutoff;\n#if USE_VERTEX_COLOR\n  varying lowp vec4 v_color;\n#endif\nvarying float factor_fog;\nvec4 frag () {\n  vec4 o = mainColor;\n  o.rgb *= colorScaleAndCutoff.xyz;\n  #if USE_VERTEX_COLOR\n    o *= v_color;\n  #endif\n  #if USE_TEXTURE\n    o *= texture2D(mainTexture, v_uv);\n  #endif\n  #if USE_ALPHA_TEST\n    if (o.ALPHA_TEST_CHANNEL < colorScaleAndCutoff.w) discard;\n  #endif\n  o = vec4(mix(CC_FORWARD_ADD > 0 ? vec3(0.0) : cc_fogColor.rgb, o.rgb, factor_fog), o.a);\n  return CCFragOutput(o);\n}\nvoid main() { gl_FragColor = frag(); }"}],[{vert:"\nprecision highp float;\nhighp float decode32 (highp vec4 rgba) {\n  rgba = rgba * 255.0;\n  highp float Sign = 1.0 - (step(128.0, (rgba[3]) + 0.5)) * 2.0;\n  highp float Exponent = 2.0 * (mod(float(int((rgba[3]) + 0.5)), 128.0)) + (step(128.0, (rgba[2]) + 0.5)) - 127.0;\n  highp float Mantissa = (mod(float(int((rgba[2]) + 0.5)), 128.0)) * 65536.0 + rgba[1] * 256.0 + rgba[0] + 8388608.0;\n  return Sign * exp2(Exponent - 23.0) * Mantissa;\n}\nstruct StandardVertInput {\n  highp vec4 position;\n  vec3 normal;\n  vec4 tangent;\n};\nattribute vec3 a_position;\nattribute vec3 a_normal;\nattribute vec2 a_texCoord;\nattribute vec4 a_tangent;\n#if CC_USE_MORPH\n    attribute float a_vertexId;\n    int getVertexId() {\n        return int(a_vertexId);\n    }\nuniform vec4 cc_displacementWeights[15];\nuniform vec4 cc_displacementTextureInfo;\nvec2 getPixelLocation(vec2 textureResolution, int pixelIndex) {\n    float pixelIndexF = float(pixelIndex);\n    float x = mod(pixelIndexF, textureResolution.x);\n    float y = floor(pixelIndexF / textureResolution.x);\n    return vec2(x, y);\n}\nvec2 getPixelCoordFromLocation(vec2 location, vec2 textureResolution) {\n    return (vec2(location.x, location.y) + .5) / textureResolution;\n}\n#if CC_SUPPORT_FLOAT_TEXTURE\n        vec4 fetchVec3ArrayFromTexture(sampler2D tex, int elementIndex) {\n            int pixelIndex = elementIndex;\n            vec2 location = getPixelLocation(cc_displacementTextureInfo.xy, pixelIndex);\n            vec2 uv = getPixelCoordFromLocation(location, cc_displacementTextureInfo.xy);\n            return texture2D(tex, uv);\n        }\n#else\n    vec4 fetchVec3ArrayFromTexture(sampler2D tex, int elementIndex) {\n        int pixelIndex = elementIndex * 4;\n        vec2 location = getPixelLocation(cc_displacementTextureInfo.xy, pixelIndex);\n        vec2 x = getPixelCoordFromLocation(location + vec2(0.0, 0.0), cc_displacementTextureInfo.xy);\n        vec2 y = getPixelCoordFromLocation(location + vec2(1.0, 0.0), cc_displacementTextureInfo.xy);\n        vec2 z = getPixelCoordFromLocation(location + vec2(2.0, 0.0), cc_displacementTextureInfo.xy);\n        return vec4(\n            decode32(texture2D(tex, x)),\n            decode32(texture2D(tex, y)),\n            decode32(texture2D(tex, z)),\n            1.0\n        );\n    }\n#endif\nfloat getDisplacementWeight(int index) {\n    int quot = index / 4;\n    int remainder = index - quot * 4;\n    if (remainder == 0) {\n        return cc_displacementWeights[quot].x;\n    } else if (remainder == 1) {\n        return cc_displacementWeights[quot].y;\n    } else if (remainder == 2) {\n        return cc_displacementWeights[quot].z;\n    } else {\n        return cc_displacementWeights[quot].w;\n    }\n}\nvec3 getVec3DisplacementFromTexture(sampler2D tex, int vertexIndex) {\n#if CC_MORPH_PRECOMPUTED\n    return fetchVec3ArrayFromTexture(tex, vertexIndex).rgb;\n#else\n    vec3 result = vec3(0, 0, 0);\n    int nVertices = int(cc_displacementTextureInfo.z);\n    for (int iTarget = 0; iTarget < CC_MORPH_TARGET_COUNT; ++iTarget) {\n        result += (fetchVec3ArrayFromTexture(tex, nVertices * iTarget + vertexIndex).rgb * getDisplacementWeight(iTarget));\n    }\n    return result;\n#endif\n}\n#if CC_MORPH_TARGET_HAS_POSITION\n    uniform sampler2D cc_PositionDisplacements;\n    vec3 getPositionDisplacement(int vertexId) {\n        return getVec3DisplacementFromTexture(cc_PositionDisplacements, vertexId);\n    }\n#endif\n#if CC_MORPH_TARGET_HAS_NORMAL\n    uniform sampler2D cc_NormalDisplacements;\n    vec3 getNormalDisplacement(int vertexId) {\n        return getVec3DisplacementFromTexture(cc_NormalDisplacements, vertexId);\n    }\n#endif\n#if CC_MORPH_TARGET_HAS_TANGENT\n    uniform sampler2D cc_TangentDisplacements;\n    vec3 getTangentDisplacement(int vertexId) {\n        return getVec3DisplacementFromTexture(cc_TangentDisplacements, vertexId);\n    }\n#endif\nvoid applyMorph (inout StandardVertInput attr) {\n    int vertexId = getVertexId();\n#if CC_MORPH_TARGET_HAS_POSITION\n    attr.position.xyz = attr.position.xyz + getPositionDisplacement(vertexId);\n#endif\n#if CC_MORPH_TARGET_HAS_NORMAL\n    attr.normal.xyz = attr.normal.xyz + getNormalDisplacement(vertexId);\n#endif\n#if CC_MORPH_TARGET_HAS_TANGENT\n    attr.tangent.xyz = attr.tangent.xyz + getTangentDisplacement(vertexId);\n#endif\n}\nvoid applyMorph (inout vec4 position) {\n#if CC_MORPH_TARGET_HAS_POSITION\n    position.xyz = position.xyz + getPositionDisplacement(getVertexId());\n#endif\n}\n#endif\n#if CC_USE_SKINNING\n  attribute vec4 a_joints;\nattribute vec4 a_weights;\n#if CC_USE_BAKED_ANIMATION\n  #if USE_INSTANCING\n    attribute highp vec4 a_jointAnimInfo;\n  #endif\n  uniform highp vec4 cc_jointTextureInfo;\n  uniform highp vec4 cc_jointAnimInfo;\n  uniform highp sampler2D cc_jointTexture;\n  #else\n  uniform highp vec4 cc_joints[90];\n#endif\n#if CC_USE_BAKED_ANIMATION\n  #if CC_SUPPORT_FLOAT_TEXTURE\n    mat4 getJointMatrix (float i) {\n    #if USE_INSTANCING\n      highp float j = 3.0 * (a_jointAnimInfo.x * a_jointAnimInfo.y + i) + a_jointAnimInfo.z;\n    #else\n      highp float j = 3.0 * (cc_jointAnimInfo.x * cc_jointTextureInfo.y + i) + cc_jointTextureInfo.z;\n    #endif\n    highp float invSize = cc_jointTextureInfo.w;\n    highp float y = floor(j * invSize);\n    highp float x = j - y * cc_jointTextureInfo.x;\n    y = (y + 0.5) * invSize;\n      vec4 v1 = texture2D(cc_jointTexture, vec2((x + 0.5) * invSize, y));\n      vec4 v2 = texture2D(cc_jointTexture, vec2((x + 1.5) * invSize, y));\n      vec4 v3 = texture2D(cc_jointTexture, vec2((x + 2.5) * invSize, y));\n      return mat4(vec4(v1.xyz, 0.0), vec4(v2.xyz, 0.0), vec4(v3.xyz, 0.0), vec4(v1.w, v2.w, v3.w, 1.0));\n    }\n  #else\n    mat4 getJointMatrix (float i) {\n    #if USE_INSTANCING\n      highp float j = 12.0 * (a_jointAnimInfo.x * a_jointAnimInfo.y + i) + a_jointAnimInfo.z;\n    #else\n      highp float j = 12.0 * (cc_jointAnimInfo.x * cc_jointTextureInfo.y + i) + cc_jointTextureInfo.z;\n    #endif\n    highp float invSize = cc_jointTextureInfo.w;\n    highp float y = floor(j * invSize);\n    highp float x = j - y * cc_jointTextureInfo.x;\n    y = (y + 0.5) * invSize;\n      vec4 v1 = vec4(\n        decode32(texture2D(cc_jointTexture, vec2((x + 0.5) * invSize, y))),\n        decode32(texture2D(cc_jointTexture, vec2((x + 1.5) * invSize, y))),\n        decode32(texture2D(cc_jointTexture, vec2((x + 2.5) * invSize, y))),\n        decode32(texture2D(cc_jointTexture, vec2((x + 3.5) * invSize, y)))\n      );\n      vec4 v2 = vec4(\n        decode32(texture2D(cc_jointTexture, vec2((x + 4.5) * invSize, y))),\n        decode32(texture2D(cc_jointTexture, vec2((x + 5.5) * invSize, y))),\n        decode32(texture2D(cc_jointTexture, vec2((x + 6.5) * invSize, y))),\n        decode32(texture2D(cc_jointTexture, vec2((x + 7.5) * invSize, y)))\n      );\n      vec4 v3 = vec4(\n        decode32(texture2D(cc_jointTexture, vec2((x + 8.5) * invSize, y))),\n        decode32(texture2D(cc_jointTexture, vec2((x + 9.5) * invSize, y))),\n        decode32(texture2D(cc_jointTexture, vec2((x + 10.5) * invSize, y))),\n        decode32(texture2D(cc_jointTexture, vec2((x + 11.5) * invSize, y)))\n      );\n      return mat4(vec4(v1.xyz, 0.0), vec4(v2.xyz, 0.0), vec4(v3.xyz, 0.0), vec4(v1.w, v2.w, v3.w, 1.0));\n    }\n  #endif\n#else\n  mat4 getJointMatrix (float i) {\n    int idx = int(i);\n    vec4 v1 = cc_joints[idx * 3];\n    vec4 v2 = cc_joints[idx * 3 + 1];\n    vec4 v3 = cc_joints[idx * 3 + 2];\n    return mat4(vec4(v1.xyz, 0.0), vec4(v2.xyz, 0.0), vec4(v3.xyz, 0.0), vec4(v1.w, v2.w, v3.w, 1.0));\n  }\n#endif\nmat4 skinMatrix () {\n  vec4 joints = vec4(a_joints);\n  return getJointMatrix(joints.x) * a_weights.x\n       + getJointMatrix(joints.y) * a_weights.y\n       + getJointMatrix(joints.z) * a_weights.z\n       + getJointMatrix(joints.w) * a_weights.w;\n}\nvoid CCSkin (inout vec4 position) {\n  mat4 m = skinMatrix();\n  position = m * position;\n}\nvoid CCSkin (inout StandardVertInput attr) {\n  mat4 m = skinMatrix();\n  attr.position = m * attr.position;\n  attr.normal = (m * vec4(attr.normal, 0.0)).xyz;\n  attr.tangent.xyz = (m * vec4(attr.tangent.xyz, 0.0)).xyz;\n}\n#endif\nuniform highp mat4 cc_matView;\nuniform highp mat4 cc_matProj;\n#if USE_INSTANCING\n  attribute vec4 a_matWorld0;\n  attribute vec4 a_matWorld1;\n  attribute vec4 a_matWorld2;\n  #if USE_LIGHTMAP\n    attribute vec4 a_lightingMapUVParam;\n  #endif\n#elif USE_BATCHING\n  attribute float a_dyn_batch_id;\n  uniform highp mat4 cc_matWorlds[10];\n#else\nuniform highp mat4 cc_matWorld;\n#endif\nuniform highp mat4 cc_matLightPlaneProj;\nvec4 vert () {\n  vec4 position;\n  position = vec4(a_position, 1.0);\n  #if CC_USE_MORPH\n    applyMorph(position);\n  #endif\n  #if CC_USE_SKINNING\n    CCSkin(position);\n  #endif\n  mat4 matWorld;\n  #if USE_INSTANCING\n    matWorld = mat4(\n      vec4(a_matWorld0.xyz, 0.0),\n      vec4(a_matWorld1.xyz, 0.0),\n      vec4(a_matWorld2.xyz, 0.0),\n      vec4(a_matWorld0.w, a_matWorld1.w, a_matWorld2.w, 1.0)\n    );\n  #elif USE_BATCHING\n    matWorld = cc_matWorlds[int(a_dyn_batch_id)];\n  #else\n    matWorld = cc_matWorld;\n  #endif\n  position = cc_matProj * (cc_matView * cc_matLightPlaneProj * matWorld) * position;\n  position.z -= 0.0001;\n  return position;\n}\nvoid main() { gl_Position = vert(); }",frag:"\nprecision mediump float;\nuniform lowp vec4 cc_shadowColor;\nuniform mediump vec4 cc_exposure;\nvec3 SRGBToLinear (vec3 gamma) {\n  return gamma * gamma;\n}\nvec4 CCFragOutput (vec4 color) {\n  #if CC_USE_HDR\n    color.rgb = mix(color.rgb, SRGBToLinear(color.rgb) * cc_exposure.w, vec3(cc_exposure.z));\n  #endif\n  return color;\n}\nvec4 frag () {\n  return CCFragOutput(cc_shadowColor);\n}\nvoid main() { gl_FragColor = frag(); }"}],[{vert:"\nprecision highp float;\nuniform highp mat4 cc_matView;\nuniform highp mat4 cc_matProj;\nstruct StandardVertInput {\n  highp vec4 position;\n  vec3 normal;\n  vec4 tangent;\n};\nattribute vec3 a_position;\nattribute vec3 a_normal;\nattribute vec2 a_texCoord;\nattribute vec4 a_tangent;\nvarying mediump vec4 viewDir;\nvec4 vert () {\n  viewDir = vec4(a_position, 1.0);\n  mat4 matViewRotOnly = mat4(mat3(cc_matView));\n  mat4 matProj = cc_matProj;\n  if (matProj[3].w > 0.0) {\n    vec2 scale = vec2(48.0, 24.0);\n    matProj[0].xy *= scale;\n    matProj[1].xy *= scale;\n    matProj[2].zw = vec2(-1.0);\n    matProj[3].zw = vec2(0.0);\n  }\n  vec4 pos = matProj * matViewRotOnly * viewDir;\n  pos.z = 0.99999 * pos.w;\n  return pos;\n}\nvoid main() { gl_Position = vert(); }",frag:"\nprecision mediump float;\nuniform mediump vec4 cc_ambientSky;\nuniform samplerCube cc_environment;\nvec3 unpackRGBE (vec4 rgbe) {\n  return rgbe.rgb * pow(2.0, rgbe.a * 255.0 - 128.0);\n}\nvec3 SRGBToLinear (vec3 gamma) {\n  return gamma * gamma;\n}\nvec3 ACESToneMap (vec3 color) {\n  color = min(color, vec3(8.0));\n  const float A = 2.51;\n  const float B = 0.03;\n  const float C = 2.43;\n  const float D = 0.59;\n  const float E = 0.14;\n  return (color * (A * color + B)) / (color * (C * color + D) + E);\n}\nvec4 CCFragOutput (vec4 color) {\n  #if !CC_USE_HDR\n    color.rgb = sqrt(ACESToneMap(color.rgb));\n  #endif\n  return color;\n}\nvarying mediump vec4 viewDir;\nvec4 frag () {\n  #if USE_RGBE_CUBEMAP\n    vec3 c = unpackRGBE(textureCube(cc_environment, viewDir.xyz));\n  #else\n    vec3 c = SRGBToLinear(textureCube(cc_environment, viewDir.xyz).rgb);\n  #endif\n  return CCFragOutput(vec4(c * cc_ambientSky.w, 1.0));\n}\nvoid main() { gl_FragColor = frag(); }"}],[{vert:"\nprecision mediump float;\nuniform highp mat4 cc_matViewProj;\nattribute vec3 a_position;\nattribute vec4 a_color;\nvarying vec2 v_uv;\nuniform vec4 offset;\nuniform vec4 digits[20];\nfloat getComponent(vec4 v, float i) {\n  if (i < 1.0) { return v.x; }\n  else if (i < 2.0) { return v.y; }\n  else if (i < 3.0) { return v.z; }\n  else { return v.w; }\n}\nvec4 vert () {\n  vec4 position = cc_matViewProj * vec4(a_position, 1.0);\n  position.xy += offset.xy;\n  v_uv = a_color.xy;\n  if (a_color.z >= 0.0) {\n    float n = getComponent(digits[int(a_color.z)], a_color.w);\n    v_uv += vec2(offset.z * n, 0.0);\n  }\n  return position;\n}\nvoid main() { gl_Position = vert(); }",frag:"\nprecision mediump float;\nuniform mediump vec4 cc_exposure;\nvec3 SRGBToLinear (vec3 gamma) {\n  return gamma * gamma;\n}\nvec4 CCFragOutput (vec4 color) {\n  #if CC_USE_HDR\n    color.rgb = mix(color.rgb, SRGBToLinear(color.rgb) * cc_exposure.w, vec3(cc_exposure.z));\n  #endif\n  return color;\n}\nvarying vec2 v_uv;\nuniform sampler2D mainTexture;\nvec4 frag () {\n  return CCFragOutput(texture2D(mainTexture, v_uv));\n}\nvoid main() { gl_FragColor = frag(); }"}],[{vert:"\nprecision mediump float;\nattribute vec2 a_position;\nattribute vec2 a_texCoord;\nvarying vec2 v_uv;\nvec4 vert () {\n  vec4 pos = vec4(a_position, 0, 1);\n  v_uv = a_texCoord;\n  return pos;\n}\nvoid main() { gl_Position = vert(); }",frag:"\nprecision mediump float;\nvarying vec2 v_uv;\nuniform sampler2D mainTexture;\nuniform float u_precent;\nvec4 frag () {\n  vec4 color = texture2D(mainTexture, v_uv);\n  float precent = clamp(u_precent, 0.0, 1.0);\n  color.xyz *= precent;\n  return color;\n}\nvoid main() { gl_FragColor = frag(); }"}]],glsl3:[[{vert:"\nprecision mediump float;\nlayout(std140) uniform Constants {\n  vec4 mainTiling_Offset;\n  vec4 frameTile_velLenScale;\n  vec4 scale;\n};\nlayout(std140) uniform CCGlobal {\n  highp   vec4 cc_time;\n  mediump vec4 cc_screenSize;\n  mediump vec4 cc_nativeSize;\n};\nlayout(std140) uniform CCCamera {\n  highp   mat4 cc_matView;\n  highp   mat4 cc_matViewInv;\n  highp   mat4 cc_matProj;\n  highp   mat4 cc_matProjInv;\n  highp   mat4 cc_matViewProj;\n  highp   mat4 cc_matViewProjInv;\n  highp   vec4 cc_cameraPos;\n  mediump vec4 cc_screenScale;\n  mediump vec4 cc_exposure;\n  mediump vec4 cc_mainLitDir;\n  mediump vec4 cc_mainLitColor;\n  mediump vec4 cc_ambientSky;\n  mediump vec4 cc_ambientGround;\n  mediump vec4 cc_fogColor;\n  mediump vec4 cc_fogBase;\n  mediump vec4 cc_fogAdd;\n};\nlayout(std140) uniform CCLocal {\n  highp mat4 cc_matWorld;\n  highp mat4 cc_matWorldIT;\n  highp vec4 cc_lightingMapUVParam;\n};\nvec4 quaternionFromAxis (vec3 xAxis,vec3 yAxis,vec3 zAxis){\n  mat3 m = mat3(xAxis,yAxis,zAxis);\n  float trace = m[0][0] + m[1][1] + m[2][2];\n  vec4 quat;\n  if (trace > 0.) {\n    float s = 0.5 / sqrt(trace + 1.0);\n    quat.w = 0.25 / s;\n    quat.x = (m[2][1] - m[1][2]) * s;\n    quat.y = (m[0][2] - m[2][0]) * s;\n    quat.z = (m[1][0] - m[0][1]) * s;\n  } else if ((m[0][0] > m[1][1]) && (m[0][0] > m[2][2])) {\n    float s = 2.0 * sqrt(1.0 + m[0][0] - m[1][1] - m[2][2]);\n    quat.w = (m[2][1] - m[1][2]) / s;\n    quat.x = 0.25 * s;\n    quat.y = (m[0][1] + m[1][0]) / s;\n    quat.z = (m[0][2] + m[2][0]) / s;\n  } else if (m[1][1] > m[2][2]) {\n    float s = 2.0 * sqrt(1.0 + m[1][1] - m[0][0] - m[2][2]);\n    quat.w = (m[0][2] - m[2][0]) / s;\n    quat.x = (m[0][1] + m[1][0]) / s;\n    quat.y = 0.25 * s;\n    quat.z = (m[1][2] + m[2][1]) / s;\n  } else {\n    float s = 2.0 * sqrt(1.0 + m[2][2] - m[0][0] - m[1][1]);\n    quat.w = (m[1][0] - m[0][1]) / s;\n    quat.x = (m[0][2] + m[2][0]) / s;\n    quat.y = (m[1][2] + m[2][1]) / s;\n    quat.z = 0.25 * s;\n  }\n  float len = quat.x * quat.x + quat.y * quat.y + quat.z * quat.z + quat.w * quat.w;\n  if (len > 0.) {\n    len = 1. / sqrt(len);\n    quat.x = quat.x * len;\n    quat.y = quat.y * len;\n    quat.z = quat.z * len;\n    quat.w = quat.w * len;\n  }\n  return quat;\n}\nvec4 quaternionFromEuler (vec3 angle){\n  float x = angle.x / 2.;\n  float y = angle.y / 2.;\n  float z = angle.z / 2.;\n  float sx = sin(x);\n  float cx = cos(x);\n  float sy = sin(y);\n  float cy = cos(y);\n  float sz = sin(z);\n  float cz = cos(z);\n  vec4 quat = vec4(0);\n  quat.x = sx * cy * cz + cx * sy * sz;\n  quat.y = cx * sy * cz + sx * cy * sz;\n  quat.z = cx * cy * sz - sx * sy * cz;\n  quat.w = cx * cy * cz - sx * sy * sz;\n  return quat;\n}\nvec4 quatMultiply (vec4 a, vec4 b){\n  vec4 quat;\n  quat.x = a.x * b.w + a.w * b.x + a.y * b.z - a.z * b.y;\n  quat.y = a.y * b.w + a.w * b.y + a.z * b.x - a.x * b.z;\n  quat.z = a.z * b.w + a.w * b.z + a.x * b.y - a.y * b.x;\n  quat.w = a.w * b.w - a.x * b.x - a.y * b.y - a.z * b.z;\n  return quat;\n}\nvoid rotateVecFromQuat (inout vec3 v, vec4 q){\n  float ix = q.w * v.x + q.y * v.z - q.z * v.y;\n  float iy = q.w * v.y + q.z * v.x - q.x * v.z;\n  float iz = q.w * v.z + q.x * v.y - q.y * v.x;\n  float iw = -q.x * v.x - q.y * v.y - q.z * v.z;\n  v.x = ix * q.w + iw * -q.x + iy * -q.z - iz * -q.y;\n  v.y = iy * q.w + iw * -q.y + iz * -q.x - ix * -q.z;\n  v.z = iz * q.w + iw * -q.z + ix * -q.y - iy * -q.x;\n}\nvec3 rotateInLocalSpace (vec3 pos, vec3 xAxis, vec3 yAxis, vec3 zAxis, vec4 q){\n  vec4 viewQuat = quaternionFromAxis(xAxis, yAxis, zAxis);\n  vec4 rotQuat = quatMultiply(viewQuat, q);\n  rotateVecFromQuat(pos, rotQuat);\n  return pos;\n}\nvoid rotateCorner (inout vec2 corner, float angle){\n  float xOS = cos(angle) * corner.x - sin(angle) * corner.y;\n  float yOS = sin(angle) * corner.x + cos(angle) * corner.y;\n  corner.x = xOS;\n  corner.y = yOS;\n}\nout mediump vec2 uv;\nout mediump vec4 color;\nvoid computeVertPos (inout vec4 pos, vec2 vertOffset, vec4 q, vec3 s\n  , mat4 viewInv\n) {\n  vec3 viewSpaceVert = vec3(vertOffset.x * s.x, vertOffset.y * s.y, 0.);\n  vec3 camX = normalize(vec3(viewInv[0][0], viewInv[1][0], viewInv[2][0]));\n  vec3 camY = normalize(vec3(viewInv[0][1], viewInv[1][1], viewInv[2][1]));\n  vec3 camZ = normalize(vec3(viewInv[0][2], viewInv[1][2], viewInv[2][2]));\n  pos.xyz += rotateInLocalSpace(viewSpaceVert, camX, camY, camZ, q);\n}\nin vec3 a_position;\nin vec2 a_texCoord;\nin vec4 a_color;\nlayout(std140) uniform builtin {\n  vec4 cc_size_rotation;\n};\nvec4 vs_main() {\n  vec4 pos = vec4(a_position, 1);\n  pos = cc_matWorld * pos;\n  vec2 vertOffset = a_texCoord.xy - 0.5;\n  computeVertPos(pos, vertOffset, quaternionFromEuler(vec3(0., 0., cc_size_rotation.z)), vec3(cc_size_rotation.xy, 0.), cc_matViewInv);\n  pos = cc_matViewProj * pos;\n  uv = a_texCoord.xy;\n  color = a_color;\n  return pos;\n}\nvoid main() { gl_Position = vs_main(); }",frag:"\nprecision mediump float;\nlayout(std140) uniform CCGlobal {\n  highp   vec4 cc_time;\n  mediump vec4 cc_screenSize;\n  mediump vec4 cc_nativeSize;\n};\nlayout(std140) uniform CCCamera {\n  highp   mat4 cc_matView;\n  highp   mat4 cc_matViewInv;\n  highp   mat4 cc_matProj;\n  highp   mat4 cc_matProjInv;\n  highp   mat4 cc_matViewProj;\n  highp   mat4 cc_matViewProjInv;\n  highp   vec4 cc_cameraPos;\n  mediump vec4 cc_screenScale;\n  mediump vec4 cc_exposure;\n  mediump vec4 cc_mainLitDir;\n  mediump vec4 cc_mainLitColor;\n  mediump vec4 cc_ambientSky;\n  mediump vec4 cc_ambientGround;\n  mediump vec4 cc_fogColor;\n  mediump vec4 cc_fogBase;\n  mediump vec4 cc_fogAdd;\n};\nvec3 SRGBToLinear (vec3 gamma) {\n  return gamma * gamma;\n}\nvec4 CCFragOutput (vec4 color) {\n  #if CC_USE_HDR\n    color.rgb = mix(color.rgb, SRGBToLinear(color.rgb) * cc_exposure.w, vec3(cc_exposure.z));\n  #endif\n  return color;\n}\nin vec2 uv;\nin vec4 color;\nuniform sampler2D mainTexture;\nlayout(std140) uniform FragConstants {\n  vec4 tintColor;\n};\nvec4 add () {\n  vec4 col = 2.0 * color * tintColor * texture(mainTexture, uv);\n  return CCFragOutput(col);\n}\nlayout(location = 0) out vec4 cc_FragColor;\nvoid main() { cc_FragColor = add(); }"}],[{vert:"\nprecision highp float;\nin vec3 a_position;\nvec4 vert () {\n  vec4 pos = vec4(a_position, 1);\n  return pos;\n}\nvoid main() { gl_Position = vert(); }",frag:"\nprecision highp float;\nvec4 frag () {\n  vec4 o = vec4(1.0);\n  return o;\n}\nlayout(location = 0) out vec4 cc_FragColor;\nvoid main() { cc_FragColor = frag(); }"}],[{vert:"\nprecision highp float;\nlayout(std140) uniform CCGlobal {\n  highp   vec4 cc_time;\n  mediump vec4 cc_screenSize;\n  mediump vec4 cc_nativeSize;\n};\nlayout(std140) uniform CCCamera {\n  highp   mat4 cc_matView;\n  highp   mat4 cc_matViewInv;\n  highp   mat4 cc_matProj;\n  highp   mat4 cc_matProjInv;\n  highp   mat4 cc_matViewProj;\n  highp   mat4 cc_matViewProjInv;\n  highp   vec4 cc_cameraPos;\n  mediump vec4 cc_screenScale;\n  mediump vec4 cc_exposure;\n  mediump vec4 cc_mainLitDir;\n  mediump vec4 cc_mainLitColor;\n  mediump vec4 cc_ambientSky;\n  mediump vec4 cc_ambientGround;\n  mediump vec4 cc_fogColor;\n  mediump vec4 cc_fogBase;\n  mediump vec4 cc_fogAdd;\n};\nlayout(std140) uniform CCLocal {\n  highp mat4 cc_matWorld;\n  highp mat4 cc_matWorldIT;\n  highp vec4 cc_lightingMapUVParam;\n};\nin vec3 a_position;\nin vec4 a_color;\nout vec4 v_color;\nin float a_dist;\nout float v_dist;\nvec4 vert () {\n  vec4 pos = vec4(a_position, 1);\n  pos = cc_matViewProj * cc_matWorld * pos;\n  v_color = a_color;\n  v_dist = a_dist;\n  return pos;\n}\nvoid main() { gl_Position = vert(); }",frag:"\nprecision highp float;\nin vec4 v_color;\nin float v_dist;\nvec4 frag () {\n  vec4 o = v_color;\n    float aa = fwidth(v_dist);\n  float alpha = 1. - smoothstep(-aa, 0., abs(v_dist) - 1.0);\n  o.rgb *= o.a;\n  o *= alpha;\n  return o;\n}\nlayout(location = 0) out vec4 cc_FragColor;\nvoid main() { cc_FragColor = frag(); }"}],[{vert:"\nprecision mediump float;\nvec4 quaternionFromAxis (vec3 xAxis,vec3 yAxis,vec3 zAxis){\n  mat3 m = mat3(xAxis,yAxis,zAxis);\n  float trace = m[0][0] + m[1][1] + m[2][2];\n  vec4 quat;\n  if (trace > 0.) {\n    float s = 0.5 / sqrt(trace + 1.0);\n    quat.w = 0.25 / s;\n    quat.x = (m[2][1] - m[1][2]) * s;\n    quat.y = (m[0][2] - m[2][0]) * s;\n    quat.z = (m[1][0] - m[0][1]) * s;\n  } else if ((m[0][0] > m[1][1]) && (m[0][0] > m[2][2])) {\n    float s = 2.0 * sqrt(1.0 + m[0][0] - m[1][1] - m[2][2]);\n    quat.w = (m[2][1] - m[1][2]) / s;\n    quat.x = 0.25 * s;\n    quat.y = (m[0][1] + m[1][0]) / s;\n    quat.z = (m[0][2] + m[2][0]) / s;\n  } else if (m[1][1] > m[2][2]) {\n    float s = 2.0 * sqrt(1.0 + m[1][1] - m[0][0] - m[2][2]);\n    quat.w = (m[0][2] - m[2][0]) / s;\n    quat.x = (m[0][1] + m[1][0]) / s;\n    quat.y = 0.25 * s;\n    quat.z = (m[1][2] + m[2][1]) / s;\n  } else {\n    float s = 2.0 * sqrt(1.0 + m[2][2] - m[0][0] - m[1][1]);\n    quat.w = (m[1][0] - m[0][1]) / s;\n    quat.x = (m[0][2] + m[2][0]) / s;\n    quat.y = (m[1][2] + m[2][1]) / s;\n    quat.z = 0.25 * s;\n  }\n  float len = quat.x * quat.x + quat.y * quat.y + quat.z * quat.z + quat.w * quat.w;\n  if (len > 0.) {\n    len = 1. / sqrt(len);\n    quat.x = quat.x * len;\n    quat.y = quat.y * len;\n    quat.z = quat.z * len;\n    quat.w = quat.w * len;\n  }\n  return quat;\n}\nvec4 quaternionFromEuler (vec3 angle){\n  float x = angle.x / 2.;\n  float y = angle.y / 2.;\n  float z = angle.z / 2.;\n  float sx = sin(x);\n  float cx = cos(x);\n  float sy = sin(y);\n  float cy = cos(y);\n  float sz = sin(z);\n  float cz = cos(z);\n  vec4 quat = vec4(0);\n  quat.x = sx * cy * cz + cx * sy * sz;\n  quat.y = cx * sy * cz + sx * cy * sz;\n  quat.z = cx * cy * sz - sx * sy * cz;\n  quat.w = cx * cy * cz - sx * sy * sz;\n  return quat;\n}\nmat4 matrixFromRT (vec4 q, vec3 p){\n  float x2 = q.x + q.x;\n  float y2 = q.y + q.y;\n  float z2 = q.z + q.z;\n  float xx = q.x * x2;\n  float xy = q.x * y2;\n  float xz = q.x * z2;\n  float yy = q.y * y2;\n  float yz = q.y * z2;\n  float zz = q.z * z2;\n  float wx = q.w * x2;\n  float wy = q.w * y2;\n  float wz = q.w * z2;\n  return mat4(\n    1. - (yy + zz), xy + wz, xz - wy, 0,\n    xy - wz, 1. - (xx + zz), yz + wx, 0,\n    xz + wy, yz - wx, 1. - (xx + yy), 0,\n    p.x, p.y, p.z, 1\n  );\n}\nmat4 matFromRTS (vec4 q, vec3 t, vec3 s){\n  float x = q.x, y = q.y, z = q.z, w = q.w;\n  float x2 = x + x;\n  float y2 = y + y;\n  float z2 = z + z;\n  float xx = x * x2;\n  float xy = x * y2;\n  float xz = x * z2;\n  float yy = y * y2;\n  float yz = y * z2;\n  float zz = z * z2;\n  float wx = w * x2;\n  float wy = w * y2;\n  float wz = w * z2;\n  float sx = s.x;\n  float sy = s.y;\n  float sz = s.z;\n  return mat4((1. - (yy + zz)) * sx, (xy + wz) * sx, (xz - wy) * sx, 0,\n    (xy - wz) * sy, (1. - (xx + zz)) * sy, (yz + wx) * sy, 0,\n    (xz + wy) * sz, (yz - wx) * sz, (1. - (xx + yy)) * sz, 0,\n    t.x, t.y, t.z, 1);\n}\nvec4 quatMultiply (vec4 a, vec4 b){\n  vec4 quat;\n  quat.x = a.x * b.w + a.w * b.x + a.y * b.z - a.z * b.y;\n  quat.y = a.y * b.w + a.w * b.y + a.z * b.x - a.x * b.z;\n  quat.z = a.z * b.w + a.w * b.z + a.x * b.y - a.y * b.x;\n  quat.w = a.w * b.w - a.x * b.x - a.y * b.y - a.z * b.z;\n  return quat;\n}\nvoid rotateVecFromQuat (inout vec3 v, vec4 q){\n  float ix = q.w * v.x + q.y * v.z - q.z * v.y;\n  float iy = q.w * v.y + q.z * v.x - q.x * v.z;\n  float iz = q.w * v.z + q.x * v.y - q.y * v.x;\n  float iw = -q.x * v.x - q.y * v.y - q.z * v.z;\n  v.x = ix * q.w + iw * -q.x + iy * -q.z - iz * -q.y;\n  v.y = iy * q.w + iw * -q.y + iz * -q.x - ix * -q.z;\n  v.z = iz * q.w + iw * -q.z + ix * -q.y - iy * -q.x;\n}\nvec3 rotateInLocalSpace (vec3 pos, vec3 xAxis, vec3 yAxis, vec3 zAxis, vec4 q){\n  vec4 viewQuat = quaternionFromAxis(xAxis, yAxis, zAxis);\n  vec4 rotQuat = quatMultiply(viewQuat, q);\n  rotateVecFromQuat(pos, rotQuat);\n  return pos;\n}\nvoid rotateCorner (inout vec2 corner, float angle){\n  float xOS = cos(angle) * corner.x - sin(angle) * corner.y;\n  float yOS = sin(angle) * corner.x + cos(angle) * corner.y;\n  corner.x = xOS;\n  corner.y = yOS;\n}\nlayout(std140) uniform Constants {\n  vec4 mainTiling_Offset;\n  vec4 frameTile_velLenScale;\n  vec4 scale;\n};\nlayout(std140) uniform CCGlobal {\n  highp   vec4 cc_time;\n  mediump vec4 cc_screenSize;\n  mediump vec4 cc_nativeSize;\n};\nlayout(std140) uniform CCCamera {\n  highp   mat4 cc_matView;\n  highp   mat4 cc_matViewInv;\n  highp   mat4 cc_matProj;\n  highp   mat4 cc_matProjInv;\n  highp   mat4 cc_matViewProj;\n  highp   mat4 cc_matViewProjInv;\n  highp   vec4 cc_cameraPos;\n  mediump vec4 cc_screenScale;\n  mediump vec4 cc_exposure;\n  mediump vec4 cc_mainLitDir;\n  mediump vec4 cc_mainLitColor;\n  mediump vec4 cc_ambientSky;\n  mediump vec4 cc_ambientGround;\n  mediump vec4 cc_fogColor;\n  mediump vec4 cc_fogBase;\n  mediump vec4 cc_fogAdd;\n};\nlayout(std140) uniform CCLocal {\n  highp mat4 cc_matWorld;\n  highp mat4 cc_matWorldIT;\n  highp vec4 cc_lightingMapUVParam;\n};\nout mediump vec2 uv;\nout mediump vec4 color;\nvoid computeVertPos (inout vec4 pos, vec2 vertOffset, vec4 q, vec3 s\n#if CC_RENDER_MODE == 0 || CC_RENDER_MODE == 3\n  , mat4 viewInv\n#endif\n#if CC_RENDER_MODE == 1\n  , vec3 eye\n  , vec4 velocity\n  , float velocityScale\n  , float lengthScale\n  , float xIndex\n#endif\n) {\n#if CC_RENDER_MODE == 0\n  vec3 viewSpaceVert = vec3(vertOffset.x * s.x, vertOffset.y * s.y, 0.);\n  vec3 camX = normalize(vec3(viewInv[0][0], viewInv[1][0], viewInv[2][0]));\n  vec3 camY = normalize(vec3(viewInv[0][1], viewInv[1][1], viewInv[2][1]));\n  vec3 camZ = normalize(vec3(viewInv[0][2], viewInv[1][2], viewInv[2][2]));\n  pos.xyz += rotateInLocalSpace(viewSpaceVert, camX, camY, camZ, q);\n#elif CC_RENDER_MODE == 1\n  vec3 camRight = normalize(cross(pos.xyz - eye, velocity.xyz)) * s.x;\n  vec3 camUp = velocity.xyz * velocityScale + normalize(velocity.xyz) * lengthScale * s.y;\n  pos.xyz += (camRight * abs(vertOffset.x) * sign(vertOffset.y)) - camUp * xIndex;\n#elif CC_RENDER_MODE == 2\n  vec3 viewSpaceVert = vec3(vertOffset.x * s.x, vertOffset.y * s.y, 0.);\n  vec3 camX = vec3(1, 0, 0);\n  vec3 camY = vec3(0, 0, -1);\n  pos.xyz += rotateInLocalSpace(viewSpaceVert, camX, camY, cross(camX, camY), q);\n#elif CC_RENDER_MODE == 3\n  vec2 viewSpaceVert = vec2(vertOffset.x * s.x, vertOffset.y * s.y);\n  rotateCorner(viewSpaceVert, q.z);\n  vec3 camX = normalize(vec3(cc_matView[0][0], cc_matView[1][0], cc_matView[2][0]));\n  vec3 camY = vec3(0, 1, 0);\n  vec3 offset = camX * viewSpaceVert.x + camY * viewSpaceVert.y;\n  pos.xyz += offset;\n#else\n  pos.x += vertOffset.x;\n  pos.y += vertOffset.y;\n#endif\n}\nvec2 computeUV (float frameIndex, vec2 vertIndex, vec2 frameTile){\n  vec2 aniUV = vec2(0, floor(frameIndex * frameTile.y));\n  aniUV.x = floor(frameIndex * frameTile.x * frameTile.y - aniUV.y * frameTile.x);\n#if CC_RENDER_MODE != 4\n  vertIndex.y = 1. - vertIndex.y;\n#endif\n  return (aniUV.xy + vertIndex) / vec2(frameTile.x, frameTile.y);\n}\nlayout(std140) uniform SampleConstants {\n  vec4 u_sampleInfo;\n};\nlayout(std140) uniform TickConstants {\n  vec4 u_worldRot;\n  vec4 u_timeDelta;\n};\nin vec4 a_position_starttime;\nin vec4 a_size_uv;\nin vec4 a_rotation_uv;\nin vec4 a_color;\nin vec4 a_dir_life;\nin float a_rndSeed;\n#if CC_RENDER_MODE == 4\n  in vec3 a_texCoord;\n  in vec3 a_texCoord3;\n  in vec3 a_normal;\n  in vec4 a_color1;\n#endif\nvec3 unpackCurveData (sampler2D tex, vec2 coord) {\n    vec4 a = texture(tex, coord);\n    vec4 b = texture(tex, coord + u_sampleInfo.y);\n    float c = fract(coord.x * u_sampleInfo.x);\n    return mix(a.xyz, b.xyz, c);\n}\nvec3 unpackCurveData (sampler2D tex, vec2 coord, out float w) {\n    vec4 a = texture(tex, coord);\n    vec4 b = texture(tex, coord + u_sampleInfo.y);\n    float c = fract(coord.x * u_sampleInfo.x);\n    w = mix(a.w, b.w, c);\n    return mix(a.xyz, b.xyz, c);\n}\nfloat pseudoRandom (float seed) {\n  seed = mod(seed, 233280.);\n  float q = (seed * 9301. + 49297.) / 233280.;\n  return fract(q);\n}\n#if COLOR_OVER_TIME_MODULE_ENABLE\n  uniform sampler2D color_over_time_tex0;\n  layout(std140) uniform ColorConstant {\n    int u_color_mode;\n  };\n#endif\n#if ROTATION_OVER_TIME_MODULE_ENABLE\n  uniform sampler2D rotation_over_time_tex0;\n  layout(std140) uniform RotationConstant {\n    int u_rotation_mode;\n  };\n#endif\n#if SIZE_OVER_TIME_MODULE_ENABLE\n  uniform sampler2D size_over_time_tex0;\n  layout(std140) uniform SizeConstant {\n    int u_size_mode;\n  };\n#endif\n#if FORCE_OVER_TIME_MODULE_ENABLE\n  uniform sampler2D force_over_time_tex0;\n  layout(std140) uniform ForceConstant {\n    int u_force_mode;\n    int u_force_space;\n  };\n#endif\n#if VELOCITY_OVER_TIME_MODULE_ENABLE\n  uniform sampler2D velocity_over_time_tex0;\n  layout(std140) uniform VelocityConstant {\n    int u_velocity_mode;\n    int u_velocity_space;\n  };\n#endif\n#if TEXTURE_ANIMATION_MODULE_ENABLE\n  uniform sampler2D texture_animation_tex0;\n  layout(std140) uniform AnimationConstant {\n    vec4 u_anim_info;\n  };\n#endif\nfloat repeat (float t, float length) {\n  return t - floor(t / length) * length;\n}\nvec4 rotateQuat (vec4 p, vec4 q) {\n  vec3 iv = cross(q.xyz, p.xyz) + q.w * p.xyz;\n  vec3 res = p.xyz + 2.0 * cross(q.xyz, iv);\n  return vec4(res.xyz, p.w);\n}\nvec4 gpvs_main () {\n  float activeTime = u_timeDelta.x - a_position_starttime.w;\n  float normalizedTime = clamp(activeTime / a_dir_life.w, 0.0, 1.0);\n  vec2 timeCoord0 = vec2(normalizedTime, 0.);\n  vec2 timeCoord1 = vec2(normalizedTime, 1.);\n  #if CC_RENDER_MODE == 4\n    vec2 vertIdx = vec2(a_texCoord.x, a_texCoord.y);\n  #else\n    vec2 vertIdx = vec2(a_size_uv.w, a_rotation_uv.w);\n  #endif\n  vec4 velocity = vec4(a_dir_life.xyz, 0.);\n  vec4 pos = vec4(a_position_starttime.xyz, 1.);\n  vec3 size = a_size_uv.xyz;\n  #if SIZE_OVER_TIME_MODULE_ENABLE\n    if (u_size_mode == 1) {\n      size *= unpackCurveData(size_over_time_tex0, timeCoord0);\n    } else {\n      vec3 size_0 = unpackCurveData(size_over_time_tex0, timeCoord0);\n      vec3 size_1 = unpackCurveData(size_over_time_tex0, timeCoord1);\n      float factor_s = pseudoRandom(a_rndSeed + 39825.);\n      size *= mix(size_0, size_1, factor_s);\n    }\n  #endif\n  vec3 compScale = scale.xyz * size;\n  #if FORCE_OVER_TIME_MODULE_ENABLE\n    vec3 forceAnim = vec3(0.);\n    if (u_force_mode == 1) {\n      forceAnim = unpackCurveData(force_over_time_tex0, timeCoord0);\n    } else {\n      vec3 force_0 = unpackCurveData(force_over_time_tex0, timeCoord0);\n      vec3 force_1 = unpackCurveData(force_over_time_tex0, timeCoord1);\n      float factor_f =  pseudoRandom(a_rndSeed + 212165.);\n      forceAnim = mix(force_0, force_1, factor_f);\n    }\n    vec4 forceTrack = vec4(forceAnim, 0.);\n    if (u_force_space == 0) {\n      forceTrack = rotateQuat(forceTrack, u_worldRot);\n    }\n    velocity.xyz += forceTrack.xyz;\n  #endif\n  #if VELOCITY_OVER_TIME_MODULE_ENABLE\n    float speedModifier0 = 1.;\n    float speedModifier1 = 1.;\n    vec3 velocityAnim = vec3(0.);\n    if (u_velocity_mode == 1) {\n      velocityAnim = unpackCurveData(velocity_over_time_tex0, timeCoord0, speedModifier0);\n    } else {\n      vec3 vectory_0 = unpackCurveData(velocity_over_time_tex0, timeCoord0, speedModifier0);\n      vec3 vectory_1 = unpackCurveData(velocity_over_time_tex0, timeCoord1, speedModifier1);\n      float factor_v = pseudoRandom(a_rndSeed + 197866.);\n      velocityAnim = mix(vectory_0, vectory_1, factor_v);\n      speedModifier0 = mix(speedModifier0, speedModifier1, factor_v);\n    }\n    vec4 velocityTrack = vec4(velocityAnim, 0.);\n    if (u_velocity_space == 0) {\n      velocityTrack = rotateQuat(velocityTrack, u_worldRot);\n    }\n    velocity.xyz += velocityTrack.xyz;\n    velocity.xyz *= speedModifier0;\n  #endif\n  pos.xyz += velocity.xyz * normalizedTime * a_dir_life.w;\n  #if !CC_USE_WORLD_SPACE\n    pos = cc_matWorld * pos;\n    #if CC_RENDER_MODE == 1\n      velocity = rotateQuat(velocity, u_worldRot);\n    #endif\n  #endif\n  vec3 rotation = a_rotation_uv.xyz;\n  #if ROTATION_OVER_TIME_MODULE_ENABLE\n    if (u_rotation_mode == 1) {\n      rotation += unpackCurveData(rotation_over_time_tex0, timeCoord0) * normalizedTime * a_dir_life.w;\n    } else {\n      vec3 rotation_0 = unpackCurveData(rotation_over_time_tex0, timeCoord0);\n      vec3 rotation_1 = unpackCurveData(rotation_over_time_tex0, timeCoord1);\n      float factor_r = pseudoRandom(a_rndSeed + 125292.);\n      rotation += mix(rotation_0, rotation_1, factor_r) * normalizedTime * a_dir_life.w;\n    }\n  #endif\n  #if COLOR_OVER_TIME_MODULE_ENABLE\n    if (u_color_mode == 1) {\n      color = a_color * texture(color_over_time_tex0, timeCoord0);\n    } else {\n      vec4 color_0 = texture(color_over_time_tex0, timeCoord0);\n      vec4 color_1 = texture(color_over_time_tex0, timeCoord1);\n      float factor_c = pseudoRandom(a_rndSeed + 91041.);\n      color = a_color * mix(color_0, color_1, factor_c);\n    }\n  #else\n    color = a_color;\n  #endif\n  #if CC_RENDER_MODE != 4\n    vec2 cornerOffset = vec2((vertIdx - 0.5));\n    #if CC_RENDER_MODE == 0\n      vec3 rotEuler = rotation.xyz;\n    #elif CC_RENDER_MODE == 1\n      vec3 rotEuler = vec3(0.);\n    #else\n      vec3 rotEuler = vec3(0., 0., rotation.z);\n    #endif\n    computeVertPos(pos, cornerOffset, quaternionFromEuler(rotEuler), compScale\n      #if CC_RENDER_MODE == 0 || CC_RENDER_MODE == 3\n        , cc_matViewInv\n      #endif\n      #if CC_RENDER_MODE == 1\n        , cc_cameraPos.xyz\n        , velocity\n        , frameTile_velLenScale.z\n        , frameTile_velLenScale.w\n        , a_size_uv.w\n      #endif\n    );\n  #else\n    mat4 xformNoScale = matrixFromRT(quaternionFromEuler(rotation), pos.xyz);\n    mat4 xform = matFromRTS(quaternionFromEuler(rotation), pos.xyz, compScale);\n    pos = xform * vec4(a_texCoord3, 1);\n    vec4 normal = xformNoScale * vec4(a_normal, 0);\n    color *= a_color1;\n  #endif\n  pos = cc_matViewProj * pos;\n  float frameIndex = 0.;\n  #if TEXTURE_ANIMATION_MODULE_ENABLE\n    float startFrame = 0.;\n    vec3 frameInfo = vec3(0.);\n    if (int(u_anim_info.x) == 1) {\n      frameInfo = unpackCurveData(texture_animation_tex0, timeCoord0);\n    } else {\n      vec3 frameInfo0 = unpackCurveData(texture_animation_tex0, timeCoord0);\n      vec3 frameInfo1 = unpackCurveData(texture_animation_tex0, timeCoord1);\n      float factor_t = pseudoRandom(a_rndSeed + 90794.);\n      frameInfo = mix(frameInfo0, frameInfo1, factor_t);\n    }\n    startFrame = frameInfo.x / u_anim_info.y;\n    frameIndex = repeat(u_anim_info.z * (frameInfo.y + startFrame), 1.);\n  #endif\n  uv = computeUV(frameIndex, vertIdx, frameTile_velLenScale.xy) * mainTiling_Offset.xy + mainTiling_Offset.zw;\n  return pos;\n}\nvoid main() { gl_Position = gpvs_main(); }",frag:"\nprecision mediump float;\nlayout(std140) uniform CCGlobal {\n  highp   vec4 cc_time;\n  mediump vec4 cc_screenSize;\n  mediump vec4 cc_nativeSize;\n};\nlayout(std140) uniform CCCamera {\n  highp   mat4 cc_matView;\n  highp   mat4 cc_matViewInv;\n  highp   mat4 cc_matProj;\n  highp   mat4 cc_matProjInv;\n  highp   mat4 cc_matViewProj;\n  highp   mat4 cc_matViewProjInv;\n  highp   vec4 cc_cameraPos;\n  mediump vec4 cc_screenScale;\n  mediump vec4 cc_exposure;\n  mediump vec4 cc_mainLitDir;\n  mediump vec4 cc_mainLitColor;\n  mediump vec4 cc_ambientSky;\n  mediump vec4 cc_ambientGround;\n  mediump vec4 cc_fogColor;\n  mediump vec4 cc_fogBase;\n  mediump vec4 cc_fogAdd;\n};\nvec3 SRGBToLinear (vec3 gamma) {\n  return gamma * gamma;\n}\nvec4 CCFragOutput (vec4 color) {\n  #if CC_USE_HDR\n    color.rgb = mix(color.rgb, SRGBToLinear(color.rgb) * cc_exposure.w, vec3(cc_exposure.z));\n  #endif\n  return color;\n}\nin vec2 uv;\nin vec4 color;\nuniform sampler2D mainTexture;\nlayout(std140) uniform FragConstants {\n  vec4 tintColor;\n};\nvec4 add () {\n  vec4 col = 2.0 * color * tintColor * texture(mainTexture, uv);\n  return CCFragOutput(col);\n}\nlayout(location = 0) out vec4 cc_FragColor;\nvoid main() { cc_FragColor = add(); }"}],[{vert:"\nprecision mediump float;\nlayout(std140) uniform Constants {\n  vec4 mainTiling_Offset;\n  vec4 frameTile_velLenScale;\n  vec4 scale;\n};\nlayout(std140) uniform CCGlobal {\n  highp   vec4 cc_time;\n  mediump vec4 cc_screenSize;\n  mediump vec4 cc_nativeSize;\n};\nlayout(std140) uniform CCCamera {\n  highp   mat4 cc_matView;\n  highp   mat4 cc_matViewInv;\n  highp   mat4 cc_matProj;\n  highp   mat4 cc_matProjInv;\n  highp   mat4 cc_matViewProj;\n  highp   mat4 cc_matViewProjInv;\n  highp   vec4 cc_cameraPos;\n  mediump vec4 cc_screenScale;\n  mediump vec4 cc_exposure;\n  mediump vec4 cc_mainLitDir;\n  mediump vec4 cc_mainLitColor;\n  mediump vec4 cc_ambientSky;\n  mediump vec4 cc_ambientGround;\n  mediump vec4 cc_fogColor;\n  mediump vec4 cc_fogBase;\n  mediump vec4 cc_fogAdd;\n};\nlayout(std140) uniform CCLocal {\n  highp mat4 cc_matWorld;\n  highp mat4 cc_matWorldIT;\n  highp vec4 cc_lightingMapUVParam;\n};\nout mediump vec2 uv;\nout mediump vec4 color;\nin vec3 a_position;\nin vec4 a_texCoord;\nin vec3 a_texCoord1;\nin vec3 a_texCoord2;\nin vec4 a_color;\n#if CC_DRAW_WIRE_FRAME\n  out vec3 vBarycentric;\n#endif\nvec4 vs_main() {\n  highp vec4 pos = vec4(a_position, 1);\n  vec4 velocity = vec4(a_texCoord1.xyz, 0);\n  #if !CC_USE_WORLD_SPACE\n    pos = cc_matWorld * pos;\n    velocity = cc_matWorld * velocity;\n  #endif\n  float vertOffset = (a_texCoord.x - 0.5) * a_texCoord.y;\n  vec3 camUp = normalize(cross(pos.xyz - cc_cameraPos.xyz, velocity.xyz));\n  pos.xyz += camUp * vertOffset;\n  pos = cc_matViewProj * pos;\n  uv = a_texCoord.zw * mainTiling_Offset.xy + mainTiling_Offset.zw;;\n  color = a_color;\n  #if CC_DRAW_WIRE_FRAME\n    vBarycentric = a_texCoord2;\n  #endif\n  return pos;\n}\nvoid main() { gl_Position = vs_main(); }",frag:"\n  precision mediump float;\nlayout(std140) uniform CCGlobal {\n  highp   vec4 cc_time;\n  mediump vec4 cc_screenSize;\n  mediump vec4 cc_nativeSize;\n};\nlayout(std140) uniform CCCamera {\n  highp   mat4 cc_matView;\n  highp   mat4 cc_matViewInv;\n  highp   mat4 cc_matProj;\n  highp   mat4 cc_matProjInv;\n  highp   mat4 cc_matViewProj;\n  highp   mat4 cc_matViewProjInv;\n  highp   vec4 cc_cameraPos;\n  mediump vec4 cc_screenScale;\n  mediump vec4 cc_exposure;\n  mediump vec4 cc_mainLitDir;\n  mediump vec4 cc_mainLitColor;\n  mediump vec4 cc_ambientSky;\n  mediump vec4 cc_ambientGround;\n  mediump vec4 cc_fogColor;\n  mediump vec4 cc_fogBase;\n  mediump vec4 cc_fogAdd;\n};\nvec3 SRGBToLinear (vec3 gamma) {\n  return gamma * gamma;\n}\nvec4 CCFragOutput (vec4 color) {\n  #if CC_USE_HDR\n    color.rgb = mix(color.rgb, SRGBToLinear(color.rgb) * cc_exposure.w, vec3(cc_exposure.z));\n  #endif\n  return color;\n}\n  in vec2 uv;\n  in vec4 color;\n  #if CC_DRAW_WIRE_FRAME\n    in vec3 vBarycentric;\n  #endif\n  uniform sampler2D mainTexture;\n  layout(std140) uniform FragConstants {\n    vec4 tintColor;\n  };\n  vec4 add () {\n    vec4 col = 2.0 * color * tintColor * texture(mainTexture, uv);\n#if CC_DRAW_WIRE_FRAME\n    if (any(lessThan(vBarycentric, vec3(0.02)))) {\n        col = vec4(0., 1., 1., 1.);\n    }\n#endif\n    return CCFragOutput(col);\n  }\nlayout(location = 0) out vec4 cc_FragColor;\nvoid main() { cc_FragColor = add(); }"}],[{vert:"\nprecision highp float;\nvec4 quaternionFromAxis (vec3 xAxis,vec3 yAxis,vec3 zAxis){\n  mat3 m = mat3(xAxis,yAxis,zAxis);\n  float trace = m[0][0] + m[1][1] + m[2][2];\n  vec4 quat;\n  if (trace > 0.) {\n    float s = 0.5 / sqrt(trace + 1.0);\n    quat.w = 0.25 / s;\n    quat.x = (m[2][1] - m[1][2]) * s;\n    quat.y = (m[0][2] - m[2][0]) * s;\n    quat.z = (m[1][0] - m[0][1]) * s;\n  } else if ((m[0][0] > m[1][1]) && (m[0][0] > m[2][2])) {\n    float s = 2.0 * sqrt(1.0 + m[0][0] - m[1][1] - m[2][2]);\n    quat.w = (m[2][1] - m[1][2]) / s;\n    quat.x = 0.25 * s;\n    quat.y = (m[0][1] + m[1][0]) / s;\n    quat.z = (m[0][2] + m[2][0]) / s;\n  } else if (m[1][1] > m[2][2]) {\n    float s = 2.0 * sqrt(1.0 + m[1][1] - m[0][0] - m[2][2]);\n    quat.w = (m[0][2] - m[2][0]) / s;\n    quat.x = (m[0][1] + m[1][0]) / s;\n    quat.y = 0.25 * s;\n    quat.z = (m[1][2] + m[2][1]) / s;\n  } else {\n    float s = 2.0 * sqrt(1.0 + m[2][2] - m[0][0] - m[1][1]);\n    quat.w = (m[1][0] - m[0][1]) / s;\n    quat.x = (m[0][2] + m[2][0]) / s;\n    quat.y = (m[1][2] + m[2][1]) / s;\n    quat.z = 0.25 * s;\n  }\n  float len = quat.x * quat.x + quat.y * quat.y + quat.z * quat.z + quat.w * quat.w;\n  if (len > 0.) {\n    len = 1. / sqrt(len);\n    quat.x = quat.x * len;\n    quat.y = quat.y * len;\n    quat.z = quat.z * len;\n    quat.w = quat.w * len;\n  }\n  return quat;\n}\nvec4 quaternionFromEuler (vec3 angle){\n  float x = angle.x / 2.;\n  float y = angle.y / 2.;\n  float z = angle.z / 2.;\n  float sx = sin(x);\n  float cx = cos(x);\n  float sy = sin(y);\n  float cy = cos(y);\n  float sz = sin(z);\n  float cz = cos(z);\n  vec4 quat = vec4(0);\n  quat.x = sx * cy * cz + cx * sy * sz;\n  quat.y = cx * sy * cz + sx * cy * sz;\n  quat.z = cx * cy * sz - sx * sy * cz;\n  quat.w = cx * cy * cz - sx * sy * sz;\n  return quat;\n}\nmat4 matrixFromRT (vec4 q, vec3 p){\n  float x2 = q.x + q.x;\n  float y2 = q.y + q.y;\n  float z2 = q.z + q.z;\n  float xx = q.x * x2;\n  float xy = q.x * y2;\n  float xz = q.x * z2;\n  float yy = q.y * y2;\n  float yz = q.y * z2;\n  float zz = q.z * z2;\n  float wx = q.w * x2;\n  float wy = q.w * y2;\n  float wz = q.w * z2;\n  return mat4(\n    1. - (yy + zz), xy + wz, xz - wy, 0,\n    xy - wz, 1. - (xx + zz), yz + wx, 0,\n    xz + wy, yz - wx, 1. - (xx + yy), 0,\n    p.x, p.y, p.z, 1\n  );\n}\nmat4 matFromRTS (vec4 q, vec3 t, vec3 s){\n  float x = q.x, y = q.y, z = q.z, w = q.w;\n  float x2 = x + x;\n  float y2 = y + y;\n  float z2 = z + z;\n  float xx = x * x2;\n  float xy = x * y2;\n  float xz = x * z2;\n  float yy = y * y2;\n  float yz = y * z2;\n  float zz = z * z2;\n  float wx = w * x2;\n  float wy = w * y2;\n  float wz = w * z2;\n  float sx = s.x;\n  float sy = s.y;\n  float sz = s.z;\n  return mat4((1. - (yy + zz)) * sx, (xy + wz) * sx, (xz - wy) * sx, 0,\n    (xy - wz) * sy, (1. - (xx + zz)) * sy, (yz + wx) * sy, 0,\n    (xz + wy) * sz, (yz - wx) * sz, (1. - (xx + yy)) * sz, 0,\n    t.x, t.y, t.z, 1);\n}\nvec4 quatMultiply (vec4 a, vec4 b){\n  vec4 quat;\n  quat.x = a.x * b.w + a.w * b.x + a.y * b.z - a.z * b.y;\n  quat.y = a.y * b.w + a.w * b.y + a.z * b.x - a.x * b.z;\n  quat.z = a.z * b.w + a.w * b.z + a.x * b.y - a.y * b.x;\n  quat.w = a.w * b.w - a.x * b.x - a.y * b.y - a.z * b.z;\n  return quat;\n}\nvoid rotateVecFromQuat (inout vec3 v, vec4 q){\n  float ix = q.w * v.x + q.y * v.z - q.z * v.y;\n  float iy = q.w * v.y + q.z * v.x - q.x * v.z;\n  float iz = q.w * v.z + q.x * v.y - q.y * v.x;\n  float iw = -q.x * v.x - q.y * v.y - q.z * v.z;\n  v.x = ix * q.w + iw * -q.x + iy * -q.z - iz * -q.y;\n  v.y = iy * q.w + iw * -q.y + iz * -q.x - ix * -q.z;\n  v.z = iz * q.w + iw * -q.z + ix * -q.y - iy * -q.x;\n}\nvec3 rotateInLocalSpace (vec3 pos, vec3 xAxis, vec3 yAxis, vec3 zAxis, vec4 q){\n  vec4 viewQuat = quaternionFromAxis(xAxis, yAxis, zAxis);\n  vec4 rotQuat = quatMultiply(viewQuat, q);\n  rotateVecFromQuat(pos, rotQuat);\n  return pos;\n}\nvoid rotateCorner (inout vec2 corner, float angle){\n  float xOS = cos(angle) * corner.x - sin(angle) * corner.y;\n  float yOS = sin(angle) * corner.x + cos(angle) * corner.y;\n  corner.x = xOS;\n  corner.y = yOS;\n}\nlayout(std140) uniform Constants {\n  vec4 mainTiling_Offset;\n  vec4 frameTile_velLenScale;\n  vec4 scale;\n};\nlayout(std140) uniform CCGlobal {\n  highp   vec4 cc_time;\n  mediump vec4 cc_screenSize;\n  mediump vec4 cc_nativeSize;\n};\nlayout(std140) uniform CCCamera {\n  highp   mat4 cc_matView;\n  highp   mat4 cc_matViewInv;\n  highp   mat4 cc_matProj;\n  highp   mat4 cc_matProjInv;\n  highp   mat4 cc_matViewProj;\n  highp   mat4 cc_matViewProjInv;\n  highp   vec4 cc_cameraPos;\n  mediump vec4 cc_screenScale;\n  mediump vec4 cc_exposure;\n  mediump vec4 cc_mainLitDir;\n  mediump vec4 cc_mainLitColor;\n  mediump vec4 cc_ambientSky;\n  mediump vec4 cc_ambientGround;\n  mediump vec4 cc_fogColor;\n  mediump vec4 cc_fogBase;\n  mediump vec4 cc_fogAdd;\n};\nlayout(std140) uniform CCLocal {\n  highp mat4 cc_matWorld;\n  highp mat4 cc_matWorldIT;\n  highp vec4 cc_lightingMapUVParam;\n};\nout mediump vec2 uv;\nout mediump vec4 color;\nvoid computeVertPos (inout vec4 pos, vec2 vertOffset, vec4 q, vec3 s\n#if CC_RENDER_MODE == 0 || CC_RENDER_MODE == 3\n  , mat4 viewInv\n#endif\n#if CC_RENDER_MODE == 1\n  , vec3 eye\n  , vec4 velocity\n  , float velocityScale\n  , float lengthScale\n  , float xIndex\n#endif\n) {\n#if CC_RENDER_MODE == 0\n  vec3 viewSpaceVert = vec3(vertOffset.x * s.x, vertOffset.y * s.y, 0.);\n  vec3 camX = normalize(vec3(viewInv[0][0], viewInv[1][0], viewInv[2][0]));\n  vec3 camY = normalize(vec3(viewInv[0][1], viewInv[1][1], viewInv[2][1]));\n  vec3 camZ = normalize(vec3(viewInv[0][2], viewInv[1][2], viewInv[2][2]));\n  pos.xyz += rotateInLocalSpace(viewSpaceVert, camX, camY, camZ, q);\n#elif CC_RENDER_MODE == 1\n  vec3 camRight = normalize(cross(pos.xyz - eye, velocity.xyz)) * s.x;\n  vec3 camUp = velocity.xyz * velocityScale + normalize(velocity.xyz) * lengthScale * s.y;\n  pos.xyz += (camRight * abs(vertOffset.x) * sign(vertOffset.y)) - camUp * xIndex;\n#elif CC_RENDER_MODE == 2\n  vec3 viewSpaceVert = vec3(vertOffset.x * s.x, vertOffset.y * s.y, 0.);\n  vec3 camX = vec3(1, 0, 0);\n  vec3 camY = vec3(0, 0, -1);\n  pos.xyz += rotateInLocalSpace(viewSpaceVert, camX, camY, cross(camX, camY), q);\n#elif CC_RENDER_MODE == 3\n  vec2 viewSpaceVert = vec2(vertOffset.x * s.x, vertOffset.y * s.y);\n  rotateCorner(viewSpaceVert, q.z);\n  vec3 camX = normalize(vec3(cc_matView[0][0], cc_matView[1][0], cc_matView[2][0]));\n  vec3 camY = vec3(0, 1, 0);\n  vec3 offset = camX * viewSpaceVert.x + camY * viewSpaceVert.y;\n  pos.xyz += offset;\n#else\n  pos.x += vertOffset.x;\n  pos.y += vertOffset.y;\n#endif\n}\nvec2 computeUV (float frameIndex, vec2 vertIndex, vec2 frameTile){\n  vec2 aniUV = vec2(0, floor(frameIndex * frameTile.y));\n  aniUV.x = floor(frameIndex * frameTile.x * frameTile.y - aniUV.y * frameTile.x);\n#if CC_RENDER_MODE != 4\n  vertIndex.y = 1. - vertIndex.y;\n#endif\n  return (aniUV.xy + vertIndex) / vec2(frameTile.x, frameTile.y);\n}\nin vec3 a_position;\nin vec3 a_texCoord;\nin vec3 a_texCoord1;\nin vec3 a_texCoord2;\nin vec4 a_color;\n#if CC_RENDER_MODE == 1\n  in vec3 a_color1;\n#endif\n#if CC_RENDER_MODE == 4\n  in vec3 a_texCoord3;\n  in vec3 a_normal;\n  in vec4 a_color1;\n#endif\nvec4 lpvs_main () {\n  vec3 compScale = scale.xyz * a_texCoord1;\n  vec4 pos = vec4(a_position, 1);\n  #if CC_RENDER_MODE == 1\n    vec4 velocity = vec4(a_color1.xyz, 0);\n  #endif\n  #if !CC_USE_WORLD_SPACE\n    pos = cc_matWorld * pos;\n    #if CC_RENDER_MODE == 1\n      velocity = cc_matWorld * velocity;\n    #endif\n  #endif\n  #if CC_RENDER_MODE != 4\n    vec2 cornerOffset = vec2((a_texCoord.xy - 0.5));\n    #if CC_RENDER_MODE == 0\n      vec3 rotEuler = a_texCoord2;\n    #elif CC_RENDER_MODE == 1\n      vec3 rotEuler = vec3(0.);\n    #else\n      vec3 rotEuler = vec3(0., 0., a_texCoord2.z);\n    #endif\n    computeVertPos(pos, cornerOffset, quaternionFromEuler(rotEuler), compScale\n    #if CC_RENDER_MODE == 0 || CC_RENDER_MODE == 3\n      , cc_matViewInv\n    #endif\n    #if CC_RENDER_MODE == 1\n      , cc_cameraPos.xyz\n      , velocity\n      , frameTile_velLenScale.z\n      , frameTile_velLenScale.w\n      , a_texCoord.x\n    #endif\n    );\n    color = a_color;\n  #else\n    mat4 xformNoScale = matrixFromRT(quaternionFromEuler(a_texCoord2), pos.xyz);\n    mat4 xform = matFromRTS(quaternionFromEuler(a_texCoord2), pos.xyz, compScale);\n    pos = xform * vec4(a_texCoord3, 1);\n    vec4 normal = xformNoScale * vec4(a_normal, 0);\n    color = a_color * a_color1;\n  #endif\n  uv = computeUV(a_texCoord.z, a_texCoord.xy, frameTile_velLenScale.xy) * mainTiling_Offset.xy + mainTiling_Offset.zw;\n  pos = cc_matViewProj * pos;\n  return pos;\n}\nvoid main() { gl_Position = lpvs_main(); }",frag:"\nprecision mediump float;\nlayout(std140) uniform CCGlobal {\n  highp   vec4 cc_time;\n  mediump vec4 cc_screenSize;\n  mediump vec4 cc_nativeSize;\n};\nlayout(std140) uniform CCCamera {\n  highp   mat4 cc_matView;\n  highp   mat4 cc_matViewInv;\n  highp   mat4 cc_matProj;\n  highp   mat4 cc_matProjInv;\n  highp   mat4 cc_matViewProj;\n  highp   mat4 cc_matViewProjInv;\n  highp   vec4 cc_cameraPos;\n  mediump vec4 cc_screenScale;\n  mediump vec4 cc_exposure;\n  mediump vec4 cc_mainLitDir;\n  mediump vec4 cc_mainLitColor;\n  mediump vec4 cc_ambientSky;\n  mediump vec4 cc_ambientGround;\n  mediump vec4 cc_fogColor;\n  mediump vec4 cc_fogBase;\n  mediump vec4 cc_fogAdd;\n};\nvec3 SRGBToLinear (vec3 gamma) {\n  return gamma * gamma;\n}\nvec4 CCFragOutput (vec4 color) {\n  #if CC_USE_HDR\n    color.rgb = mix(color.rgb, SRGBToLinear(color.rgb) * cc_exposure.w, vec3(cc_exposure.z));\n  #endif\n  return color;\n}\nin vec2 uv;\nin vec4 color;\nuniform sampler2D mainTexture;\nlayout(std140) uniform FragConstants {\n  vec4 tintColor;\n};\nvec4 add () {\n  vec4 col = 2.0 * color * tintColor * texture(mainTexture, uv);\n  return CCFragOutput(col);\n}\nlayout(location = 0) out vec4 cc_FragColor;\nvoid main() { cc_FragColor = add(); }"}],[{vert:"\nprecision highp float;\nlayout(std140) uniform CCGlobal {\n  highp   vec4 cc_time;\n  mediump vec4 cc_screenSize;\n  mediump vec4 cc_nativeSize;\n};\nlayout(std140) uniform CCCamera {\n  highp   mat4 cc_matView;\n  highp   mat4 cc_matViewInv;\n  highp   mat4 cc_matProj;\n  highp   mat4 cc_matProjInv;\n  highp   mat4 cc_matViewProj;\n  highp   mat4 cc_matViewProjInv;\n  highp   vec4 cc_cameraPos;\n  mediump vec4 cc_screenScale;\n  mediump vec4 cc_exposure;\n  mediump vec4 cc_mainLitDir;\n  mediump vec4 cc_mainLitColor;\n  mediump vec4 cc_ambientSky;\n  mediump vec4 cc_ambientGround;\n  mediump vec4 cc_fogColor;\n  mediump vec4 cc_fogBase;\n  mediump vec4 cc_fogAdd;\n};\n#if USE_LOCAL\nlayout(std140) uniform CCLocal {\n  highp mat4 cc_matWorld;\n  highp mat4 cc_matWorldIT;\n  highp vec4 cc_lightingMapUVParam;\n};\n#endif\nin vec3 a_position;\nin vec2 a_texCoord;\nin vec4 a_color;\nout vec4 v_light;\nout vec2 uv0;\n#if TWO_COLORED\n  in vec4 a_color2;\n  out vec4 v_dark;\n#endif\nvec4 vert () {\n  vec4 pos = vec4(a_position, 1);\n  #if USE_LOCAL\n    pos = cc_matWorld * pos;\n  #endif\n  pos = cc_matViewProj * pos;\n  uv0 = a_texCoord;\n  v_light = a_color;\n  #if TWO_COLORED\n    v_dark = a_color2;\n  #endif\n  return pos;\n}\nvoid main() { gl_Position = vert(); }",frag:"\nprecision highp float;\n#if USE_ALPHA_TEST\n  layout(std140) uniform ALPHA_TEST_DATA {\n    float alphaThreshold;\n  };\n#endif\nvoid ALPHA_TEST (in vec4 color) {\n  #if USE_ALPHA_TEST\n      if (color.a < alphaThreshold) discard;\n  #endif\n}\nvoid ALPHA_TEST (in float alpha) {\n  #if USE_ALPHA_TEST\n      if (alpha < alphaThreshold) discard;\n  #endif\n}\nin vec4 v_light;\n#if TWO_COLORED\n  in vec4 v_dark;\n#endif\nin vec2 uv0;\nuniform sampler2D cc_spriteTexture;\nvec4 frag () {\n  vec4 o = vec4(1, 1, 1, 1);\n  #if TWO_COLORED\n    vec4 texColor = vec4(1, 1, 1, 1);\n    texColor *= texture(cc_spriteTexture, uv0);\n     o.a = texColor.a * v_light.a;\n    o.rgb = ((texColor.a - 1.0) * v_dark.a + 1.0 - texColor.rgb) * v_dark.rgb + texColor.rgb * v_light.rgb;\n  #else\n    o *= texture(cc_spriteTexture, uv0);\n    o *= v_light;\n  #endif\n  ALPHA_TEST(o);\n  return o;\n}\nlayout(location = 0) out vec4 cc_FragColor;\nvoid main() { cc_FragColor = frag(); }"}],[{vert:"\nprecision highp float;\nlayout(std140) uniform CCGlobal {\n  highp   vec4 cc_time;\n  mediump vec4 cc_screenSize;\n  mediump vec4 cc_nativeSize;\n};\nlayout(std140) uniform CCCamera {\n  highp   mat4 cc_matView;\n  highp   mat4 cc_matViewInv;\n  highp   mat4 cc_matProj;\n  highp   mat4 cc_matProjInv;\n  highp   mat4 cc_matViewProj;\n  highp   mat4 cc_matViewProjInv;\n  highp   vec4 cc_cameraPos;\n  mediump vec4 cc_screenScale;\n  mediump vec4 cc_exposure;\n  mediump vec4 cc_mainLitDir;\n  mediump vec4 cc_mainLitColor;\n  mediump vec4 cc_ambientSky;\n  mediump vec4 cc_ambientGround;\n  mediump vec4 cc_fogColor;\n  mediump vec4 cc_fogBase;\n  mediump vec4 cc_fogAdd;\n};\n#if USE_LOCAL\nlayout(std140) uniform CCLocal {\n  highp mat4 cc_matWorld;\n  highp mat4 cc_matWorldIT;\n  highp vec4 cc_lightingMapUVParam;\n};\n#endif\nin vec3 a_position;\nin vec2 a_texCoord;\nin vec4 a_color;\nout vec4 color;\nout vec2 uv0;\nvec4 vert () {\n  vec4 pos = vec4(a_position, 1);\n  #if USE_LOCAL\n    pos = cc_matWorld * pos;\n  #endif\n  #if USE_PIXEL_ALIGNMENT\n    pos = cc_matView * pos;\n    pos.xyz = floor(pos.xyz);\n    pos = cc_matProj * pos;\n  #else\n    pos = cc_matViewProj * pos;\n  #endif\n  uv0 = a_texCoord;\n  color = a_color;\n  return pos;\n}\nvoid main() { gl_Position = vert(); }",frag:"\nprecision highp float;\nvec4 CCSampleWithAlphaSeparated(sampler2D tex, vec2 uv) {\n#if CC_USE_EMBEDDED_ALPHA\n    return vec4(texture(tex, uv).rgb, texture(tex, uv + vec2(0.0, 0.5)).r);\n#else\n    return texture(tex, uv);\n#endif\n}\n#if USE_ALPHA_TEST\n  layout(std140) uniform ALPHA_TEST_DATA {\n    float alphaThreshold;\n  };\n#endif\nvoid ALPHA_TEST (in vec4 color) {\n  #if USE_ALPHA_TEST\n      if (color.a < alphaThreshold) discard;\n  #endif\n}\nvoid ALPHA_TEST (in float alpha) {\n  #if USE_ALPHA_TEST\n      if (alpha < alphaThreshold) discard;\n  #endif\n}\nin vec4 color;\n#if USE_TEXTURE\n  in vec2 uv0;\n  uniform sampler2D cc_spriteTexture;\n#endif\nvec4 frag () {\n  vec4 o = vec4(1, 1, 1, 1);\n  #if USE_TEXTURE\n    o *= CCSampleWithAlphaSeparated(cc_spriteTexture, uv0);\n    #if IS_GRAY\n      float gray  = 0.2126 * o.r + 0.7152 * o.g + 0.0722 * o.b;\n      o.r = o.g = o.b = gray;\n    #endif\n  #endif\n  o *= color;\n  ALPHA_TEST(o);\n  return o;\n}\nlayout(location = 0) out vec4 cc_FragColor;\nvoid main() { cc_FragColor = frag(); }"}],[{vert:"\nprecision highp float;\nhighp float decode32 (highp vec4 rgba) {\n  rgba = rgba * 255.0;\n  highp float Sign = 1.0 - (step(128.0, (rgba[3]) + 0.5)) * 2.0;\n  highp float Exponent = 2.0 * (mod(float(int((rgba[3]) + 0.5)), 128.0)) + (step(128.0, (rgba[2]) + 0.5)) - 127.0;\n  highp float Mantissa = (mod(float(int((rgba[2]) + 0.5)), 128.0)) * 65536.0 + rgba[1] * 256.0 + rgba[0] + 8388608.0;\n  return Sign * exp2(Exponent - 23.0) * Mantissa;\n}\nstruct StandardVertInput {\n  highp vec4 position;\n  vec3 normal;\n  vec4 tangent;\n};\nin vec3 a_position;\nin vec3 a_normal;\nin vec2 a_texCoord;\nin vec4 a_tangent;\n#if CC_USE_MORPH\n    in float a_vertexId;\n    int getVertexId() {\n        return int(a_vertexId);\n    }\nlayout(std140) uniform CCMorph {\n    vec4 cc_displacementWeights[15];\n    vec4 cc_displacementTextureInfo;\n};\nvec2 getPixelLocation(vec2 textureResolution, int pixelIndex) {\n    float pixelIndexF = float(pixelIndex);\n    float x = mod(pixelIndexF, textureResolution.x);\n    float y = floor(pixelIndexF / textureResolution.x);\n    return vec2(x, y);\n}\nvec2 getPixelCoordFromLocation(vec2 location, vec2 textureResolution) {\n    return (vec2(location.x, location.y) + .5) / textureResolution;\n}\n#if CC_SUPPORT_FLOAT_TEXTURE\n        vec4 fetchVec3ArrayFromTexture(sampler2D tex, int pixelIndex) {\n            ivec2 texSize = textureSize(tex, 0);\n            return texelFetch(tex, ivec2(pixelIndex % texSize.x, pixelIndex / texSize.x), 0);\n        }\n#else\n    vec4 fetchVec3ArrayFromTexture(sampler2D tex, int elementIndex) {\n        int pixelIndex = elementIndex * 4;\n        vec2 location = getPixelLocation(cc_displacementTextureInfo.xy, pixelIndex);\n        vec2 x = getPixelCoordFromLocation(location + vec2(0.0, 0.0), cc_displacementTextureInfo.xy);\n        vec2 y = getPixelCoordFromLocation(location + vec2(1.0, 0.0), cc_displacementTextureInfo.xy);\n        vec2 z = getPixelCoordFromLocation(location + vec2(2.0, 0.0), cc_displacementTextureInfo.xy);\n        return vec4(\n            decode32(texture(tex, x)),\n            decode32(texture(tex, y)),\n            decode32(texture(tex, z)),\n            1.0\n        );\n    }\n#endif\nfloat getDisplacementWeight(int index) {\n    int quot = index / 4;\n    int remainder = index - quot * 4;\n    if (remainder == 0) {\n        return cc_displacementWeights[quot].x;\n    } else if (remainder == 1) {\n        return cc_displacementWeights[quot].y;\n    } else if (remainder == 2) {\n        return cc_displacementWeights[quot].z;\n    } else {\n        return cc_displacementWeights[quot].w;\n    }\n}\nvec3 getVec3DisplacementFromTexture(sampler2D tex, int vertexIndex) {\n#if CC_MORPH_PRECOMPUTED\n    return fetchVec3ArrayFromTexture(tex, vertexIndex).rgb;\n#else\n    vec3 result = vec3(0, 0, 0);\n    int nVertices = int(cc_displacementTextureInfo.z);\n    for (int iTarget = 0; iTarget < CC_MORPH_TARGET_COUNT; ++iTarget) {\n        result += (fetchVec3ArrayFromTexture(tex, nVertices * iTarget + vertexIndex).rgb * getDisplacementWeight(iTarget));\n    }\n    return result;\n#endif\n}\n#if CC_MORPH_TARGET_HAS_POSITION\n    uniform sampler2D cc_PositionDisplacements;\n    vec3 getPositionDisplacement(int vertexId) {\n        return getVec3DisplacementFromTexture(cc_PositionDisplacements, vertexId);\n    }\n#endif\n#if CC_MORPH_TARGET_HAS_NORMAL\n    uniform sampler2D cc_NormalDisplacements;\n    vec3 getNormalDisplacement(int vertexId) {\n        return getVec3DisplacementFromTexture(cc_NormalDisplacements, vertexId);\n    }\n#endif\n#if CC_MORPH_TARGET_HAS_TANGENT\n    uniform sampler2D cc_TangentDisplacements;\n    vec3 getTangentDisplacement(int vertexId) {\n        return getVec3DisplacementFromTexture(cc_TangentDisplacements, vertexId);\n    }\n#endif\nvoid applyMorph (inout StandardVertInput attr) {\n    int vertexId = getVertexId();\n#if CC_MORPH_TARGET_HAS_POSITION\n    attr.position.xyz = attr.position.xyz + getPositionDisplacement(vertexId);\n#endif\n#if CC_MORPH_TARGET_HAS_NORMAL\n    attr.normal.xyz = attr.normal.xyz + getNormalDisplacement(vertexId);\n#endif\n#if CC_MORPH_TARGET_HAS_TANGENT\n    attr.tangent.xyz = attr.tangent.xyz + getTangentDisplacement(vertexId);\n#endif\n}\nvoid applyMorph (inout vec4 position) {\n#if CC_MORPH_TARGET_HAS_POSITION\n    position.xyz = position.xyz + getPositionDisplacement(getVertexId());\n#endif\n}\n#endif\n#if CC_USE_SKINNING\n  in vec4 a_joints;\nin vec4 a_weights;\n#if CC_USE_BAKED_ANIMATION\n  #if USE_INSTANCING\n    in highp vec4 a_jointAnimInfo;\n  #endif\n  layout(std140) uniform CCSkinningTexture {\n    highp vec4 cc_jointTextureInfo;\n  };\n  layout(std140) uniform CCSkinningAnimation {\n    highp vec4 cc_jointAnimInfo;\n  };\n  uniform highp sampler2D cc_jointTexture;\n  #else\n  layout(std140) uniform CCSkinning {\n    highp vec4 cc_joints[30 * 3];\n  };\n#endif\n#if CC_USE_BAKED_ANIMATION\n  #if CC_SUPPORT_FLOAT_TEXTURE\n    mat4 getJointMatrix (float i) {\n    #if USE_INSTANCING\n      highp float j = 3.0 * (a_jointAnimInfo.x * a_jointAnimInfo.y + i) + a_jointAnimInfo.z;\n    #else\n      highp float j = 3.0 * (cc_jointAnimInfo.x * cc_jointTextureInfo.y + i) + cc_jointTextureInfo.z;\n    #endif\n    highp float invSize = cc_jointTextureInfo.w;\n    highp float y = floor(j * invSize);\n    highp float x = j - y * cc_jointTextureInfo.x;\n    y = (y + 0.5) * invSize;\n      vec4 v1 = texture(cc_jointTexture, vec2((x + 0.5) * invSize, y));\n      vec4 v2 = texture(cc_jointTexture, vec2((x + 1.5) * invSize, y));\n      vec4 v3 = texture(cc_jointTexture, vec2((x + 2.5) * invSize, y));\n      return mat4(vec4(v1.xyz, 0.0), vec4(v2.xyz, 0.0), vec4(v3.xyz, 0.0), vec4(v1.w, v2.w, v3.w, 1.0));\n    }\n  #else\n    mat4 getJointMatrix (float i) {\n    #if USE_INSTANCING\n      highp float j = 12.0 * (a_jointAnimInfo.x * a_jointAnimInfo.y + i) + a_jointAnimInfo.z;\n    #else\n      highp float j = 12.0 * (cc_jointAnimInfo.x * cc_jointTextureInfo.y + i) + cc_jointTextureInfo.z;\n    #endif\n    highp float invSize = cc_jointTextureInfo.w;\n    highp float y = floor(j * invSize);\n    highp float x = j - y * cc_jointTextureInfo.x;\n    y = (y + 0.5) * invSize;\n      vec4 v1 = vec4(\n        decode32(texture(cc_jointTexture, vec2((x + 0.5) * invSize, y))),\n        decode32(texture(cc_jointTexture, vec2((x + 1.5) * invSize, y))),\n        decode32(texture(cc_jointTexture, vec2((x + 2.5) * invSize, y))),\n        decode32(texture(cc_jointTexture, vec2((x + 3.5) * invSize, y)))\n      );\n      vec4 v2 = vec4(\n        decode32(texture(cc_jointTexture, vec2((x + 4.5) * invSize, y))),\n        decode32(texture(cc_jointTexture, vec2((x + 5.5) * invSize, y))),\n        decode32(texture(cc_jointTexture, vec2((x + 6.5) * invSize, y))),\n        decode32(texture(cc_jointTexture, vec2((x + 7.5) * invSize, y)))\n      );\n      vec4 v3 = vec4(\n        decode32(texture(cc_jointTexture, vec2((x + 8.5) * invSize, y))),\n        decode32(texture(cc_jointTexture, vec2((x + 9.5) * invSize, y))),\n        decode32(texture(cc_jointTexture, vec2((x + 10.5) * invSize, y))),\n        decode32(texture(cc_jointTexture, vec2((x + 11.5) * invSize, y)))\n      );\n      return mat4(vec4(v1.xyz, 0.0), vec4(v2.xyz, 0.0), vec4(v3.xyz, 0.0), vec4(v1.w, v2.w, v3.w, 1.0));\n    }\n  #endif\n#else\n  mat4 getJointMatrix (float i) {\n    int idx = int(i);\n    vec4 v1 = cc_joints[idx * 3];\n    vec4 v2 = cc_joints[idx * 3 + 1];\n    vec4 v3 = cc_joints[idx * 3 + 2];\n    return mat4(vec4(v1.xyz, 0.0), vec4(v2.xyz, 0.0), vec4(v3.xyz, 0.0), vec4(v1.w, v2.w, v3.w, 1.0));\n  }\n#endif\nmat4 skinMatrix () {\n  vec4 joints = vec4(a_joints);\n  return getJointMatrix(joints.x) * a_weights.x\n       + getJointMatrix(joints.y) * a_weights.y\n       + getJointMatrix(joints.z) * a_weights.z\n       + getJointMatrix(joints.w) * a_weights.w;\n}\nvoid CCSkin (inout vec4 position) {\n  mat4 m = skinMatrix();\n  position = m * position;\n}\nvoid CCSkin (inout StandardVertInput attr) {\n  mat4 m = skinMatrix();\n  attr.position = m * attr.position;\n  attr.normal = (m * vec4(attr.normal, 0.0)).xyz;\n  attr.tangent.xyz = (m * vec4(attr.tangent.xyz, 0.0)).xyz;\n}\n#endif\nlayout(std140) uniform CCGlobal {\n  highp   vec4 cc_time;\n  mediump vec4 cc_screenSize;\n  mediump vec4 cc_nativeSize;\n};\nlayout(std140) uniform CCCamera {\n  highp   mat4 cc_matView;\n  highp   mat4 cc_matViewInv;\n  highp   mat4 cc_matProj;\n  highp   mat4 cc_matProjInv;\n  highp   mat4 cc_matViewProj;\n  highp   mat4 cc_matViewProjInv;\n  highp   vec4 cc_cameraPos;\n  mediump vec4 cc_screenScale;\n  mediump vec4 cc_exposure;\n  mediump vec4 cc_mainLitDir;\n  mediump vec4 cc_mainLitColor;\n  mediump vec4 cc_ambientSky;\n  mediump vec4 cc_ambientGround;\n  mediump vec4 cc_fogColor;\n  mediump vec4 cc_fogBase;\n  mediump vec4 cc_fogAdd;\n};\n#if USE_INSTANCING\n  in vec4 a_matWorld0;\n  in vec4 a_matWorld1;\n  in vec4 a_matWorld2;\n  #if USE_LIGHTMAP\n    in vec4 a_lightingMapUVParam;\n  #endif\n#elif USE_BATCHING\n  in float a_dyn_batch_id;\n  layout(std140) uniform CCLocalBatched {\n    highp mat4 cc_matWorlds[10];\n  };\n#else\nlayout(std140) uniform CCLocal {\n  highp mat4 cc_matWorld;\n  highp mat4 cc_matWorldIT;\n  highp vec4 cc_lightingMapUVParam;\n};\n#endif\nlayout(std140) uniform Constants {\n  vec4 tilingOffset;\n  vec4 albedo;\n  vec4 albedoScaleAndCutoff;\n  vec4 pbrParams;\n  vec4 emissive;\n  vec4 emissiveScaleParam;\n};\nfloat LinearFog(vec4 pos) {\n    vec4 wPos = pos;\n    float cam_dis = distance(cc_cameraPos, wPos);\n    float fogStart = cc_fogBase.x;\n    float fogEnd = cc_fogBase.y;\n    return clamp((fogEnd - cam_dis) / (fogEnd - fogStart), 0., 1.);\n}\nfloat ExpFog(vec4 pos) {\n    vec4 wPos = pos;\n    float fogAtten = cc_fogAdd.z;\n    float fogDensity = cc_fogBase.z;\n    float cam_dis = distance(cc_cameraPos, wPos) / fogAtten * 4.;\n    float f = exp(-cam_dis * fogDensity);\n    return f;\n}\nfloat ExpSquaredFog(vec4 pos) {\n    vec4 wPos = pos;\n    float fogAtten = cc_fogAdd.z;\n    float fogDensity = cc_fogBase.z;\n    float cam_dis = distance(cc_cameraPos, wPos) / fogAtten * 4.;\n    float f = exp(-cam_dis * cam_dis * fogDensity * fogDensity);\n    return f;\n}\nfloat LayeredFog(vec4 pos) {\n    vec4 wPos = pos;\n    float fogAtten = cc_fogAdd.z;\n    float _FogTop = cc_fogAdd.x;\n    float _FogRange = cc_fogAdd.y;\n    vec3 camWorldProj = cc_cameraPos.xyz;\n    camWorldProj.y = 0.;\n    vec3 worldPosProj = wPos.xyz;\n    worldPosProj.y = 0.;\n    float fDeltaD = distance(worldPosProj, camWorldProj) / fogAtten * 2.0;\n    float fDeltaY, fDensityIntegral;\n    if (cc_cameraPos.y > _FogTop) {\n        if (wPos.y < _FogTop) {\n            fDeltaY = (_FogTop - wPos.y) / _FogRange * 2.0;\n            fDensityIntegral = fDeltaY * fDeltaY * 0.5;\n        } else {\n            fDeltaY = 0.;\n            fDensityIntegral = 0.;\n        }\n    } else {\n        if (wPos.y < _FogTop) {\n            float fDeltaA = (_FogTop - cc_cameraPos.y) / _FogRange * 2.;\n            float fDeltaB = (_FogTop - wPos.y) / _FogRange * 2.;\n            fDeltaY = abs(fDeltaA - fDeltaB);\n            fDensityIntegral = abs((fDeltaA * fDeltaA * 0.5) - (fDeltaB * fDeltaB * 0.5));\n        } else {\n            fDeltaY = abs(_FogTop - cc_cameraPos.y) / _FogRange * 2.;\n            fDensityIntegral = abs(fDeltaY * fDeltaY * 0.5);\n        }\n    }\n    float fDensity;\n    if (fDeltaY != 0.) {\n        fDensity = (sqrt(1.0 + ((fDeltaD / fDeltaY) * (fDeltaD / fDeltaY)))) * fDensityIntegral;\n    } else {\n        fDensity = 0.;\n    }\n    float f = exp(-fDensity);\n    return f;\n}\nfloat CC_TRANSFER_FOG(vec4 pos) {\n    #if CC_USE_FOG == 0\n        return LinearFog(pos);\n\t#elif CC_USE_FOG == 1\n        return ExpFog(pos);\n    #elif CC_USE_FOG == 2\n        return ExpSquaredFog(pos);\n    #elif CC_USE_FOG == 3\n        return LayeredFog(pos);\n    #endif\n    return 1.;\n}\nout highp vec4 v_shadowPos;\nlayout(std140) uniform CCShadow {\n  highp mat4 cc_matLightPlaneProj;\n  highp mat4 cc_matLightViewProj;\n  lowp  vec4 cc_shadowColor;\n  lowp  vec4 cc_shadowInfo;\n};\n#if USE_VERTEX_COLOR\n  in vec4 a_color;\n  out vec4 v_color;\n#endif\nout vec3 v_position;\nout vec3 v_normal;\nout vec2 v_uv;\nout vec2 v_uv1;\nout float v_fog_factor;\n#if USE_NORMAL_MAP\n  out vec3 v_tangent;\n  out vec3 v_bitangent;\n#endif\n#if HAS_SECOND_UV || USE_LIGHTMAP\n  in vec2 a_texCoord1;\n#endif\n#if USE_LIGHTMAP && !USE_BATCHING && !CC_FORWARD_ADD\n  out vec2 v_luv;\nvoid CCLightingMapCaclUV()\n{\n#if !USE_INSTANCING\n      v_luv = cc_lightingMapUVParam.xy + a_texCoord1 * cc_lightingMapUVParam.zw;\n#else\n      v_luv = a_lightingMapUVParam.xy + a_texCoord1 * a_lightingMapUVParam.zw;\n#endif\n}\n#endif\nvec4 vert () {\n  StandardVertInput In;\n  In.position = vec4(a_position, 1.0);\n  In.normal = a_normal;\n  In.tangent = a_tangent;\n  #if CC_USE_MORPH\n    applyMorph(In);\n  #endif\n  #if CC_USE_SKINNING\n    CCSkin(In);\n  #endif\n  mat4 matWorld, matWorldIT;\n  #if USE_INSTANCING\n    matWorld = mat4(\n      vec4(a_matWorld0.xyz, 0.0),\n      vec4(a_matWorld1.xyz, 0.0),\n      vec4(a_matWorld2.xyz, 0.0),\n      vec4(a_matWorld0.w, a_matWorld1.w, a_matWorld2.w, 1.0)\n    );\n    matWorldIT = matWorld;\n  #elif USE_BATCHING\n    matWorld = cc_matWorlds[int(a_dyn_batch_id)];\n    matWorldIT = matWorld;\n  #else\n    matWorld = cc_matWorld;\n    matWorldIT = cc_matWorldIT;\n  #endif\n  vec4 pos = matWorld * In.position;\n  v_position = pos.xyz;\n  v_normal = normalize((matWorldIT * vec4(In.normal, 0.0)).xyz);\n  #if USE_NORMAL_MAP\n    v_tangent = normalize((matWorld * vec4(In.tangent.xyz, 0.0)).xyz);\n    v_bitangent = cross(v_normal, v_tangent) * In.tangent.w;\n  #endif\n  v_uv = a_texCoord * tilingOffset.xy + tilingOffset.zw;\n  #if HAS_SECOND_UV\n    v_uv1 = a_texCoord1 * tilingOffset.xy + tilingOffset.zw;\n  #endif\n  #if USE_VERTEX_COLOR\n    v_color = a_color;\n  #endif\n  v_fog_factor = CC_TRANSFER_FOG(pos);\n  #if USE_LIGHTMAP && !USE_BATCHING && !CC_FORWARD_ADD\n    CCLightingMapCaclUV();\n  #endif\n    v_shadowPos = cc_matLightViewProj * pos;\n  return cc_matProj * (cc_matView * matWorld) * In.position;\n}\nvoid main() { gl_Position = vert(); }",frag:"\nprecision highp float;\nlayout(std140) uniform CCGlobal {\n  highp   vec4 cc_time;\n  mediump vec4 cc_screenSize;\n  mediump vec4 cc_nativeSize;\n};\nlayout(std140) uniform CCCamera {\n  highp   mat4 cc_matView;\n  highp   mat4 cc_matViewInv;\n  highp   mat4 cc_matProj;\n  highp   mat4 cc_matProjInv;\n  highp   mat4 cc_matViewProj;\n  highp   mat4 cc_matViewProjInv;\n  highp   vec4 cc_cameraPos;\n  mediump vec4 cc_screenScale;\n  mediump vec4 cc_exposure;\n  mediump vec4 cc_mainLitDir;\n  mediump vec4 cc_mainLitColor;\n  mediump vec4 cc_ambientSky;\n  mediump vec4 cc_ambientGround;\n  mediump vec4 cc_fogColor;\n  mediump vec4 cc_fogBase;\n  mediump vec4 cc_fogAdd;\n};\nlayout(std140) uniform CCShadow {\n  highp mat4 cc_matLightPlaneProj;\n  highp mat4 cc_matLightViewProj;\n  lowp  vec4 cc_shadowColor;\n  lowp  vec4 cc_shadowInfo;\n};\n#if CC_USE_IBL\nuniform samplerCube cc_environment;\nvec3 unpackRGBE (vec4 rgbe) {\n  return rgbe.rgb * pow(2.0, rgbe.a * 255.0 - 128.0);\n}\nvec4 fragTextureLod (sampler2D tex, vec2 coord, float lod) {\n    return textureLod(tex, coord, lod);\n}\nvec4 fragTextureLod (samplerCube tex, vec3 coord, float lod) {\n    return textureLod(tex, coord, lod);\n}\n#endif\n#if CC_RECEIVE_SHADOW\nin highp vec4 v_shadowPos;\n#if CC_RECEIVE_SHADOW\n  uniform sampler2D cc_shadowMap;\n  uniform sampler2D cc_spotLightingMap;\n  float CCGetShadowFactorX1 () {\n    vec3 clipPos = v_shadowPos.xyz / v_shadowPos.w * 0.5 + 0.5;\n    if (clipPos.x < 0.0 || clipPos.x > 1.0 ||\n        clipPos.y < 0.0 || clipPos.y > 1.0 ||\n        clipPos.z <-1.0 || clipPos.z > 1.0) { return 0.0; }\n    float closestDepth = dot(texture(cc_shadowMap, clipPos.xy), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 160581375.0));\n    float shadow = step(closestDepth, clipPos.z - cc_shadowInfo.w);\n    return shadow;\n  }\n  float CCGetShadowFactorX5 () {\n    vec3 clipPos = v_shadowPos.xyz / v_shadowPos.w * 0.5 + 0.5;\n    if (clipPos.x < 0.0 || clipPos.x > 1.0 ||\n        clipPos.y < 0.0 || clipPos.y > 1.0 ||\n        clipPos.z <-1.0 || clipPos.z > 1.0) { return 0.0; }\n    float offsetx = 1.0 / cc_shadowInfo.x;\n    float offsety = 1.0 / cc_shadowInfo.y;\n    float shadow = 0.0;\n    float closestDepth = 0.0;\n    closestDepth = dot(texture(cc_shadowMap, vec2(clipPos.x - offsetx, clipPos.y - offsety)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 160581375.0));\n    shadow += step(closestDepth, clipPos.z - cc_shadowInfo.w);\n    closestDepth = dot(texture(cc_shadowMap, vec2(clipPos.x - offsetx, clipPos.y + offsety)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 160581375.0));\n    shadow += step(closestDepth, clipPos.z - cc_shadowInfo.w);\n    closestDepth = dot(texture(cc_shadowMap, vec2(clipPos.x, clipPos.y)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 160581375.0));\n    shadow += step(closestDepth, clipPos.z - cc_shadowInfo.w);\n    closestDepth = dot(texture(cc_shadowMap, vec2(clipPos.x + offsetx, clipPos.y - offsety)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 160581375.0));\n    shadow += step(closestDepth, clipPos.z - cc_shadowInfo.w);\n    closestDepth = dot(texture(cc_shadowMap, vec2(clipPos.x + offsetx, clipPos.y + offsety)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 160581375.0));\n    shadow += step(closestDepth, clipPos.z - cc_shadowInfo.w);\n    return shadow / 5.0;\n  }\n  float CCGetShadowFactorX9 () {\n    vec3 clipPos = v_shadowPos.xyz / v_shadowPos.w * 0.5 + 0.5;\n    if (clipPos.x < 0.0 || clipPos.x > 1.0 ||\n        clipPos.y < 0.0 || clipPos.y > 1.0 ||\n        clipPos.z <-1.0 || clipPos.z > 1.0) { return 0.0; }\n    float offsetx = 1.0 / cc_shadowInfo.x;\n    float offsety = 1.0 / cc_shadowInfo.y;\n    float shadow = 0.0;\n    for (int i = -1; i <= 1; i++) {\n      for (int j = -1; j <= 1; j++) {\n        float closestDepth = dot(texture(cc_shadowMap, clipPos.xy + vec2(i, j) * vec2(offsetx, offsety)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 160581375.0));\n        shadow += step(closestDepth, clipPos.z - cc_shadowInfo.w);\n      }\n    }\n    return shadow / 9.0;\n  }\n  float CCGetShadowFactorX25 () {\n    vec3 clipPos = v_shadowPos.xyz / v_shadowPos.w * 0.5 + 0.5;\n    if (clipPos.x < 0.0 || clipPos.x > 1.0 ||\n        clipPos.y < 0.0 || clipPos.y > 1.0 ||\n        clipPos.z <-1.0 || clipPos.z > 1.0) { return 0.0; }\n    float offsetx = 1.0 / cc_shadowInfo.x;\n    float offsety = 1.0 / cc_shadowInfo.y;\n    float shadow = 0.0;\n    for (int i = -2; i <= 2; i++) {\n      for (int j = -2; j <= 2; j++) {\n        float closestDepth = dot(texture(cc_shadowMap, clipPos.xy + vec2(i, j) * vec2(offsetx, offsety)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 160581375.0));\n        shadow += step(closestDepth, clipPos.z - cc_shadowInfo.w);\n      }\n    }\n    return shadow / 25.0;\n  }\n  float CCGetDirLightShadowFactorX1 () {\n    vec3 clipPos = v_shadowPos.xyz / v_shadowPos.w * 0.5 + 0.5;\n    if (clipPos.x < 0.0 || clipPos.x > 1.0 ||\n        clipPos.y < 0.0 || clipPos.y > 1.0 ||\n        clipPos.z <-1.0 || clipPos.z > 1.0) { return 0.0; }\n    float closestDepth = dot(texture(cc_spotLightingMap, clipPos.xy), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 160581375.0));\n    float shadow = step(closestDepth, clipPos.z - cc_shadowInfo.w);\n    return shadow;\n  }\n  float CCGetDirLightShadowFactorX5 () {\n    vec3 clipPos = v_shadowPos.xyz / v_shadowPos.w * 0.5 + 0.5;\n    if (clipPos.x < 0.0 || clipPos.x > 1.0 ||\n        clipPos.y < 0.0 || clipPos.y > 1.0 ||\n        clipPos.z <-1.0 || clipPos.z > 1.0) { return 0.0; }\n    float offsetx = 1.0 / cc_shadowInfo.x;\n    float offsety = 1.0 / cc_shadowInfo.y;\n    float shadow = 0.0;\n    float closestDepth = 0.0;\n    closestDepth = dot(texture(cc_spotLightingMap, vec2(clipPos.x - offsetx, clipPos.y - offsety)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 160581375.0));\n    shadow += step(closestDepth, clipPos.z - cc_shadowInfo.w);\n    closestDepth = dot(texture(cc_spotLightingMap, vec2(clipPos.x - offsetx, clipPos.y + offsety)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 160581375.0));\n    shadow += step(closestDepth, clipPos.z - cc_shadowInfo.w);\n    closestDepth = dot(texture(cc_spotLightingMap, vec2(clipPos.x, clipPos.y)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 160581375.0));\n    shadow += step(closestDepth, clipPos.z - cc_shadowInfo.w);\n    closestDepth = dot(texture(cc_spotLightingMap, vec2(clipPos.x + offsetx, clipPos.y - offsety)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 160581375.0));\n    shadow += step(closestDepth, clipPos.z - cc_shadowInfo.w);\n    closestDepth = dot(texture(cc_spotLightingMap, vec2(clipPos.x + offsetx, clipPos.y + offsety)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 160581375.0));\n    return shadow / 5.0;\n  }\n  float CCGetDirLightShadowFactorX9 () {\n    vec3 clipPos = v_shadowPos.xyz / v_shadowPos.w * 0.5 + 0.5;\n    if (clipPos.x < 0.0 || clipPos.x > 1.0 ||\n        clipPos.y < 0.0 || clipPos.y > 1.0 ||\n        clipPos.z <-1.0 || clipPos.z > 1.0) { return 0.0; }\n    float offsetx = 1.0 / cc_shadowInfo.x;\n    float offsety = 1.0 / cc_shadowInfo.y;\n    float shadow = 0.0;\n    for (int i = -1; i <= 1; i++) {\n      for (int j = -1; j <= 1; j++) {\n        float closestDepth = dot(texture(cc_spotLightingMap, clipPos.xy + vec2(i, j) * vec2(offsetx, offsety)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 160581375.0));\n        shadow += step(closestDepth, clipPos.z - cc_shadowInfo.w);\n      }\n    }\n    return shadow / 9.0;\n  }\n  float CCGetDirLightShadowFactorX25 () {\n    vec3 clipPos = v_shadowPos.xyz / v_shadowPos.w * 0.5 + 0.5;\n    if (clipPos.x < 0.0 || clipPos.x > 1.0 ||\n        clipPos.y < 0.0 || clipPos.y > 1.0 ||\n        clipPos.z <-1.0 || clipPos.z > 1.0) { return 0.0; }\n    float offsetx = 1.0 / cc_shadowInfo.x;\n    float offsety = 1.0 / cc_shadowInfo.y;\n    float shadow = 0.0;\n    for (int i = -2; i <= 2; i++) {\n      for (int j = -2; j <= 2; j++) {\n        float closestDepth = dot(texture(cc_spotLightingMap, clipPos.xy + vec2(i, j) * vec2(offsetx, offsety)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 160581375.0));\n        shadow += step(closestDepth, clipPos.z - cc_shadowInfo.w);\n      }\n    }\n    return shadow / 25.0;\n  }\n#endif\n#endif\nvec3 SRGBToLinear (vec3 gamma) {\n  return gamma * gamma;\n}\nfloat GGXMobile (float roughness, float NoH, vec3 H, vec3 N) {\n  vec3 NxH = cross(N, H);\n  float OneMinusNoHSqr = dot(NxH, NxH);\n  float a = roughness * roughness;\n  float n = NoH * a;\n  float p = a / (OneMinusNoHSqr + n * n);\n  return p * p;\n}\nfloat CalcSpecular (float roughness, float NoH, vec3 H, vec3 N) {\n  return (roughness*0.25 + 0.25) * GGXMobile(roughness, NoH, H, N);\n}\nvec3 BRDFApprox (vec3 specular, float roughness, float NoV) {\n  const vec4 c0 = vec4(-1.0, -0.0275, -0.572, 0.022);\n  const vec4 c1 = vec4(1.0, 0.0425, 1.04, -0.04);\n  vec4 r = roughness * c0 + c1;\n  float a004 = min( r.x * r.x, exp2( -9.28 * NoV ) ) * r.x + r.y;\n  vec2 AB = vec2( -1.04, 1.04 ) * a004 + r.zw;\n  AB.y *= clamp(50.0 * specular.g, 0.0, 1.0);\n  return specular * AB.x + AB.y;\n}\nstruct StandardSurface {\n  vec4 albedo;\n  vec3 position;\n  vec3 normal;\n  vec3 emissive;\n  vec4 lightmap;\n  float roughness;\n  float metallic;\n  float occlusion;\n};\n#if CC_FORWARD_ADD\nlayout(std140) uniform CCForwardLight {\n  highp vec4 cc_lightPos[1];\n  vec4 cc_lightColor[1];\n  vec4 cc_lightSizeRangeAngle[1];\n  vec4 cc_lightDir[1];\n};\nfloat SmoothDistAtt (float distSqr, float invSqrAttRadius) {\n  float factor = distSqr * invSqrAttRadius;\n  float smoothFactor = clamp(1.0 - factor * factor, 0.0, 1.0);\n  return smoothFactor * smoothFactor;\n}\nfloat GetDistAtt (float distSqr, float invSqrAttRadius) {\n  float attenuation = 1.0 / max(distSqr, 0.01*0.01);\n  attenuation *= SmoothDistAtt(distSqr , invSqrAttRadius);\n  return attenuation;\n}\nfloat GetAngleAtt (vec3 L, vec3 litDir, float litAngleScale, float litAngleOffset) {\n  float cd = dot(litDir, L);\n  float attenuation = clamp(cd * litAngleScale + litAngleOffset, 0.0, 1.0);\n  return (attenuation * attenuation);\n}\n  vec4 CCStandardShading (StandardSurface s) {\n    vec3 diffuse = s.albedo.rgb * (1.0 - s.metallic);\n    vec3 specular = mix(vec3(0.04), s.albedo.rgb, s.metallic);\n    vec3 diffuseContrib = diffuse / 3.14159265359;\n    vec3 N = normalize(s.normal);\n    vec3 V = normalize(cc_cameraPos.xyz - s.position);\n    float NV = max(abs(dot(N, V)), 0.001);\n    specular = BRDFApprox(specular, s.roughness, NV);\n    vec3 finalColor = vec3(0.0);\n    for (int i = 0; i < 1; i++) {\n      vec3 SLU = cc_lightPos[i].xyz - s.position;\n      vec3 SL = normalize(SLU);\n      vec3 SH = normalize(SL + V);\n      float SNL = max(dot(N, SL), 0.001);\n      float SNH = max(dot(N, SH), 0.0);\n      float distSqr = dot(SLU, SLU);\n      float litRadius = cc_lightSizeRangeAngle[i].x;\n      float litRadiusSqr = litRadius * litRadius;\n      float illum = 3.14159265359 * (litRadiusSqr / max(litRadiusSqr , distSqr));\n      float attRadiusSqrInv = 1.0 / max(cc_lightSizeRangeAngle[i].y, 0.01);\n      attRadiusSqrInv *= attRadiusSqrInv;\n      float att = GetDistAtt(distSqr, attRadiusSqrInv);\n      vec3 lspec = specular * CalcSpecular(s.roughness, SNH, SH, N);\n      if (cc_lightPos[i].w > 0.0) {\n        float cosInner = max(dot(-cc_lightDir[i].xyz, SL), 0.01);\n        float cosOuter = cc_lightSizeRangeAngle[i].z;\n        float litAngleScale = 1.0 / max(0.001, cosInner - cosOuter);\n        float litAngleOffset = -cosOuter * litAngleScale;\n        att *= GetAngleAtt(SL, -cc_lightDir[i].xyz, litAngleScale, litAngleOffset);\n      }\n      vec3 lightColor = cc_lightColor[i].rgb;\n    #if CC_RECEIVE_SHADOW\n      if (cc_lightPos[i].w > 0.0) {\n    {\n      float pcf = cc_shadowInfo.z + 0.001;\n      float shadowAttenuation = 0.0;\n      if (pcf > 3.0) shadowAttenuation = CCGetDirLightShadowFactorX25();\n      else if (3.0 > pcf && pcf > 2.0) shadowAttenuation = CCGetDirLightShadowFactorX9();\n      else if (2.0 > pcf && pcf > 1.0) shadowAttenuation = CCGetDirLightShadowFactorX5();\n      else shadowAttenuation = CCGetDirLightShadowFactorX1();\n      lightColor *= 1.0 - shadowAttenuation;\n    }\n      }\n    #endif\n      finalColor += SNL * lightColor * cc_lightColor[i].w * illum * att * (diffuseContrib + lspec);\n    }\n    finalColor = finalColor * s.occlusion;\n    return vec4(finalColor, 0.0);\n  }\n#else\n  vec4 CCStandardShading (StandardSurface s) {\n    vec3 diffuse = s.albedo.rgb * (1.0 - s.metallic);\n    vec3 specular = mix(vec3(0.04), s.albedo.rgb, s.metallic);\n    vec3 N = normalize(s.normal);\n    vec3 V = normalize(cc_cameraPos.xyz - s.position);\n    float NV = max(abs(dot(N, V)), 0.001);\n    specular = BRDFApprox(specular, s.roughness, NV);\n    vec3 L = normalize(-cc_mainLitDir.xyz);\n    vec3 H = normalize(L+V);\n    float NH = max(dot(N, H), 0.0);\n    float NL = max(dot(N, L), 0.001);\n    vec3 finalColor = NL * cc_mainLitColor.rgb * cc_mainLitColor.w;\n    #if USE_LIGHTMAP && !USE_BATCHING && !CC_FORWARD_ADD\n      finalColor = s.lightmap.a * s.lightmap.rgb + (1.0 - s.lightmap.a) * finalColor;\n    #endif\n    vec3 diffuseContrib = diffuse / 3.14159265359;\n    vec3 specularContrib = specular * CalcSpecular(s.roughness, NH, H, N);\n    finalColor *= (diffuseContrib + specularContrib);\n    float fAmb = 0.5 - N.y * 0.5;\n    vec3 ambDiff = mix(cc_ambientSky.rgb, cc_ambientGround.rgb, fAmb) * cc_ambientSky.w;\n    finalColor += (ambDiff.rgb * diffuse);\n    #if CC_USE_IBL\n      vec3 R = normalize(reflect(-V, N));\n      vec4 envmap = fragTextureLod(cc_environment, R, s.roughness * cc_ambientGround.w);\n      #if CC_USE_IBL == 2\n        vec3 env = unpackRGBE(envmap);\n      #else\n        vec3 env = SRGBToLinear(envmap.rgb);\n      #endif\n      finalColor += env * cc_ambientSky.w * specular;\n    #endif\n    finalColor = finalColor * s.occlusion;\n    #if CC_USE_HDR\n      s.emissive *= cc_exposure.w;\n    #endif\n    finalColor += s.emissive;\n    #if CC_RECEIVE_SHADOW\n    {\n      float pcf = cc_shadowInfo.z + 0.001;\n      float shadowAttenuation = 0.0;\n      if (pcf > 3.0) shadowAttenuation = CCGetShadowFactorX25();\n      else if (3.0 > pcf && pcf > 2.0) shadowAttenuation = CCGetShadowFactorX9();\n      else if (2.0 > pcf && pcf > 1.0) shadowAttenuation = CCGetShadowFactorX5();\n      else shadowAttenuation = CCGetShadowFactorX1();\n      vec3 shadowColor = cc_shadowColor.rgb * cc_shadowColor.a + finalColor.rgb * (1.0 - cc_shadowColor.a);\n      finalColor.rgb = shadowColor.rgb * shadowAttenuation * NL + finalColor.rgb * (1.0 - shadowAttenuation * NL);\n    }\n    #endif\n    return vec4(finalColor, s.albedo.a);\n  }\n#endif\nvec3 ACESToneMap (vec3 color) {\n  color = min(color, vec3(8.0));\n  const float A = 2.51;\n  const float B = 0.03;\n  const float C = 2.43;\n  const float D = 0.59;\n  const float E = 0.14;\n  return (color * (A * color + B)) / (color * (C * color + D) + E);\n}\nvec4 CCFragOutput (vec4 color) {\n  #if !CC_USE_HDR\n    color.rgb = sqrt(ACESToneMap(color.rgb));\n  #endif\n  return color;\n}\nlayout(std140) uniform Constants {\n  vec4 tilingOffset;\n  vec4 albedo;\n  vec4 albedoScaleAndCutoff;\n  vec4 pbrParams;\n  vec4 emissive;\n  vec4 emissiveScaleParam;\n};\n#if USE_LIGHTMAP && !USE_BATCHING && !CC_FORWARD_ADD\n  in vec2 v_luv;\nuniform sampler2D cc_lightingMap;\n#endif\nin vec3 v_position;\nin vec2 v_uv;\nin vec2 v_uv1;\nin vec3 v_normal;\nin float v_fog_factor;\n#if USE_VERTEX_COLOR\n  in vec4 v_color;\n#endif\n#if USE_ALBEDO_MAP\n  uniform sampler2D albedoMap;\n#endif\n#if USE_NORMAL_MAP\n  in vec3 v_tangent;\n  in vec3 v_bitangent;\n  uniform sampler2D normalMap;\n#endif\n#if USE_PBR_MAP\n  uniform sampler2D pbrMap;\n#endif\n#if USE_METALLIC_ROUGHNESS_MAP\n  uniform sampler2D metallicRoughnessMap;\n#endif\n#if USE_OCCLUSION_MAP\n  uniform sampler2D occlusionMap;\n#endif\n#if USE_EMISSIVE_MAP\n  uniform sampler2D emissiveMap;\n#endif\n#if USE_ALPHA_TEST\n#endif\nvoid surf (out StandardSurface s) {\n  vec4 baseColor = albedo;\n  #if USE_VERTEX_COLOR\n    baseColor *= v_color;\n  #endif\n  #if USE_ALBEDO_MAP\n    vec4 texColor = texture(albedoMap, ALBEDO_UV);\n    texColor.rgb = SRGBToLinear(texColor.rgb);\n    baseColor *= texColor;\n  #endif\n  s.albedo = baseColor;\n  s.albedo.rgb *= albedoScaleAndCutoff.xyz;\n  #if USE_ALPHA_TEST\n    if (s.albedo.ALPHA_TEST_CHANNEL < albedoScaleAndCutoff.w) discard;\n  #endif\n  #if USE_LIGHTMAP && !USE_BATCHING && !CC_FORWARD_ADD\n    s.lightmap = texture(cc_lightingMap, v_luv);\n  #endif\n  s.normal = v_normal;\n  #if USE_NORMAL_MAP\n    vec3 nmmp = texture(normalMap, NORMAL_UV).xyz - vec3(0.5);\n    s.normal =\n      (nmmp.x * pbrParams.w) * normalize(v_tangent) +\n      (nmmp.y * pbrParams.w) * normalize(v_bitangent) +\n      nmmp.z * normalize(s.normal);\n  #endif\n  s.position = v_position;\n  vec4 pbr = pbrParams;\n  #if USE_PBR_MAP\n    vec4 res = texture(pbrMap, PBR_UV);\n    pbr.x *= res.r;\n    pbr.y *= res.g;\n    pbr.z *= res.b;\n  #endif\n  #if USE_METALLIC_ROUGHNESS_MAP\n    vec4 metallicRoughness = texture(metallicRoughnessMap, PBR_UV);\n    pbr.z *= metallicRoughness.b;\n    pbr.y *= metallicRoughness.g;\n  #endif\n  #if USE_OCCLUSION_MAP\n    pbr.x *= texture(occlusionMap, PBR_UV).r;\n  #endif\n  s.occlusion = clamp(pbr.x, 0.0, 0.96);\n  s.roughness = clamp(pbr.y, 0.04, 1.0);\n  s.metallic = pbr.z;\n  s.emissive = emissive.rgb * emissiveScaleParam.xyz;\n  #if USE_EMISSIVE_MAP\n    s.emissive *= SRGBToLinear(texture(emissiveMap, EMISSIVE_UV).rgb);\n  #endif\n}\nvec4 frag () {\n  StandardSurface s; surf(s);\n  vec4 color = CCStandardShading(s);\n  color = vec4(mix(CC_FORWARD_ADD > 0 ? vec3(0.0) : cc_fogColor.rgb, color.rgb, v_fog_factor), color.a);\n  return CCFragOutput(color);\n}\nlayout(location = 0) out vec4 cc_FragColor;\nvoid main() { cc_FragColor = frag(); }"},{vert:"\nprecision highp float;\nhighp float decode32 (highp vec4 rgba) {\n  rgba = rgba * 255.0;\n  highp float Sign = 1.0 - (step(128.0, (rgba[3]) + 0.5)) * 2.0;\n  highp float Exponent = 2.0 * (mod(float(int((rgba[3]) + 0.5)), 128.0)) + (step(128.0, (rgba[2]) + 0.5)) - 127.0;\n  highp float Mantissa = (mod(float(int((rgba[2]) + 0.5)), 128.0)) * 65536.0 + rgba[1] * 256.0 + rgba[0] + 8388608.0;\n  return Sign * exp2(Exponent - 23.0) * Mantissa;\n}\nstruct StandardVertInput {\n  highp vec4 position;\n  vec3 normal;\n  vec4 tangent;\n};\nin vec3 a_position;\nin vec3 a_normal;\nin vec2 a_texCoord;\nin vec4 a_tangent;\n#if CC_USE_MORPH\n    in float a_vertexId;\n    int getVertexId() {\n        return int(a_vertexId);\n    }\nlayout(std140) uniform CCMorph {\n    vec4 cc_displacementWeights[15];\n    vec4 cc_displacementTextureInfo;\n};\nvec2 getPixelLocation(vec2 textureResolution, int pixelIndex) {\n    float pixelIndexF = float(pixelIndex);\n    float x = mod(pixelIndexF, textureResolution.x);\n    float y = floor(pixelIndexF / textureResolution.x);\n    return vec2(x, y);\n}\nvec2 getPixelCoordFromLocation(vec2 location, vec2 textureResolution) {\n    return (vec2(location.x, location.y) + .5) / textureResolution;\n}\n#if CC_SUPPORT_FLOAT_TEXTURE\n        vec4 fetchVec3ArrayFromTexture(sampler2D tex, int pixelIndex) {\n            ivec2 texSize = textureSize(tex, 0);\n            return texelFetch(tex, ivec2(pixelIndex % texSize.x, pixelIndex / texSize.x), 0);\n        }\n#else\n    vec4 fetchVec3ArrayFromTexture(sampler2D tex, int elementIndex) {\n        int pixelIndex = elementIndex * 4;\n        vec2 location = getPixelLocation(cc_displacementTextureInfo.xy, pixelIndex);\n        vec2 x = getPixelCoordFromLocation(location + vec2(0.0, 0.0), cc_displacementTextureInfo.xy);\n        vec2 y = getPixelCoordFromLocation(location + vec2(1.0, 0.0), cc_displacementTextureInfo.xy);\n        vec2 z = getPixelCoordFromLocation(location + vec2(2.0, 0.0), cc_displacementTextureInfo.xy);\n        return vec4(\n            decode32(texture(tex, x)),\n            decode32(texture(tex, y)),\n            decode32(texture(tex, z)),\n            1.0\n        );\n    }\n#endif\nfloat getDisplacementWeight(int index) {\n    int quot = index / 4;\n    int remainder = index - quot * 4;\n    if (remainder == 0) {\n        return cc_displacementWeights[quot].x;\n    } else if (remainder == 1) {\n        return cc_displacementWeights[quot].y;\n    } else if (remainder == 2) {\n        return cc_displacementWeights[quot].z;\n    } else {\n        return cc_displacementWeights[quot].w;\n    }\n}\nvec3 getVec3DisplacementFromTexture(sampler2D tex, int vertexIndex) {\n#if CC_MORPH_PRECOMPUTED\n    return fetchVec3ArrayFromTexture(tex, vertexIndex).rgb;\n#else\n    vec3 result = vec3(0, 0, 0);\n    int nVertices = int(cc_displacementTextureInfo.z);\n    for (int iTarget = 0; iTarget < CC_MORPH_TARGET_COUNT; ++iTarget) {\n        result += (fetchVec3ArrayFromTexture(tex, nVertices * iTarget + vertexIndex).rgb * getDisplacementWeight(iTarget));\n    }\n    return result;\n#endif\n}\n#if CC_MORPH_TARGET_HAS_POSITION\n    uniform sampler2D cc_PositionDisplacements;\n    vec3 getPositionDisplacement(int vertexId) {\n        return getVec3DisplacementFromTexture(cc_PositionDisplacements, vertexId);\n    }\n#endif\n#if CC_MORPH_TARGET_HAS_NORMAL\n    uniform sampler2D cc_NormalDisplacements;\n    vec3 getNormalDisplacement(int vertexId) {\n        return getVec3DisplacementFromTexture(cc_NormalDisplacements, vertexId);\n    }\n#endif\n#if CC_MORPH_TARGET_HAS_TANGENT\n    uniform sampler2D cc_TangentDisplacements;\n    vec3 getTangentDisplacement(int vertexId) {\n        return getVec3DisplacementFromTexture(cc_TangentDisplacements, vertexId);\n    }\n#endif\nvoid applyMorph (inout StandardVertInput attr) {\n    int vertexId = getVertexId();\n#if CC_MORPH_TARGET_HAS_POSITION\n    attr.position.xyz = attr.position.xyz + getPositionDisplacement(vertexId);\n#endif\n#if CC_MORPH_TARGET_HAS_NORMAL\n    attr.normal.xyz = attr.normal.xyz + getNormalDisplacement(vertexId);\n#endif\n#if CC_MORPH_TARGET_HAS_TANGENT\n    attr.tangent.xyz = attr.tangent.xyz + getTangentDisplacement(vertexId);\n#endif\n}\nvoid applyMorph (inout vec4 position) {\n#if CC_MORPH_TARGET_HAS_POSITION\n    position.xyz = position.xyz + getPositionDisplacement(getVertexId());\n#endif\n}\n#endif\n#if CC_USE_SKINNING\n  in vec4 a_joints;\nin vec4 a_weights;\n#if CC_USE_BAKED_ANIMATION\n  #if USE_INSTANCING\n    in highp vec4 a_jointAnimInfo;\n  #endif\n  layout(std140) uniform CCSkinningTexture {\n    highp vec4 cc_jointTextureInfo;\n  };\n  layout(std140) uniform CCSkinningAnimation {\n    highp vec4 cc_jointAnimInfo;\n  };\n  uniform highp sampler2D cc_jointTexture;\n  #else\n  layout(std140) uniform CCSkinning {\n    highp vec4 cc_joints[30 * 3];\n  };\n#endif\n#if CC_USE_BAKED_ANIMATION\n  #if CC_SUPPORT_FLOAT_TEXTURE\n    mat4 getJointMatrix (float i) {\n    #if USE_INSTANCING\n      highp float j = 3.0 * (a_jointAnimInfo.x * a_jointAnimInfo.y + i) + a_jointAnimInfo.z;\n    #else\n      highp float j = 3.0 * (cc_jointAnimInfo.x * cc_jointTextureInfo.y + i) + cc_jointTextureInfo.z;\n    #endif\n    highp float invSize = cc_jointTextureInfo.w;\n    highp float y = floor(j * invSize);\n    highp float x = j - y * cc_jointTextureInfo.x;\n    y = (y + 0.5) * invSize;\n      vec4 v1 = texture(cc_jointTexture, vec2((x + 0.5) * invSize, y));\n      vec4 v2 = texture(cc_jointTexture, vec2((x + 1.5) * invSize, y));\n      vec4 v3 = texture(cc_jointTexture, vec2((x + 2.5) * invSize, y));\n      return mat4(vec4(v1.xyz, 0.0), vec4(v2.xyz, 0.0), vec4(v3.xyz, 0.0), vec4(v1.w, v2.w, v3.w, 1.0));\n    }\n  #else\n    mat4 getJointMatrix (float i) {\n    #if USE_INSTANCING\n      highp float j = 12.0 * (a_jointAnimInfo.x * a_jointAnimInfo.y + i) + a_jointAnimInfo.z;\n    #else\n      highp float j = 12.0 * (cc_jointAnimInfo.x * cc_jointTextureInfo.y + i) + cc_jointTextureInfo.z;\n    #endif\n    highp float invSize = cc_jointTextureInfo.w;\n    highp float y = floor(j * invSize);\n    highp float x = j - y * cc_jointTextureInfo.x;\n    y = (y + 0.5) * invSize;\n      vec4 v1 = vec4(\n        decode32(texture(cc_jointTexture, vec2((x + 0.5) * invSize, y))),\n        decode32(texture(cc_jointTexture, vec2((x + 1.5) * invSize, y))),\n        decode32(texture(cc_jointTexture, vec2((x + 2.5) * invSize, y))),\n        decode32(texture(cc_jointTexture, vec2((x + 3.5) * invSize, y)))\n      );\n      vec4 v2 = vec4(\n        decode32(texture(cc_jointTexture, vec2((x + 4.5) * invSize, y))),\n        decode32(texture(cc_jointTexture, vec2((x + 5.5) * invSize, y))),\n        decode32(texture(cc_jointTexture, vec2((x + 6.5) * invSize, y))),\n        decode32(texture(cc_jointTexture, vec2((x + 7.5) * invSize, y)))\n      );\n      vec4 v3 = vec4(\n        decode32(texture(cc_jointTexture, vec2((x + 8.5) * invSize, y))),\n        decode32(texture(cc_jointTexture, vec2((x + 9.5) * invSize, y))),\n        decode32(texture(cc_jointTexture, vec2((x + 10.5) * invSize, y))),\n        decode32(texture(cc_jointTexture, vec2((x + 11.5) * invSize, y)))\n      );\n      return mat4(vec4(v1.xyz, 0.0), vec4(v2.xyz, 0.0), vec4(v3.xyz, 0.0), vec4(v1.w, v2.w, v3.w, 1.0));\n    }\n  #endif\n#else\n  mat4 getJointMatrix (float i) {\n    int idx = int(i);\n    vec4 v1 = cc_joints[idx * 3];\n    vec4 v2 = cc_joints[idx * 3 + 1];\n    vec4 v3 = cc_joints[idx * 3 + 2];\n    return mat4(vec4(v1.xyz, 0.0), vec4(v2.xyz, 0.0), vec4(v3.xyz, 0.0), vec4(v1.w, v2.w, v3.w, 1.0));\n  }\n#endif\nmat4 skinMatrix () {\n  vec4 joints = vec4(a_joints);\n  return getJointMatrix(joints.x) * a_weights.x\n       + getJointMatrix(joints.y) * a_weights.y\n       + getJointMatrix(joints.z) * a_weights.z\n       + getJointMatrix(joints.w) * a_weights.w;\n}\nvoid CCSkin (inout vec4 position) {\n  mat4 m = skinMatrix();\n  position = m * position;\n}\nvoid CCSkin (inout StandardVertInput attr) {\n  mat4 m = skinMatrix();\n  attr.position = m * attr.position;\n  attr.normal = (m * vec4(attr.normal, 0.0)).xyz;\n  attr.tangent.xyz = (m * vec4(attr.tangent.xyz, 0.0)).xyz;\n}\n#endif\n#if USE_INSTANCING\n  in vec4 a_matWorld0;\n  in vec4 a_matWorld1;\n  in vec4 a_matWorld2;\n  #if USE_LIGHTMAP\n    in vec4 a_lightingMapUVParam;\n  #endif\n#elif USE_BATCHING\n  in float a_dyn_batch_id;\n  layout(std140) uniform CCLocalBatched {\n    highp mat4 cc_matWorlds[10];\n  };\n#else\nlayout(std140) uniform CCLocal {\n  highp mat4 cc_matWorld;\n  highp mat4 cc_matWorldIT;\n  highp vec4 cc_lightingMapUVParam;\n};\n#endif\nlayout(std140) uniform Constants {\n  vec4 tilingOffset;\n  vec4 albedo;\n  vec4 albedoScaleAndCutoff;\n  vec4 pbrParams;\n  vec4 emissive;\n  vec4 emissiveScaleParam;\n};\nlayout(std140) uniform CCShadow {\n  highp mat4 cc_matLightPlaneProj;\n  highp mat4 cc_matLightViewProj;\n  lowp  vec4 cc_shadowColor;\n  lowp  vec4 cc_shadowInfo;\n};\n#if HAS_SECOND_UV || USE_LIGHTMAP\n  in vec2 a_texCoord1;\n#endif\nout vec2 v_uv;\nout vec2 v_uv1;\nout float v_clip_depth;\nvec4 vert () {\n  StandardVertInput In;\n  In.position = vec4(a_position, 1.0);\n  In.normal = a_normal;\n  In.tangent = a_tangent;\n  #if CC_USE_MORPH\n    applyMorph(In);\n  #endif\n  #if CC_USE_SKINNING\n    CCSkin(In);\n  #endif\n  mat4 matWorld, matWorldIT;\n  #if USE_INSTANCING\n    matWorld = mat4(\n      vec4(a_matWorld0.xyz, 0.0),\n      vec4(a_matWorld1.xyz, 0.0),\n      vec4(a_matWorld2.xyz, 0.0),\n      vec4(a_matWorld0.w, a_matWorld1.w, a_matWorld2.w, 1.0)\n    );\n    matWorldIT = matWorld;\n  #elif USE_BATCHING\n    matWorld = cc_matWorlds[int(a_dyn_batch_id)];\n    matWorldIT = matWorld;\n  #else\n    matWorld = cc_matWorld;\n    matWorldIT = cc_matWorldIT;\n  #endif\n  vec4 worldPos = matWorld * In.position;\n  vec4 clipPos = cc_matLightViewProj * worldPos;\n  v_uv = a_texCoord * tilingOffset.xy + tilingOffset.zw;\n  #if HAS_SECOND_UV\n    v_uv1 = a_texCoord1 * tilingOffset.xy + tilingOffset.zw;\n  #endif\n  v_clip_depth = clipPos.z / clipPos.w * 0.5 + 0.5;\n  return clipPos;\n}\nvoid main() { gl_Position = vert(); }",frag:"\nprecision highp float;\nlayout(std140) uniform Constants {\n  vec4 tilingOffset;\n  vec4 albedo;\n  vec4 albedoScaleAndCutoff;\n  vec4 pbrParams;\n  vec4 emissive;\n  vec4 emissiveScaleParam;\n};\nvec4 packDepthToRGBA (float depth) {\n  vec4 ret = vec4(1.0, 255.0, 65025.0, 160581375.0) * depth;\n  ret = fract(ret);\n  ret -= ret.yzww * vec4(1.0 / 255.0, 1.0 / 255.0, 1.0 / 255.0, 0.0);\n  return ret;\n}\nin vec2 v_uv;\nin vec2 v_uv1;\nin float v_clip_depth;\n#if USE_ALBEDO_MAP\n  uniform sampler2D albedoMap;\n#endif\n#if USE_ALPHA_TEST\n#endif\nvec4 frag () {\n  vec4 baseColor = albedo;\n  #if USE_ALBEDO_MAP\n    baseColor *= texture(albedoMap, ALBEDO_UV);\n  #endif\n  #if USE_ALPHA_TEST\n    if (baseColor.ALPHA_TEST_CHANNEL < albedoScaleAndCutoff.w) discard;\n  #endif\n  return packDepthToRGBA(v_clip_depth);\n}\nlayout(location = 0) out vec4 cc_FragColor;\nvoid main() { cc_FragColor = frag(); }"}],[{vert:"\nprecision mediump float;\nlayout(std140) uniform CCGlobal {\n  highp   vec4 cc_time;\n  mediump vec4 cc_screenSize;\n  mediump vec4 cc_nativeSize;\n};\nlayout(std140) uniform CCCamera {\n  highp   mat4 cc_matView;\n  highp   mat4 cc_matViewInv;\n  highp   mat4 cc_matProj;\n  highp   mat4 cc_matProjInv;\n  highp   mat4 cc_matViewProj;\n  highp   mat4 cc_matViewProjInv;\n  highp   vec4 cc_cameraPos;\n  mediump vec4 cc_screenScale;\n  mediump vec4 cc_exposure;\n  mediump vec4 cc_mainLitDir;\n  mediump vec4 cc_mainLitColor;\n  mediump vec4 cc_ambientSky;\n  mediump vec4 cc_ambientGround;\n  mediump vec4 cc_fogColor;\n  mediump vec4 cc_fogBase;\n  mediump vec4 cc_fogAdd;\n};\nlayout(std140) uniform CCLocal {\n  highp mat4 cc_matWorld;\n  highp mat4 cc_matWorldIT;\n  highp vec4 cc_lightingMapUVParam;\n};\nfloat LinearFog(vec4 pos) {\n    vec4 wPos = pos;\n    float cam_dis = distance(cc_cameraPos, wPos);\n    float fogStart = cc_fogBase.x;\n    float fogEnd = cc_fogBase.y;\n    return clamp((fogEnd - cam_dis) / (fogEnd - fogStart), 0., 1.);\n}\nfloat ExpFog(vec4 pos) {\n    vec4 wPos = pos;\n    float fogAtten = cc_fogAdd.z;\n    float fogDensity = cc_fogBase.z;\n    float cam_dis = distance(cc_cameraPos, wPos) / fogAtten * 4.;\n    float f = exp(-cam_dis * fogDensity);\n    return f;\n}\nfloat ExpSquaredFog(vec4 pos) {\n    vec4 wPos = pos;\n    float fogAtten = cc_fogAdd.z;\n    float fogDensity = cc_fogBase.z;\n    float cam_dis = distance(cc_cameraPos, wPos) / fogAtten * 4.;\n    float f = exp(-cam_dis * cam_dis * fogDensity * fogDensity);\n    return f;\n}\nfloat LayeredFog(vec4 pos) {\n    vec4 wPos = pos;\n    float fogAtten = cc_fogAdd.z;\n    float _FogTop = cc_fogAdd.x;\n    float _FogRange = cc_fogAdd.y;\n    vec3 camWorldProj = cc_cameraPos.xyz;\n    camWorldProj.y = 0.;\n    vec3 worldPosProj = wPos.xyz;\n    worldPosProj.y = 0.;\n    float fDeltaD = distance(worldPosProj, camWorldProj) / fogAtten * 2.0;\n    float fDeltaY, fDensityIntegral;\n    if (cc_cameraPos.y > _FogTop) {\n        if (wPos.y < _FogTop) {\n            fDeltaY = (_FogTop - wPos.y) / _FogRange * 2.0;\n            fDensityIntegral = fDeltaY * fDeltaY * 0.5;\n        } else {\n            fDeltaY = 0.;\n            fDensityIntegral = 0.;\n        }\n    } else {\n        if (wPos.y < _FogTop) {\n            float fDeltaA = (_FogTop - cc_cameraPos.y) / _FogRange * 2.;\n            float fDeltaB = (_FogTop - wPos.y) / _FogRange * 2.;\n            fDeltaY = abs(fDeltaA - fDeltaB);\n            fDensityIntegral = abs((fDeltaA * fDeltaA * 0.5) - (fDeltaB * fDeltaB * 0.5));\n        } else {\n            fDeltaY = abs(_FogTop - cc_cameraPos.y) / _FogRange * 2.;\n            fDensityIntegral = abs(fDeltaY * fDeltaY * 0.5);\n        }\n    }\n    float fDensity;\n    if (fDeltaY != 0.) {\n        fDensity = (sqrt(1.0 + ((fDeltaD / fDeltaY) * (fDeltaD / fDeltaY)))) * fDensityIntegral;\n    } else {\n        fDensity = 0.;\n    }\n    float f = exp(-fDensity);\n    return f;\n}\nfloat CC_TRANSFER_FOG(vec4 pos) {\n    #if CC_USE_FOG == 0\n        return LinearFog(pos);\n\t#elif CC_USE_FOG == 1\n        return ExpFog(pos);\n    #elif CC_USE_FOG == 2\n        return ExpSquaredFog(pos);\n    #elif CC_USE_FOG == 3\n        return LayeredFog(pos);\n    #endif\n    return 1.;\n}\nout highp vec4 v_shadowPos;\nlayout(std140) uniform CCShadow {\n  highp mat4 cc_matLightPlaneProj;\n  highp mat4 cc_matLightViewProj;\n  lowp  vec4 cc_shadowColor;\n  lowp  vec4 cc_shadowInfo;\n};\nin vec3 a_position;\nin vec3 a_normal;\nin vec2 a_texCoord;\nout highp vec3 v_position;\nout mediump vec3 v_normal;\n#if USE_NORMALMAP\n  out mediump vec3 v_tangent;\n  out mediump vec3 v_binormal;\n#endif\nout mediump vec2 uvw;\nout mediump vec2 uv0;\nout mediump vec2 uv1;\nout mediump vec2 uv2;\nout mediump vec2 uv3;\nout mediump vec2 luv;\nout mediump vec3 diffuse;\nout mediump float v_fog_factor;\nlayout(std140) uniform TexCoords {\n  vec4 UVScale;\n  vec4 lightMapUVParam;\n};\nvec4 vert () {\n  vec3 worldPos;\n  worldPos.x = cc_matWorld[3][0] + a_position.x;\n  worldPos.y = cc_matWorld[3][1] + a_position.y;\n  worldPos.z = cc_matWorld[3][2] + a_position.z;\n  vec4 pos = vec4(worldPos, 1.0);\n  pos = cc_matViewProj * pos;\n  uvw = a_texCoord;\n  uv0 = a_position.xz * UVScale.x;\n  uv1 = a_position.xz * UVScale.y;\n  uv2 = a_position.xz * UVScale.z;\n  uv3 = a_position.xz * UVScale.w;\n  #if USE_LIGHTMAP\n    luv = lightMapUVParam.xy + a_texCoord * lightMapUVParam.zw;\n  #endif\n  v_position = worldPos;\n  v_normal = a_normal;\n  v_fog_factor = CC_TRANSFER_FOG(vec4(worldPos, 1.0));\n  #if USE_NORMALMAP\n    v_tangent = vec3(1.0, 0.0, 0.0);\n    v_binormal = vec3(0.0, 0.0, 1.0);\n    v_binormal = cross(v_tangent, a_normal);\n    v_tangent = cross(a_normal, v_binormal);\n  #endif\n    v_shadowPos = cc_matLightViewProj * vec4(worldPos, 1.0);\n  return pos;\n}\nvoid main() { gl_Position = vert(); }",frag:"\nprecision highp float;\nlayout(std140) uniform CCGlobal {\n  highp   vec4 cc_time;\n  mediump vec4 cc_screenSize;\n  mediump vec4 cc_nativeSize;\n};\nlayout(std140) uniform CCCamera {\n  highp   mat4 cc_matView;\n  highp   mat4 cc_matViewInv;\n  highp   mat4 cc_matProj;\n  highp   mat4 cc_matProjInv;\n  highp   mat4 cc_matViewProj;\n  highp   mat4 cc_matViewProjInv;\n  highp   vec4 cc_cameraPos;\n  mediump vec4 cc_screenScale;\n  mediump vec4 cc_exposure;\n  mediump vec4 cc_mainLitDir;\n  mediump vec4 cc_mainLitColor;\n  mediump vec4 cc_ambientSky;\n  mediump vec4 cc_ambientGround;\n  mediump vec4 cc_fogColor;\n  mediump vec4 cc_fogBase;\n  mediump vec4 cc_fogAdd;\n};\nlayout(std140) uniform CCShadow {\n  highp mat4 cc_matLightPlaneProj;\n  highp mat4 cc_matLightViewProj;\n  lowp  vec4 cc_shadowColor;\n  lowp  vec4 cc_shadowInfo;\n};\n#if CC_USE_IBL\nuniform samplerCube cc_environment;\nvec3 unpackRGBE (vec4 rgbe) {\n  return rgbe.rgb * pow(2.0, rgbe.a * 255.0 - 128.0);\n}\nvec4 fragTextureLod (sampler2D tex, vec2 coord, float lod) {\n    return textureLod(tex, coord, lod);\n}\nvec4 fragTextureLod (samplerCube tex, vec3 coord, float lod) {\n    return textureLod(tex, coord, lod);\n}\n#endif\n#if CC_RECEIVE_SHADOW\nin highp vec4 v_shadowPos;\n#if CC_RECEIVE_SHADOW\n  uniform sampler2D cc_shadowMap;\n  uniform sampler2D cc_spotLightingMap;\n  float CCGetShadowFactorX1 () {\n    vec3 clipPos = v_shadowPos.xyz / v_shadowPos.w * 0.5 + 0.5;\n    if (clipPos.x < 0.0 || clipPos.x > 1.0 ||\n        clipPos.y < 0.0 || clipPos.y > 1.0 ||\n        clipPos.z <-1.0 || clipPos.z > 1.0) { return 0.0; }\n    float closestDepth = dot(texture(cc_shadowMap, clipPos.xy), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 160581375.0));\n    float shadow = step(closestDepth, clipPos.z - cc_shadowInfo.w);\n    return shadow;\n  }\n  float CCGetShadowFactorX5 () {\n    vec3 clipPos = v_shadowPos.xyz / v_shadowPos.w * 0.5 + 0.5;\n    if (clipPos.x < 0.0 || clipPos.x > 1.0 ||\n        clipPos.y < 0.0 || clipPos.y > 1.0 ||\n        clipPos.z <-1.0 || clipPos.z > 1.0) { return 0.0; }\n    float offsetx = 1.0 / cc_shadowInfo.x;\n    float offsety = 1.0 / cc_shadowInfo.y;\n    float shadow = 0.0;\n    float closestDepth = 0.0;\n    closestDepth = dot(texture(cc_shadowMap, vec2(clipPos.x - offsetx, clipPos.y - offsety)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 160581375.0));\n    shadow += step(closestDepth, clipPos.z - cc_shadowInfo.w);\n    closestDepth = dot(texture(cc_shadowMap, vec2(clipPos.x - offsetx, clipPos.y + offsety)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 160581375.0));\n    shadow += step(closestDepth, clipPos.z - cc_shadowInfo.w);\n    closestDepth = dot(texture(cc_shadowMap, vec2(clipPos.x, clipPos.y)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 160581375.0));\n    shadow += step(closestDepth, clipPos.z - cc_shadowInfo.w);\n    closestDepth = dot(texture(cc_shadowMap, vec2(clipPos.x + offsetx, clipPos.y - offsety)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 160581375.0));\n    shadow += step(closestDepth, clipPos.z - cc_shadowInfo.w);\n    closestDepth = dot(texture(cc_shadowMap, vec2(clipPos.x + offsetx, clipPos.y + offsety)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 160581375.0));\n    shadow += step(closestDepth, clipPos.z - cc_shadowInfo.w);\n    return shadow / 5.0;\n  }\n  float CCGetShadowFactorX9 () {\n    vec3 clipPos = v_shadowPos.xyz / v_shadowPos.w * 0.5 + 0.5;\n    if (clipPos.x < 0.0 || clipPos.x > 1.0 ||\n        clipPos.y < 0.0 || clipPos.y > 1.0 ||\n        clipPos.z <-1.0 || clipPos.z > 1.0) { return 0.0; }\n    float offsetx = 1.0 / cc_shadowInfo.x;\n    float offsety = 1.0 / cc_shadowInfo.y;\n    float shadow = 0.0;\n    for (int i = -1; i <= 1; i++) {\n      for (int j = -1; j <= 1; j++) {\n        float closestDepth = dot(texture(cc_shadowMap, clipPos.xy + vec2(i, j) * vec2(offsetx, offsety)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 160581375.0));\n        shadow += step(closestDepth, clipPos.z - cc_shadowInfo.w);\n      }\n    }\n    return shadow / 9.0;\n  }\n  float CCGetShadowFactorX25 () {\n    vec3 clipPos = v_shadowPos.xyz / v_shadowPos.w * 0.5 + 0.5;\n    if (clipPos.x < 0.0 || clipPos.x > 1.0 ||\n        clipPos.y < 0.0 || clipPos.y > 1.0 ||\n        clipPos.z <-1.0 || clipPos.z > 1.0) { return 0.0; }\n    float offsetx = 1.0 / cc_shadowInfo.x;\n    float offsety = 1.0 / cc_shadowInfo.y;\n    float shadow = 0.0;\n    for (int i = -2; i <= 2; i++) {\n      for (int j = -2; j <= 2; j++) {\n        float closestDepth = dot(texture(cc_shadowMap, clipPos.xy + vec2(i, j) * vec2(offsetx, offsety)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 160581375.0));\n        shadow += step(closestDepth, clipPos.z - cc_shadowInfo.w);\n      }\n    }\n    return shadow / 25.0;\n  }\n  float CCGetDirLightShadowFactorX1 () {\n    vec3 clipPos = v_shadowPos.xyz / v_shadowPos.w * 0.5 + 0.5;\n    if (clipPos.x < 0.0 || clipPos.x > 1.0 ||\n        clipPos.y < 0.0 || clipPos.y > 1.0 ||\n        clipPos.z <-1.0 || clipPos.z > 1.0) { return 0.0; }\n    float closestDepth = dot(texture(cc_spotLightingMap, clipPos.xy), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 160581375.0));\n    float shadow = step(closestDepth, clipPos.z - cc_shadowInfo.w);\n    return shadow;\n  }\n  float CCGetDirLightShadowFactorX5 () {\n    vec3 clipPos = v_shadowPos.xyz / v_shadowPos.w * 0.5 + 0.5;\n    if (clipPos.x < 0.0 || clipPos.x > 1.0 ||\n        clipPos.y < 0.0 || clipPos.y > 1.0 ||\n        clipPos.z <-1.0 || clipPos.z > 1.0) { return 0.0; }\n    float offsetx = 1.0 / cc_shadowInfo.x;\n    float offsety = 1.0 / cc_shadowInfo.y;\n    float shadow = 0.0;\n    float closestDepth = 0.0;\n    closestDepth = dot(texture(cc_spotLightingMap, vec2(clipPos.x - offsetx, clipPos.y - offsety)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 160581375.0));\n    shadow += step(closestDepth, clipPos.z - cc_shadowInfo.w);\n    closestDepth = dot(texture(cc_spotLightingMap, vec2(clipPos.x - offsetx, clipPos.y + offsety)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 160581375.0));\n    shadow += step(closestDepth, clipPos.z - cc_shadowInfo.w);\n    closestDepth = dot(texture(cc_spotLightingMap, vec2(clipPos.x, clipPos.y)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 160581375.0));\n    shadow += step(closestDepth, clipPos.z - cc_shadowInfo.w);\n    closestDepth = dot(texture(cc_spotLightingMap, vec2(clipPos.x + offsetx, clipPos.y - offsety)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 160581375.0));\n    shadow += step(closestDepth, clipPos.z - cc_shadowInfo.w);\n    closestDepth = dot(texture(cc_spotLightingMap, vec2(clipPos.x + offsetx, clipPos.y + offsety)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 160581375.0));\n    return shadow / 5.0;\n  }\n  float CCGetDirLightShadowFactorX9 () {\n    vec3 clipPos = v_shadowPos.xyz / v_shadowPos.w * 0.5 + 0.5;\n    if (clipPos.x < 0.0 || clipPos.x > 1.0 ||\n        clipPos.y < 0.0 || clipPos.y > 1.0 ||\n        clipPos.z <-1.0 || clipPos.z > 1.0) { return 0.0; }\n    float offsetx = 1.0 / cc_shadowInfo.x;\n    float offsety = 1.0 / cc_shadowInfo.y;\n    float shadow = 0.0;\n    for (int i = -1; i <= 1; i++) {\n      for (int j = -1; j <= 1; j++) {\n        float closestDepth = dot(texture(cc_spotLightingMap, clipPos.xy + vec2(i, j) * vec2(offsetx, offsety)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 160581375.0));\n        shadow += step(closestDepth, clipPos.z - cc_shadowInfo.w);\n      }\n    }\n    return shadow / 9.0;\n  }\n  float CCGetDirLightShadowFactorX25 () {\n    vec3 clipPos = v_shadowPos.xyz / v_shadowPos.w * 0.5 + 0.5;\n    if (clipPos.x < 0.0 || clipPos.x > 1.0 ||\n        clipPos.y < 0.0 || clipPos.y > 1.0 ||\n        clipPos.z <-1.0 || clipPos.z > 1.0) { return 0.0; }\n    float offsetx = 1.0 / cc_shadowInfo.x;\n    float offsety = 1.0 / cc_shadowInfo.y;\n    float shadow = 0.0;\n    for (int i = -2; i <= 2; i++) {\n      for (int j = -2; j <= 2; j++) {\n        float closestDepth = dot(texture(cc_spotLightingMap, clipPos.xy + vec2(i, j) * vec2(offsetx, offsety)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 160581375.0));\n        shadow += step(closestDepth, clipPos.z - cc_shadowInfo.w);\n      }\n    }\n    return shadow / 25.0;\n  }\n#endif\n#endif\nvec3 SRGBToLinear (vec3 gamma) {\n  return gamma * gamma;\n}\nfloat GGXMobile (float roughness, float NoH, vec3 H, vec3 N) {\n  vec3 NxH = cross(N, H);\n  float OneMinusNoHSqr = dot(NxH, NxH);\n  float a = roughness * roughness;\n  float n = NoH * a;\n  float p = a / (OneMinusNoHSqr + n * n);\n  return p * p;\n}\nfloat CalcSpecular (float roughness, float NoH, vec3 H, vec3 N) {\n  return (roughness*0.25 + 0.25) * GGXMobile(roughness, NoH, H, N);\n}\nvec3 BRDFApprox (vec3 specular, float roughness, float NoV) {\n  const vec4 c0 = vec4(-1.0, -0.0275, -0.572, 0.022);\n  const vec4 c1 = vec4(1.0, 0.0425, 1.04, -0.04);\n  vec4 r = roughness * c0 + c1;\n  float a004 = min( r.x * r.x, exp2( -9.28 * NoV ) ) * r.x + r.y;\n  vec2 AB = vec2( -1.04, 1.04 ) * a004 + r.zw;\n  AB.y *= clamp(50.0 * specular.g, 0.0, 1.0);\n  return specular * AB.x + AB.y;\n}\nstruct StandardSurface {\n  vec4 albedo;\n  vec3 position;\n  vec3 normal;\n  vec3 emissive;\n  vec4 lightmap;\n  float roughness;\n  float metallic;\n  float occlusion;\n};\n#if CC_FORWARD_ADD\nlayout(std140) uniform CCForwardLight {\n  highp vec4 cc_lightPos[1];\n  vec4 cc_lightColor[1];\n  vec4 cc_lightSizeRangeAngle[1];\n  vec4 cc_lightDir[1];\n};\nfloat SmoothDistAtt (float distSqr, float invSqrAttRadius) {\n  float factor = distSqr * invSqrAttRadius;\n  float smoothFactor = clamp(1.0 - factor * factor, 0.0, 1.0);\n  return smoothFactor * smoothFactor;\n}\nfloat GetDistAtt (float distSqr, float invSqrAttRadius) {\n  float attenuation = 1.0 / max(distSqr, 0.01*0.01);\n  attenuation *= SmoothDistAtt(distSqr , invSqrAttRadius);\n  return attenuation;\n}\nfloat GetAngleAtt (vec3 L, vec3 litDir, float litAngleScale, float litAngleOffset) {\n  float cd = dot(litDir, L);\n  float attenuation = clamp(cd * litAngleScale + litAngleOffset, 0.0, 1.0);\n  return (attenuation * attenuation);\n}\n  vec4 CCStandardShading (StandardSurface s) {\n    vec3 diffuse = s.albedo.rgb * (1.0 - s.metallic);\n    vec3 specular = mix(vec3(0.04), s.albedo.rgb, s.metallic);\n    vec3 diffuseContrib = diffuse / 3.14159265359;\n    vec3 N = normalize(s.normal);\n    vec3 V = normalize(cc_cameraPos.xyz - s.position);\n    float NV = max(abs(dot(N, V)), 0.001);\n    specular = BRDFApprox(specular, s.roughness, NV);\n    vec3 finalColor = vec3(0.0);\n    for (int i = 0; i < 1; i++) {\n      vec3 SLU = cc_lightPos[i].xyz - s.position;\n      vec3 SL = normalize(SLU);\n      vec3 SH = normalize(SL + V);\n      float SNL = max(dot(N, SL), 0.001);\n      float SNH = max(dot(N, SH), 0.0);\n      float distSqr = dot(SLU, SLU);\n      float litRadius = cc_lightSizeRangeAngle[i].x;\n      float litRadiusSqr = litRadius * litRadius;\n      float illum = 3.14159265359 * (litRadiusSqr / max(litRadiusSqr , distSqr));\n      float attRadiusSqrInv = 1.0 / max(cc_lightSizeRangeAngle[i].y, 0.01);\n      attRadiusSqrInv *= attRadiusSqrInv;\n      float att = GetDistAtt(distSqr, attRadiusSqrInv);\n      vec3 lspec = specular * CalcSpecular(s.roughness, SNH, SH, N);\n      if (cc_lightPos[i].w > 0.0) {\n        float cosInner = max(dot(-cc_lightDir[i].xyz, SL), 0.01);\n        float cosOuter = cc_lightSizeRangeAngle[i].z;\n        float litAngleScale = 1.0 / max(0.001, cosInner - cosOuter);\n        float litAngleOffset = -cosOuter * litAngleScale;\n        att *= GetAngleAtt(SL, -cc_lightDir[i].xyz, litAngleScale, litAngleOffset);\n      }\n      vec3 lightColor = cc_lightColor[i].rgb;\n    #if CC_RECEIVE_SHADOW\n      if (cc_lightPos[i].w > 0.0) {\n    {\n      float pcf = cc_shadowInfo.z + 0.001;\n      float shadowAttenuation = 0.0;\n      if (pcf > 3.0) shadowAttenuation = CCGetDirLightShadowFactorX25();\n      else if (3.0 > pcf && pcf > 2.0) shadowAttenuation = CCGetDirLightShadowFactorX9();\n      else if (2.0 > pcf && pcf > 1.0) shadowAttenuation = CCGetDirLightShadowFactorX5();\n      else shadowAttenuation = CCGetDirLightShadowFactorX1();\n      lightColor *= 1.0 - shadowAttenuation;\n    }\n      }\n    #endif\n      finalColor += SNL * lightColor * cc_lightColor[i].w * illum * att * (diffuseContrib + lspec);\n    }\n    finalColor = finalColor * s.occlusion;\n    return vec4(finalColor, 0.0);\n  }\n#else\n  vec4 CCStandardShading (StandardSurface s) {\n    vec3 diffuse = s.albedo.rgb * (1.0 - s.metallic);\n    vec3 specular = mix(vec3(0.04), s.albedo.rgb, s.metallic);\n    vec3 N = normalize(s.normal);\n    vec3 V = normalize(cc_cameraPos.xyz - s.position);\n    float NV = max(abs(dot(N, V)), 0.001);\n    specular = BRDFApprox(specular, s.roughness, NV);\n    vec3 L = normalize(-cc_mainLitDir.xyz);\n    vec3 H = normalize(L+V);\n    float NH = max(dot(N, H), 0.0);\n    float NL = max(dot(N, L), 0.001);\n    vec3 finalColor = NL * cc_mainLitColor.rgb * cc_mainLitColor.w;\n    #if USE_LIGHTMAP && !USE_BATCHING && !CC_FORWARD_ADD\n      finalColor = s.lightmap.a * s.lightmap.rgb + (1.0 - s.lightmap.a) * finalColor;\n    #endif\n    vec3 diffuseContrib = diffuse / 3.14159265359;\n    vec3 specularContrib = specular * CalcSpecular(s.roughness, NH, H, N);\n    finalColor *= (diffuseContrib + specularContrib);\n    float fAmb = 0.5 - N.y * 0.5;\n    vec3 ambDiff = mix(cc_ambientSky.rgb, cc_ambientGround.rgb, fAmb) * cc_ambientSky.w;\n    finalColor += (ambDiff.rgb * diffuse);\n    #if CC_USE_IBL\n      vec3 R = normalize(reflect(-V, N));\n      vec4 envmap = fragTextureLod(cc_environment, R, s.roughness * cc_ambientGround.w);\n      #if CC_USE_IBL == 2\n        vec3 env = unpackRGBE(envmap);\n      #else\n        vec3 env = SRGBToLinear(envmap.rgb);\n      #endif\n      finalColor += env * cc_ambientSky.w * specular;\n    #endif\n    finalColor = finalColor * s.occlusion;\n    #if CC_USE_HDR\n      s.emissive *= cc_exposure.w;\n    #endif\n    finalColor += s.emissive;\n    #if CC_RECEIVE_SHADOW\n    {\n      float pcf = cc_shadowInfo.z + 0.001;\n      float shadowAttenuation = 0.0;\n      if (pcf > 3.0) shadowAttenuation = CCGetShadowFactorX25();\n      else if (3.0 > pcf && pcf > 2.0) shadowAttenuation = CCGetShadowFactorX9();\n      else if (2.0 > pcf && pcf > 1.0) shadowAttenuation = CCGetShadowFactorX5();\n      else shadowAttenuation = CCGetShadowFactorX1();\n      vec3 shadowColor = cc_shadowColor.rgb * cc_shadowColor.a + finalColor.rgb * (1.0 - cc_shadowColor.a);\n      finalColor.rgb = shadowColor.rgb * shadowAttenuation * NL + finalColor.rgb * (1.0 - shadowAttenuation * NL);\n    }\n    #endif\n    return vec4(finalColor, s.albedo.a);\n  }\n#endif\nvec3 ACESToneMap (vec3 color) {\n  color = min(color, vec3(8.0));\n  const float A = 2.51;\n  const float B = 0.03;\n  const float C = 2.43;\n  const float D = 0.59;\n  const float E = 0.14;\n  return (color * (A * color + B)) / (color * (C * color + D) + E);\n}\nvec4 CCFragOutput (vec4 color) {\n  #if !CC_USE_HDR\n    color.rgb = sqrt(ACESToneMap(color.rgb));\n  #endif\n  return color;\n}\nin highp vec3 v_position;\nin mediump vec3 v_normal;\n#if USE_NORMALMAP\n  in mediump vec3 v_tangent;\n  in mediump vec3 v_binormal;\n#endif\nin mediump vec2 uvw;\nin mediump vec2 uv0;\nin mediump vec2 uv1;\nin mediump vec2 uv2;\nin mediump vec2 uv3;\nin mediump vec3 diffuse;\nin mediump vec2 luv;\nin mediump float v_fog_factor;\nlayout(std140) uniform PbrParams {\n  vec4 metallic;\n  vec4 roughness;\n};\nuniform sampler2D weightMap;\nuniform sampler2D detailMap0;\nuniform sampler2D detailMap1;\nuniform sampler2D detailMap2;\nuniform sampler2D detailMap3;\nuniform sampler2D normalMap0;\nuniform sampler2D normalMap1;\nuniform sampler2D normalMap2;\nuniform sampler2D normalMap3;\nuniform sampler2D lightMap;\nvoid surf (out StandardSurface s) {\n  #if LAYERS > 1\n    vec4 w = texture(weightMap, uvw);\n  #endif\n  vec4 baseColor = vec4(0, 0, 0, 0);\n  #if LAYERS == 1\n    baseColor = texture(detailMap0, uv0);\n  #elif LAYERS == 2\n    baseColor += texture(detailMap0, uv0) * w.r;\n    baseColor += texture(detailMap1, uv1) * w.g;\n  #elif LAYERS == 3\n    baseColor += texture(detailMap0, uv0) * w.r;\n    baseColor += texture(detailMap1, uv1) * w.g;\n    baseColor += texture(detailMap2, uv2) * w.b;\n  #elif LAYERS == 4\n    baseColor += texture(detailMap0, uv0) * w.r;\n    baseColor += texture(detailMap1, uv1) * w.g;\n    baseColor += texture(detailMap2, uv2) * w.b;\n    baseColor += texture(detailMap3, uv3) * w.a;\n  #else\n    baseColor = texture(detailMap0, uv0);\n  #endif\n  s.position = v_position;\n  #if USE_NORMALMAP\n    vec4 baseNormal = vec4(0, 0, 0, 0);\n    #if LAYERS == 1\n      baseNormal = texture(normalMap0, uv0);\n    #elif LAYERS == 2\n      baseNormal += texture(normalMap0, uv0) * w.r;\n      baseNormal += texture(normalMap1, uv1) * w.g;\n    #elif LAYERS == 3\n      baseNormal += texture(normalMap0, uv0) * w.r;\n      baseNormal += texture(normalMap1, uv1) * w.g;\n      baseNormal += texture(normalMap2, uv2) * w.b;\n    #elif LAYERS == 4\n      baseNormal += texture(normalMap0, uv0) * w.r;\n      baseNormal += texture(normalMap1, uv1) * w.g;\n      baseNormal += texture(normalMap2, uv2) * w.b;\n      baseNormal += texture(normalMap3, uv3) * w.a;\n    #else\n      baseNormal = texture(normalMap0, uv0);\n    #endif\n    vec3 nmmp = baseNormal.xyz - vec3(0.5);\n    s.normal =\n      nmmp.x * normalize(v_tangent) +\n      nmmp.y * normalize(v_binormal) +\n      nmmp.z * normalize(v_normal);\n  #else\n    s.normal = v_normal;\n  #endif\n  s.albedo = vec4(SRGBToLinear(baseColor.rgb), 1.0);\n  s.occlusion = 1.0;\n  #if USE_PBR\n    s.roughness = 0.0;\n    #if LAYERS == 1\n      s.roughness = roughness.x;\n    #elif LAYERS == 2\n      s.roughness += roughness.x * w.r;\n      s.roughness += roughness.y * w.g;\n    #elif LAYERS == 3\n      s.roughness += roughness.x * w.r;\n      s.roughness += roughness.y * w.g;\n      s.roughness += roughness.z * w.b;\n    #elif LAYERS == 4\n      s.roughness += roughness.x * w.r;\n      s.roughness += roughness.y * w.g;\n      s.roughness += roughness.z * w.b;\n      s.roughness += roughness.w * w.a;\n    #else\n      s.roughness = 1.0;\n    #endif\n    s.metallic = 0.0;\n    #if LAYERS == 1\n      s.metallic = metallic.x;\n    #elif LAYERS == 2\n      s.metallic += metallic.x * w.r;\n      s.metallic += metallic.y * w.g;\n    #elif LAYERS == 3\n      s.metallic += metallic.x * w.r;\n      s.metallic += metallic.y * w.g;\n      s.metallic += metallic.z * w.b;\n    #elif LAYERS == 4\n      s.metallic += metallic.x * w.r;\n      s.metallic += metallic.y * w.g;\n      s.metallic += metallic.z * w.b;\n      s.metallic += metallic.w * w.a;\n    #else\n      s.metallic = 0.0;\n    #endif\n  #else\n    s.roughness = 1.0;\n    s.metallic = 0.0;\n  #endif\n  s.emissive = vec3(0.0, 0.0, 0.0);\n  #if USE_LIGHTMAP && !USE_BATCHING && !CC_FORWARD_ADD\n    s.lightmap = texture(lightMap, luv);\n  #else\n    s.lightmap = vec4(0.0, 0.0, 0.0, 0.0);\n  #endif\n}\nvec4 frag () {\n  StandardSurface s; surf(s);\n  vec4 color = CCStandardShading(s);\n  color = vec4(mix(CC_FORWARD_ADD > 0 ? vec3(0.0) : cc_fogColor.rgb, color.rgb, v_fog_factor), color.a);\n  return CCFragOutput(color);\n}\nlayout(location = 0) out vec4 cc_FragColor;\nvoid main() { cc_FragColor = frag(); }"},{vert:"\nprecision highp float;\nlayout(std140) uniform CCGlobal {\n  highp   vec4 cc_time;\n  mediump vec4 cc_screenSize;\n  mediump vec4 cc_nativeSize;\n};\nlayout(std140) uniform CCCamera {\n  highp   mat4 cc_matView;\n  highp   mat4 cc_matViewInv;\n  highp   mat4 cc_matProj;\n  highp   mat4 cc_matProjInv;\n  highp   mat4 cc_matViewProj;\n  highp   mat4 cc_matViewProjInv;\n  highp   vec4 cc_cameraPos;\n  mediump vec4 cc_screenScale;\n  mediump vec4 cc_exposure;\n  mediump vec4 cc_mainLitDir;\n  mediump vec4 cc_mainLitColor;\n  mediump vec4 cc_ambientSky;\n  mediump vec4 cc_ambientGround;\n  mediump vec4 cc_fogColor;\n  mediump vec4 cc_fogBase;\n  mediump vec4 cc_fogAdd;\n};\nlayout(std140) uniform CCLocal {\n  highp mat4 cc_matWorld;\n  highp mat4 cc_matWorldIT;\n  highp vec4 cc_lightingMapUVParam;\n};\nlayout(std140) uniform CCShadow {\n  highp mat4 cc_matLightPlaneProj;\n  highp mat4 cc_matLightViewProj;\n  lowp  vec4 cc_shadowColor;\n  lowp  vec4 cc_shadowInfo;\n};\nin vec3 a_position;\nin vec3 a_normal;\nin vec2 a_texCoord;\nout vec2 v_clip_depth;\nvec4 vert () {\n  vec4 worldPos;\n  worldPos.x = cc_matWorld[3][0] + a_position.x;\n  worldPos.y = cc_matWorld[3][1] + a_position.y;\n  worldPos.z = cc_matWorld[3][2] + a_position.z;\n  worldPos.w = 1.0;\n  vec4 clipPos = cc_matLightViewProj * worldPos;\n  v_clip_depth = clipPos.zw;\n  return clipPos;\n}\nvoid main() { gl_Position = vert(); }",frag:"\nprecision highp float;\nvec4 packDepthToRGBA (float depth) {\n  vec4 ret = vec4(1.0, 255.0, 65025.0, 160581375.0) * depth;\n  ret = fract(ret);\n  ret -= ret.yzww * vec4(1.0 / 255.0, 1.0 / 255.0, 1.0 / 255.0, 0.0);\n  return ret;\n}\nin vec2 v_clip_depth;\nvec4 frag () {\n  return packDepthToRGBA(v_clip_depth.x / v_clip_depth.y * 0.5 + 0.5);\n}\nlayout(location = 0) out vec4 cc_FragColor;\nvoid main() { cc_FragColor = frag(); }"}],[{vert:"\nprecision highp float;\nhighp float decode32 (highp vec4 rgba) {\n  rgba = rgba * 255.0;\n  highp float Sign = 1.0 - (step(128.0, (rgba[3]) + 0.5)) * 2.0;\n  highp float Exponent = 2.0 * (mod(float(int((rgba[3]) + 0.5)), 128.0)) + (step(128.0, (rgba[2]) + 0.5)) - 127.0;\n  highp float Mantissa = (mod(float(int((rgba[2]) + 0.5)), 128.0)) * 65536.0 + rgba[1] * 256.0 + rgba[0] + 8388608.0;\n  return Sign * exp2(Exponent - 23.0) * Mantissa;\n}\nstruct StandardVertInput {\n  highp vec4 position;\n  vec3 normal;\n  vec4 tangent;\n};\nin vec3 a_position;\nin vec3 a_normal;\nin vec2 a_texCoord;\nin vec4 a_tangent;\n#if CC_USE_MORPH\n    in float a_vertexId;\n    int getVertexId() {\n        return int(a_vertexId);\n    }\nlayout(std140) uniform CCMorph {\n    vec4 cc_displacementWeights[15];\n    vec4 cc_displacementTextureInfo;\n};\nvec2 getPixelLocation(vec2 textureResolution, int pixelIndex) {\n    float pixelIndexF = float(pixelIndex);\n    float x = mod(pixelIndexF, textureResolution.x);\n    float y = floor(pixelIndexF / textureResolution.x);\n    return vec2(x, y);\n}\nvec2 getPixelCoordFromLocation(vec2 location, vec2 textureResolution) {\n    return (vec2(location.x, location.y) + .5) / textureResolution;\n}\n#if CC_SUPPORT_FLOAT_TEXTURE\n        vec4 fetchVec3ArrayFromTexture(sampler2D tex, int pixelIndex) {\n            ivec2 texSize = textureSize(tex, 0);\n            return texelFetch(tex, ivec2(pixelIndex % texSize.x, pixelIndex / texSize.x), 0);\n        }\n#else\n    vec4 fetchVec3ArrayFromTexture(sampler2D tex, int elementIndex) {\n        int pixelIndex = elementIndex * 4;\n        vec2 location = getPixelLocation(cc_displacementTextureInfo.xy, pixelIndex);\n        vec2 x = getPixelCoordFromLocation(location + vec2(0.0, 0.0), cc_displacementTextureInfo.xy);\n        vec2 y = getPixelCoordFromLocation(location + vec2(1.0, 0.0), cc_displacementTextureInfo.xy);\n        vec2 z = getPixelCoordFromLocation(location + vec2(2.0, 0.0), cc_displacementTextureInfo.xy);\n        return vec4(\n            decode32(texture(tex, x)),\n            decode32(texture(tex, y)),\n            decode32(texture(tex, z)),\n            1.0\n        );\n    }\n#endif\nfloat getDisplacementWeight(int index) {\n    int quot = index / 4;\n    int remainder = index - quot * 4;\n    if (remainder == 0) {\n        return cc_displacementWeights[quot].x;\n    } else if (remainder == 1) {\n        return cc_displacementWeights[quot].y;\n    } else if (remainder == 2) {\n        return cc_displacementWeights[quot].z;\n    } else {\n        return cc_displacementWeights[quot].w;\n    }\n}\nvec3 getVec3DisplacementFromTexture(sampler2D tex, int vertexIndex) {\n#if CC_MORPH_PRECOMPUTED\n    return fetchVec3ArrayFromTexture(tex, vertexIndex).rgb;\n#else\n    vec3 result = vec3(0, 0, 0);\n    int nVertices = int(cc_displacementTextureInfo.z);\n    for (int iTarget = 0; iTarget < CC_MORPH_TARGET_COUNT; ++iTarget) {\n        result += (fetchVec3ArrayFromTexture(tex, nVertices * iTarget + vertexIndex).rgb * getDisplacementWeight(iTarget));\n    }\n    return result;\n#endif\n}\n#if CC_MORPH_TARGET_HAS_POSITION\n    uniform sampler2D cc_PositionDisplacements;\n    vec3 getPositionDisplacement(int vertexId) {\n        return getVec3DisplacementFromTexture(cc_PositionDisplacements, vertexId);\n    }\n#endif\n#if CC_MORPH_TARGET_HAS_NORMAL\n    uniform sampler2D cc_NormalDisplacements;\n    vec3 getNormalDisplacement(int vertexId) {\n        return getVec3DisplacementFromTexture(cc_NormalDisplacements, vertexId);\n    }\n#endif\n#if CC_MORPH_TARGET_HAS_TANGENT\n    uniform sampler2D cc_TangentDisplacements;\n    vec3 getTangentDisplacement(int vertexId) {\n        return getVec3DisplacementFromTexture(cc_TangentDisplacements, vertexId);\n    }\n#endif\nvoid applyMorph (inout StandardVertInput attr) {\n    int vertexId = getVertexId();\n#if CC_MORPH_TARGET_HAS_POSITION\n    attr.position.xyz = attr.position.xyz + getPositionDisplacement(vertexId);\n#endif\n#if CC_MORPH_TARGET_HAS_NORMAL\n    attr.normal.xyz = attr.normal.xyz + getNormalDisplacement(vertexId);\n#endif\n#if CC_MORPH_TARGET_HAS_TANGENT\n    attr.tangent.xyz = attr.tangent.xyz + getTangentDisplacement(vertexId);\n#endif\n}\nvoid applyMorph (inout vec4 position) {\n#if CC_MORPH_TARGET_HAS_POSITION\n    position.xyz = position.xyz + getPositionDisplacement(getVertexId());\n#endif\n}\n#endif\n#if CC_USE_SKINNING\n  in vec4 a_joints;\nin vec4 a_weights;\n#if CC_USE_BAKED_ANIMATION\n  #if USE_INSTANCING\n    in highp vec4 a_jointAnimInfo;\n  #endif\n  layout(std140) uniform CCSkinningTexture {\n    highp vec4 cc_jointTextureInfo;\n  };\n  layout(std140) uniform CCSkinningAnimation {\n    highp vec4 cc_jointAnimInfo;\n  };\n  uniform highp sampler2D cc_jointTexture;\n  #else\n  layout(std140) uniform CCSkinning {\n    highp vec4 cc_joints[30 * 3];\n  };\n#endif\n#if CC_USE_BAKED_ANIMATION\n  #if CC_SUPPORT_FLOAT_TEXTURE\n    mat4 getJointMatrix (float i) {\n    #if USE_INSTANCING\n      highp float j = 3.0 * (a_jointAnimInfo.x * a_jointAnimInfo.y + i) + a_jointAnimInfo.z;\n    #else\n      highp float j = 3.0 * (cc_jointAnimInfo.x * cc_jointTextureInfo.y + i) + cc_jointTextureInfo.z;\n    #endif\n    highp float invSize = cc_jointTextureInfo.w;\n    highp float y = floor(j * invSize);\n    highp float x = j - y * cc_jointTextureInfo.x;\n    y = (y + 0.5) * invSize;\n      vec4 v1 = texture(cc_jointTexture, vec2((x + 0.5) * invSize, y));\n      vec4 v2 = texture(cc_jointTexture, vec2((x + 1.5) * invSize, y));\n      vec4 v3 = texture(cc_jointTexture, vec2((x + 2.5) * invSize, y));\n      return mat4(vec4(v1.xyz, 0.0), vec4(v2.xyz, 0.0), vec4(v3.xyz, 0.0), vec4(v1.w, v2.w, v3.w, 1.0));\n    }\n  #else\n    mat4 getJointMatrix (float i) {\n    #if USE_INSTANCING\n      highp float j = 12.0 * (a_jointAnimInfo.x * a_jointAnimInfo.y + i) + a_jointAnimInfo.z;\n    #else\n      highp float j = 12.0 * (cc_jointAnimInfo.x * cc_jointTextureInfo.y + i) + cc_jointTextureInfo.z;\n    #endif\n    highp float invSize = cc_jointTextureInfo.w;\n    highp float y = floor(j * invSize);\n    highp float x = j - y * cc_jointTextureInfo.x;\n    y = (y + 0.5) * invSize;\n      vec4 v1 = vec4(\n        decode32(texture(cc_jointTexture, vec2((x + 0.5) * invSize, y))),\n        decode32(texture(cc_jointTexture, vec2((x + 1.5) * invSize, y))),\n        decode32(texture(cc_jointTexture, vec2((x + 2.5) * invSize, y))),\n        decode32(texture(cc_jointTexture, vec2((x + 3.5) * invSize, y)))\n      );\n      vec4 v2 = vec4(\n        decode32(texture(cc_jointTexture, vec2((x + 4.5) * invSize, y))),\n        decode32(texture(cc_jointTexture, vec2((x + 5.5) * invSize, y))),\n        decode32(texture(cc_jointTexture, vec2((x + 6.5) * invSize, y))),\n        decode32(texture(cc_jointTexture, vec2((x + 7.5) * invSize, y)))\n      );\n      vec4 v3 = vec4(\n        decode32(texture(cc_jointTexture, vec2((x + 8.5) * invSize, y))),\n        decode32(texture(cc_jointTexture, vec2((x + 9.5) * invSize, y))),\n        decode32(texture(cc_jointTexture, vec2((x + 10.5) * invSize, y))),\n        decode32(texture(cc_jointTexture, vec2((x + 11.5) * invSize, y)))\n      );\n      return mat4(vec4(v1.xyz, 0.0), vec4(v2.xyz, 0.0), vec4(v3.xyz, 0.0), vec4(v1.w, v2.w, v3.w, 1.0));\n    }\n  #endif\n#else\n  mat4 getJointMatrix (float i) {\n    int idx = int(i);\n    vec4 v1 = cc_joints[idx * 3];\n    vec4 v2 = cc_joints[idx * 3 + 1];\n    vec4 v3 = cc_joints[idx * 3 + 2];\n    return mat4(vec4(v1.xyz, 0.0), vec4(v2.xyz, 0.0), vec4(v3.xyz, 0.0), vec4(v1.w, v2.w, v3.w, 1.0));\n  }\n#endif\nmat4 skinMatrix () {\n  vec4 joints = vec4(a_joints);\n  return getJointMatrix(joints.x) * a_weights.x\n       + getJointMatrix(joints.y) * a_weights.y\n       + getJointMatrix(joints.z) * a_weights.z\n       + getJointMatrix(joints.w) * a_weights.w;\n}\nvoid CCSkin (inout vec4 position) {\n  mat4 m = skinMatrix();\n  position = m * position;\n}\nvoid CCSkin (inout StandardVertInput attr) {\n  mat4 m = skinMatrix();\n  attr.position = m * attr.position;\n  attr.normal = (m * vec4(attr.normal, 0.0)).xyz;\n  attr.tangent.xyz = (m * vec4(attr.tangent.xyz, 0.0)).xyz;\n}\n#endif\nlayout(std140) uniform CCGlobal {\n  highp   vec4 cc_time;\n  mediump vec4 cc_screenSize;\n  mediump vec4 cc_nativeSize;\n};\nlayout(std140) uniform CCCamera {\n  highp   mat4 cc_matView;\n  highp   mat4 cc_matViewInv;\n  highp   mat4 cc_matProj;\n  highp   mat4 cc_matProjInv;\n  highp   mat4 cc_matViewProj;\n  highp   mat4 cc_matViewProjInv;\n  highp   vec4 cc_cameraPos;\n  mediump vec4 cc_screenScale;\n  mediump vec4 cc_exposure;\n  mediump vec4 cc_mainLitDir;\n  mediump vec4 cc_mainLitColor;\n  mediump vec4 cc_ambientSky;\n  mediump vec4 cc_ambientGround;\n  mediump vec4 cc_fogColor;\n  mediump vec4 cc_fogBase;\n  mediump vec4 cc_fogAdd;\n};\n#if USE_INSTANCING\n  in vec4 a_matWorld0;\n  in vec4 a_matWorld1;\n  in vec4 a_matWorld2;\n  #if USE_LIGHTMAP\n    in vec4 a_lightingMapUVParam;\n  #endif\n#elif USE_BATCHING\n  in float a_dyn_batch_id;\n  layout(std140) uniform CCLocalBatched {\n    highp mat4 cc_matWorlds[10];\n  };\n#else\nlayout(std140) uniform CCLocal {\n  highp mat4 cc_matWorld;\n  highp mat4 cc_matWorldIT;\n  highp vec4 cc_lightingMapUVParam;\n};\n#endif\nfloat LinearFog(vec4 pos) {\n    vec4 wPos = pos;\n    float cam_dis = distance(cc_cameraPos, wPos);\n    float fogStart = cc_fogBase.x;\n    float fogEnd = cc_fogBase.y;\n    return clamp((fogEnd - cam_dis) / (fogEnd - fogStart), 0., 1.);\n}\nfloat ExpFog(vec4 pos) {\n    vec4 wPos = pos;\n    float fogAtten = cc_fogAdd.z;\n    float fogDensity = cc_fogBase.z;\n    float cam_dis = distance(cc_cameraPos, wPos) / fogAtten * 4.;\n    float f = exp(-cam_dis * fogDensity);\n    return f;\n}\nfloat ExpSquaredFog(vec4 pos) {\n    vec4 wPos = pos;\n    float fogAtten = cc_fogAdd.z;\n    float fogDensity = cc_fogBase.z;\n    float cam_dis = distance(cc_cameraPos, wPos) / fogAtten * 4.;\n    float f = exp(-cam_dis * cam_dis * fogDensity * fogDensity);\n    return f;\n}\nfloat LayeredFog(vec4 pos) {\n    vec4 wPos = pos;\n    float fogAtten = cc_fogAdd.z;\n    float _FogTop = cc_fogAdd.x;\n    float _FogRange = cc_fogAdd.y;\n    vec3 camWorldProj = cc_cameraPos.xyz;\n    camWorldProj.y = 0.;\n    vec3 worldPosProj = wPos.xyz;\n    worldPosProj.y = 0.;\n    float fDeltaD = distance(worldPosProj, camWorldProj) / fogAtten * 2.0;\n    float fDeltaY, fDensityIntegral;\n    if (cc_cameraPos.y > _FogTop) {\n        if (wPos.y < _FogTop) {\n            fDeltaY = (_FogTop - wPos.y) / _FogRange * 2.0;\n            fDensityIntegral = fDeltaY * fDeltaY * 0.5;\n        } else {\n            fDeltaY = 0.;\n            fDensityIntegral = 0.;\n        }\n    } else {\n        if (wPos.y < _FogTop) {\n            float fDeltaA = (_FogTop - cc_cameraPos.y) / _FogRange * 2.;\n            float fDeltaB = (_FogTop - wPos.y) / _FogRange * 2.;\n            fDeltaY = abs(fDeltaA - fDeltaB);\n            fDensityIntegral = abs((fDeltaA * fDeltaA * 0.5) - (fDeltaB * fDeltaB * 0.5));\n        } else {\n            fDeltaY = abs(_FogTop - cc_cameraPos.y) / _FogRange * 2.;\n            fDensityIntegral = abs(fDeltaY * fDeltaY * 0.5);\n        }\n    }\n    float fDensity;\n    if (fDeltaY != 0.) {\n        fDensity = (sqrt(1.0 + ((fDeltaD / fDeltaY) * (fDeltaD / fDeltaY)))) * fDensityIntegral;\n    } else {\n        fDensity = 0.;\n    }\n    float f = exp(-fDensity);\n    return f;\n}\nfloat CC_TRANSFER_FOG(vec4 pos) {\n    #if CC_USE_FOG == 0\n        return LinearFog(pos);\n\t#elif CC_USE_FOG == 1\n        return ExpFog(pos);\n    #elif CC_USE_FOG == 2\n        return ExpSquaredFog(pos);\n    #elif CC_USE_FOG == 3\n        return LayeredFog(pos);\n    #endif\n    return 1.;\n}\n#if USE_VERTEX_COLOR\n  in lowp vec4 a_color;\n  out lowp vec4 v_color;\n#endif\n#if USE_TEXTURE\n  out vec2 v_uv;\n  layout(std140) uniform TexCoords {\n    vec4 tilingOffset;\n  };\n#endif\nout float factor_fog;\nvec4 vert () {\n  vec4 position;\n  position = vec4(a_position, 1.0);\n  #if CC_USE_MORPH\n    applyMorph(position);\n  #endif\n  #if CC_USE_SKINNING\n    CCSkin(position);\n  #endif\n  mat4 matWorld;\n  #if USE_INSTANCING\n    matWorld = mat4(\n      vec4(a_matWorld0.xyz, 0.0),\n      vec4(a_matWorld1.xyz, 0.0),\n      vec4(a_matWorld2.xyz, 0.0),\n      vec4(a_matWorld0.w, a_matWorld1.w, a_matWorld2.w, 1.0)\n    );\n  #elif USE_BATCHING\n    matWorld = cc_matWorlds[int(a_dyn_batch_id)];\n  #else\n    matWorld = cc_matWorld;\n  #endif\n  #if USE_TEXTURE\n    v_uv = a_texCoord * tilingOffset.xy + tilingOffset.zw;\n  #endif\n  #if USE_VERTEX_COLOR\n    v_color = a_color;\n  #endif\n  factor_fog = CC_TRANSFER_FOG(matWorld * position);\n  return cc_matProj * (cc_matView * matWorld) * position;\n}\nvoid main() { gl_Position = vert(); }",frag:"\nprecision highp float;\nlayout(std140) uniform CCGlobal {\n  highp   vec4 cc_time;\n  mediump vec4 cc_screenSize;\n  mediump vec4 cc_nativeSize;\n};\nlayout(std140) uniform CCCamera {\n  highp   mat4 cc_matView;\n  highp   mat4 cc_matViewInv;\n  highp   mat4 cc_matProj;\n  highp   mat4 cc_matProjInv;\n  highp   mat4 cc_matViewProj;\n  highp   mat4 cc_matViewProjInv;\n  highp   vec4 cc_cameraPos;\n  mediump vec4 cc_screenScale;\n  mediump vec4 cc_exposure;\n  mediump vec4 cc_mainLitDir;\n  mediump vec4 cc_mainLitColor;\n  mediump vec4 cc_ambientSky;\n  mediump vec4 cc_ambientGround;\n  mediump vec4 cc_fogColor;\n  mediump vec4 cc_fogBase;\n  mediump vec4 cc_fogAdd;\n};\nvec3 SRGBToLinear (vec3 gamma) {\n  return gamma * gamma;\n}\nvec4 CCFragOutput (vec4 color) {\n  #if CC_USE_HDR\n    color.rgb = mix(color.rgb, SRGBToLinear(color.rgb) * cc_exposure.w, vec3(cc_exposure.z));\n  #endif\n  return color;\n}\n#if USE_ALPHA_TEST\n#endif\n#if USE_TEXTURE\n  in vec2 v_uv;\n  uniform sampler2D mainTexture;\n#endif\nlayout(std140) uniform Constant {\n  vec4 mainColor;\n  vec4 colorScaleAndCutoff;\n};\n#if USE_VERTEX_COLOR\n  in lowp vec4 v_color;\n#endif\nin float factor_fog;\nvec4 frag () {\n  vec4 o = mainColor;\n  o.rgb *= colorScaleAndCutoff.xyz;\n  #if USE_VERTEX_COLOR\n    o *= v_color;\n  #endif\n  #if USE_TEXTURE\n    o *= texture(mainTexture, v_uv);\n  #endif\n  #if USE_ALPHA_TEST\n    if (o.ALPHA_TEST_CHANNEL < colorScaleAndCutoff.w) discard;\n  #endif\n  o = vec4(mix(CC_FORWARD_ADD > 0 ? vec3(0.0) : cc_fogColor.rgb, o.rgb, factor_fog), o.a);\n  return CCFragOutput(o);\n}\nlayout(location = 0) out vec4 cc_FragColor;\nvoid main() { cc_FragColor = frag(); }"}],[{vert:"\nprecision highp float;\nhighp float decode32 (highp vec4 rgba) {\n  rgba = rgba * 255.0;\n  highp float Sign = 1.0 - (step(128.0, (rgba[3]) + 0.5)) * 2.0;\n  highp float Exponent = 2.0 * (mod(float(int((rgba[3]) + 0.5)), 128.0)) + (step(128.0, (rgba[2]) + 0.5)) - 127.0;\n  highp float Mantissa = (mod(float(int((rgba[2]) + 0.5)), 128.0)) * 65536.0 + rgba[1] * 256.0 + rgba[0] + 8388608.0;\n  return Sign * exp2(Exponent - 23.0) * Mantissa;\n}\nstruct StandardVertInput {\n  highp vec4 position;\n  vec3 normal;\n  vec4 tangent;\n};\nin vec3 a_position;\nin vec3 a_normal;\nin vec2 a_texCoord;\nin vec4 a_tangent;\n#if CC_USE_MORPH\n    in float a_vertexId;\n    int getVertexId() {\n        return int(a_vertexId);\n    }\nlayout(std140) uniform CCMorph {\n    vec4 cc_displacementWeights[15];\n    vec4 cc_displacementTextureInfo;\n};\nvec2 getPixelLocation(vec2 textureResolution, int pixelIndex) {\n    float pixelIndexF = float(pixelIndex);\n    float x = mod(pixelIndexF, textureResolution.x);\n    float y = floor(pixelIndexF / textureResolution.x);\n    return vec2(x, y);\n}\nvec2 getPixelCoordFromLocation(vec2 location, vec2 textureResolution) {\n    return (vec2(location.x, location.y) + .5) / textureResolution;\n}\n#if CC_SUPPORT_FLOAT_TEXTURE\n        vec4 fetchVec3ArrayFromTexture(sampler2D tex, int pixelIndex) {\n            ivec2 texSize = textureSize(tex, 0);\n            return texelFetch(tex, ivec2(pixelIndex % texSize.x, pixelIndex / texSize.x), 0);\n        }\n#else\n    vec4 fetchVec3ArrayFromTexture(sampler2D tex, int elementIndex) {\n        int pixelIndex = elementIndex * 4;\n        vec2 location = getPixelLocation(cc_displacementTextureInfo.xy, pixelIndex);\n        vec2 x = getPixelCoordFromLocation(location + vec2(0.0, 0.0), cc_displacementTextureInfo.xy);\n        vec2 y = getPixelCoordFromLocation(location + vec2(1.0, 0.0), cc_displacementTextureInfo.xy);\n        vec2 z = getPixelCoordFromLocation(location + vec2(2.0, 0.0), cc_displacementTextureInfo.xy);\n        return vec4(\n            decode32(texture(tex, x)),\n            decode32(texture(tex, y)),\n            decode32(texture(tex, z)),\n            1.0\n        );\n    }\n#endif\nfloat getDisplacementWeight(int index) {\n    int quot = index / 4;\n    int remainder = index - quot * 4;\n    if (remainder == 0) {\n        return cc_displacementWeights[quot].x;\n    } else if (remainder == 1) {\n        return cc_displacementWeights[quot].y;\n    } else if (remainder == 2) {\n        return cc_displacementWeights[quot].z;\n    } else {\n        return cc_displacementWeights[quot].w;\n    }\n}\nvec3 getVec3DisplacementFromTexture(sampler2D tex, int vertexIndex) {\n#if CC_MORPH_PRECOMPUTED\n    return fetchVec3ArrayFromTexture(tex, vertexIndex).rgb;\n#else\n    vec3 result = vec3(0, 0, 0);\n    int nVertices = int(cc_displacementTextureInfo.z);\n    for (int iTarget = 0; iTarget < CC_MORPH_TARGET_COUNT; ++iTarget) {\n        result += (fetchVec3ArrayFromTexture(tex, nVertices * iTarget + vertexIndex).rgb * getDisplacementWeight(iTarget));\n    }\n    return result;\n#endif\n}\n#if CC_MORPH_TARGET_HAS_POSITION\n    uniform sampler2D cc_PositionDisplacements;\n    vec3 getPositionDisplacement(int vertexId) {\n        return getVec3DisplacementFromTexture(cc_PositionDisplacements, vertexId);\n    }\n#endif\n#if CC_MORPH_TARGET_HAS_NORMAL\n    uniform sampler2D cc_NormalDisplacements;\n    vec3 getNormalDisplacement(int vertexId) {\n        return getVec3DisplacementFromTexture(cc_NormalDisplacements, vertexId);\n    }\n#endif\n#if CC_MORPH_TARGET_HAS_TANGENT\n    uniform sampler2D cc_TangentDisplacements;\n    vec3 getTangentDisplacement(int vertexId) {\n        return getVec3DisplacementFromTexture(cc_TangentDisplacements, vertexId);\n    }\n#endif\nvoid applyMorph (inout StandardVertInput attr) {\n    int vertexId = getVertexId();\n#if CC_MORPH_TARGET_HAS_POSITION\n    attr.position.xyz = attr.position.xyz + getPositionDisplacement(vertexId);\n#endif\n#if CC_MORPH_TARGET_HAS_NORMAL\n    attr.normal.xyz = attr.normal.xyz + getNormalDisplacement(vertexId);\n#endif\n#if CC_MORPH_TARGET_HAS_TANGENT\n    attr.tangent.xyz = attr.tangent.xyz + getTangentDisplacement(vertexId);\n#endif\n}\nvoid applyMorph (inout vec4 position) {\n#if CC_MORPH_TARGET_HAS_POSITION\n    position.xyz = position.xyz + getPositionDisplacement(getVertexId());\n#endif\n}\n#endif\n#if CC_USE_SKINNING\n  in vec4 a_joints;\nin vec4 a_weights;\n#if CC_USE_BAKED_ANIMATION\n  #if USE_INSTANCING\n    in highp vec4 a_jointAnimInfo;\n  #endif\n  layout(std140) uniform CCSkinningTexture {\n    highp vec4 cc_jointTextureInfo;\n  };\n  layout(std140) uniform CCSkinningAnimation {\n    highp vec4 cc_jointAnimInfo;\n  };\n  uniform highp sampler2D cc_jointTexture;\n  #else\n  layout(std140) uniform CCSkinning {\n    highp vec4 cc_joints[30 * 3];\n  };\n#endif\n#if CC_USE_BAKED_ANIMATION\n  #if CC_SUPPORT_FLOAT_TEXTURE\n    mat4 getJointMatrix (float i) {\n    #if USE_INSTANCING\n      highp float j = 3.0 * (a_jointAnimInfo.x * a_jointAnimInfo.y + i) + a_jointAnimInfo.z;\n    #else\n      highp float j = 3.0 * (cc_jointAnimInfo.x * cc_jointTextureInfo.y + i) + cc_jointTextureInfo.z;\n    #endif\n    highp float invSize = cc_jointTextureInfo.w;\n    highp float y = floor(j * invSize);\n    highp float x = j - y * cc_jointTextureInfo.x;\n    y = (y + 0.5) * invSize;\n      vec4 v1 = texture(cc_jointTexture, vec2((x + 0.5) * invSize, y));\n      vec4 v2 = texture(cc_jointTexture, vec2((x + 1.5) * invSize, y));\n      vec4 v3 = texture(cc_jointTexture, vec2((x + 2.5) * invSize, y));\n      return mat4(vec4(v1.xyz, 0.0), vec4(v2.xyz, 0.0), vec4(v3.xyz, 0.0), vec4(v1.w, v2.w, v3.w, 1.0));\n    }\n  #else\n    mat4 getJointMatrix (float i) {\n    #if USE_INSTANCING\n      highp float j = 12.0 * (a_jointAnimInfo.x * a_jointAnimInfo.y + i) + a_jointAnimInfo.z;\n    #else\n      highp float j = 12.0 * (cc_jointAnimInfo.x * cc_jointTextureInfo.y + i) + cc_jointTextureInfo.z;\n    #endif\n    highp float invSize = cc_jointTextureInfo.w;\n    highp float y = floor(j * invSize);\n    highp float x = j - y * cc_jointTextureInfo.x;\n    y = (y + 0.5) * invSize;\n      vec4 v1 = vec4(\n        decode32(texture(cc_jointTexture, vec2((x + 0.5) * invSize, y))),\n        decode32(texture(cc_jointTexture, vec2((x + 1.5) * invSize, y))),\n        decode32(texture(cc_jointTexture, vec2((x + 2.5) * invSize, y))),\n        decode32(texture(cc_jointTexture, vec2((x + 3.5) * invSize, y)))\n      );\n      vec4 v2 = vec4(\n        decode32(texture(cc_jointTexture, vec2((x + 4.5) * invSize, y))),\n        decode32(texture(cc_jointTexture, vec2((x + 5.5) * invSize, y))),\n        decode32(texture(cc_jointTexture, vec2((x + 6.5) * invSize, y))),\n        decode32(texture(cc_jointTexture, vec2((x + 7.5) * invSize, y)))\n      );\n      vec4 v3 = vec4(\n        decode32(texture(cc_jointTexture, vec2((x + 8.5) * invSize, y))),\n        decode32(texture(cc_jointTexture, vec2((x + 9.5) * invSize, y))),\n        decode32(texture(cc_jointTexture, vec2((x + 10.5) * invSize, y))),\n        decode32(texture(cc_jointTexture, vec2((x + 11.5) * invSize, y)))\n      );\n      return mat4(vec4(v1.xyz, 0.0), vec4(v2.xyz, 0.0), vec4(v3.xyz, 0.0), vec4(v1.w, v2.w, v3.w, 1.0));\n    }\n  #endif\n#else\n  mat4 getJointMatrix (float i) {\n    int idx = int(i);\n    vec4 v1 = cc_joints[idx * 3];\n    vec4 v2 = cc_joints[idx * 3 + 1];\n    vec4 v3 = cc_joints[idx * 3 + 2];\n    return mat4(vec4(v1.xyz, 0.0), vec4(v2.xyz, 0.0), vec4(v3.xyz, 0.0), vec4(v1.w, v2.w, v3.w, 1.0));\n  }\n#endif\nmat4 skinMatrix () {\n  vec4 joints = vec4(a_joints);\n  return getJointMatrix(joints.x) * a_weights.x\n       + getJointMatrix(joints.y) * a_weights.y\n       + getJointMatrix(joints.z) * a_weights.z\n       + getJointMatrix(joints.w) * a_weights.w;\n}\nvoid CCSkin (inout vec4 position) {\n  mat4 m = skinMatrix();\n  position = m * position;\n}\nvoid CCSkin (inout StandardVertInput attr) {\n  mat4 m = skinMatrix();\n  attr.position = m * attr.position;\n  attr.normal = (m * vec4(attr.normal, 0.0)).xyz;\n  attr.tangent.xyz = (m * vec4(attr.tangent.xyz, 0.0)).xyz;\n}\n#endif\nlayout(std140) uniform CCGlobal {\n  highp   vec4 cc_time;\n  mediump vec4 cc_screenSize;\n  mediump vec4 cc_nativeSize;\n};\nlayout(std140) uniform CCCamera {\n  highp   mat4 cc_matView;\n  highp   mat4 cc_matViewInv;\n  highp   mat4 cc_matProj;\n  highp   mat4 cc_matProjInv;\n  highp   mat4 cc_matViewProj;\n  highp   mat4 cc_matViewProjInv;\n  highp   vec4 cc_cameraPos;\n  mediump vec4 cc_screenScale;\n  mediump vec4 cc_exposure;\n  mediump vec4 cc_mainLitDir;\n  mediump vec4 cc_mainLitColor;\n  mediump vec4 cc_ambientSky;\n  mediump vec4 cc_ambientGround;\n  mediump vec4 cc_fogColor;\n  mediump vec4 cc_fogBase;\n  mediump vec4 cc_fogAdd;\n};\n#if USE_INSTANCING\n  in vec4 a_matWorld0;\n  in vec4 a_matWorld1;\n  in vec4 a_matWorld2;\n  #if USE_LIGHTMAP\n    in vec4 a_lightingMapUVParam;\n  #endif\n#elif USE_BATCHING\n  in float a_dyn_batch_id;\n  layout(std140) uniform CCLocalBatched {\n    highp mat4 cc_matWorlds[10];\n  };\n#else\nlayout(std140) uniform CCLocal {\n  highp mat4 cc_matWorld;\n  highp mat4 cc_matWorldIT;\n  highp vec4 cc_lightingMapUVParam;\n};\n#endif\nlayout(std140) uniform CCShadow {\n  highp mat4 cc_matLightPlaneProj;\n  highp mat4 cc_matLightViewProj;\n  lowp  vec4 cc_shadowColor;\n  lowp  vec4 cc_shadowInfo;\n};\nvec4 vert () {\n  vec4 position;\n  position = vec4(a_position, 1.0);\n  #if CC_USE_MORPH\n    applyMorph(position);\n  #endif\n  #if CC_USE_SKINNING\n    CCSkin(position);\n  #endif\n  mat4 matWorld;\n  #if USE_INSTANCING\n    matWorld = mat4(\n      vec4(a_matWorld0.xyz, 0.0),\n      vec4(a_matWorld1.xyz, 0.0),\n      vec4(a_matWorld2.xyz, 0.0),\n      vec4(a_matWorld0.w, a_matWorld1.w, a_matWorld2.w, 1.0)\n    );\n  #elif USE_BATCHING\n    matWorld = cc_matWorlds[int(a_dyn_batch_id)];\n  #else\n    matWorld = cc_matWorld;\n  #endif\n  position = cc_matProj * (cc_matView * cc_matLightPlaneProj * matWorld) * position;\n  position.z -= 0.0001;\n  return position;\n}\nvoid main() { gl_Position = vert(); }",frag:"\nprecision mediump float;\nlayout(std140) uniform CCShadow {\n  highp mat4 cc_matLightPlaneProj;\n  highp mat4 cc_matLightViewProj;\n  lowp  vec4 cc_shadowColor;\n  lowp  vec4 cc_shadowInfo;\n};\nlayout(std140) uniform CCGlobal {\n  highp   vec4 cc_time;\n  mediump vec4 cc_screenSize;\n  mediump vec4 cc_nativeSize;\n};\nlayout(std140) uniform CCCamera {\n  highp   mat4 cc_matView;\n  highp   mat4 cc_matViewInv;\n  highp   mat4 cc_matProj;\n  highp   mat4 cc_matProjInv;\n  highp   mat4 cc_matViewProj;\n  highp   mat4 cc_matViewProjInv;\n  highp   vec4 cc_cameraPos;\n  mediump vec4 cc_screenScale;\n  mediump vec4 cc_exposure;\n  mediump vec4 cc_mainLitDir;\n  mediump vec4 cc_mainLitColor;\n  mediump vec4 cc_ambientSky;\n  mediump vec4 cc_ambientGround;\n  mediump vec4 cc_fogColor;\n  mediump vec4 cc_fogBase;\n  mediump vec4 cc_fogAdd;\n};\nvec3 SRGBToLinear (vec3 gamma) {\n  return gamma * gamma;\n}\nvec4 CCFragOutput (vec4 color) {\n  #if CC_USE_HDR\n    color.rgb = mix(color.rgb, SRGBToLinear(color.rgb) * cc_exposure.w, vec3(cc_exposure.z));\n  #endif\n  return color;\n}\nvec4 frag () {\n  return CCFragOutput(cc_shadowColor);\n}\nlayout(location = 0) out vec4 cc_FragColor;\nvoid main() { cc_FragColor = frag(); }"}],[{vert:"\nprecision highp float;\nlayout(std140) uniform CCGlobal {\n  highp   vec4 cc_time;\n  mediump vec4 cc_screenSize;\n  mediump vec4 cc_nativeSize;\n};\nlayout(std140) uniform CCCamera {\n  highp   mat4 cc_matView;\n  highp   mat4 cc_matViewInv;\n  highp   mat4 cc_matProj;\n  highp   mat4 cc_matProjInv;\n  highp   mat4 cc_matViewProj;\n  highp   mat4 cc_matViewProjInv;\n  highp   vec4 cc_cameraPos;\n  mediump vec4 cc_screenScale;\n  mediump vec4 cc_exposure;\n  mediump vec4 cc_mainLitDir;\n  mediump vec4 cc_mainLitColor;\n  mediump vec4 cc_ambientSky;\n  mediump vec4 cc_ambientGround;\n  mediump vec4 cc_fogColor;\n  mediump vec4 cc_fogBase;\n  mediump vec4 cc_fogAdd;\n};\nstruct StandardVertInput {\n  highp vec4 position;\n  vec3 normal;\n  vec4 tangent;\n};\nin vec3 a_position;\nin vec3 a_normal;\nin vec2 a_texCoord;\nin vec4 a_tangent;\nout mediump vec4 viewDir;\nvec4 vert () {\n  viewDir = vec4(a_position, 1.0);\n  mat4 matViewRotOnly = mat4(mat3(cc_matView));\n  mat4 matProj = cc_matProj;\n  if (matProj[3].w > 0.0) {\n    vec2 scale = vec2(48.0, 24.0);\n    matProj[0].xy *= scale;\n    matProj[1].xy *= scale;\n    matProj[2].zw = vec2(-1.0);\n    matProj[3].zw = vec2(0.0);\n  }\n  vec4 pos = matProj * matViewRotOnly * viewDir;\n  pos.z = 0.99999 * pos.w;\n  return pos;\n}\nvoid main() { gl_Position = vert(); }",frag:"\nprecision mediump float;\nlayout(std140) uniform CCGlobal {\n  highp   vec4 cc_time;\n  mediump vec4 cc_screenSize;\n  mediump vec4 cc_nativeSize;\n};\nlayout(std140) uniform CCCamera {\n  highp   mat4 cc_matView;\n  highp   mat4 cc_matViewInv;\n  highp   mat4 cc_matProj;\n  highp   mat4 cc_matProjInv;\n  highp   mat4 cc_matViewProj;\n  highp   mat4 cc_matViewProjInv;\n  highp   vec4 cc_cameraPos;\n  mediump vec4 cc_screenScale;\n  mediump vec4 cc_exposure;\n  mediump vec4 cc_mainLitDir;\n  mediump vec4 cc_mainLitColor;\n  mediump vec4 cc_ambientSky;\n  mediump vec4 cc_ambientGround;\n  mediump vec4 cc_fogColor;\n  mediump vec4 cc_fogBase;\n  mediump vec4 cc_fogAdd;\n};\nuniform samplerCube cc_environment;\nvec3 unpackRGBE (vec4 rgbe) {\n  return rgbe.rgb * pow(2.0, rgbe.a * 255.0 - 128.0);\n}\nvec3 SRGBToLinear (vec3 gamma) {\n  return gamma * gamma;\n}\nvec3 ACESToneMap (vec3 color) {\n  color = min(color, vec3(8.0));\n  const float A = 2.51;\n  const float B = 0.03;\n  const float C = 2.43;\n  const float D = 0.59;\n  const float E = 0.14;\n  return (color * (A * color + B)) / (color * (C * color + D) + E);\n}\nvec4 CCFragOutput (vec4 color) {\n  #if !CC_USE_HDR\n    color.rgb = sqrt(ACESToneMap(color.rgb));\n  #endif\n  return color;\n}\nin mediump vec4 viewDir;\nvec4 frag () {\n  #if USE_RGBE_CUBEMAP\n    vec3 c = unpackRGBE(texture(cc_environment, viewDir.xyz));\n  #else\n    vec3 c = SRGBToLinear(texture(cc_environment, viewDir.xyz).rgb);\n  #endif\n  return CCFragOutput(vec4(c * cc_ambientSky.w, 1.0));\n}\nlayout(location = 0) out vec4 cc_FragColor;\nvoid main() { cc_FragColor = frag(); }"}],[{vert:"\nprecision mediump float;\nlayout(std140) uniform CCGlobal {\n  highp   vec4 cc_time;\n  mediump vec4 cc_screenSize;\n  mediump vec4 cc_nativeSize;\n};\nlayout(std140) uniform CCCamera {\n  highp   mat4 cc_matView;\n  highp   mat4 cc_matViewInv;\n  highp   mat4 cc_matProj;\n  highp   mat4 cc_matProjInv;\n  highp   mat4 cc_matViewProj;\n  highp   mat4 cc_matViewProjInv;\n  highp   vec4 cc_cameraPos;\n  mediump vec4 cc_screenScale;\n  mediump vec4 cc_exposure;\n  mediump vec4 cc_mainLitDir;\n  mediump vec4 cc_mainLitColor;\n  mediump vec4 cc_ambientSky;\n  mediump vec4 cc_ambientGround;\n  mediump vec4 cc_fogColor;\n  mediump vec4 cc_fogBase;\n  mediump vec4 cc_fogAdd;\n};\nin vec3 a_position;\nin vec4 a_color;\nout vec2 v_uv;\nlayout(std140) uniform Constants {\n  vec4 offset;\n};\nlayout(std140) uniform PerFrameInfo {\n  vec4 digits[8 * 10 / 4];\n};\nfloat getComponent(vec4 v, float i) {\n  if (i < 1.0) { return v.x; }\n  else if (i < 2.0) { return v.y; }\n  else if (i < 3.0) { return v.z; }\n  else { return v.w; }\n}\nvec4 vert () {\n  vec4 position = cc_matViewProj * vec4(a_position, 1.0);\n  position.xy += offset.xy;\n  v_uv = a_color.xy;\n  if (a_color.z >= 0.0) {\n    float n = getComponent(digits[int(a_color.z)], a_color.w);\n    v_uv += vec2(offset.z * n, 0.0);\n  }\n  return position;\n}\nvoid main() { gl_Position = vert(); }",frag:"\nprecision mediump float;\nlayout(std140) uniform CCGlobal {\n  highp   vec4 cc_time;\n  mediump vec4 cc_screenSize;\n  mediump vec4 cc_nativeSize;\n};\nlayout(std140) uniform CCCamera {\n  highp   mat4 cc_matView;\n  highp   mat4 cc_matViewInv;\n  highp   mat4 cc_matProj;\n  highp   mat4 cc_matProjInv;\n  highp   mat4 cc_matViewProj;\n  highp   mat4 cc_matViewProjInv;\n  highp   vec4 cc_cameraPos;\n  mediump vec4 cc_screenScale;\n  mediump vec4 cc_exposure;\n  mediump vec4 cc_mainLitDir;\n  mediump vec4 cc_mainLitColor;\n  mediump vec4 cc_ambientSky;\n  mediump vec4 cc_ambientGround;\n  mediump vec4 cc_fogColor;\n  mediump vec4 cc_fogBase;\n  mediump vec4 cc_fogAdd;\n};\nvec3 SRGBToLinear (vec3 gamma) {\n  return gamma * gamma;\n}\nvec4 CCFragOutput (vec4 color) {\n  #if CC_USE_HDR\n    color.rgb = mix(color.rgb, SRGBToLinear(color.rgb) * cc_exposure.w, vec3(cc_exposure.z));\n  #endif\n  return color;\n}\nin vec2 v_uv;\nuniform sampler2D mainTexture;\nvec4 frag () {\n  return CCFragOutput(texture(mainTexture, v_uv));\n}\nlayout(location = 0) out vec4 cc_FragColor;\nvoid main() { cc_FragColor = frag(); }"}],[{vert:"\nprecision mediump float;\nin vec2 a_position;\nin vec2 a_texCoord;\nout vec2 v_uv;\nvec4 vert () {\n  vec4 pos = vec4(a_position, 0, 1);\n  v_uv = a_texCoord;\n  return pos;\n}\nvoid main() { gl_Position = vert(); }",frag:"\nprecision mediump float;\nin vec2 v_uv;\nuniform sampler2D mainTexture;\nlayout(std140) uniform splashFrag {\n  float u_precent;\n};\nvec4 frag () {\n  vec4 color = texture(mainTexture, v_uv);\n  float precent = clamp(u_precent, 0.0, 1.0);\n  color.xyz *= precent;\n  return color;\n}\nlayout(location = 0) out vec4 cc_FragColor;\nvoid main() { cc_FragColor = frag(); }"}]]},nd=function(){function e(){this._device=null,this._resources={}}var t=e.prototype;return t.initBuiltinRes=function(e){var t=this;this._device=e;var n=this._resources,i=document.createElement("canvas"),r=i.getContext("2d"),o=new K_(i),a=i.width=i.height=2;r.fillStyle="#000",r.fillRect(0,0,a,a);var s=new wm;s._uuid="black-texture",s.image=o,n[s._uuid]=s,r.fillStyle="rgba(0,0,0,0)",r.fillRect(0,0,a,a);for(var l=new Uint8Array(16),u=0;u<l.length;++u)l[u]=0;var h=new wm;h._uuid="empty-texture",h.image=o,h.uploadData(l),n[h._uuid]=h;var _=new Im;_._uuid="black-cube-texture",_.setMipFilter(Im.Filter.NEAREST),_.image={front:new K_(i),back:new K_(i),left:new K_(i),right:new K_(i),top:new K_(i),bottom:new K_(i)},n[_._uuid]=_,r.fillStyle="#777",r.fillRect(0,0,a,a);var f=new wm;f._uuid="grey-texture",f.image=o,n[f._uuid]=f,r.fillStyle="#fff",r.fillRect(0,0,a,a);var m=new wm;m._uuid="white-texture",m.image=o,n[m._uuid]=m;var d=new Im;d._uuid="white-cube-texture",d.setMipFilter(Im.Filter.NEAREST),d.image={front:new K_(i),back:new K_(i),left:new K_(i),right:new K_(i),top:new K_(i),bottom:new K_(i)},n[d._uuid]=d,r.fillStyle="#7f7fff",r.fillRect(0,0,a,a);var p=new wm;p._uuid="normal-texture",p.image=o,n[p._uuid]=p,i.width=i.height=16,r.fillStyle="#ddd",r.fillRect(0,0,16,16),r.fillStyle="#555",r.fillRect(0,0,8,8),r.fillStyle="#555",r.fillRect(8,8,8,8);var v=new wm;v._uuid="default-texture",v.image=o,n[v._uuid]=v;var g=new Im;if(g.setMipFilter(Im.Filter.NEAREST),g._uuid="default-cube-texture",g.image={front:new K_(i),back:new K_(i),left:new K_(i),right:new K_(i),top:new K_(i),bottom:new K_(i)},n[g._uuid]=g,c.SpriteFrame){var y=new c.SpriteFrame,x=o._texture;y.texture=x,y._uuid="default-spriteframe",n[y._uuid]=y}var E=Qm(e);if(!E)return Promise.reject(Error("Failed to initialize builtin shaders: unknown device."));var S=td[E];return S?Promise.resolve().then((function(){Pm.forEach((function(e,t){var n=Object.assign(new c.EffectAsset,e);n.shaders.forEach((function(e,n){var i=S[t][n];i&&(e[E]=i)})),n.hideInEditor=!0,n.onLoaded()})),t._initMaterials()})):Promise.reject(Error("Current device is requiring builtin shaders of version "+E+" but shaders of that version are not assembled in this build."))},t.get=function(e){return this._resources[e]},t._initMaterials=function(){var e=this._resources,t=[],n=new c.Material;n._uuid="standard-material",n.initialize({effectName:"standard"}),e[n._uuid]=n,t.push(n);var i=new c.Material;i._uuid="missing-effect-material",i.initialize({effectName:"unlit",defines:{USE_COLOR:!0}}),i.setProperty("mainColor",c.color("#ffff00")),e[i._uuid]=i,t.push(i);var r=new c.Material;r._uuid="missing-material",r.initialize({effectName:"unlit",defines:{USE_COLOR:!0}}),r.setProperty("mainColor",c.color("#ff00ff")),e[r._uuid]=r,t.push(r);var o=new c.Material;o._uuid="default-clear-stencil",o.initialize({defines:{USE_TEXTURE:!1},effectName:"clear-stencil"}),e[o._uuid]=o,t.push(o);var a=new c.Material;a._uuid="ui-base-material",a.initialize({defines:{USE_TEXTURE:!1},effectName:"sprite"}),e[a._uuid]=a,t.push(a);var s=new c.Material;s._uuid="ui-sprite-material",s.initialize({defines:{USE_TEXTURE:!0,CC_USE_EMBEDDED_ALPHA:!1,IS_GRAY:!1},effectName:"sprite"}),e[s._uuid]=s,t.push(s);var l=new c.Material;l._uuid="ui-alpha-test-material",l.initialize({defines:{USE_TEXTURE:!0,USE_ALPHA_TEST:!0,CC_USE_EMBEDDED_ALPHA:!1,IS_GRAY:!1},effectName:"sprite"}),e[l._uuid]=l,t.push(l);var u=new c.Material;u._uuid="ui-sprite-gray-material",u.initialize({defines:{USE_TEXTURE:!0,CC_USE_EMBEDDED_ALPHA:!1,IS_GRAY:!0},effectName:"sprite"}),e[u._uuid]=u,t.push(u);var h=new c.Material;h._uuid="ui-sprite-alpha-sep-material",h.initialize({defines:{USE_TEXTURE:!0,CC_USE_EMBEDDED_ALPHA:!0,IS_GRAY:!1},effectName:"sprite"}),e[h._uuid]=h,t.push(h);var _=new c.Material;_._uuid="ui-sprite-gray-alpha-sep-material",_.initialize({defines:{USE_TEXTURE:!0,CC_USE_EMBEDDED_ALPHA:!0,IS_GRAY:!0},effectName:"sprite"}),e[_._uuid]=_,t.push(_);var f=new c.Material;f._uuid="ui-graphics-material",f.initialize({effectName:"graphics"}),e[f._uuid]=f,t.push(f);var m=new c.Material;m._uuid="default-particle-material",m.initialize({effectName:"particle"}),e[m._uuid]=m,t.push(m);var d=new c.Material;d._uuid="default-particle-gpu-material",d.initialize({effectName:"particle-gpu"}),e[d._uuid]=d,t.push(d);var p=new c.Material;p._uuid="default-trail-material",p.initialize({effectName:"particle-trail"}),e[p._uuid]=p,t.push(p);var v=new c.Material;v._uuid="default-billboard-material",v.initialize({effectName:"billboard"}),e[v._uuid]=v,t.push(v);var g=new c.Material;g._uuid="default-spine-material",g.initialize({defines:{USE_TEXTURE:!0,CC_USE_EMBEDDED_ALPHA:!1,IS_GRAY:!1},effectName:"spine"}),e[g._uuid]=g,t.push(g),c.game.on(c.Game.EVENT_RENDERER_INITED,(function(){for(var e=0;e<t.length;++e)for(var n=t[e],i=0;i<n.passes.length;++i)n.passes[i].tryCompile()}))},e}(),id=e("b3",c.builtinResMgr=new nd),rd=e("fi",(Jm=new Map,$m=0,function(e){return"number"==typeof e?e:(Jm.has(e)||(Jm.set(e,1<<$m),$m++),Jm.get(e))})),od=new ka(Qo.UNIFORM|Qo.TRANSFER_DST,Zo.HOST|Zo.DEVICE),ad=new Va(null),sd=new Hs(null);!function(e){e[e.INSTANCING=1]="INSTANCING",e[e.VB_MERGING=2]="VB_MERGING"}(ed||(ed={}));var cd=e("cq",function(){function e(e){this._rootBuffer=null,this._rootBufferDirty=!1,this._buffers=[],this._descriptorSet=null,this._passIndex=0,this._propertyIndex=0,this._programName="",this._dynamics={},this._propertyHandleMap={},this._rootBlock=null,this._blocks=[],this._shaderInfo=null,this._defines={},this._properties={},this._root=void 0,this._device=void 0,this._hShaderDefault=Yi,this._handle=Yi,this._bs=new ds,this._dss=new fs,this._rs=new _s,this._root=e,this._device=e.device}e.fillPipelineInfo=function(e,t){var n=e.handle;void 0!==t.priority&&ur.set(n,qi.PRIORITY,t.priority),void 0!==t.primitive&&ur.set(n,qi.PRIMITIVE,t.primitive),void 0!==t.stage&&ur.set(n,qi.STAGE,t.stage),void 0!==t.dynamicStates&&ur.set(n,qi.DYNAMIC_STATES,t.dynamicStates),void 0!==t.phase&&ur.set(n,qi.PHASE,rd(t.phase));var i=e._bs;if(t.blendState){var r=t.blendState,o=r.targets;o&&o.forEach((function(e,t){i.setTarget(t,e)})),void 0!==r.isA2C&&(i.isA2C=r.isA2C),void 0!==r.isIndepend&&(i.isIndepend=r.isIndepend),void 0!==r.blendColor&&(i.blendColor=r.blendColor)}e._rs.assign(t.rasterizerState),e._dss.assign(t.depthStencilState)},e.getPassHash=function(e,t){var n,i=e.handle,r=t+","+ur.get(i,qi.PRIMITIVE)+","+ur.get(i,qi.DYNAMIC_STATES);return r+=function(e){for(var t,n=",bs,"+e.isA2C,i=ne(e.targets);!(t=i()).done;){var r=t.value;n+=",bt,"+r.blend+","+r.blendEq+","+r.blendAlphaEq+","+r.blendColorMask,n+=","+r.blendSrc+","+r.blendDst+","+r.blendSrcAlpha+","+r.blendDstAlpha}return n}(e._bs),r+=function(e){var t=",dss,"+e.depthTest+","+e.depthWrite+","+e.depthFunc;return t+=","+e.stencilTestFront+","+e.stencilFuncFront+","+e.stencilRefFront+","+e.stencilReadMaskFront,t+=","+e.stencilFailOpFront+","+e.stencilZFailOpFront+","+e.stencilPassOpFront+","+e.stencilWriteMaskFront,(t+=","+e.stencilTestBack+","+e.stencilFuncBack+","+e.stencilRefBack+","+e.stencilReadMaskBack)+","+e.stencilFailOpBack+","+e.stencilZFailOpBack+","+e.stencilPassOpBack+","+e.stencilWriteMaskBack}(e._dss),es(r+=",rs,"+(n=e._rs).cullMode+","+n.depthBias+","+n.isFrontFaceCCW,666)};var t=e.prototype;return t.initialize=function(e){this._doInit(e),this.resetUBOs(),this.resetTextures(),this.tryCompile()},t.getHandle=function(e,t,n){void 0===t&&(t=0),void 0===n&&(n=Xo.UNKNOWN);var i=this._propertyHandleMap[e];return i?(n?i=Bm(i,n):t&&(i=Bm(i,Lm(i)-t)),i+t):0},t.getBinding=function(t){var n=this.getHandle(t);return n?e.getBindingFromHandle(n):-1},t.setUniform=function(t,n){var i=e.getBindingFromHandle(t),r=e.getTypeFromHandle(t),o=e.getOffsetFromHandle(t),a=this._blocks[i];Gm[r](a,n,o),this._rootBufferDirty=!0},t.getUniform=function(t,n){var i=e.getBindingFromHandle(t),r=e.getTypeFromHandle(t),o=e.getOffsetFromHandle(t),a=this._blocks[i];return Um[r](a,n,o)},t.setUniformArray=function(t,n){for(var i=e.getBindingFromHandle(t),r=e.getTypeFromHandle(t),o=za(r)>>2,a=this._blocks[i],s=e.getOffsetFromHandle(t),c=0;c<n.length;c++,s+=o)null!==n[c]&&Gm[r](a,n[c],s);this._rootBufferDirty=!0},t.bindTexture=function(e,t,n){this._descriptorSet.bindTexture(e,t,n||0)},t.bindSampler=function(e,t,n){this._descriptorSet.bindSampler(e,t,n||0)},t.setDynamicState=function(e,t){var n=this._dynamics[e];n&&n.value===t||(n.value=t,n.dirty=!0)},t.overridePipelineStates=function(){console.warn("base pass cannot override states, please use pass instance instead.")},t.update=function(){this._rootBufferDirty&&this._rootBuffer&&(this._rootBuffer.update(this._rootBlock),this._rootBufferDirty=!1),this._descriptorSet.update()},t.destroy=function(){for(var e=0;e<this._shaderInfo.blocks.length;e++){var t=this._shaderInfo.blocks[e];this._buffers[t.binding].destroy()}this._buffers=[],this._rootBuffer&&(this._rootBuffer.destroy(),this._rootBlock=null),this._descriptorSet=null,this._rs.destroy(),this._dss.destroy(),this._bs.destroy(),this._handle&&(Ki.free(ur.get(this._handle,qi.DESCRIPTOR_SET)),ur.free(this._handle),this._handle=Yi)},t.resetUniform=function(t){var n=this.getHandle(t);if(n){var i=e.getTypeFromHandle(n),r=e.getBindingFromHandle(n),o=e.getOffsetFromHandle(n),a=this._blocks[r],s=this._properties[t],c=s&&s.value||km(i);Gm[i](a,c,o),this._rootBufferDirty=!0}},t.resetTexture=function(t,n){var i=this.getHandle(t);if(i){var r=e.getTypeFromHandle(i),o=e.getBindingFromHandle(i),a=this._properties[t],s=a&&a.value,c=s?s+"-texture":km(r),l=id.get(c),u=l&&l.getGFXTexture(),h=a&&void 0!==a.samplerHash?a.samplerHash:l&&l.getSamplerHash(),_=df.getSampler(this._device,h);this._descriptorSet.bindSampler(o,_,n),this._descriptorSet.bindTexture(o,u,n)}},t.resetUBOs=function(){for(var e=0;e<this._shaderInfo.blocks.length;e++)for(var t=this._shaderInfo.blocks[e],n=this._blocks[t.binding],i=0,r=0;r<t.members.length;r++){for(var o=t.members[r],a=this._properties[o.name],s=a&&a.value||km(o.type),c=(za(o.type)>>2)*o.count,l=0;l+s.length<=c;l+=s.length)n.set(s,i+l);i+=c}this._rootBufferDirty=!0},t.resetTextures=function(){for(var e=0;e<this._shaderInfo.samplers.length;e++)for(var t=this._shaderInfo.samplers[e],n=0;n<t.count;n++)this.resetTexture(t.name,n)},t.tryCompile=function(){var t=this._root.pipeline;return!!t&&(this._syncBatchingScheme(),this._hShaderDefault=Zm.getGFXShader(this._device,this._programName,this._defines,t),this._hShaderDefault?(ur.set(this._handle,qi.PIPELINE_LAYOUT,Zm.getTemplateInfo(this._programName).hPipelineLayout),ur.set(this._handle,qi.HASH,e.getPassHash(this,this._hShaderDefault)),!0):(console.warn("create shader "+this._programName+" failed"),!1))},t.getShaderVariant=function(e){if(void 0===e&&(e=null),!this._hShaderDefault&&!this.tryCompile())return console.warn("pass resources incomplete"),Yi;if(!e)return this._hShaderDefault;for(var t=this._root.pipeline,n=0;n<e.length;n++){var i=e[n];this._defines[i.name]=i.value}for(var r=Zm.getGFXShader(this._device,this._programName,this._defines,t),o=0;o<e.length;o++){var a=e[o];delete this._defines[a.name]}return r},t.beginChangeStatesSilently=function(){},t.endChangeStatesSilently=function(){},t._doInit=function(t,n){void 0===n&&(n=!1);var i=this._handle=ur.alloc();ur.set(i,qi.PRIORITY,jl.DEFAULT),ur.set(i,qi.STAGE,Vl.DEFAULT),ur.set(i,qi.PHASE,rd("default")),ur.set(i,qi.PRIMITIVE,ea.TRIANGLE_LIST),ur.set(i,qi.RASTERIZER_STATE,this._rs.handle),ur.set(i,qi.DEPTH_STENCIL_STATE,this._dss.handle),ur.set(i,qi.BLEND_STATE,this._bs.handle),this._passIndex=t.passIndex,this._propertyIndex=void 0!==t.propertyIndex?t.propertyIndex:t.passIndex,this._programName=t.program,this._defines=n?J({},t.defines):t.defines,this._shaderInfo=Zm.getTemplate(t.program),this._properties=t.properties||this._properties;var r=this._device;e.fillPipelineInfo(this,t),t.stateOverrides&&e.fillPipelineInfo(this,t.stateOverrides),sd.layout=Zm.getDescriptorSetLayout(this._device,t.program);var o=Ki.alloc(this._device,sd);ur.set(this._handle,qi.DESCRIPTOR_SET,o),this._descriptorSet=Ki.get(o);for(var a=this._shaderInfo.blocks,s=Zm.getTemplateInfo(t.program),c=s.blockSizes,l=s.handleMap,u=r.uboOffsetAlignment,h=[],_=0,f=0,m=0;m<a.length;m++){var d=c[m];h.push(f),f+=Math.ceil(d/u)*u,_=d}var p=h[h.length-1]+_;p&&(od.size=16*Math.ceil(p/16),this._rootBuffer=r.createBuffer(od),this._rootBlock=new ArrayBuffer(p));for(var v=0,g=0;v<a.length;v++){var y=a[v].binding,x=c[v];ad.buffer=this._rootBuffer,ad.offset=h[g++],ad.range=16*Math.ceil(x/16);var E=this._buffers[y]=r.createBuffer(ad);this._blocks[y]=new Float32Array(this._rootBlock,ad.offset,x/Float32Array.BYTES_PER_ELEMENT),this._descriptorSet.bindBuffer(y,E)}var S=this._propertyHandleMap=l,T={};for(var A in this._properties){var C=this._properties[A];C.handleInfo&&(T[A]=this.getHandle.apply(this,C.handleInfo))}Object.assign(S,T)},t._syncBatchingScheme=function(){this._defines.USE_INSTANCING?this._device.hasFeature(Ra.INSTANCED_ARRAYS)?ur.set(this._handle,qi.BATCHING_SCHEME,ed.INSTANCING):(this._defines.USE_INSTANCING=!1,ur.set(this._handle,qi.BATCHING_SCHEME,0)):this._defines.USE_BATCHING?ur.set(this._handle,qi.BATCHING_SCHEME,ed.VB_MERGING):ur.set(this._handle,qi.BATCHING_SCHEME,0)},t._destroyHandle=function(){this._handle&&(ur.free(this._handle),this._handle=Yi)},t._initPassFromTarget=function(e,t,n,i){ur.set(this.handle,qi.PRIORITY,e.priority),ur.set(this.handle,qi.STAGE,e.stage),ur.set(this.handle,qi.PHASE,e.phase),ur.set(this.handle,qi.BATCHING_SCHEME,e.batchingScheme),ur.set(this.handle,qi.PRIMITIVE,e.primitive),ur.set(this.handle,qi.DYNAMIC_STATES,e.dynamicStates),this._descriptorSet=e.descriptorSet,ur.set(this.handle,qi.DESCRIPTOR_SET,ur.get(e.handle,qi.DESCRIPTOR_SET)),this._bs=n,ur.set(this.handle,qi.BLEND_STATE,n.handle),this._rs=e.rasterizerState,ur.set(this.handle,qi.RASTERIZER_STATE,ur.get(e.handle,qi.RASTERIZER_STATE)),this._dss=t,ur.set(this.handle,qi.DEPTH_STENCIL_STATE,t.handle),this._passIndex=e.passIndex,this._propertyIndex=e.propertyIndex,this._programName=e.program,this._defines=e.defines,this._shaderInfo=e._shaderInfo,this._properties=e._properties,this._blocks=e._blocks,this._dynamics=e._dynamics,this._hShaderDefault=e._hShaderDefault,ur.set(this._handle,qi.PIPELINE_LAYOUT,Zm.getTemplateInfo(this._programName).hPipelineLayout);var r=ur.get(e.handle,qi.HASH);ur.set(this._handle,qi.HASH,r^i)},Z(e,[{key:"root",get:function(){return this._root}},{key:"device",get:function(){return this._device}},{key:"shaderInfo",get:function(){return this._shaderInfo}},{key:"localSetLayout",get:function(){return Zm.getDescriptorSetLayout(this._device,this._programName,!0)}},{key:"program",get:function(){return this._programName}},{key:"properties",get:function(){return this._properties}},{key:"defines",get:function(){return this._defines}},{key:"passIndex",get:function(){return this._passIndex}},{key:"propertyIndex",get:function(){return this._propertyIndex}},{key:"dynamics",get:function(){return this._dynamics}},{key:"blocks",get:function(){return this._blocks}},{key:"handle",get:function(){return this._handle}},{key:"priority",get:function(){return ur.get(this._handle,qi.PRIORITY)}},{key:"primitive",get:function(){return ur.get(this._handle,qi.PRIMITIVE)}},{key:"stage",get:function(){return ur.get(this._handle,qi.STAGE)}},{key:"phase",get:function(){return ur.get(this._handle,qi.PHASE)}},{key:"rasterizerState",get:function(){return this._rs}},{key:"depthStencilState",get:function(){return this._dss}},{key:"blendState",get:function(){return this._bs}},{key:"dynamicStates",get:function(){return ur.get(this._handle,qi.DYNAMIC_STATES)}},{key:"batchingScheme",get:function(){return ur.get(this._handle,qi.BATCHING_SCHEME)}},{key:"descriptorSet",get:function(){return this._descriptorSet}},{key:"hash",get:function(){return ur.get(this._handle,qi.HASH)}},{key:"rootBufferDirty",get:function(){return this._rootBufferDirty}}]),e}());cd.PropertyType=Nm,cd.getPropertyTypeFromHandle=Dm,cd.getTypeFromHandle=Lm,cd.getBindingFromHandle=Fm,cd.getOffsetFromHandle=zm,de(ah.prototype,"RenderScene.prototype",[{name:"raycastUI2DNode"},{name:"raycastUINode"}]),de(ah.prototype,"RenderScene.prototype",[{name:"raycastAll",suggest:"using intersect.rayModel in geometry"},{name:"raycastAllModels",suggest:"using intersect.rayModel in geometry"},{name:"raycastSingleModel",suggest:"using intersect.rayModel in geometry"},{name:"raycastAllCanvas",suggest:"using intersect.rayAABB in geometry"},{name:"rayResultCanvas"},{name:"rayResultModels"},{name:"rayResultAll"},{name:"rayResultSingleModel"}]);var ld={};de(ld,"CameraVisFlags",[{name:"GENERAL"}]),me(ld,"CameraVisFlags",[{name:"PROFILER",newName:"PROFILER",target:ql.BitMask,targetName:"PROFILER"},{name:"GIZMOS",newName:"GIZMOS",target:ql.BitMask,targetName:"GIZMOS"},{name:"EDITOR",newName:"EDITOR",target:ql.BitMask,targetName:"EDITOR"},{name:"UI",newName:"UI",target:ql.BitMask,targetName:"UI_3D"},{name:"UI2D",newName:"UI2D",target:ql.BitMask,targetName:"UI_2D"}]),c.CameraVisFlags=ld;var ud,hd={};function _d(e,t){t<1e3?t=1e3:t>15e3&&(t=15e3);var n=t*t,i=(.860117757+.000154118254*t+1.28641212e-7*n)/(1+.000842420235*t+7.08145163e-7*n),r=(.317398726+422806245e-13*t+4.20481691e-8*n)/(1-289741816e-13*t+1.61456053e-7*n),o=2*i-8*r+4,a=3*i/o,s=2*r/o,c=1/s*a,l=1/s*(1-a-s);e.x=3.2404542*c-1.5371385+-.4985314*l,e.y=-.969266*c+1.8760108+.041556*l,e.z=.0556434*c-.2040259+1.0572252*l}de(hd,"VisibilityFlags",[{name:"GENERAL"}]),me(hd,"VisibilityFlags",[{name:"ALWALS",newName:"ALWALS",target:ql.Enum,targetName:"ALWALS"},{name:"PROFILER",newName:"PROFILER",target:ql.Enum,targetName:"PROFILER"},{name:"GIZMOS",newName:"GIZMOS",target:ql.Enum,targetName:"GIZMOS"},{name:"EDITOR",newName:"EDITOR",target:ql.Enum,targetName:"EDITOR"},{name:"UI",newName:"UI",target:ql.Enum,targetName:"UI_3D"},{name:"UI2D",newName:"UI2D",target:ql.Enum,targetName:"UI_2D"}]),c.VisibilityFlags=hd,me(cd.prototype,"Pass.prototype",[{name:"getBindingTypeFromHandle",newName:"getDescriptorTypeFromHandle"}]),de(oh.prototype,"Camera.prototype",[{name:"getSplitFrustum"}]),function(e){e[e.DIRECTIONAL=0]="DIRECTIONAL",e[e.SPHERE=1]="SPHERE",e[e.SPOT=2]="SPOT",e[e.UNKNOWN=3]="UNKNOWN"}(ud||(ud=e("bh",{})));var fd=e("bq",(function(e){return 4*Math.PI*Math.PI*e*e})),md=e("bi",function(){function e(){this._baked=!1,this._color=new Fn(1,1,1),this._colorTemp=6550,this._colorTempRGB=new Fn(1,1,1),this._scene=null,this._node=null,this._name=null,this._handle=Yi}var t=e.prototype;return t.initialize=function(){this._handle=to.alloc(),to.setVec3(this._handle,Zr.COLOR,this._color),to.setVec3(this._handle,Zr.COLOR_TEMPERATURE_RGB,this._colorTempRGB),to.set(this._handle,Zr.TYPE,ud.UNKNOWN)},t.attachToScene=function(e){this._scene=e},t.detachFromScene=function(){this._scene=null},t.destroy=function(){this._name=null,this._node=null,this._handle&&(to.free(this._handle),this._handle=Yi)},t.update=function(){},Z(e,[{key:"baked",get:function(){return this._baked},set:function(e){this._baked=e}},{key:"color",set:function(e){this._color.set(e),to.setVec3(this._handle,Zr.COLOR,e)},get:function(){return this._color}},{key:"useColorTemperature",set:function(e){to.set(this._handle,Zr.USE_COLOR_TEMPERATURE,e?1:0)},get:function(){return 1===to.get(this._handle,Zr.USE_COLOR_TEMPERATURE)}},{key:"colorTemperature",set:function(e){this._colorTemp=e,_d(this._colorTempRGB,this._colorTemp),to.setVec3(this._handle,Zr.COLOR_TEMPERATURE_RGB,this._colorTempRGB)},get:function(){return this._colorTemp}},{key:"colorTemperatureRGB",get:function(){return this._colorTempRGB}},{key:"node",set:function(e){this._node=e,this._node&&(this._node.hasChangedFlags|=Qu.ROTATION,to.set(this._handle,Zr.NODE,this._node.handle))},get:function(){return this._node}},{key:"type",get:function(){return to.get(this._handle,Zr.TYPE)}},{key:"name",get:function(){return this._name},set:function(e){this._name=e}},{key:"scene",get:function(){return this._scene}},{key:"handle",get:function(){return this._handle}}]),e}()),dd=new Fn(0,0,-1),pd=new Fn,vd=e("bn",function(e){function t(){var t;return(t=e.call(this)||this)._dir=new Fn(1,-1,-1),t._shadowRange=1e3,t._shadowIntensity=0,t._shadowFadeDistance=0,t._shadowDistance=0,t._fadeStart=.8,t._splits=new oi(1,0,0,0),t._biasAutoAdjust=1,t}$(t,e),Z(t,[{key:"shadowRange",set:function(e){this._shadowRange=e},get:function(){return this._shadowRange}},{key:"shadowIntensitywRange",set:function(e){this._shadowIntensity=e}},{key:"shadowIntensity",get:function(){return this._shadowIntensity}},{key:"shadowFadeDistance",set:function(e){this._shadowFadeDistance=e},get:function(){return this._shadowFadeDistance}},{key:"shadowDistance",set:function(e){this._shadowDistance=e},get:function(){return this._shadowDistance}},{key:"fadeStart",set:function(e){this._fadeStart=e},get:function(){return this._fadeStart}},{key:"splits",set:function(e){this._splits=e},get:function(){return this._splits}},{key:"biasAutoAdjust",set:function(e){this._biasAutoAdjust=e},get:function(){return this._biasAutoAdjust}},{key:"direction",set:function(e){Fn.normalize(this._dir,e),to.setVec3(this._handle,Zr.DIRECTION,this._dir)},get:function(){return this._dir}},{key:"illuminance",set:function(e){to.set(this._handle,Zr.ILLUMINANCE,e)},get:function(){return to.get(this._handle,Zr.ILLUMINANCE)}}]);var n=t.prototype;return n.initialize=function(){e.prototype.initialize.call(this),to.set(this._handle,Zr.ILLUMINANCE,So.SUN_ILLUM),to.setVec3(this._handle,Zr.DIRECTION,this._dir),to.set(this._handle,Zr.TYPE,ud.DIRECTIONAL)},n.update=function(){this._node&&this._node.hasChangedFlags&&(this.direction=Fn.transformQuat(pd,dd,this._node.worldRotation))},t}(md)),gd=new Hs(null),yd=function(){function e(){this._device=null,this._passes=null,this._subMesh=null,this._patches=null,this._handle=Yi,this._priority=jl.DEFAULT,this._inputAssembler=null,this._descriptorSet=null}var t=e.prototype;return t.initialize=function(e,t,n){void 0===n&&(n=null),this._device=c.director.root.device,this._subMesh=e,this._patches=n,this._passes=t,this._handle=fr.alloc(),this._flushPassInfo(),t[0].batchingScheme===ed.VB_MERGING&&this._subMesh.genFlatBuffers(),gd.layout=t[0].localSetLayout;var i=Ki.alloc(this._device,gd),r=Qi.alloc(this._device,e.iaInfo);fr.set(this._handle,cr.PRIORITY,jl.DEFAULT),fr.set(this._handle,cr.INPUT_ASSEMBLER,r),fr.set(this._handle,cr.DESCRIPTOR_SET,i),fr.set(this._handle,cr.SUB_MESH,e.handle),this._inputAssembler=Qi.get(r),this._descriptorSet=Ki.get(i)},t.initPlanarShadowShader=function(){var e=c.director.root.pipeline.shadows.getPlanarShader(this._patches);fr.set(this._handle,cr.PLANAR_SHADER,e)},t.destroy=function(){Ki.free(fr.get(this._handle,cr.DESCRIPTOR_SET)),Qi.free(fr.get(this._handle,cr.INPUT_ASSEMBLER)),fr.free(this._handle),this._descriptorSet=null,this._inputAssembler=null,this._priority=jl.DEFAULT,this._handle=Yi,this._patches=null,this._subMesh=null,this._passes=null},t.update=function(){for(var e=0;e<this._passes.length;++e)this._passes[e].update();this._descriptorSet.update()},t.onPipelineStateChanged=function(){var e=this._passes;if(e){for(var t=0;t<e.length;t++){var n=e[t];n.beginChangeStatesSilently(),n.tryCompile(),n.endChangeStatesSilently()}this._flushPassInfo()}},t.onMacroPatchesStateChanged=function(e){this._patches=e;var t=this._passes;if(t){for(var n=0;n<t.length;n++){var i=t[n];i.beginChangeStatesSilently(),i.tryCompile(),i.endChangeStatesSilently()}this._flushPassInfo()}},t._flushPassInfo=function(){var e=this._passes;if(e){fr.set(this._handle,cr.PASS_COUNT,e.length);for(var t=cr.PASS_0,n=cr.SHADER_0,i=0;i<e.length;i++,t++,n++)fr.set(this._handle,t,e[i].handle),fr.set(this._handle,n,e[i].getShaderVariant(this._patches))}},Z(e,[{key:"passes",set:function(e){if(this._passes=e,this._flushPassInfo(),this._descriptorSet){Ki.free(fr.get(this._handle,cr.DESCRIPTOR_SET)),gd.layout=e[0].localSetLayout;var t=Ki.alloc(this._device,gd);fr.set(this._handle,cr.DESCRIPTOR_SET,t),this._descriptorSet=Ki.get(t)}},get:function(){return this._passes}},{key:"subMesh",set:function(e){this._subMesh=e,this._inputAssembler.destroy(),this._inputAssembler.initialize(e.iaInfo),this._passes[0].batchingScheme===ed.VB_MERGING&&this._subMesh.genFlatBuffers(),fr.set(this._handle,cr.SUB_MESH,e.handle)},get:function(){return this._subMesh}},{key:"priority",set:function(e){this._priority=e,fr.set(this._handle,cr.PRIORITY,e)},get:function(){return this._priority}},{key:"handle",get:function(){return this._handle}},{key:"inputAssembler",get:function(){return this._inputAssembler}},{key:"descriptorSet",get:function(){return this._descriptorSet}},{key:"patches",get:function(){return this._patches}},{key:"planarShaderHandel",get:function(){return fr.get(this._handle,cr.PLANAR_SHADER)}}]),e}(),xd=e("fg",function(){function e(e){this.instances=[],this.pass=void 0,this.hasPendingModels=!1,this.dynamicOffsets=[],this._device=void 0,this._device=e.device,this.pass=e}e.get=function(t,n){void 0===n&&(n=0);var i=e._buffers;i.has(t)||i.set(t,{});var r=i.get(t);return r[n]||(r[n]=new e(t))};var t=e.prototype;return t.destroy=function(){for(var e=0;e<this.instances.length;++e){var t=this.instances[e];t.vb.destroy(),t.ia.destroy()}this.instances.length=0},t.merge=function(e,t,n){var i=t.buffer.length;if(i){for(var r=e.inputAssembler,o=e.descriptorSet.getTexture(Lu),a=fr.get(e.handle,cr.SHADER_0+n),s=fr.get(e.handle,cr.DESCRIPTOR_SET),c=0;c<this.instances.length;++c){var l=this.instances[c];if(!(l.ia.indexBuffer!==r.indexBuffer||l.count>=1024)&&l.lightingMap===o){if(l.stride!==i)return;if(l.count>=l.capacity){l.capacity<<=1;var u=l.stride*l.capacity,h=l.data;l.data=new Uint8Array(u),l.data.set(h),l.vb.resize(u)}return l.hShader!==a&&(l.hShader=a),l.hDescriptorSet!==s&&(l.hDescriptorSet=s),l.data.set(t.buffer,l.stride*l.count++),void(this.hasPendingModels=!0)}}for(var _=this._device.createBuffer(new ka(Qo.VERTEX|Qo.TRANSFER_DST,Zo.HOST|Zo.DEVICE,32*i,i)),f=new Uint8Array(32*i),m=r.vertexBuffers.slice(),d=r.attributes.slice(),p=r.indexBuffer,v=0;v<t.attributes.length;v++){var g=t.attributes[v],y=new ts(g.name,g.format,g.isNormalized,m.length,!0);d.push(y)}f.set(t.buffer),m.push(_);var x=new ns(d,m,p),E=this._device.createInputAssembler(x);this.instances.push({count:1,capacity:32,vb:_,data:f,ia:E,stride:i,hShader:a,hDescriptorSet:s,lightingMap:o}),this.hasPendingModels=!0}},t.uploadBuffers=function(e){for(var t=0;t<this.instances.length;++t){var n=this.instances[t];n.count&&(n.ia.instanceCount=n.count,e.updateBuffer(n.vb,n.data))}},t.clear=function(){for(var e=0;e<this.instances.length;++e)this.instances[e].count=0;this.hasPendingModels=!1},e}());xd._buffers=new Map;var Ed,Sd=new ki(Gi.ATTRIBUTE,(function(e,t){return t||new ts})),Td=new Zn,Ad=new v_((function(){return new yd}),32),Cd=[{name:"CC_RECEIVE_SHADOW",value:!0}];!function(e){e[e.DEFAULT=0]="DEFAULT",e[e.SKINNING=1]="SKINNING",e[e.BAKED_SKINNING=2]="BAKED_SKINNING",e[e.BATCH_2D=3]="BATCH_2D",e[e.PARTICLE_BATCH=4]="PARTICLE_BATCH",e[e.LINE=5]="LINE"}(Ed||(Ed=e("bF",{})));var wd,Id,bd,Rd,Od,Nd,Pd,Md,Dd,Ld,Fd,zd,Bd,Ud,Gd,Hd,kd,Vd,jd=ef([la.LINEAR,la.LINEAR,la.NONE,ua.CLAMP,ua.CLAMP,ua.CLAMP]),Wd=ef([la.LINEAR,la.LINEAR,la.LINEAR,ua.CLAMP,ua.CLAMP,ua.CLAMP]),qd=e("aY",function(){function e(){this.type=Ed.DEFAULT,this.scene=null,this.isDynamicBatching=!1,this.instancedAttributes={buffer:null,views:[],attributes:[]},this._worldBounds=null,this._modelBounds=null,this._subModels=[],this._node=null,this._transform=null,this._device=void 0,this._inited=!1,this._descriptorSetCount=1,this._updateStamp=-1,this._transformUpdated=!0,this._handle=Yi,this._hWorldBounds=Yi,this._localData=new Float32Array(du.COUNT),this._localBuffer=null,this._instMatWorldIdx=-1,this._lightmap=null,this._lightmapUVParam=new oi,this._device=c.director.root.device}Z(e,[{key:"subModels",get:function(){return this._subModels}},{key:"inited",get:function(){return this._inited}},{key:"worldBounds",get:function(){return this._worldBounds}},{key:"modelBounds",get:function(){return this._modelBounds}},{key:"localBuffer",get:function(){return this._localBuffer}},{key:"updateStamp",get:function(){return this._updateStamp}},{key:"isInstancingEnabled",get:function(){return this._instMatWorldIdx>=0}},{key:"receiveShadow",get:function(){return!!pr.get(this._handle,hr.RECEIVE_SHADOW)},set:function(e){pr.set(this._handle,hr.RECEIVE_SHADOW,e?1:0),this.onMacroPatchesStateChanged()}},{key:"castShadow",get:function(){return!!pr.get(this._handle,hr.CAST_SHADOW)},set:function(e){pr.set(this._handle,hr.CAST_SHADOW,e?1:0)}},{key:"handle",get:function(){return this._handle}},{key:"node",get:function(){return this._node},set:function(e){this._node=e,pr.set(this._handle,hr.NODE,e.handle)}},{key:"transform",get:function(){return this._transform},set:function(e){this._transform=e,pr.set(this._handle,hr.TRANSFORM,e.handle)}},{key:"visFlags",get:function(){return pr.get(this._handle,hr.VIS_FLAGS)},set:function(e){pr.set(this._handle,hr.VIS_FLAGS,e)}},{key:"enabled",get:function(){return!!pr.get(this._handle,hr.ENABLED)},set:function(e){pr.set(this._handle,hr.ENABLED,e?1:0)}}]);var t=e.prototype;return t.initialize=function(){if(!this._inited){this._handle=pr.alloc();var e=$i.alloc(),t=tr.alloc();pr.set(this._handle,hr.INSTANCED_ATTR_ARRAY,t),pr.set(this._handle,hr.SUB_MODEL_ARRAY,e),pr.set(this._handle,hr.VIS_FLAGS,ql.Enum.NONE),pr.set(this._handle,hr.ENABLED,1),pr.set(this._handle,hr.RECEIVE_SHADOW,1),pr.set(this._handle,hr.CAST_SHADOW,0),this._inited=!0}},t.destroy=function(){for(var e=this._subModels,t=0;t<e.length;t++){var n=this._subModels[t];n.destroy(),Ad.free(n)}if(this._localBuffer&&(this._localBuffer.destroy(),this._localBuffer=null),this._worldBounds=null,this._modelBounds=null,this._subModels.length=0,this._inited=!1,this._transformUpdated=!0,this._transform=null,this._node=null,this.isDynamicBatching=!1,this._handle){var i=pr.get(this._handle,hr.SUB_MODEL_ARRAY);i&&$i.free(i);var r=pr.get(this._handle,hr.INSTANCED_BUFFER);r&&ar.free(r);var o=pr.get(this._handle,hr.INSTANCED_ATTR_ARRAY);o&&Wi(o,tr,Sd),pr.free(this._handle),this._handle=Yi}this._hWorldBounds&&(Sr.free(this._hWorldBounds),this._hWorldBounds=Yi)},t.attachToScene=function(e){this.scene=e},t.detachFromScene=function(){this.scene=null},t.updateTransform=function(){var e=this.transform;if(e.hasChangedFlags||e._dirtyFlags){e.updateWorldTransform(),this._transformUpdated=!0;var t=this._worldBounds;this._modelBounds&&t&&(this._modelBounds.transform(e._mat,e._pos,e._rot,e._scale,t),Sr.setVec3(this._hWorldBounds,vr.CENTER,t.center),Sr.setVec3(this._hWorldBounds,vr.HALF_EXTENSION,t.halfExtents))}},t.updateWorldBound=function(){var e=this.transform;if(null!==e){e.updateWorldTransform(),this._transformUpdated=!0;var t=this._worldBounds;this._modelBounds&&t&&(this._modelBounds.transform(e._mat,e._pos,e._rot,e._scale,t),Sr.setVec3(this._hWorldBounds,vr.CENTER,t.center),Sr.setVec3(this._hWorldBounds,vr.HALF_EXTENSION,t.halfExtents))}},t.updateUBOs=function(e){for(var t=this._subModels,n=0;n<t.length;n++)t[n].update();if(this._updateStamp=e,this._transformUpdated){this._transformUpdated=!1;var i=this.transform._mat,r=this._instMatWorldIdx;if(r>=0){var o=this.instancedAttributes.views;!function(e,t,n,i){t[0]=e.m00,t[1]=e.m01,t[2]=e.m02,t[3]=e.m12,n[0]=e.m04,n[1]=e.m05,n[2]=e.m06,n[3]=e.m13,i[0]=e.m08,i[1]=e.m09,i[2]=e.m10,i[3]=e.m14}(i,o[r],o[r+1],o[r+2])}else this._localBuffer&&(Zn.toArray(this._localData,i,du.MAT_WORLD_OFFSET),Zn.inverseTranspose(Td,i),Zn.toArray(this._localData,Td,du.MAT_WORLD_IT_OFFSET),this._localBuffer.update(this._localData))}},t.createBoundingShape=function(e,t){e&&t&&(this._modelBounds=dl.fromPoints(dl.create(),e,t),this._worldBounds=dl.clone(this._modelBounds),this._hWorldBounds===Yi&&(this._hWorldBounds=Sr.alloc(),pr.set(this._handle,hr.WORLD_BOUNDS,this._hWorldBounds)),Sr.setVec3(this._hWorldBounds,vr.CENTER,this._worldBounds.center),Sr.setVec3(this._hWorldBounds,vr.HALF_EXTENSION,this._worldBounds.halfExtents))},t.initSubModel=function(e,t,n){this.initialize();var i=!1;if(null==this._subModels[e]?(this._subModels[e]=Ad.alloc(),i=!0):this._subModels[e].destroy(),this._subModels[e].initialize(t,n.passes,this.getMacroPatches(e)),this._subModels[e].initPlanarShadowShader(),this._updateAttributesAndBinding(e),i){var r=pr.get(this._handle,hr.SUB_MODEL_ARRAY);$i.assign(r,e,this._subModels[e].handle)}},t.setSubModelMesh=function(e,t){this._subModels[e]&&(this._subModels[e].subMesh=t)},t.setSubModelMaterial=function(e,t){this._subModels[e]&&(this._subModels[e].passes=t.passes,this._updateAttributesAndBinding(e))},t.onGlobalPipelineStateChanged=function(){for(var e=this._subModels,t=0;t<e.length;t++)e[t].onPipelineStateChanged()},t.onMacroPatchesStateChanged=function(){for(var e=this._subModels,t=0;t<e.length;t++)e[t].onMacroPatchesStateChanged(this.getMacroPatches(t))},t.updateLightingmap=function(e,t){oi.toArray(this._localData,t,du.LIGHTINGMAP_UVPARAM),this._lightmap=e,this._lightmapUVParam=t,null===e&&(e=id.get("empty-texture"));var n=e.getGFXTexture();if(n)for(var i=df.getSampler(this._device,e.mipmaps.length>1?Wd:jd),r=this._subModels,o=0;o<r.length;o++){var a=r[o].descriptorSet;a.bindTexture(Lu,n),a.bindSampler(Lu,i),a.update()}},t.getMacroPatches=function(){return this.receiveShadow?Cd:null},t._updateAttributesAndBinding=function(e){var t=this._subModels[e];if(t){this._initLocalDescriptors(e),this._updateLocalDescriptors(e,t.descriptorSet);var n=Xi.get(fr.get(t.handle,cr.SHADER_0));this._updateInstancedAttributes(n.attributes,t.passes[0])}},t._getInstancedAttributeIndex=function(e){for(var t=this.instancedAttributes.attributes,n=0;n<t.length;n++)if(t[n].name===e)return n;return-1},t._updateInstancedAttributes=function(e,t){if(t.device.hasFeature(Ra.INSTANCED_ARRAYS)){var n=pr.get(this._handle,hr.INSTANCED_BUFFER);n&&ar.free(n);var i=pr.get(this._handle,hr.INSTANCED_ATTR_ARRAY);i&&Wi(i,tr,Sd,!1);for(var r=0,o=0;o<e.length;o++){var a=e[o];a.isInstanced&&(r+=Ma[a.format].size)}var s=ar.alloc(r),c=ar.getBuffer(s);pr.set(this._handle,hr.INSTANCED_BUFFER,s);var l=this.instancedAttributes;l.buffer=new Uint8Array(c),l.views.length=l.attributes.length=0;for(var u=0,h=0;h<e.length;h++){var _=e[h];if(_.isInstanced){var f=Sd.alloc(),m=Sd.get(f);m.format=_.format,m.name=_.name,m.isNormalized=_.isNormalized,m.location=_.location,l.attributes.push(m),tr.push(i,f);var d=Ma[_.format];l.views.push(new(Ba(d))(c,u,d.count)),u+=d.size}}t.batchingScheme===ed.INSTANCING&&xd.get(t).destroy(),this._instMatWorldIdx=this._getInstancedAttributeIndex("a_matWorld0"),this._transformUpdated=!0}},t._initLocalDescriptors=function(){this._localBuffer||(this._localBuffer=this._device.createBuffer(new ka(Qo.UNIFORM|Qo.TRANSFER_DST,Zo.HOST|Zo.DEVICE,du.SIZE,du.SIZE)))},t._updateLocalDescriptors=function(e,t){this._localBuffer&&t.bindBuffer(du.BINDING,this._localBuffer)},e}()),Yd=e("ee",mh("cc.EffectAsset")((Md=Pd=function(e){function t(){for(var t,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return ie(t=e.call.apply(e,[this].concat(i))||this,"techniques",bd,ee(t)),ie(t,"shaders",Rd,ee(t)),ie(t,"combinations",Od,ee(t)),ie(t,"hideInEditor",Nd,ee(t)),t}$(t,e),t.register=function(e){t._effects[e.name]=e},t.remove=function(e){if(t._effects[e])delete t._effects[e];else for(var n in t._effects)if(t._effects[n]._uuid===e)return void delete t._effects[n]},t.get=function(e){if(t._effects[e])return t._effects[e];for(var n in t._effects)if(t._effects[n]._uuid===e)return t._effects[n];return null},t.getAll=function(){return t._effects};var n=t.prototype;return n.onLoaded=function(){Zm.register(this),t.register(this),c.game.once(c.Game.EVENT_ENGINE_INITED,this._precompile,this)},n._precompile=function(){for(var e=this,t=c.director.root,n=function(n){var i=e.shaders[n],r=e.combinations[n];if(!r)return"continue";Object.keys(r).reduce((function(e,t){return e.reduce((function(e,n){var i=r[t],o=[n].concat([].concat(Array(i.length-1)).map((function(){return J({},n)})));return o.forEach((function(e,n){return e[t]=i[n]})),e.concat(o)}),[])}),[{}]).forEach((function(e){return Zm.getGFXShader(t.device,i.name,e,t.pipeline)}))},i=0;i<this.shaders.length;i++)n(i)},n.destroy=function(){return t.remove(this.name),e.prototype.destroy.call(this)},t}(B_),Pd._effects={},bd=re((Id=Md).prototype,"techniques",[yh,bh],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),Rd=re(Id.prototype,"shaders",[yh,bh],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),Od=re(Id.prototype,"combinations",[yh,bh],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),Nd=re(Id.prototype,"hideInEditor",[yh,xh],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),wd=Id))||wd);c.EffectAsset=Yd;var Xd=new be("RenderTex"),Kd=new Es;Kd.endLayout=xa.SHADER_READONLY_OPTIMAL;var Qd,Zd,Jd,$d,ep,tp,np,ip,rp,op,ap=new Ss,sp=new As([Kd],ap),cp={width:1,height:1,renderPassInfo:sp},lp=e("ef",(Dd=mh("cc.RenderTexture"),Ld=Mh(),Fd=Dh(),zd=Mh(),Bd=Dh(),Dd((Vd=function(e){function t(){var t;return ie(t=e.call(this)||this,"_width",Hd,ee(t)),ie(t,"_height",kd,ee(t)),t._textureHash=0,t._id=void 0,t._window=null,t._id=Xd.getNewId(),t._textureHash=es(t._id,666),t}$(t,e);var n=t.prototype;return n.getHash=function(){return this._textureHash},n.initialize=function(e){this._name=e.name||"",this._width=e.width,this._height=e.height,this._initWindow(e)},n.reset=function(e){this.initialize(e)},n.destroy=function(){return this._window&&(c.director.root.destroyWindow(this._window),this._window=null),e.prototype.destroy.call(this)},n.resize=function(e,t){this._width=e,this._height=t,this._window&&this._window.resize(e,t),this.emit("resize",this._window)},n.getGFXTexture=function(){return this._window&&this._window.framebuffer.colorTextures[0]},n.getGFXSampler=function(){var e=c.director.root;return df.getSampler(e.device,Z_)},n.getSamplerHash=function(){return Z_},n.onLoaded=function(){this._initWindow(),this.loaded=!0,this.emit("load")},n._initWindow=function(e){var t=c.director.root;cp.title=this._name,cp.width=this._width,cp.height=this._height,cp.renderPassInfo=e&&e.passInfo?e.passInfo:sp,this._window?(this._window.destroy(),this._window.initialize(t.device,cp)):this._window=t.createWindow(cp)},Z(t,[{key:"width",get:function(){return this._width}},{key:"height",get:function(){return this._height}},{key:"window",get:function(){return this._window}}]),t}(B_),Hd=re((Gd=Vd).prototype,"_width",[yh,Ld,Fd],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),kd=re(Gd.prototype,"_height",[yh,zd,Bd],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),Ud=Gd))||Ud));c.RenderTexture=lp;var up=e("bK",(Qd=mh("cc.Material"),Zd=Vh(Yd),Qd((op=function(e){function t(){var t;return ie(t=e.call(this)||this,"_effectAsset",ep,ee(t)),ie(t,"_techIdx",tp,ee(t)),ie(t,"_defines",np,ee(t)),ie(t,"_states",ip,ee(t)),ie(t,"_props",rp,ee(t)),t._passes=[],t._hash=0,t.loaded=!1,t}$(t,e),t.getHash=function(e){for(var t,n=0,i=ne(e.passes);!(t=i()).done;)n^=t.value.hash;return n};var n=t.prototype;return n.initialize=function(e){this._defines||(this._defines=[]),this._states||(this._states=[]),this._props||(this._props=[]),void 0!==e.technique&&(this._techIdx=e.technique),e.effectAsset?this._effectAsset=e.effectAsset:e.effectName&&(this._effectAsset=Yd.get(e.effectName)),e.defines&&this._prepareInfo(e.defines,this._defines),e.states&&this._prepareInfo(e.states,this._states),this._update()},n.reset=function(e){this.initialize(e)},n.destroy=function(){return this._doDestroy(),e.prototype.destroy.call(this)},n.recompileShaders=function(){console.warn("Shaders in material asset '"+this.name+"' cannot be modified at runtime, please instantiate the material first.")},n.overridePipelineStates=function(){console.warn("Pipeline states in material asset '"+this.name+"' cannot be modified at runtime, please instantiate the material first.")},n.onLoaded=function(){this._update(),this.loaded=!0,this.emit("load")},n.resetUniforms=function(e){void 0===e&&(e=!0),this._props.length=this._passes.length;for(var t=0;t<this._props.length;t++)this._props[t]={};if(e)for(var n,i=ne(this._passes);!(n=i()).done;){var r=n.value;r.resetUBOs(),r.resetTextures()}},n.setProperty=function(e,t,n){var i=!1;if(void 0===n)for(var r=this._passes,o=r.length,a=0;a<o;a++){var s=r[a];this._uploadProperty(s,e,t)&&(this._props[s.propertyIndex][e]=t,i=!0)}else{if(n>=this._passes.length)return void console.warn("illegal pass index: "+n+".");var c=this._passes[n];this._uploadProperty(c,e,t)&&(this._props[c.propertyIndex][e]=t,i=!0)}i||console.warn("illegal property name: "+e+".")},n.getProperty=function(e,t){if(void 0===t)for(var n=this._props,i=n.length,r=0;r<i;r++){var o=n[r];if(e in o)return o[e]}else{if(t>=this._props.length)return console.warn("illegal pass index: "+t+"."),null;var a=this._props[this._passes[t].propertyIndex];if(e in a)return a[e]}return null},n.copy=function(e){this._techIdx=e._techIdx,this._props.length=e._props.length;for(var t=0;t<e._props.length;t++)this._props[t]=J({},e._props[t]);this._defines.length=e._defines.length;for(var n=0;n<e._defines.length;n++)this._defines[n]=J({},e._defines[n]);this._states.length=e._states.length;for(var i=0;i<e._states.length;i++)this._states[i]=J({},e._states[i]);this._effectAsset=e._effectAsset,this._update()},n._prepareInfo=function(e,t){var n=e;if(!Array.isArray(n)){var i=this._effectAsset?this._effectAsset.techniques[this._techIdx].passes.length:1;n=Array(i).fill(n)}for(var r=0;r<n.length;++r)Object.assign(t[r]||(t[r]={}),n[r])},n._createPasses=function(){var e=this._effectAsset.techniques[this._techIdx||0];if(!e)return[];for(var t=e.passes.length,n=[],i=0;i<t;++i){var r=e.passes[i],o=r.passIndex=i,a=r.defines=this._defines[o]||(this._defines[o]={}),s=r.stateOverrides=this._states[o]||(this._states[o]={});if(void 0!==r.propertyIndex&&(Object.assign(a,this._defines[r.propertyIndex]),Object.assign(s,this._states[r.propertyIndex])),void 0!==r.embeddedMacros&&Object.assign(a,r.embeddedMacros),!r.switch||a[r.switch]){var l=new cd(c.director.root);l.initialize(r),n.push(l)}}return n},n._update=function(e){var n=this;if(void 0===e&&(e=!0),this._effectAsset){if(this._passes&&this._passes.length)for(var i,r=ne(this._passes);!(i=r()).done;)i.value.destroy();this._passes=this._createPasses();var o=this._effectAsset.techniques[this._techIdx].passes.length;if(this._props.length=o,e)this._passes.forEach((function(e,t){var i=n._props[t];for(var r in i||(i=n._props[t]={}),void 0!==e.propertyIndex&&Object.assign(i,n._props[e.propertyIndex]),i)n._uploadProperty(e,r,i[r])}));else for(var a=0;a<this._props.length;a++)this._props[a]={}}else{var s=id.get("missing-effect-material");s&&(this._passes=s._passes.slice())}this._hash=t.getHash(this)},n._uploadProperty=function(e,t,n){var i=e.getHandle(t);if(!i)return!1;var r=cd.getPropertyTypeFromHandle(i);if(r===Nm.UBO)Array.isArray(n)?e.setUniformArray(i,n):null!==n?e.setUniform(i,n):e.resetUniform(t);else if(r===Nm.SAMPLER)if(Array.isArray(n))for(var o=0;o<n.length;o++)this._bindTexture(e,i,n[o],o);else n?this._bindTexture(e,i,n):e.resetTexture(t);return!0},n._bindTexture=function(e,t,n,i){var r=cd.getBindingFromHandle(t);if(n instanceof zs)e.bindTexture(r,n,i);else if(n instanceof vf||n instanceof lp){var o=n.getGFXTexture();if(!o||!o.width||!o.height)return;e.bindTexture(r,o,i),e.bindSampler(r,n.getGFXSampler(),i)}},n._doDestroy=function(){if(this._passes&&this._passes.length)for(var e,t=ne(this._passes);!(e=t()).done;)e.value.destroy();this._effectAsset=null,this._passes.length=0,this._props.length=0,this._defines.length=0,this._states.length=0},Z(t,[{key:"effectAsset",get:function(){return this._effectAsset}},{key:"effectName",get:function(){return this._effectAsset?this._effectAsset.name:""}},{key:"technique",get:function(){return this._techIdx}},{key:"passes",get:function(){return this._passes}},{key:"hash",get:function(){return this._hash}},{key:"parent",get:function(){return null}},{key:"owner",get:function(){return null}}]),t}(B_),ep=re(($d=op).prototype,"_effectAsset",[Zd],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),tp=re($d.prototype,"_techIdx",[yh],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),np=re($d.prototype,"_defines",[yh],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),ip=re($d.prototype,"_states",[yh],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),rp=re($d.prototype,"_props",[yh],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),Jd=$d))||Jd));c.Material=up;var hp=vt({Planar:0,ShadowMap:1}),_p=vt({HARD:0,FILTER_X5:1,FILTER_X9:2,FILTER_X25:3}),fp=hp.ShadowMap+1,mp=function(){function e(){this.sphere=new jo(0,0,0,.01),this.maxReceived=4,this._normal=new Fn(0,1,0),this._shadowColor=new Dn(0,0,0,76),this._matLight=new Zn,this._material=null,this._instancingMaterial=null,this._size=new ti(512,512),this._handle=Yi,this._handle=Jr.alloc()}Z(e,[{key:"enabled",get:function(){return!!Jr.get(this._handle,Xr.ENABLE)},set:function(e){Jr.set(this._handle,Xr.ENABLE,e?1:0),e||Jr.set(this._handle,Xr.TYPE,fp),this.activate()}},{key:"normal",get:function(){return this._normal},set:function(e){Fn.copy(this._normal,e),Jr.setVec3(this._handle,Xr.NORMAL,this._normal)}},{key:"distance",get:function(){return Jr.get(this._handle,Xr.DISTANCE)},set:function(e){Jr.set(this._handle,Xr.DISTANCE,e)}},{key:"shadowColor",get:function(){return this._shadowColor},set:function(e){this._shadowColor=e,Jr.setVec4(this._handle,Xr.COLOR,e)}},{key:"type",get:function(){return Jr.get(this._handle,Xr.TYPE)},set:function(e){Jr.set(this._handle,Xr.TYPE,this.enabled?e:fp),this.activate()}},{key:"near",get:function(){return Jr.get(this._handle,Xr.NEAR)},set:function(e){Jr.set(this._handle,Xr.NEAR,e)}},{key:"far",get:function(){return Jr.get(this._handle,Xr.FAR)},set:function(e){Jr.set(this._handle,Xr.FAR,e)}},{key:"aspect",get:function(){return Jr.get(this._handle,Xr.ASPECT)},set:function(e){Jr.set(this._handle,Xr.ASPECT,e)}},{key:"orthoSize",get:function(){return Jr.get(this._handle,Xr.ORTHO_SIZE)},set:function(e){Jr.set(this._handle,Xr.ORTHO_SIZE,e)}},{key:"size",get:function(){return this._size},set:function(e){this._size=e,Jr.setVec2(this._handle,Xr.SIZE,this._size)}},{key:"pcf",get:function(){return Jr.get(this._handle,Xr.PCF_TYPE)},set:function(e){Jr.set(this._handle,Xr.PCF_TYPE,e)}},{key:"shadowMapDirty",get:function(){return!!Jr.get(this._handle,Xr.SHADOW_MAP_DIRTY)},set:function(e){Jr.set(this._handle,Xr.SHADOW_MAP_DIRTY,e?1:0)}},{key:"bias",get:function(){return Jr.get(this._handle,Xr.BIAS)},set:function(e){Jr.set(this._handle,Xr.BIAS,e)}},{key:"autoAdapt",get:function(){return!!Jr.get(this._handle,Xr.AUTO_ADAPT)},set:function(e){Jr.set(this._handle,Xr.AUTO_ADAPT,e?1:0)}},{key:"matLight",get:function(){return this._matLight}},{key:"material",get:function(){return this._material}},{key:"instancingMaterial",get:function(){return this._instancingMaterial}},{key:"handle",get:function(){return this._handle}}]);var t=e.prototype;return t.getPlanarShader=function(e){return this._material||(this._material=new up,this._material.initialize({effectName:"planar-shadow"}),Jr.set(this._handle,Xr.PLANAR_PASS,this._material.passes[0].handle)),this._material.passes[0].getShaderVariant(e)},t.initialize=function(e){Jr.set(this._handle,Xr.TYPE,e.enabled?e.type:fp),Jr.set(this._handle,Xr.NEAR,e.near),Jr.set(this._handle,Xr.FAR,e.far),Jr.set(this._handle,Xr.ASPECT,e.aspect),Jr.set(this._handle,Xr.ORTHO_SIZE,e.orthoSize),this._size=e.shadowMapSize,Jr.setVec2(this._handle,Xr.SIZE,this._size),Jr.set(this._handle,Xr.PCF_TYPE,e.pcf),Fn.copy(this._normal,e.normal),Jr.setVec3(this._handle,Xr.NORMAL,this._normal),Jr.set(this._handle,Xr.DISTANCE,e.distance),this._shadowColor.set(e.shadowColor),Jr.setVec4(this._handle,Xr.COLOR,this._shadowColor),Jr.set(this._handle,Xr.BIAS,e.bias),Jr.set(this._handle,Xr.ENABLE,e.enabled?1:0),this.maxReceived=e.maxReceived,Jr.set(this._handle,Xr.AUTO_ADAPT,e.autoAdapt?1:0)},t.activate=function(){if(this.enabled)this.type===hp.ShadowMap?this._updatePipeline():this._updatePlanarInfo();else{var e=c.director.root;e.pipeline.macros.CC_RECEIVE_SHADOW=0,e.onGlobalPipelineStateChanged()}},t._updatePlanarInfo=function(){this._material||(this._material=new up,this._material.initialize({effectName:"planar-shadow"}),Jr.set(this._handle,Xr.PLANAR_PASS,this._material.passes[0].handle)),this._instancingMaterial||(this._instancingMaterial=new up,this._instancingMaterial.initialize({effectName:"planar-shadow",defines:{USE_INSTANCING:!0}}),Jr.set(this._handle,Xr.INSTANCE_PASS,this._instancingMaterial.passes[0].handle));var e=c.director.root;e.pipeline.macros.CC_RECEIVE_SHADOW=0,e.onGlobalPipelineStateChanged()},t._updatePipeline=function(){var e=c.director.root;e.pipeline.macros.CC_RECEIVE_SHADOW=1,e.onGlobalPipelineStateChanged()},t.destroy=function(){this._material&&this._material.destroy(),this._instancingMaterial&&this._instancingMaterial.destroy(),this._handle&&(Jr.free(this._handle),this._handle=Yi),this.sphere.destroy()},e}();mp.MAX_FAR=2e3,mp.COEFFICIENT_OF_EXPANSION=2*Math.sqrt(3),c.Shadows=mp;var dp=function(e){function t(t,n){var i;(i=e.call(this,t.root)||this)._parent=void 0,i._owner=void 0,i._dontNotify=!1,i._parent=t,i._owner=n,i._doInit(i._parent,!0);for(var r=0;r<i._shaderInfo.blocks.length;r++){var o=i._shaderInfo.blocks[r],a=i._blocks[o.binding],s=i._parent.blocks[o.binding];a.set(s)}i._rootBufferDirty=!0;for(var c=i._parent,l=0;l<i._shaderInfo.samplers.length;l++)for(var u=i._shaderInfo.samplers[l],h=0;h<u.count;h++){var _=c._descriptorSet.getSampler(u.binding,h),f=c._descriptorSet.getTexture(u.binding,h);i._descriptorSet.bindSampler(u.binding,_,h),i._descriptorSet.bindTexture(u.binding,f,h)}return e.prototype.tryCompile.call(ee(i)),i}$(t,e),Z(t,[{key:"parent",get:function(){return this._parent}}]);var n=t.prototype;return n.overridePipelineStates=function(e,t){this._bs.reset(),this._rs.reset(),this._dss.reset(),cd.fillPipelineInfo(this,e),cd.fillPipelineInfo(this,t),this._onStateChange()},n.tryCompile=function(t){if(t&&!Vm(this._defines,t))return!1;var n=e.prototype.tryCompile.call(this);return this._onStateChange(),n},n.beginChangeStatesSilently=function(){this._dontNotify=!0},n.endChangeStatesSilently=function(){this._dontNotify=!1},n._syncBatchingScheme=function(){this._defines.USE_BATCHING=this._defines.USE_INSTANCING=!1,ur.set(this._handle,qi.BATCHING_SCHEME,0)},n._onStateChange=function(){ur.set(this._handle,qi.HASH,cd.getPassHash(this,this._hShaderDefault)),this._owner.onPassStateChange(this._dontNotify)},t}(cd),pp=e("c9",function(e){function t(t){var n;return(n=e.call(this)||this)._passes=[],n._parent=void 0,n._owner=void 0,n._subModelIdx=0,n._parent=t.parent,n._owner=t.owner||null,n._subModelIdx=t.subModelIdx||0,n.copy(n._parent),n}$(t,e),Z(t,[{key:"parent",get:function(){return this._parent}},{key:"owner",get:function(){return this._owner}}]);var n=t.prototype;return n.recompileShaders=function(e,t){if(this._passes&&this.effectAsset)if(void 0===t)for(var n,i=ne(this._passes);!(n=i()).done;)n.value.tryCompile(e);else this._passes[t].tryCompile(e)},n.overridePipelineStates=function(e,t){if(this._passes&&this.effectAsset){var n=this.effectAsset.techniques[this.technique].passes;if(void 0===t)for(var i=0;i<this._passes.length;i++){var r=this._passes[i],o=this._states[i]||(this._states[i]={});for(var a in e)o[a]=e[a];r.overridePipelineStates(n[r.passIndex],o)}else{var s=this._states[t]||(this._states[t]={});for(var c in e)s[c]=e[c];this._passes[t].overridePipelineStates(n[t],s)}}},n.destroy=function(){return this._doDestroy(),!0},n.onPassStateChange=function(e){this._hash=up.getHash(this),!e&&this._owner&&this._owner._onRebuildPSO(this._subModelIdx,this)},n._createPasses=function(){var e=[],t=this._parent.passes;if(!t)return e;for(var n=0;n<t.length;++n)e.push(new dp(t[n],this));return e},t}(up)),vp=null,gp=null,yp=function(){function e(){this._envmap=null,this._globalDescriptorSet=null,this._model=null,this._default=null,this._handle=Yi,this._handle=qr.alloc()}Z(e,[{key:"model",get:function(){return this._model}},{key:"enabled",get:function(){return qr.get(this._handle,kr.ENABLE)},set:function(e){e?this.activate():this._updatePipeline(),qr.set(this._handle,kr.ENABLE,e?1:0)}},{key:"useIBL",get:function(){return qr.get(this._handle,kr.USE_IBL)},set:function(e){qr.set(this._handle,kr.USE_IBL,e?1:0),this._updatePipeline()}},{key:"isRGBE",get:function(){return qr.get(this._handle,kr.IS_RGBE)},set:function(e){e&&(gp&&gp.recompileShaders({USE_RGBE_CUBEMAP:e}),this._model&&this._model.setSubModelMaterial(0,gp)),qr.set(this._handle,kr.IS_RGBE,e?1:0),this._updatePipeline()}},{key:"envmap",get:function(){return this._envmap},set:function(e){this._envmap=e||this._default,this._envmap&&(c.director.root.pipeline.ambient.albedoArray[3]=this._envmap.mipmapLevel,this._updateGlobalBinding())}},{key:"handle",get:function(){return this._handle}}]);var t=e.prototype;return t.initialize=function(e){qr.set(this._handle,kr.ENABLE,e.enabled?1:0),qr.set(this._handle,kr.USE_IBL,e.useIBL?1:0),qr.set(this._handle,kr.IS_RGBE,e.isRGBE?1:0),this._envmap=e.envmap},t.activate=function(){var e=c.director.root.pipeline;if(this._globalDescriptorSet=e.descriptorSet,this._default=id.get("default-cube-texture"),this._model||(this._model=c.director.root.createModel(c.renderer.scene.Model),this._model._initLocalDescriptors=function(){}),qr.set(this._handle,kr.MODEL,this._model.handle),this._envmap||(this._envmap=this._default),e.ambient.groundAlbedo[3]=this._envmap.mipmapLevel,gp)gp.recompileShaders({USE_RGBE_CUBEMAP:this.isRGBE});else{var t=new up;t.initialize({effectName:"skybox",defines:{USE_RGBE_CUBEMAP:this.isRGBE}}),gp=new pp({parent:t})}this.enabled&&(vp||(vp=c.utils.createMesh(c.primitives.box({width:2,height:2,length:2}))),this._model.initSubModel(0,vp.renderingSubMeshes[0],gp)),this._updateGlobalBinding(),this._updatePipeline()},t._updatePipeline=function(){var e=this.useIBL?this.isRGBE?2:1:0,t=c.director.root,n=t.pipeline;n.macros.CC_USE_IBL!==e&&(n.macros.CC_USE_IBL=e,t.onGlobalPipelineStateChanged())},t._updateGlobalBinding=function(){var e=this.envmap.getGFXTexture(),t=df.getSampler(c.director._device,this.envmap.getSamplerHash());this._globalDescriptorSet.bindSampler(lu,t),this._globalDescriptorSet.bindTexture(lu,e)},t.destroy=function(){this._handle&&(qr.free(this._handle),this._handle=Yi)},e}();c.Skybox=yp;var xp,Ep,Sp=e("bp",function(e){function t(){var t;return(t=e.call(this)||this)._needUpdate=!1,t._pos=void 0,t._aabb=void 0,t._hAABB=Yi,t._aabb=dl.create(),t._pos=new Fn,t}$(t,e),Z(t,[{key:"position",get:function(){return this._pos}},{key:"size",set:function(e){to.set(this._handle,Zr.SIZE,e)},get:function(){return to.get(this._handle,Zr.SIZE)}},{key:"range",set:function(e){to.set(this._handle,Zr.RANGE,e),this._needUpdate=!0},get:function(){return to.get(this._handle,Zr.RANGE)}},{key:"luminance",set:function(e){to.set(this._handle,Zr.ILLUMINANCE,e)},get:function(){return to.get(this._handle,Zr.ILLUMINANCE)}},{key:"aabb",get:function(){return this._aabb}}]);var n=t.prototype;return n.initialize=function(){e.prototype.initialize.call(this),this._hAABB=Sr.alloc(),to.set(this._handle,Zr.TYPE,ud.SPHERE),to.set(this._handle,Zr.SIZE,.15),to.set(this._handle,Zr.RANGE,1),to.set(this._handle,Zr.AABB,this._hAABB),to.set(this._handle,Zr.ILLUMINANCE,1700/fd(.15))},n.update=function(){if(this._node&&(this._node.hasChangedFlags||this._needUpdate)){this._node.getWorldPosition(this._pos);var e=to.get(this._handle,Zr.RANGE);dl.set(this._aabb,this._pos.x,this._pos.y,this._pos.z,e,e,e),this._needUpdate=!1,to.setVec3(this._handle,Zr.POSITION,this._pos),Sr.setVec3(this._hAABB,vr.CENTER,this._aabb.center),Sr.setVec3(this._hAABB,vr.HALF_EXTENSION,this._aabb.halfExtents)}},n.destroy=function(){return this._hAABB&&(Sr.free(this._hAABB),this._hAABB=Yi),e.prototype.destroy.call(this)},t}(md)),Tp=new Fn(0,0,-1),Ap=new Vn,Cp=new Zn,wp=new Zn,Ip=new Zn,bp=new Zn,Rp=e("br",function(e){function t(){var t;return(t=e.call(this)||this)._dir=new Fn(1,-1,-1),t._range=5,t._spotAngle=Math.cos(Math.PI/6),t._pos=void 0,t._aabb=void 0,t._frustum=void 0,t._angle=0,t._needUpdate=!1,t._hAABB=Yi,t._hFrustum=Yi,t._aabb=dl.create(),t._frustum=Cl.create(),t._pos=new Fn,t}$(t,e),Z(t,[{key:"position",get:function(){return this._pos}},{key:"size",set:function(e){to.set(this._handle,Zr.SIZE,e)},get:function(){return to.get(this._handle,Zr.SIZE)}},{key:"range",set:function(e){this._range=e,to.set(this._handle,Zr.RANGE,e),this._needUpdate=!0},get:function(){return to.get(this._handle,Zr.RANGE)}},{key:"luminance",set:function(e){to.set(this._handle,Zr.ILLUMINANCE,e)},get:function(){return to.get(this._handle,Zr.ILLUMINANCE)}},{key:"direction",get:function(){return this._dir}},{key:"spotAngle",get:function(){return to.get(this._handle,Zr.SPOT_ANGLE)},set:function(e){this._angle=e,to.set(this._handle,Zr.SPOT_ANGLE,Math.cos(.5*e)),this._needUpdate=!0}},{key:"aspect",set:function(e){to.set(this._handle,Zr.ASPECT,e),this._needUpdate=!0},get:function(){return to.get(this._handle,Zr.ASPECT)}},{key:"aabb",get:function(){return this._aabb}},{key:"frustum",get:function(){return this._frustum}}]);var n=t.prototype;return n.initialize=function(){e.prototype.initialize.call(this),this._hAABB=Sr.alloc(),this._hFrustum=Gr.alloc(),to.set(this._handle,Zr.TYPE,ud.SPOT),to.set(this._handle,Zr.SIZE,.15),to.set(this._handle,Zr.AABB,this._hAABB),to.set(this._handle,Zr.ILLUMINANCE,1700/fd(.15)),to.set(this._handle,Zr.RANGE,Math.cos(Math.PI/6)),to.set(this._handle,Zr.ASPECT,1),to.setVec3(this._handle,Zr.DIRECTION,this._dir)},n.update=function(){this._node&&(this._node.hasChangedFlags||this._needUpdate)&&(this._node.getWorldPosition(this._pos),Fn.transformQuat(this._dir,Tp,this._node.getWorldRotation(Ap)),Fn.normalize(this._dir,this._dir),to.setVec3(this._handle,Zr.DIRECTION,this._dir),dl.set(this._aabb,this._pos.x,this._pos.y,this._pos.z,this._range,this._range,this._range),this._node.getWorldRT(Cp),Zn.invert(Cp,Cp),Zn.perspective(wp,this._angle,1,.001,this._range),Zn.multiply(Ip,wp,Cp),this._frustum.update(Ip,bp),this._needUpdate=!1,to.setVec3(this._handle,Zr.POSITION,this._pos),Sr.setVec3(this._hAABB,vr.CENTER,this._aabb.center),Sr.setVec3(this._hAABB,vr.HALF_EXTENSION,this._aabb.halfExtents),wl(this._hFrustum,this._frustum))},n.destroy=function(){return this._hAABB&&(Sr.free(this._hAABB),this._hAABB=Yi),this._hFrustum&&(Gr.free(this._hFrustum),this._hFrustum=Yi),e.prototype.destroy.call(this)},t}(md)),Op=Object.freeze({__proto__:null,Ambient:So,get CameraFOVAxis(){return Hu},get CameraProjection(){return ku},get CameraAperture(){return Vu},get CameraISO(){return ju},get CameraShutter(){return Wu},SKYBOX_FLAG:ih,Camera:oh,CameraVisFlags:ld,VisibilityFlags:hd,DirectionalLight:vd,ColorTemperatureToRGB:_d,get LightType(){return ud},nt2lm:fd,Light:md,get ModelType(){return Ed},Model:qd,ShadowType:hp,PCFType:_p,Shadows:mp,RenderScene:ah,Skybox:yp,SphereLight:Sp,SpotLight:Rp,SubModel:yd});function Np(e){return--e,e|=e>>16,e|=e>>8,e|=e>>4,e|=e>>2,e|=e>>1,++e}function Pp(e,t){return Math.ceil(e/t)*t}!function(e){e[e.OPAQUE=0]="OPAQUE",e[e.TRANSPARENT=1]="TRANSPARENT",e[e.OVERLAY=2]="OVERLAY"}(xp||(xp={})),function(e){e[e.DEFAULT=1]="DEFAULT",e[e.FORWARD=2]="FORWARD",e[e.SHADOWCAST=4]="SHADOWCAST"}(Ep||(Ep={}));var Mp=e("bv",function(){function e(e){this._device=void 0,this._format=Ko.UNKNOWN,this._formatSize=0,this._chunks=[],this._chunkCount=0,this._handles=[],this._region0=new hs,this._region1=new hs,this._region2=new hs,this._roundUpFn=null,this._bufferViewCtor=Uint8Array,this._channels=4,this._alignment=1,this._device=e}var t=e.prototype;return t.initialize=function(e){var t=Ma[e.format];this._format=e.format,this._formatSize=t.size,this._channels=t.count,this._bufferViewCtor=Ba(t),this._roundUpFn=e.roundUpFn||null,this._alignment=e.alignment||1,e.inOrderFree&&(this.alloc=this._McDonaldAlloc)},t.destroy=function(){for(var e=0;e<this._chunkCount;++e)this._chunks[e].texture.destroy();this._chunks.length=0,this._handles.length=0},t.alloc=function(e,t){e=Pp(e,this._alignment);var n=-1,i=-1;if(void 0!==t&&(n=t,i=this._findAvailableSpace(e,n)),i<0)for(var r=0;r<this._chunkCount&&(n=r,!((i=this._findAvailableSpace(e,n))>=0));++r);if(i>=0){var o=this._chunks[n];o.start+=e;var a={chunkIdx:n,start:i,end:i+e,texture:o.texture};return this._handles.push(a),a}var s=Math.sqrt(e/this._formatSize),c=this._roundUpFn&&this._roundUpFn(s,this._formatSize)||Math.max(1024,Np(s)),l=this._chunks[this.createChunk(c)];l.start+=e;var u={chunkIdx:this._chunkCount-1,start:0,end:e,texture:l.texture};return this._handles.push(u),u},t.free=function(e){for(var t=0;t<this._handles.length;++t)if(this._handles[t]===e)return this._chunks[e.chunkIdx].end=e.end,void this._handles.splice(t,1)},t.createChunk=function(e){var t=e*e*this._formatSize;console.info("TextureBufferPool: Allocate chunk "+this._chunkCount+", size: "+t+", format: "+this._format);var n={texture:this._device.createTexture(new Ds(ha.TEX2D,_a.SAMPLED|_a.TRANSFER_DST,this._format,e,e,ma.IMMUTABLE)),size:t,start:0,end:t};return this._chunks[this._chunkCount]=n,this._chunkCount++},t.update=function(e,t){var n=[],i=[],r=e.start/this._formatSize,o=t.byteLength/this._formatSize,a=r%e.texture.width,s=Math.floor(r/e.texture.width),c=Math.min(e.texture.width-a,o),l=0;a>0&&(this._region0.texOffset.x=a,this._region0.texOffset.y=s,this._region0.texExtent.width=c,this._region0.texExtent.height=1,n.push(new this._bufferViewCtor(t,l*this._formatSize,c*this._channels)),i.push(this._region0),a=0,s+=1,o-=c,l+=c),o>0&&(this._region1.texOffset.x=a,this._region1.texOffset.y=s,o>e.texture.width?(this._region1.texExtent.width=e.texture.width,this._region1.texExtent.height=Math.floor(o/e.texture.width),c=this._region1.texExtent.width*this._region1.texExtent.height):(c=o,this._region1.texExtent.width=c,this._region1.texExtent.height=1),n.push(new this._bufferViewCtor(t,l*this._formatSize,c*this._channels)),i.push(this._region1),a=0,s+=this._region1.texExtent.height,o-=c,l+=c),o>0&&(this._region2.texOffset.x=a,this._region2.texOffset.y=s,this._region2.texExtent.width=o,this._region2.texExtent.height=1,n.push(new this._bufferViewCtor(t,l*this._formatSize,o*this._channels)),i.push(this._region2)),this._device.copyBuffersToTexture(n,e.texture,i)},t._findAvailableSpace=function(e,t){var n=this._chunks[t],i=!1,r=n.start;if(r+e<=n.size)i=!0;else{r=0;for(var o=this._handles.filter((function(e){return e.chunkIdx===t})).sort((function(e,t){return e.start-t.start})),a=0;a<o.length;a++){var s=o[a];if(r+e<=s.start){i=!0;break}r=s.end}!i&&r+e<=n.size&&(i=!0)}return i?r:-1},t._McDonaldAlloc=function(e){e=Pp(e,this._alignment);for(var t=0;t<this._chunkCount;++t){var n=this._chunks[t],i=!1,r=n.start;if(r+e<=n.end?i=!0:r>n.end?r+e<=n.size?i=!0:e<=n.end&&(n.start=r=0,i=!0):r===n.end&&(n.start=r=0,n.end=n.size,e<=n.end&&(i=!0)),i){n.start+=e;var o={chunkIdx:t,start:r,end:r+e,texture:n.texture};return this._handles.push(o),o}}var a=Math.sqrt(e/this._formatSize),s=this._roundUpFn&&this._roundUpFn(a,this._formatSize)||Math.max(1024,Np(a)),c=this._chunks[this.createChunk(s)];c.start+=e;var l={chunkIdx:this._chunkCount,start:0,end:e,texture:c.texture};return this._handles.push(l),l},e}()),Dp=function(e){if(void 0===ae[e]){var t=1<<oe;ae[e]=t,oe+=1}},Lp=Object.freeze({__proto__:null,addStage:Dp,scene:Op,createIA:function(e,t){if(!t.positions)return console.error("The data must have positions field"),null;for(var n=[],i=t.positions.length/3,r=0;r<i;++r)n.push(t.positions[3*r],t.positions[3*r+1],t.positions[3*r+2]),t.normals&&n.push(t.normals[3*r],t.normals[3*r+1],t.normals[3*r+2]),t.uvs&&n.push(t.uvs[2*r],t.uvs[2*r+1]),t.colors&&n.push(t.colors[3*r],t.colors[3*r+1],t.colors[3*r+2]);var o=[];o.push(new ts(Yo.ATTR_POSITION,Ko.RGB32F)),t.normals&&o.push(new ts(Yo.ATTR_NORMAL,Ko.RGB32F)),t.uvs&&o.push(new ts(Yo.ATTR_TEX_COORD,Ko.RG32F)),t.colors&&o.push(new ts(Yo.ATTR_COLOR,Ko.RGB32F));var a=e.createBuffer(new ka(Qo.VERTEX|Qo.TRANSFER_DST,Zo.HOST|Zo.DEVICE,4*n.length,4*n.length/i));a.update(new Float32Array(n));var s=null;return t.indices&&(s=e.createBuffer(new ka(Qo.INDEX|Qo.TRANSFER_DST,Zo.HOST|Zo.DEVICE,2*t.indices.length,2))).update(new Uint16Array(t.indices)),e.createInputAssembler(new ns(o,[a],s))},get RenderQueue(){return xp},get PassStage(){return Ep},get PropertyType(){return Nm},genHandle:Mm,getPropertyTypeFromHandle:Dm,getTypeFromHandle:Lm,getSetIndexFromHandle:function(e){return(3145728&e)>>>20},getBindingFromHandle:Fm,getOffsetFromHandle:zm,customizeType:Bm,type2reader:Um,type2writer:Gm,getDefaultFromType:km,overrideMacros:Vm,get BatchingSchemes(){return ed},Pass:cd,getDeviceShaderVersion:Qm,programLib:Zm,get SamplerInfoIndex(){return X_},defaultSamplerHash:Z_,genSamplerHash:ef,samplerLib:df,nearestPOT:Np,TextureBufferPool:Mp,MaterialInstance:pp,PassInstance:dp,ObjectPool:ki,freeHandleArray:Wi,get PoolType(){return Gi},NULL_HANDLE:Yi,ShaderPool:Xi,DSPool:Ki,IAPool:Qi,PipelineLayoutPool:Zi,FramebufferPool:Ji,SubModelArrayPool:$i,ModelArrayPool:er,AttributeArrayPool:tr,FlatBufferArrayPool:nr,LightArrayPool:ir,BlendTargetArrayPool:rr,UIBatchArrayPool:or,RawBufferPool:ar,RawObjectPool:sr,get PassView(){return qi},PassPool:ur,get SubModelView(){return cr},SubModelPool:fr,get ModelView(){return hr},ModelPool:pr,get BatchView2D(){return mr},BatchPool2D:yr,get AABBView(){return vr},AABBPool:Sr,get SceneView(){return xr},ScenePool:Cr,get CameraView(){return Tr},CameraPool:br,get NodeView(){return wr},NodePool:Nr,get RootView(){return Or},RootPool:Dr,get RenderWindowView(){return Pr},RenderWindowPool:zr,get FrustumView(){return Lr},FrustumPool:Gr,get AmbientView(){return Br},AmbientPool:Vr,get SkyboxView(){return kr},SkyboxPool:qr,get FogView(){return jr},FogPool:Kr,get ShadowsView(){return Xr},ShadowsPool:Jr,get LightView(){return Zr},LightPool:to,get SphereView(){return $r},SpherePool:ro,get FlatBufferView(){return io},FlatBufferPool:so,get SubMeshView(){return oo},SubMeshPool:uo,get RasterizerStateView(){return co},RasterizerStatePool:fo,get DepthStencilStateView(){return ho},DepthStencilStatePool:vo,get BlendTargetView(){return mo},BlendTargetPool:yo,get BlendStateView(){return go},BlendStatePool:Eo});function Fp(e){return e*e}function zp(e){return e*(2-e)}function Bp(e){return e*e*e}function Up(e){return--e*e*e+1}function Gp(e){return e*e*e*e}function Hp(e){return 1- --e*e*e*e}function kp(e){return e*e*e*e*e}function Vp(e){return--e*e*e*e*e+1}function jp(e){return 1-Math.cos(e*Math.PI/2)}function Wp(e){return Math.sin(e*Math.PI/2)}function qp(e){return 0===e?0:Math.pow(1024,e-1)}function Yp(e){return 1===e?1:1-Math.pow(2,-10*e)}function Xp(e){return 1-Math.sqrt(1-e*e)}function Kp(e){return Math.sqrt(1- --e*e)}function Qp(e){var t,n=.1;return 0===e?0:1===e?1:(!n||n<1?(n=1,t=.1):t=.4*Math.asin(1/n)/(2*Math.PI),-n*Math.pow(2,10*(e-=1))*Math.sin(2*(e-t)*Math.PI/.4))}function Zp(e){var t,n=.1;return 0===e?0:1===e?1:(!n||n<1?(n=1,t=.1):t=.4*Math.asin(1/n)/(2*Math.PI),n*Math.pow(2,-10*e)*Math.sin(2*(e-t)*Math.PI/.4)+1)}function Jp(e){var t=1.70158;return e*e*((t+1)*e-t)}function $p(e){var t=1.70158;return--e*e*((t+1)*e+t)+1}function ev(e){return 1-tv(1-e)}function tv(e){return e<1/2.75?7.5625*e*e:e<2/2.75?7.5625*(e-=1.5/2.75)*e+.75:e<2.5/2.75?7.5625*(e-=2.25/2.75)*e+.9375:7.5625*(e-=2.625/2.75)*e+.984375}e("dw",Lp);var nv=_v(Fp,zp),iv=_v(Bp,Up),rv=_v(Gp,Hp),ov=_v(kp,Vp),av=_v(jp,Wp),sv=_v(qp,Yp),cv=_v(Xp,Kp),lv=_v(Qp,Zp),uv=_v(Jp,$p),hv=_v(ev,tv);function _v(e,t){return function(n){return n<.5?t(2*n)/2:e(2*n-1)/2+.5}}var fv,mv=Object.freeze({__proto__:null,constant:function(){return 0},linear:function(e){return e},quadIn:Fp,quadOut:zp,quadInOut:function(e){return(e*=2)<1?.5*e*e:-.5*(--e*(e-2)-1)},cubicIn:Bp,cubicOut:Up,cubicInOut:function(e){return(e*=2)<1?.5*e*e*e:.5*((e-=2)*e*e+2)},quartIn:Gp,quartOut:Hp,quartInOut:function(e){return(e*=2)<1?.5*e*e*e*e:-.5*((e-=2)*e*e*e-2)},quintIn:kp,quintOut:Vp,quintInOut:function(e){return(e*=2)<1?.5*e*e*e*e*e:.5*((e-=2)*e*e*e*e+2)},sineIn:jp,sineOut:Wp,sineInOut:function(e){return.5*(1-Math.cos(Math.PI*e))},expoIn:qp,expoOut:Yp,expoInOut:function(e){return 0===e?0:1===e?1:(e*=2)<1?.5*Math.pow(1024,e-1):.5*(2-Math.pow(2,-10*(e-1)))},circIn:Xp,circOut:Kp,circInOut:function(e){return(e*=2)<1?-.5*(Math.sqrt(1-e*e)-1):.5*(Math.sqrt(1-(e-=2)*e)+1)},elasticIn:Qp,elasticOut:Zp,elasticInOut:function(e){var t,n=.1;return 0===e?0:1===e?1:(!n||n<1?(n=1,t=.1):t=.4*Math.asin(1/n)/(2*Math.PI),(e*=2)<1?n*Math.pow(2,10*(e-=1))*Math.sin(2*(e-t)*Math.PI/.4)*-.5:n*Math.pow(2,-10*(e-=1))*Math.sin(2*(e-t)*Math.PI/.4)*.5+1)},backIn:Jp,backOut:$p,backInOut:function(e){var t=2.5949095;return(e*=2)<1?e*e*((t+1)*e-t)*.5:.5*((e-=2)*e*((t+1)*e+t)+2)},bounceIn:ev,bounceOut:tv,bounceInOut:function(e){return e<.5?.5*ev(2*e):.5*tv(2*e-1)+.5},smooth:function(e){return e<=0?0:e>=1?1:e*e*(3-2*e)},fade:function(e){return e<=0?0:e>=1?1:e*e*e*(e*(6*e-15)+10)},quadOutIn:nv,cubicOutIn:iv,quartOutIn:rv,quintOutIn:ov,sineOutIn:av,expoOutIn:sv,circOutIn:cv,elasticOutIn:lv,backOutIn:uv,bounceOutIn:hv});e("dp",mv),function(e){e[e.NONE=0]="NONE",e[e.LAN=1]="LAN",e[e.WWAN=2]="WWAN"}(fv||(fv={}));var dv,pv,vv,gv,yv,xv,Ev,Sv,Tv,Av,Cv,wv=e("ae",{NetworkType:fv,LANGUAGE_ENGLISH:"en",LANGUAGE_CHINESE:"zh",LANGUAGE_FRENCH:"fr",LANGUAGE_ITALIAN:"it",LANGUAGE_GERMAN:"de",LANGUAGE_SPANISH:"es",LANGUAGE_DUTCH:"du",LANGUAGE_RUSSIAN:"ru",LANGUAGE_KOREAN:"ko",LANGUAGE_JAPANESE:"ja",LANGUAGE_HUNGARIAN:"hu",LANGUAGE_PORTUGUESE:"pt",LANGUAGE_ARABIC:"ar",LANGUAGE_NORWEGIAN:"no",LANGUAGE_POLISH:"pl",LANGUAGE_TURKISH:"tr",LANGUAGE_UKRAINIAN:"uk",LANGUAGE_ROMANIAN:"ro",LANGUAGE_BULGARIAN:"bg",LANGUAGE_UNKNOWN:"unknown",OS_IOS:"iOS",OS_ANDROID:"Android",OS_WINDOWS:"Windows",OS_LINUX:"Linux",OS_OSX:"OS X",OS_UNKNOWN:"Unknown",UNKNOWN:-1,WIN32:0,LINUX:1,MACOS:2,ANDROID:3,IPHONE:4,IPAD:5,BLACKBERRY:6,NACL:7,EMSCRIPTEN:8,TIZEN:9,WINRT:10,WP8:11,MOBILE_BROWSER:100,DESKTOP_BROWSER:101,EDITOR_PAGE:102,EDITOR_CORE:103,WECHAT_GAME:104,QQ_PLAY:105,FB_PLAYABLE_ADS:106,BAIDU_MINI_GAME:107,VIVO_MINI_GAME:108,OPPO_MINI_GAME:109,HUAWEI_QUICK_GAME:110,XIAOMI_QUICK_GAME:111,COCOSPLAY:112,ALIPAY_MINI_GAME:113,QTT_MINI_GAME:116,BYTEDANCE_MINI_GAME:117,LINKSURE_MINI_GAME:119,BROWSER_TYPE_WECHAT:"wechat",BROWSER_TYPE_ANDROID:"androidbrowser",BROWSER_TYPE_IE:"ie",BROWSER_TYPE_EDGE:"edge",BROWSER_TYPE_QQ:"qqbrowser",BROWSER_TYPE_MOBILE_QQ:"mqqbrowser",BROWSER_TYPE_UC:"ucbrowser",BROWSER_TYPE_UCBS:"ucbs",BROWSER_TYPE_360:"360browser",BROWSER_TYPE_BAIDU_APP:"baiduboxapp",BROWSER_TYPE_BAIDU:"baidubrowser",BROWSER_TYPE_MAXTHON:"maxthon",BROWSER_TYPE_OPERA:"opera",BROWSER_TYPE_OUPENG:"oupeng",BROWSER_TYPE_MIUI:"miuibrowser",BROWSER_TYPE_FIREFOX:"firefox",BROWSER_TYPE_SAFARI:"safari",BROWSER_TYPE_CHROME:"chrome",BROWSER_TYPE_LIEBAO:"liebao",BROWSER_TYPE_QZONE:"qzone",BROWSER_TYPE_SOUGOU:"sogou",BROWSER_TYPE_HUAWEI:"huawei",BROWSER_TYPE_UNKNOWN:"unknown",isNative:!1,isBrowser:"object"==typeof window&&"object"==typeof document,isMobile:!1,isLittleEndian:(dv=new ArrayBuffer(2),new DataView(dv).setInt16(0,256,!0),256===new Int16Array(dv)[0]),platform:-1,language:"unknown",languageCode:"unknown",os:"Unknown",osVersion:"",osMainVersion:0,browserType:"unknown",browserVersion:"",windowPixelResolution:null,capabilities:null,localStorage:null,__audioSupport:null,__videoSupport:null,getNetworkType:function(){return fv.LAN},getBatteryLevel:function(){return 1},garbageCollect:function(){},isObjectValid:function(e){return null!=e},dump:function(){var e="";e+="isMobile : "+this.isMobile+"\r\n",e+="language : "+this.language+"\r\n",e+="browserType : "+this.browserType+"\r\n",e+="browserVersion : "+this.browserVersion+"\r\n",e+="capabilities : "+JSON.stringify(this.capabilities)+"\r\n",e+="os : "+this.os+"\r\n",e+="osVersion : "+this.osVersion+"\r\n",e+="platform : "+this.platform+"\r\n",v(e+="Using "+(c.game.renderType===c.game.RENDER_TYPE_WEBGL?"WEBGL":"CANVAS")+" renderer.\r\n")},openURL:function(e){window.open(e)},now:function(){return Date.now?Date.now():+new Date},restartVM:function(){},getSafeAreaRect:function(){var e=c.view.getVisibleSize();return c.rect(0,0,e.width,e.height)},__init:function(){var e=window,t=e.navigator,n=document,i=n.documentElement,r=t.userAgent.toLowerCase();wv.isMobile=/mobile|android|iphone|ipad/.test(r),wv.platform=wv.isMobile?wv.MOBILE_BROWSER:wv.DESKTOP_BROWSER;var o=t.language;wv.languageCode=o.toLowerCase(),o=(o=o||t.browserLanguage)?o.split("-")[0]:wv.LANGUAGE_ENGLISH,wv.language=o;var a=!1,s=!1,c="",l=0,u=/android\s*(\d+(?:\.\d+)*)/i.exec(r)||/android\s*(\d+(?:\.\d+)*)/i.exec(t.platform);u&&(a=!0,c=u[1]||"",l=parseInt(c)||0),(u=/(iPad|iPhone|iPod).*OS ((\d+_?){2,3})/i.exec(r))?(s=!0,c=u[2]||"",l=parseInt(c)||0):(/(iPhone|iPad|iPod)/.exec(t.platform)||"MacIntel"===t.platform&&t.maxTouchPoints&&t.maxTouchPoints>1)&&(s=!0,c="",l=0);var h=wv.OS_UNKNOWN;-1!==t.appVersion.indexOf("Win")?h=wv.OS_WINDOWS:s?h=wv.OS_IOS:-1!==t.appVersion.indexOf("Mac")?h=wv.OS_OSX:-1!==t.appVersion.indexOf("X11")&&-1===t.appVersion.indexOf("Linux")?h=wv.OS_UNIX:a?h=wv.OS_ANDROID:-1===t.appVersion.indexOf("Linux")&&-1===r.indexOf("ubuntu")||(h=wv.OS_LINUX),wv.os=h,wv.osVersion=c,wv.osMainVersion=l,wv.browserType=wv.BROWSER_TYPE_UNKNOWN,function(){var e=/mqqbrowser|micromessenger|qqbrowser|sogou|qzone|liebao|maxthon|ucbs|360 aphone|360browser|baiduboxapp|baidubrowser|maxthon|mxbrowser|miuibrowser/i.exec(r)||/qq|qqbrowser|ucbrowser|ubrowser|edge|HuaweiBrowser/i.exec(r)||/chrome|safari|firefox|trident|opera|opr\/|oupeng/i.exec(r),t=e?e[0].toLowerCase():wv.BROWSER_TYPE_UNKNOWN;("safari"===t&&a||"qq"===t&&/android.*applewebkit/i.test(r))&&(t=wv.BROWSER_TYPE_ANDROID);var n={micromessenger:wv.BROWSER_TYPE_WECHAT,trident:wv.BROWSER_TYPE_IE,edge:wv.BROWSER_TYPE_EDGE,"360 aphone":wv.BROWSER_TYPE_360,mxbrowser:wv.BROWSER_TYPE_MAXTHON,"opr/":wv.BROWSER_TYPE_OPERA,ubrowser:wv.BROWSER_TYPE_UC,huaweibrowser:wv.BROWSER_TYPE_HUAWEI};wv.browserType=n[t]||t}(),wv.browserVersion="",function(){var e=/(mqqbrowser|micromessenger|qqbrowser|sogou|qzone|liebao|maxthon|uc|ucbs|360 aphone|360|baiduboxapp|baidu|maxthon|mxbrowser|miui(?:.hybrid)?)(mobile)?(browser)?\/?([\d.]+)/i.exec(r);e||(e=/(qq|chrome|safari|firefox|trident|opera|opr\/|oupeng)(mobile)?(browser)?\/?([\d.]+)/i.exec(r)),wv.browserVersion=e?e[4]:""}();var _=window.innerWidth||document.documentElement.clientWidth,f=window.innerHeight||document.documentElement.clientHeight,m=window.devicePixelRatio||1;wv.windowPixelResolution={width:m*_,height:m*f};var d,p=document.createElement("canvas");try{var v=wv.localStorage=e.localStorage;v.setItem("storage",""),v.removeItem("storage"),v=null}catch(e){var g=function(){I(5200)};wv.localStorage={getItem:g,setItem:g,removeItem:g,clear:g}}try{d=p.toDataURL("image/webp").startsWith("data:image/webp")}catch(e){d=!1}var y=!!p.getContext("2d"),x=!1;e.WebGLRenderingContext&&(x=!0);var E,S=wv.capabilities={canvas:y,opengl:x,webp:d,imageBitmap:!1,touches:!1,mouse:!1,keyboard:!1,accelerometer:!1};"undefined"!=typeof createImageBitmap&&"undefined"!=typeof Blob&&(p.width=p.height=2,createImageBitmap(p,{}).then((function(e){S.imageBitmap=!0,e.close&&e.close()})).catch((function(){}))),(void 0!==i.ontouchstart||void 0!==n.ontouchstart||t.msPointerEnabled)&&(S.touches=!0),void 0!==i.onmouseup&&(S.mouse=!0),void 0!==i.onkeyup&&(S.keyboard=!0),(e.DeviceMotionEvent||e.DeviceOrientationEvent)&&(S.accelerometer=!0),E={ONLY_ONE:!1,WEB_AUDIO:!!(window.AudioContext||window.webkitAudioContext||window.mozAudioContext),DELAY_CREATE_CTX:!1},wv.os===wv.OS_IOS&&(E.USE_LOADER_EVENT="loadedmetadata"),wv.browserType===wv.BROWSER_TYPE_FIREFOX&&(E.DELAY_CREATE_CTX=!0,E.USE_LOADER_EVENT="canplay"),wv.os===wv.OS_ANDROID&&wv.browserType===wv.BROWSER_TYPE_UC&&(E.ONE_SOURCE=!0);try{E.WEB_AUDIO&&(E._context=null,Object.defineProperty(E,"context",{get:function(){return this._context?this._context:this._context=new(window.AudioContext||window.webkitAudioContext||window.mozAudioContext)}}))}catch(e){E.WEB_AUDIO=!1,C(5201)}var T,A=[];(T=document.createElement("audio")).canPlayType&&(T.canPlayType('audio/ogg; codecs="vorbis"')&&A.push(".ogg"),T.canPlayType("audio/mpeg")&&A.push(".mp3"),T.canPlayType('audio/wav; codecs="1"')&&A.push(".wav"),T.canPlayType("audio/mp4")&&A.push(".mp4"),T.canPlayType("audio/x-m4a")&&A.push(".m4a")),E.format=A,wv.__audioSupport=E,wv.__videoSupport={format:[]},function(){var e=document.createElement("video");if(e.canPlayType){var t=wv.__videoSupport.format;["mp4","webm"].forEach((function(n){e.canPlayType("video/"+n)&&t.push("."+n)})),wv.__videoSupport.format=t}}(),wv.__isWebIOS14OrIPadOS14Env=(wv.os===wv.OS_IOS||wv.os===wv.MACOS)&&wv.isBrowser&&/(OS 1[4-9])|(Version\/1[4-9])/.test(window.navigator.userAgent)}});"object"!=typeof window||"object"!=typeof document||o||a||r||wv.__init(),c.sys=wv;var Iv,bv,Rv,Ov,Nv,Pv,Mv,Dv,Lv,Fv,zv,Bv,Uv,Gv=e("fa",(pv=mh("RenderStage"),vv=zh(),gv=zh(),yv=zh(),pv((Cv=function(){function e(){ie(this,"_name",Sv,this),ie(this,"_priority",Tv,this),ie(this,"_tag",Av,this)}var t=e.prototype;return t.initialize=function(e){return this._name=e.name,this._priority=e.priority,e.tag&&(this._tag=e.tag),!0},t.activate=function(e,t){this._pipeline=e,this._flow=t},Z(e,[{key:"name",get:function(){return this._name}},{key:"priority",get:function(){return this._priority}},{key:"tag",get:function(){return this._tag}}]),e}(),Sv=re((Ev=Cv).prototype,"_name",[vv,yh],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),Tv=re(Ev.prototype,"_priority",[gv,yh],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),Av=re(Ev.prototype,"_tag",[yv,yh],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),xv=Ev))||xv));c.RenderStage=Gv;var Hv,kv,Vv,jv,Wv,qv,Yv,Xv,Kv,Qv=e("f9",(Iv=mh("RenderFlow"),bv=zh(),Rv=zh(),Ov=zh(),Nv=zh(),Pv=Vh([Gv]),Iv((Uv=function(){function e(){ie(this,"_name",Lv,this),ie(this,"_priority",Fv,this),ie(this,"_tag",zv,this),ie(this,"_stages",Bv,this)}var t=e.prototype;return t.initialize=function(e){return this._name=e.name,this._priority=e.priority,this._stages=e.stages,e.tag&&(this._tag=e.tag),!0},t.activate=function(e){this._pipeline=e,this._stages.sort((function(e,t){return e.priority-t.priority}));for(var t=0,n=this._stages.length;t<n;t++)this._stages[t].activate(e,this)},t.render=function(e){for(var t=0,n=this._stages.length;t<n;t++)this._stages[t].render(e)},t.destroy=function(){for(var e=0,t=this._stages.length;e<t;e++)this._stages[e].destroy();this._stages.length=0},Z(e,[{key:"name",get:function(){return this._name}},{key:"priority",get:function(){return this._priority}},{key:"tag",get:function(){return this._tag}},{key:"stages",get:function(){return this._stages}}]),e}(),Lv=re((Dv=Uv).prototype,"_name",[bv,yh],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),Fv=re(Dv.prototype,"_priority",[Rv,yh],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),zv=re(Dv.prototype,"_tag",[Ov,yh],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),Bv=re(Dv.prototype,"_stages",[Nv,Pv,yh],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),Mv=Dv))||Mv));c.RenderFlow=Qv;var Zv,Jv,$v=e("f8",(Hv=mh("cc.RenderPipeline"),kv=zh(),Vv=zh(),jv=Vh([Qv]),Hv((Kv=function(e){function t(){for(var t,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return ie(t=e.call.apply(e,[this].concat(i))||this,"_tag",Yv,ee(t)),ie(t,"_flows",Xv,ee(t)),t._macros={},t._commandBuffers=[],t}$(t,e);var n=t.prototype;return n.initialize=function(e){return this._flows=e.flows,e.tag&&(this._tag=e.tag),!0},n.activate=function(){this._device=c.director.root.device;var e=new js(Xl.bindings);this._descriptorSetLayout=this._device.createDescriptorSetLayout(e),this._descriptorSet=this._device.createDescriptorSet(new Hs(this._descriptorSetLayout));for(var t=0;t<this._flows.length;t++)this._flows[t].activate(this);return!0},n.render=function(e){for(var t=0;t<this.flows.length;t++)for(var n=0;n<e.length;n++){var i=e[n];this.flows[t].render(i)}},n.destroy=function(){for(var t=0;t<this._flows.length;t++)this._flows[t].destroy();this._flows.length=0,this._descriptorSet&&(this._descriptorSet.destroy(),this._descriptorSet=null);for(var n=0;n<this._commandBuffers.length;n++)this._commandBuffers[n].destroy();return this._commandBuffers.length=0,e.prototype.destroy.call(this)},Z(t,[{key:"macros",get:function(){return this._macros}},{key:"tag",get:function(){return this._tag}},{key:"flows",get:function(){return this._flows}},{key:"device",get:function(){return this._device}},{key:"descriptorSetLayout",get:function(){return this._descriptorSetLayout}},{key:"descriptorSet",get:function(){return this._descriptorSet}},{key:"commandBuffers",get:function(){return this._commandBuffers}}]),t}(B_),Yv=re((qv=Kv).prototype,"_tag",[kv,yh],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),Xv=re(qv.prototype,"_flows",[Vv,jv,yh],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),Wv=qv))||Wv));c.RenderPipeline=$v,function(e){e[e.FORWARD=10]="FORWARD",e[e.UI=20]="UI"}(Zv||(Zv={})),function(e){e[e.SHADOW=0]="SHADOW",e[e.FORWARD=1]="FORWARD",e[e.UI=10]="UI"}(Jv||(Jv={}));var eg=e("fh",function(){function e(){}return e.getOrCreatePipelineState=function(e,t,n,i,r){var o=t.handle,a=ur.get(o,qi.HASH)^i.hash^r.attributesHash^n.id,s=this._PSOHashMap.get(a);if(!s){var c=Zi.get(ur.get(o,qi.PIPELINE_LAYOUT)),l=new ps(r.attributes),u=new vs(n,c,i,l,t.rasterizerState,t.depthStencilState,t.blendState,ur.get(o,qi.PRIMITIVE),ur.get(o,qi.DYNAMIC_STATES));s=e.createPipelineState(u),this._PSOHashMap.set(a,s)}return s},e}());function tg(e,t){return e.hash-t.hash||e.depth-t.depth||e.shaderId-t.shaderId}function ng(e,t){return e.hash-t.hash||t.depth-e.depth||e.shaderId-t.shaderId}eg._PSOHashMap=new Map;var ig=function(){function e(e){this.queue=void 0,this._passDesc=void 0,this._passPool=void 0,this._passDesc=e,this._passPool=new g_((function(){return{hash:0,depth:0,shaderId:0,subModel:null,passIdx:0}}),64),this.queue=new y_(64,this._passDesc.sortFunc)}var t=e.prototype;return t.clear=function(){this.queue.clear(),this._passPool.reset()},t.insertRenderPass=function(e,t,n){var i=e.model.subModels[t],r=fr.get(i.handle,cr.PASS_0+n);if(i.passes[n].blendState.targets[0].blend!==this._passDesc.isTransparent||!(ur.get(r,qi.PHASE)&this._passDesc.phases))return!1;var o=0|ur.get(r,qi.PRIORITY)<<16|i.priority<<8|n,a=this._passPool.add();return a.hash=o,a.depth=e.depth||0,a.shaderId=fr.get(i.handle,cr.SHADER_0+n),a.subModel=i,a.passIdx=n,this.queue.push(a),!0},t.sort=function(){this.queue.sort()},t.recordCommandBuffer=function(e,t,n){for(var i=0;i<this.queue.length;++i){var r=this.queue.array[i],o=r.subModel,a=r.passIdx,s=o.inputAssembler,c=o.handle,l=o.passes[a],u=Xi.get(fr.get(c,cr.SHADER_0+a)),h=eg.getOrCreatePipelineState(e,l,u,t,s);n.bindPipelineState(h),n.bindDescriptorSet($l.MATERIAL,l.descriptorSet),n.bindDescriptorSet($l.LOCAL,o.descriptorSet),n.bindInputAssembler(s),n.draw(s)}},e}(),rg=function(){function e(){this.queue=new Set}var t=e.prototype;return t.clear=function(){for(var e=this.queue.values(),t=e.next();!t.done;)t.value.clear(),t=e.next();this.queue.clear()},t.uploadBuffers=function(e){for(var t=this.queue.values(),n=t.next();!n.done;){for(var i=0;i<n.value.batches.length;++i){var r=n.value.batches[i];if(r.mergeCount){for(var o=0;o<r.vbs.length;++o)r.vbs[o].update(r.vbDatas[o]);e.updateBuffer(r.vbIdx,r.vbIdxData.buffer),e.updateBuffer(r.ubo,r.uboData)}}n=t.next()}},t.recordCommandBuffer=function(e,t,n){for(var i=this.queue.values(),r=i.next();!r.done;){for(var o=!1,a=0;a<r.value.batches.length;++a){var s=r.value.batches[a];if(s.mergeCount){if(!o){var c=Xi.get(s.hShader),l=eg.getOrCreatePipelineState(e,s.pass,c,t,s.ia);n.bindPipelineState(l),n.bindDescriptorSet($l.MATERIAL,s.pass.descriptorSet),o=!0}n.bindDescriptorSet($l.LOCAL,s.descriptorSet,r.value.dynamicOffsets),n.bindInputAssembler(s.ia),n.draw(s.ia)}}r=i.next()}},e}(),og=function(){function e(){this.queue=new Set}var t=e.prototype;return t.clear=function(){for(var e=this.queue.values(),t=e.next();!t.done;)t.value.clear(),t=e.next();this.queue.clear()},t.uploadBuffers=function(e){for(var t=this.queue.values(),n=t.next();!n.done;)n.value.hasPendingModels&&n.value.uploadBuffers(e),n=t.next()},t.recordCommandBuffer=function(e,t,n){for(var i=this.queue.values(),r=i.next();!r.done;){var o=r.value,a=o.instances,s=o.pass;if(o.hasPendingModels){n.bindDescriptorSet($l.MATERIAL,s.descriptorSet);for(var c=null,l=0;l<a.length;++l){var u=a[l];if(u.count){var h=Xi.get(u.hShader),_=eg.getOrCreatePipelineState(e,s,h,t,u.ia);c!==_&&(n.bindPipelineState(_),c=_),n.bindDescriptorSet($l.LOCAL,Ki.get(u.hDescriptorSet),r.value.dynamicOffsets),n.bindInputAssembler(u.ia),n.draw(u.ia)}}}r=i.next()}},e}(),ag=function(){function e(e){this.batches=[],this.dynamicOffsets=[],this._device=void 0,this._device=e.device}e.get=function(t,n){void 0===n&&(n=0);var i=e._buffers;i.has(t)||i.set(t,{});var r=i.get(t);return r[n]||(r[n]=new e(t))};var t=e.prototype;return t.destroy=function(){for(var e=0;e<this.batches.length;++e){for(var t=this.batches[e],n=0;n<t.vbs.length;++n)t.vbs[n].destroy();t.vbIdx.destroy(),t.ia.destroy(),t.ubo.destroy()}this.batches.length=0},t.merge=function(e,t,n){var i=e.subMesh.flatBuffers;if(0!==i.length){for(var r=0,o=0,a=i[0].count,s=e.passes[t],c=fr.get(e.handle,cr.SHADER_0+t),l=e.descriptorSet,u=!1,h=0;h<this.batches.length;++h){var _=this.batches[h];if(_.vbs.length===i.length&&_.mergeCount<pu.BATCHING_COUNT){u=!0;for(var f=0;f<_.vbs.length;++f)if(_.vbs[f].stride!==i[f].stride){u=!1;break}if(u){for(var m=0;m<_.vbs.length;++m){var d=i[m],p=_.vbs[m],v=_.vbDatas[m];(r=(a+_.vbCount)*d.stride)>p.size&&(p.resize(r),_.vbDatas[m]=new Uint8Array(r),_.vbDatas[m].set(v)),_.vbDatas[m].set(d.buffer,_.vbCount*d.stride)}var g=_.vbIdxData;(o=4*(a+_.vbCount))>_.vbIdx.size&&(_.vbIdx.resize(o),_.vbIdxData=new Float32Array(o/Float32Array.BYTES_PER_ELEMENT),_.vbIdxData.set(g),g=_.vbIdxData);var y=_.vbCount,x=y+a,E=_.mergeCount;if(g[y]!==E||g[x-1]!==E)for(var S=y;S<x;S++)g[S]=E+.1;return Zn.toArray(_.uboData,n.transform.worldMatrix,pu.MAT_WORLDS_OFFSET+16*_.mergeCount),_.mergeCount||(l.bindBuffer(pu.BINDING,_.ubo),l.update(),_.pass=s,_.hShader=c,_.descriptorSet=l),++_.mergeCount,_.vbCount+=a,void(_.ia.vertexCount+=a)}}}for(var T=[],A=[],C=[],w=0;w<i.length;++w){var I=i[w],b=this._device.createBuffer(new ka(Qo.VERTEX|Qo.TRANSFER_DST,Zo.HOST|Zo.DEVICE,I.count*I.stride,I.stride));b.update(I.buffer.buffer),T.push(b),A.push(new Uint8Array(b.size)),C.push(b)}var R=this._device.createBuffer(new ka(Qo.VERTEX|Qo.TRANSFER_DST,Zo.HOST|Zo.DEVICE,4*a,4)),O=new Float32Array(a);O.fill(0),R.update(O),C.push(R);for(var N=e.inputAssembler.attributes,P=new Array(N.length+1),M=0;M<N.length;++M)P[M]=N[M];P[N.length]=new ts("a_dyn_batch_id",Ko.R32F,!1,i.length);var D=new ns(P,C),L=this._device.createInputAssembler(D),F=this._device.createBuffer(new ka(Qo.UNIFORM|Qo.TRANSFER_DST,Zo.HOST|Zo.DEVICE,pu.SIZE,pu.SIZE));l.bindBuffer(pu.BINDING,F),l.update();var z=new Float32Array(pu.COUNT);Zn.toArray(z,n.transform.worldMatrix,pu.MAT_WORLDS_OFFSET),this.batches.push({mergeCount:1,vbs:T,vbDatas:A,vbIdx:R,vbIdxData:O,vbCount:a,ia:L,ubo:F,uboData:z,pass:s,hShader:c,descriptorSet:l})}},t.clear=function(){for(var e=0;e<this.batches.length;++e){var t=this.batches[e];t.vbCount=0,t.mergeCount=0,t.ia.vertexCount=0}},e}();ag._buffers=new Map;var sg=new Fn,cg=new Fn,lg=new Fn,ug=new Zn,hg=new dl,_g=!1,fg=[],mg=jo.create(0,0,0,1),dg=new v_((function(){return{model:null,depth:0}}),128),pg=new v_((function(){return{model:null,depth:0}}),128);function vg(e,t){var n=0;e.node&&(Fn.subtract(sg,e.node.worldPosition,t.position),n=Fn.dot(sg,t.forward));var i=dg.alloc();return i.model=e,i.depth=n,i}function gg(e,t){var n=0;e.node&&(Fn.subtract(sg,e.node.worldPosition,t.position),n=Fn.dot(sg,t.forward));var i=pg.alloc();return i.model=e,i.depth=n,i}function yg(e,t,n,i){var r=e.shadows;Fn.negate(cg,n);var o=r.sphere.radius*mp.COEFFICIENT_OF_EXPANSION;return Fn.multiplyScalar(lg,cg,o),Fn.add(lg,lg,r.sphere.center),i.set(lg),Zn.fromRT(ug,t,lg),ug}function xg(e,t,n){var i=t.direction,r=e.normal,o=e.distance+.001,a=1/Fn.dot(r,i),s=i.x*a,c=i.y*a,l=i.z*a,u=r.x,h=r.y,_=r.z,f=e.matLight;f.m00=1-u*s,f.m01=-u*c,f.m02=-u*l,f.m03=0,f.m04=-h*s,f.m05=1-h*c,f.m06=-h*l,f.m07=0,f.m08=-_*s,f.m09=-_*c,f.m10=1-_*l,f.m11=0,f.m12=s*o,f.m13=c*o,f.m14=l*o,f.m15=1,Zn.toArray(n,f,ou.MAT_LIGHT_PLANE_PROJ_OFFSET)}var Eg=[la.LINEAR,la.LINEAR,la.NONE,ua.CLAMP,ua.CLAMP,ua.CLAMP],Sg=new v_((function(){return{subModel:null,passIdx:-1,dynamicOffsets:[],lights:[]}}),16),Tg=new Float32Array(4),Ag=jo.create(0,0,0,1),Cg=[],wg=[],Ig=new Zn,bg=new Zn;function Rg(e,t){return!(!t.worldBounds||il.aabbWithAABB(t.worldBounds,e.aabb))}function Og(e,t){return!(!t.worldBounds||il.aabbWithAABB(t.worldBounds,e.aabb)&&il.aabbFrustum(t.worldBounds,e.frustum))}var Ng=rd("forward-add"),Pg=[];function Mg(e,t){t.length=0;for(var n=!1,i=0;i<e.length;i++){for(var r=e[i].passes,o=-1,a=0;a<r.length;a++)if(r[a].phase===Ng){o=a,n=!0;break}t.push(o)}return n}var Dg,Lg,Fg,zg,Bg,Ug,Gg,Hg,kg,Vg,jg,Wg,qg,Yg,Xg,Kg,Qg,Zg,Jg,$g,ey,ty,ny,iy,ry,oy,ay,sy,cy,ly,uy,hy,_y,fy,my,dy,py,vy,gy,yy,xy,Ey,Sy,Ty,Ay,Cy,wy,Iy,by,Ry,Oy,Ny,Py,My,Dy,Ly,Fy,zy,By,Uy,Gy,Hy,ky,Vy,jy,Wy,qy,Yy,Xy,Ky,Qy,Zy,Jy,$y,ex,tx,nx,ix,rx,ox,ax=function(){function e(e){this._pipeline=void 0,this._device=void 0,this._validLights=[],this._lightPasses=[],this._descriptorSetMap=new Map,this._globalUBO=new Float32Array(iu.COUNT),this._cameraUBO=new Float32Array(ru.COUNT),this._shadowUBO=new Float32Array(ou.COUNT),this._lightBufferCount=16,this._lightBufferStride=void 0,this._lightBufferElementCount=void 0,this._lightBuffer=void 0,this._firstLightBufferView=void 0,this._lightBufferData=void 0,this._isHDR=void 0,this._fpScale=void 0,this._renderObjects=void 0,this._instancedQueue=void 0,this._batchedQueue=void 0,this._lightMeterScale=1e4,this._sampler=null,this._pipeline=e,this._device=e.device,this._isHDR=e.isHDR,this._fpScale=e.fpScale,this._renderObjects=e.renderObjects,this._instancedQueue=new og,this._batchedQueue=new rg,this._lightBufferStride=Math.ceil(vu.SIZE/this._device.uboOffsetAlignment)*this._device.uboOffsetAlignment,this._lightBufferElementCount=this._lightBufferStride/Float32Array.BYTES_PER_ELEMENT,this._lightBuffer=this._device.createBuffer(new ka(Qo.UNIFORM|Qo.TRANSFER_DST,Zo.HOST|Zo.DEVICE,this._lightBufferStride*this._lightBufferCount,this._lightBufferStride)),this._firstLightBufferView=this._device.createBuffer(new Va(this._lightBuffer,0,vu.SIZE)),this._lightBufferData=new Float32Array(this._lightBufferElementCount*this._lightBufferCount);var t=ef(Eg);this._sampler=df.getSampler(this._device,t)}var t=e.prototype;return t.clear=function(){this._instancedQueue.clear(),this._batchedQueue.clear(),this._validLights.length=0;for(var e=0;e<this._lightPasses.length;e++){var t=this._lightPasses[e];t.dynamicOffsets.length=0,t.lights.length=0}Sg.freeArray(this._lightPasses),this._lightPasses.length=0},t.destroy=function(){for(var e=Array.from(this._descriptorSetMap.values()),t=0;t<e.length;++t){var n=e[t];n&&(n.getBuffer(iu.BINDING).destroy(),n.getBuffer(ou.BINDING).destroy(),n.getSampler(au).destroy(),n.getSampler(_u).destroy(),n.getTexture(au).destroy(),n.getTexture(_u).destroy(),n.destroy())}this._descriptorSetMap.clear()},t.gatherLightPasses=function(e,t){var n=this._validLights;if(this.clear(),this._gatherValidLights(e,n),n.length){this._updateUBOs(e,t),this._updateLightDescriptorSet(e,t);for(var i=0;i<this._renderObjects.length;i++){var r=this._renderObjects[i].model,o=r.subModels;if(Mg(o,Pg)&&(wg.length=0,this._lightCulling(r,n),wg.length))for(var a=0;a<o.length;a++){var s=Pg[a];if(!(s<0)){var c=o[a],l=c.passes[s];c.descriptorSet.bindBuffer(vu.BINDING,this._firstLightBufferView),c.descriptorSet.update(),this._addRenderQueue(l,c,r,s,n)}}}this._instancedQueue.uploadBuffers(t),this._batchedQueue.uploadBuffers(t)}},t.recordCommandBuffer=function(e,t,n){this._instancedQueue.recordCommandBuffer(e,t,n),this._batchedQueue.recordCommandBuffer(e,t,n);for(var i=0;i<this._lightPasses.length;i++){var r=this._lightPasses[i],o=r.subModel,a=r.passIdx,s=r.dynamicOffsets,c=r.lights,l=Xi.get(fr.get(o.handle,cr.SHADER_0+a)),u=o.passes[a],h=o.inputAssembler,_=eg.getOrCreatePipelineState(e,u,l,t,h),f=Ki.get(ur.get(u.handle,qi.DESCRIPTOR_SET)),m=o.descriptorSet;n.bindPipelineState(_),n.bindDescriptorSet($l.MATERIAL,f),n.bindInputAssembler(h);for(var d=0;d<s.length;++d){var p=c[d],v=this._getOrCreateDescriptorSet(p);Cg[0]=s[d],n.bindDescriptorSet($l.GLOBAL,v),n.bindDescriptorSet($l.LOCAL,m,Cg),n.draw(h)}}},t._gatherValidLights=function(e,t){for(var n=e.scene.sphereLights,i=0;i<n.length;i++){var r=n[i];r.baked||(jo.set(Ag,r.position.x,r.position.y,r.position.z,r.range),il.sphereFrustum(Ag,e.frustum)&&(t.push(r),this._getOrCreateDescriptorSet(r)))}for(var o=e.scene.spotLights,a=0;a<o.length;a++){var s=o[a];s.baked||(jo.set(Ag,s.position.x,s.position.y,s.position.z,s.range),il.sphereFrustum(Ag,e.frustum)&&(t.push(s),this._getOrCreateDescriptorSet(s)))}},t._lightCulling=function(e,t){for(var n=0;n<t.length;n++){var i=t[n],r=!1;switch(i.type){case ud.SPHERE:r=Rg(i,e);break;case ud.SPOT:r=Og(i,e)}r||wg.push(n)}},t._addRenderQueue=function(e,t,n,i,r){var o=e.batchingScheme;if(o===ed.INSTANCING)for(var a=0;a<wg.length;a++){var s=wg[a],c=xd.get(e,s);c.merge(t,n.instancedAttributes,i),c.dynamicOffsets[0]=this._lightBufferStride*s,this._instancedQueue.queue.add(c)}else if(o===ed.VB_MERGING)for(var l=0;l<wg.length;l++){var u=wg[l],h=ag.get(e,u);h.merge(t,i,n),h.dynamicOffsets[0]=this._lightBufferStride*u,this._batchedQueue.queue.add(h)}else{var _=Sg.alloc();_.subModel=t,_.passIdx=i;for(var f=0;f<wg.length;f++){var m=wg[f];_.lights.push(r[m]),_.dynamicOffsets.push(this._lightBufferStride*m)}this._lightPasses.push(_)}},t._updateLightDescriptorSet=function(e,t){for(var n=this._pipeline.shadows,i=e.scene.mainLight,r=0;r<this._validLights.length;r++){var o=this._validLights[r],a=this._getOrCreateDescriptorSet(o);if(a){switch(this._updateGlobalDescriptorSet(e,t),o.type){case ud.SPHERE:i&&xg(n,i,this._shadowUBO),Dn.toArray(this._shadowUBO,n.shadowColor,ou.SHADOW_COLOR_OFFSET),this._shadowUBO[ou.SHADOW_INFO_OFFSET+0]=n.size.x,this._shadowUBO[ou.SHADOW_INFO_OFFSET+1]=n.size.y,this._shadowUBO[ou.SHADOW_INFO_OFFSET+2]=n.pcf,this._shadowUBO[ou.SHADOW_INFO_OFFSET+3]=n.bias;break;case ud.SPOT:if(i&&xg(n,i,this._shadowUBO),Zn.invert(Ig,o.node.getWorldMatrix()),Zn.perspective(bg,o.spotAngle,o.aspect,.001,o.range),Zn.multiply(bg,bg,Ig),Zn.toArray(this._shadowUBO,bg,ou.MAT_LIGHT_VIEW_PROJ_OFFSET),Dn.toArray(this._shadowUBO,n.shadowColor,ou.SHADOW_COLOR_OFFSET),this._shadowUBO[ou.SHADOW_INFO_OFFSET+0]=n.size.x,this._shadowUBO[ou.SHADOW_INFO_OFFSET+1]=n.size.y,this._shadowUBO[ou.SHADOW_INFO_OFFSET+2]=n.pcf,this._shadowUBO[ou.SHADOW_INFO_OFFSET+3]=n.bias,this._pipeline.shadowFrameBufferMap.has(o)&&this._pipeline.shadowFrameBufferMap.has(o)){var s,c=null===(s=this._pipeline.shadowFrameBufferMap.get(o))||void 0===s?void 0:s.colorTextures[0];c&&a.bindTexture(_u,c)}}a.update(),t.updateBuffer(a.getBuffer(iu.BINDING),this._globalUBO),t.updateBuffer(a.getBuffer(ru.BINDING),this._cameraUBO),t.updateBuffer(a.getBuffer(ou.BINDING),this._shadowUBO)}}},t._updateGlobalDescriptorSet=function(e){var t=c.director.root,n=this._pipeline.device,i=this._globalUBO,r=Math.floor(n.width),o=Math.floor(n.height);i[iu.TIME_OFFSET]=t.cumulativeTime,i[iu.TIME_OFFSET+1]=t.frameTime,i[iu.TIME_OFFSET+2]=c.director.getTotalFrames(),i[iu.SCREEN_SIZE_OFFSET]=n.width,i[iu.SCREEN_SIZE_OFFSET+1]=n.height,i[iu.SCREEN_SIZE_OFFSET+2]=1/n.width,i[iu.SCREEN_SIZE_OFFSET+3]=1/n.height,i[iu.NATIVE_SIZE_OFFSET]=r,i[iu.NATIVE_SIZE_OFFSET+1]=o,i[iu.NATIVE_SIZE_OFFSET+2]=1/i[iu.NATIVE_SIZE_OFFSET],i[iu.NATIVE_SIZE_OFFSET+3]=1/i[iu.NATIVE_SIZE_OFFSET+1],this._updateCameraUBO(e)},t._updateCameraUBO=function(e){var t=this._pipeline,n=e.scene.mainLight,i=t.ambient,r=t.shadingScale,o=this._pipeline.device,a=Math.floor(o.width),s=Math.floor(o.height),c=t.fog,l=this._cameraUBO;l[ru.SCREEN_SCALE_OFFSET]=e.width/a*r,l[ru.SCREEN_SCALE_OFFSET+1]=e.height/s*r,l[ru.SCREEN_SCALE_OFFSET+2]=1/l[ru.SCREEN_SCALE_OFFSET],l[ru.SCREEN_SCALE_OFFSET+3]=1/l[ru.SCREEN_SCALE_OFFSET+1];var u=e.exposure;if(l[ru.EXPOSURE_OFFSET]=u,l[ru.EXPOSURE_OFFSET+1]=1/u,l[ru.EXPOSURE_OFFSET+2]=this._isHDR?1:0,l[ru.EXPOSURE_OFFSET+3]=this._fpScale/u,n){if(Fn.toArray(l,n.direction,ru.MAIN_LIT_DIR_OFFSET),Fn.toArray(l,n.color,ru.MAIN_LIT_COLOR_OFFSET),n.useColorTemperature){var h=n.colorTemperatureRGB;l[ru.MAIN_LIT_COLOR_OFFSET]*=h.x,l[ru.MAIN_LIT_COLOR_OFFSET+1]*=h.y,l[ru.MAIN_LIT_COLOR_OFFSET+2]*=h.z}this._isHDR?l[ru.MAIN_LIT_COLOR_OFFSET+3]=n.illuminance*this._fpScale:l[ru.MAIN_LIT_COLOR_OFFSET+3]=n.illuminance*u}else Fn.toArray(l,Fn.UNIT_Z,ru.MAIN_LIT_DIR_OFFSET),oi.toArray(l,oi.ZERO,ru.MAIN_LIT_COLOR_OFFSET);Zn.toArray(l,e.matView,ru.MAT_VIEW_OFFSET),Zn.toArray(l,e.node.worldMatrix,ru.MAT_VIEW_INV_OFFSET),Zn.toArray(l,e.matProj,ru.MAT_PROJ_OFFSET),Zn.toArray(l,e.matProjInv,ru.MAT_PROJ_INV_OFFSET),Zn.toArray(l,e.matViewProj,ru.MAT_VIEW_PROJ_OFFSET),Zn.toArray(l,e.matViewProjInv,ru.MAT_VIEW_PROJ_INV_OFFSET),Fn.toArray(l,e.position,ru.CAMERA_POS_OFFSET);var _=o.screenSpaceSignY;e.window.hasOffScreenAttachments&&(_*=o.UVSpaceSignY),l[ru.CAMERA_POS_OFFSET+3]=_;var f=i.colorArray;this._isHDR?f[3]=i.skyIllum*this._fpScale:f[3]=i.skyIllum*u,l.set(f,ru.AMBIENT_SKY_OFFSET),l.set(i.albedoArray,ru.AMBIENT_GROUND_OFFSET),c.enabled&&(l.set(c.colorArray,ru.GLOBAL_FOG_COLOR_OFFSET),l[ru.GLOBAL_FOG_BASE_OFFSET]=c.fogStart,l[ru.GLOBAL_FOG_BASE_OFFSET+1]=c.fogEnd,l[ru.GLOBAL_FOG_BASE_OFFSET+2]=c.fogDensity,l[ru.GLOBAL_FOG_ADD_OFFSET]=c.fogTop,l[ru.GLOBAL_FOG_ADD_OFFSET+1]=c.fogRange,l[ru.GLOBAL_FOG_ADD_OFFSET+2]=c.fogAtten)},t._updateUBOs=function(e,t){var n=e.exposure;this._validLights.length>this._lightBufferCount&&(this._firstLightBufferView.destroy(),this._lightBufferCount=bn(this._validLights.length),this._lightBuffer.resize(this._lightBufferStride*this._lightBufferCount),this._lightBufferData=new Float32Array(this._lightBufferElementCount*this._lightBufferCount),this._firstLightBufferView.initialize(new Va(this._lightBuffer,0,vu.SIZE)));for(var i=0,r=0;i<this._validLights.length;i++,r+=this._lightBufferElementCount){var o=this._validLights[i];switch(o.type){case ud.SPHERE:if(Fn.toArray(Tg,o.position),Tg[3]=0,this._lightBufferData.set(Tg,r+vu.LIGHT_POS_OFFSET),Tg[0]=o.size,Tg[1]=o.range,Tg[2]=0,this._lightBufferData.set(Tg,r+vu.LIGHT_SIZE_RANGE_ANGLE_OFFSET),Fn.toArray(Tg,o.color),o.useColorTemperature){var a=o.colorTemperatureRGB;Tg[0]*=a.x,Tg[1]*=a.y,Tg[2]*=a.z}this._isHDR?Tg[3]=o.luminance*this._fpScale*this._lightMeterScale:Tg[3]=o.luminance*n*this._lightMeterScale,this._lightBufferData.set(Tg,r+vu.LIGHT_COLOR_OFFSET);break;case ud.SPOT:if(Fn.toArray(Tg,o.position),Tg[3]=1,this._lightBufferData.set(Tg,r+vu.LIGHT_POS_OFFSET),Tg[0]=o.size,Tg[1]=o.range,Tg[2]=o.spotAngle,this._lightBufferData.set(Tg,r+vu.LIGHT_SIZE_RANGE_ANGLE_OFFSET),Fn.toArray(Tg,o.direction),this._lightBufferData.set(Tg,r+vu.LIGHT_DIR_OFFSET),Fn.toArray(Tg,o.color),o.useColorTemperature){var s=o.colorTemperatureRGB;Tg[0]*=s.x,Tg[1]*=s.y,Tg[2]*=s.z}this._isHDR?Tg[3]=o.luminance*this._fpScale*this._lightMeterScale:Tg[3]=o.luminance*n*this._lightMeterScale,this._lightBufferData.set(Tg,r+vu.LIGHT_COLOR_OFFSET)}}t.updateBuffer(this._lightBuffer,this._lightBufferData)},t._getOrCreateDescriptorSet=function(e){if(!this._descriptorSetMap.has(e)){var t=this._device,n=t.createDescriptorSet(new Hs(this._pipeline.descriptorSetLayout)),i=t.createBuffer(new ka(Qo.UNIFORM|Qo.TRANSFER_DST,Zo.HOST|Zo.DEVICE,iu.SIZE,iu.SIZE));n.bindBuffer(iu.BINDING,i);var r=t.createBuffer(new ka(Qo.UNIFORM|Qo.TRANSFER_DST,Zo.HOST|Zo.DEVICE,ru.SIZE,ru.SIZE));n.bindBuffer(ru.BINDING,r);var o=t.createBuffer(new ka(Qo.UNIFORM|Qo.TRANSFER_DST,Zo.HOST|Zo.DEVICE,ou.SIZE,ou.SIZE));return n.bindBuffer(ou.BINDING,o),n.bindSampler(au,this._sampler),n.bindTexture(au,id.get("default-texture").getGFXTexture()),n.bindSampler(_u,this._sampler),n.bindTexture(_u,id.get("default-texture").getGFXTexture()),n.update(),this._descriptorSetMap.set(e,n),n}return this._descriptorSetMap.get(e)},e}();xt(ha),xt(_a),xt(ya),xt(ga),xt(xa),function(e){e[e.SCENE=0]="SCENE",e[e.POSTPROCESS=1]="POSTPROCESS",e[e.UI=2]="UI"}(ox||(ox={})),xt(ox),Dg=mh("RenderTextureDesc"),Lg=Vh(ha),Fg=Vh(_a),zg=Vh(Ko),Dg((Ug=re((Bg=function(){ie(this,"name",Ug,this),ie(this,"type",Gg,this),ie(this,"usage",Hg,this),ie(this,"format",kg,this),ie(this,"width",Vg,this),ie(this,"height",jg,this)}).prototype,"name",[yh,bh],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),Gg=re(Bg.prototype,"type",[Lg],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return ha.TEX2D}}),Hg=re(Bg.prototype,"usage",[Fg],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return _a.COLOR_ATTACHMENT}}),kg=re(Bg.prototype,"format",[zg],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return Ko.UNKNOWN}}),Vg=re(Bg.prototype,"width",[yh,bh],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return-1}}),jg=re(Bg.prototype,"height",[yh,bh],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return-1}}),Bg));var sx,cx=(Wg=mh("RenderTextureConfig"),qg=Vh(lp),Wg((Kg=re((Xg=function(){ie(this,"name",Kg,this),ie(this,"texture",Qg,this)}).prototype,"name",[yh,bh],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),Qg=re(Xg.prototype,"texture",[qg],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Yg=Xg))||Yg),lx=(Zg=mh("MaterialConfig"),Jg=Vh(up),Zg((ty=re((ey=function(){ie(this,"name",ty,this),ie(this,"material",ny,this)}).prototype,"name",[yh,bh],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),ny=re(ey.prototype,"material",[Jg],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),$g=ey))||$g),ux=(iy=mh("FrameBufferDesc"),ry=Vh([qt]),oy=Vh(lp),iy((sy=re((ay=function(){ie(this,"name",sy,this),ie(this,"renderPass",cy,this),ie(this,"colorTextures",ly,this),ie(this,"depthStencilTexture",uy,this),ie(this,"texture",hy,this)}).prototype,"name",[yh,bh],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),cy=re(ay.prototype,"renderPass",[yh,bh],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),ly=re(ay.prototype,"colorTextures",[ry],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),uy=re(ay.prototype,"depthStencilTexture",[yh,bh],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),hy=re(ay.prototype,"texture",[oy],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),ay)),_y=mh("ColorDesc"),fy=Vh(Ko),my=Vh(ga),dy=Vh(ya),py=Vh(xa),vy=Vh(xa),_y((xy=re((yy=function(){ie(this,"format",xy,this),ie(this,"loadOp",Ey,this),ie(this,"storeOp",Sy,this),ie(this,"sampleCount",Ty,this),ie(this,"beginLayout",Ay,this),ie(this,"endLayout",Cy,this)}).prototype,"format",[fy],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return Ko.UNKNOWN}}),Ey=re(yy.prototype,"loadOp",[my],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return ga.CLEAR}}),Sy=re(yy.prototype,"storeOp",[dy],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return ya.STORE}}),Ty=re(yy.prototype,"sampleCount",[yh,bh],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),Ay=re(yy.prototype,"beginLayout",[py],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return xa.UNDEFINED}}),Cy=re(yy.prototype,"endLayout",[vy],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return xa.PRESENT_SRC}}),gy=yy))||gy),hx=(wy=mh("DepthStencilDesc"),Iy=Vh(Ko),by=Vh(ga),Ry=Vh(ya),Oy=Vh(ga),Ny=Vh(ya),Py=Vh(xa),My=Vh(xa),wy((Fy=re((Ly=function(){ie(this,"format",Fy,this),ie(this,"depthLoadOp",zy,this),ie(this,"depthStoreOp",By,this),ie(this,"stencilLoadOp",Uy,this),ie(this,"stencilStoreOp",Gy,this),ie(this,"sampleCount",Hy,this),ie(this,"beginLayout",ky,this),ie(this,"endLayout",Vy,this)}).prototype,"format",[Iy],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return Ko.UNKNOWN}}),zy=re(Ly.prototype,"depthLoadOp",[by],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return ga.CLEAR}}),By=re(Ly.prototype,"depthStoreOp",[Ry],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return ya.STORE}}),Uy=re(Ly.prototype,"stencilLoadOp",[Oy],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return ga.CLEAR}}),Gy=re(Ly.prototype,"stencilStoreOp",[Ny],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return ya.STORE}}),Hy=re(Ly.prototype,"sampleCount",[yh,bh],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),ky=re(Ly.prototype,"beginLayout",[Py],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return xa.UNDEFINED}}),Vy=re(Ly.prototype,"endLayout",[My],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return xa.DEPTH_STENCIL_ATTACHMENT_OPTIMAL}}),Dy=Ly))||Dy);jy=mh("RenderPassDesc"),Wy=Vh([ux]),qy=Vh(hx),jy((Xy=re((Yy=function(){ie(this,"index",Xy,this),ie(this,"colorAttachments",Ky,this),ie(this,"depthStencilAttachment",Qy,this)}).prototype,"index",[yh,bh],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return-1}}),Ky=re(Yy.prototype,"colorAttachments",[Wy],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),Qy=re(Yy.prototype,"depthStencilAttachment",[qy],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new hx}}),Yy)),function(e){e[e.FRONT_TO_BACK=0]="FRONT_TO_BACK",e[e.BACK_TO_FRONT=1]="BACK_TO_FRONT"}(sx||(sx={})),xt(sx);var _x,fx,mx,dx,px,vx,gx,yx,xx,Ex,Sx,Tx=(Zy=mh("RenderQueueDesc"),Jy=Vh(sx),$y=Vh([qt]),Zy((nx=re((tx=function(){ie(this,"isTransparent",nx,this),ie(this,"sortMode",ix,this),ie(this,"stages",rx,this)}).prototype,"isTransparent",[yh,bh],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),ix=re(tx.prototype,"sortMode",[Jy],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return sx.FRONT_TO_BACK}}),rx=re(tx.prototype,"stages",[$y],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),ex=tx))||ex),Ax=new dl,Cx=function(){function e(e){this._pendingModels=[],this._instancedQueue=new og,this._pipeline=void 0,this._pipeline=e}var t=e.prototype;return t.gatherShadowPasses=function(e,t){var n=this._pipeline.shadows;if(this._pendingModels.length=0,n.enabled&&n.type===hp.Planar){this._pipeline.updateShadowUBO(e);var i=e.scene,r=e.frustum,o=0!=(e.visibility&ql.BitMask.DEFAULT);if(i.mainLight&&o){var a=this._pipeline.renderObjects,s=xd.get(n.instancingMaterial.passes[0]);this._instancedQueue.clear(),this._instancedQueue.queue.add(s);for(var c=0;c<a.length;c++){var l=a[c].model;if(l.enabled&&l.node&&l.castShadow&&(!l.worldBounds||(dl.transform(Ax,l.worldBounds,n.matLight),il.aabbFrustum(Ax,r))))if(l.isInstancingEnabled)for(var u=0;u<l.subModels.length;u++)s.merge(l.subModels[u],l.instancedAttributes,0);else this._pendingModels.push(l)}this._instancedQueue.uploadBuffers(t)}}},t.recordCommandBuffer=function(e,t,n){var i=this._pipeline.shadows;if(i.enabled&&i.type===hp.Planar&&this._pendingModels.length){this._instancedQueue.recordCommandBuffer(e,t,n);var r=i.material.passes[0],o=Ki.get(ur.get(r.handle,qi.DESCRIPTOR_SET));n.bindDescriptorSet($l.MATERIAL,o);for(var a=this._pendingModels.length,s=0;s<a;s++)for(var c=this._pendingModels[s],l=0;l<c.subModels.length;l++){var u=c.subModels[l],h=Xi.get(u.planarShaderHandel),_=u.inputAssembler,f=eg.getOrCreatePipelineState(e,r,h,t,_);n.bindPipelineState(f),n.bindDescriptorSet($l.LOCAL,u.descriptorSet),n.bindInputAssembler(_),n.draw(_)}}},e}(),wx=function(){function e(){this._phaseID=rd("default")}var t=e.prototype;return t.activate=function(e){this._pipeline=e},t.render=function(e,t){for(var n=this._pipeline,i=n.device,r=n.commandBuffers[0],o=e.scene.batches,a=0;a<o.length;a++){var s=o[a],c=!1;if(e.visibility&s.visFlags&&(c=!0),c)for(var l=s.handle,u=yr.get(l,mr.PASS_COUNT),h=0;h<u;h++){var _=s.passes[h];if(_.phase===this._phaseID){var f=yr.get(l,mr.SHADER_0+h),m=Xi.get(f),d=Qi.get(s.hInputAssembler),p=Ki.get(s.hDescriptorSet),v=eg.getOrCreatePipelineState(i,_,m,t,d);r.bindPipelineState(v),r.bindDescriptorSet($l.MATERIAL,_.descriptorSet),r.bindDescriptorSet($l.LOCAL,p),r.bindInputAssembler(d),r.draw(d)}}}},e}(),Ix=[new as(0,0,0,1)],bx=e("fd",(_x=mh("ForwardStage"),fx=Vh([Tx]),mx=zh(),_x((yx=gx=function(e){function t(){var t;return ie(t=e.call(this)||this,"renderQueues",vx,ee(t)),t._renderQueues=[],t._renderArea=new rs,t._batchedQueue=void 0,t._instancedQueue=void 0,t._phaseID=rd("default"),t._clearFlag=4294967295,t._batchedQueue=new rg,t._instancedQueue=new og,t._uiPhase=new wx,t}$(t,e);var n=t.prototype;return n.initialize=function(t){return e.prototype.initialize.call(this,t),t.renderQueues&&(this.renderQueues=t.renderQueues),!0},n.activate=function(t,n){e.prototype.activate.call(this,t,n);for(var i=0;i<this.renderQueues.length;i++){for(var r=0,o=0;o<this.renderQueues[i].stages.length;o++)r|=rd(this.renderQueues[i].stages[o]);var a=tg;switch(this.renderQueues[i].sortMode){case sx.BACK_TO_FRONT:a=ng;break;case sx.FRONT_TO_BACK:a=tg}this._renderQueues[i]=new ig({isTransparent:this.renderQueues[i].isTransparent,phases:r,sortFunc:a})}this._additiveLightQueue=new ax(this._pipeline),this._planarQueue=new Cx(this._pipeline),this._uiPhase.activate(t)},n.destroy=function(){},n.render=function(e){this._instancedQueue.clear(),this._batchedQueue.clear();var t=this._pipeline,n=t.device;this._renderQueues.forEach(this.renderQueueClearFunc);for(var i=t.renderObjects,r=0,o=0,a=0,s=0;s<i.length;++s){var c=i[s],l=c.model.subModels;for(r=0;r<l.length;++r){var u=l[r],h=u.passes;for(o=0;o<h.length;++o){var _=h[o];if(_.phase===this._phaseID){var f=_.batchingScheme;if(f===ed.INSTANCING){var m=xd.get(_);m.merge(u,c.model.instancedAttributes,o),this._instancedQueue.queue.add(m)}else if(f===ed.VB_MERGING){var d=ag.get(_);d.merge(u,o,c.model),this._batchedQueue.queue.add(d)}else for(a=0;a<this._renderQueues.length;a++)this._renderQueues[a].insertRenderPass(c,r,o)}}}}this._renderQueues.forEach(this.renderQueueSortFunc);var p=t.commandBuffers[0];this._instancedQueue.uploadBuffers(p),this._batchedQueue.uploadBuffers(p),this._additiveLightQueue.gatherLightPasses(e,p),this._planarQueue.gatherShadowPasses(e,p);var v,g,y=e.viewport,x=e.window.hasOnScreenAttachments&&n.surfaceTransform%2?e.height:e.width,E=e.window.hasOnScreenAttachments&&n.surfaceTransform%2?e.width:e.height;if(this._renderArea.x=y.x*x,this._renderArea.y=y.y*E,this._renderArea.width=y.width*x*t.shadingScale,this._renderArea.height=y.height*E*t.shadingScale,e.clearFlag&Ca.COLOR)if(t.isHDR){v=Ix[0],g=e.clearColor,v.x=g.x*g.x,v.y=g.y*g.y,v.z=g.z*g.z;var S=t.fpScale/e.exposure;Ix[0].x*=S,Ix[0].y*=S,Ix[0].z*=S}else Ix[0].x=e.clearColor.x,Ix[0].y=e.clearColor.y,Ix[0].z=e.clearColor.z;Ix[0].w=e.clearColor.w;var T=e.window.framebuffer,A=T.colorTextures[0]?T.renderPass:t.getRenderPass(e.clearFlag&this._clearFlag);p.beginRenderPass(A,T,this._renderArea,Ix,e.clearDepth,e.clearStencil),p.bindDescriptorSet($l.GLOBAL,t.descriptorSet),this._renderQueues[0].recordCommandBuffer(n,A,p),this._instancedQueue.recordCommandBuffer(n,A,p),this._batchedQueue.recordCommandBuffer(n,A,p),this._additiveLightQueue.recordCommandBuffer(n,A,p),this._planarQueue.recordCommandBuffer(n,A,p),this._renderQueues[1].recordCommandBuffer(n,A,p),this._uiPhase.render(e,A),p.endRenderPass()},n.renderQueueClearFunc=function(e){e.clear()},n.renderQueueSortFunc=function(e){e.sort()},t}(Gv),gx.initInfo={name:"ForwardStage",priority:Zv.FORWARD,tag:0,renderQueues:[{isTransparent:!1,sortMode:sx.FRONT_TO_BACK,stages:["default"]},{isTransparent:!0,sortMode:sx.BACK_TO_FRONT,stages:["default","planarShadow"]}]},vx=re((px=yx).prototype,"renderQueues",[fx,yh,mx],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),dx=px))||dx)),Rx=e("fc",mh("ForwardFlow")((Sx=Ex=function(e){function t(){return e.apply(this,arguments)||this}$(t,e);var n=t.prototype;return n.initialize=function(t){if(e.prototype.initialize.call(this,t),0===this._stages.length){var n=new bx;n.initialize(bx.initInfo),this._stages.push(n)}return!0},n.activate=function(t){e.prototype.activate.call(this,t)},n.render=function(t){(function(e,t){var n=t.scene,i=n.mainLight,r=e.shadows,o=e.renderObjects;dg.freeArray(o),o.length=0,r.enabled&&Dn.toArray(e.shadowUBO,r.shadowColor,ou.SHADOW_COLOR_OFFSET),i&&r.type===hp.Planar&&function(e,t){var n=e.shadows,i=t.direction,r=n.normal,o=n.distance+.001,a=1/Fn.dot(r,i),s=i.x*a,c=i.y*a,l=i.z*a,u=r.x,h=r.y,_=r.z,f=n.matLight;f.m00=1-u*s,f.m01=-u*c,f.m02=-u*l,f.m03=0,f.m04=-h*s,f.m05=1-h*c,f.m06=-h*l,f.m07=0,f.m08=-_*s,f.m09=-_*c,f.m10=1-_*l,f.m11=0,f.m12=s*o,f.m13=c*o,f.m14=l*o,f.m15=1,Zn.toArray(e.shadowUBO,n.matLight,ou.MAT_LIGHT_PLANE_PROJ_OFFSET)}(e,i),e.skybox.enabled&&e.skybox.model&&t.clearFlag&ih&&o.push(vg(e.skybox.model,t));for(var a=n.models,s=0;s<a.length;s++){var c=a[s];if(c.enabled&&(c.node&&(t.visibility&c.node.layer)===c.node.layer||t.visibility&c.visFlags)){if(c.worldBounds&&!il.aabbFrustum(c.worldBounds,t.frustum))continue;o.push(vg(c,t))}}})(this._pipeline,t),e.prototype.render.call(this,t)},n.destroy=function(){e.prototype.destroy.call(this)},t}(Qv),Ex.initInfo={name:"ForwardFlow",priority:Jv.FORWARD,stages:[]},xx=Sx))||xx),Ox=new Zn,Nx=new Zn,Px=new oi,Mx=new Fn,Dx=new Zn,Lx=rd("shadow-caster"),Fx=[];function zx(e,t){t.length=0;for(var n=!1,i=0;i<e.length;i++){for(var r=e[i].passes,o=-1,a=0;a<r.length;a++)if(r[a].phase===Lx){o=a,n=!0;break}t.push(o)}return n}var Bx,Ux,Gx,Hx,kx,Vx,jx,Wx,qx,Yx,Xx,Kx,Qx,Zx,Jx,$x,eE=function(){function e(e){this._pipeline=void 0,this._subModelsArray=[],this._passArray=[],this._shaderArray=[],this._shadowMapBuffer=void 0,this._device=void 0,this._shadowInfo=void 0,this._descriptorSet=void 0,this._shadowObjects=void 0,this._shadowUBO=void 0,this._instancedQueue=void 0,this._batchedQueue=void 0,this._pipeline=e,this._device=e.device,this._shadowInfo=e.shadows,this._descriptorSet=e.descriptorSet,this._shadowObjects=e.shadowObjects,this._shadowUBO=e.shadowUBO,this._shadowMapBuffer=e.descriptorSet.getBuffer(ou.BINDING),this._instancedQueue=new og,this._batchedQueue=new rg}var t=e.prototype;return t.gatherLightPasses=function(e,t){if(this.clear(),e&&this._shadowInfo.enabled&&this._shadowInfo.type===hp.ShadowMap){this._updateUBOs(e);for(var n=0;n<this._shadowObjects.length;n++){var i=this._shadowObjects[n].model;if(zx(i.subModels,Fx))switch(e.type){case ud.DIRECTIONAL:this.add(i,t,Fx);break;case ud.SPOT:if(i.worldBounds&&(!il.aabbWithAABB(i.worldBounds,e.aabb)||!il.aabbFrustum(i.worldBounds,e.frustum)))continue;this.add(i,t,Fx)}}}},t.clear=function(){this._subModelsArray.length=0,this._shaderArray.length=0,this._passArray.length=0,this._instancedQueue.clear(),this._batchedQueue.clear()},t.add=function(e,t,n){for(var i=e.subModels,r=0;r<i.length;r++){var o=i[r],a=n[r],s=o.passes[a],c=s.batchingScheme;if(o.descriptorSet.bindBuffer(ou.BINDING,this._shadowMapBuffer),o.descriptorSet.update(),c===ed.INSTANCING){var l=xd.get(s);l.merge(o,e.instancedAttributes,a),this._instancedQueue.queue.add(l)}else if(s.batchingScheme===ed.VB_MERGING){var u=ag.get(s);u.merge(o,a,e),this._batchedQueue.queue.add(u)}else{var h=Xi.get(fr.get(o.handle,cr.SHADER_0+a));this._subModelsArray.push(o),this._shaderArray.push(h),this._passArray.push(s)}}this._instancedQueue.uploadBuffers(t),this._batchedQueue.uploadBuffers(t)},t.recordCommandBuffer=function(e,t,n){this._instancedQueue.recordCommandBuffer(e,t,n),this._batchedQueue.recordCommandBuffer(e,t,n);for(var i=0;i<this._subModelsArray.length;++i){var r=this._subModelsArray[i],o=this._shaderArray[i],a=this._passArray[i],s=r.inputAssembler,c=eg.getOrCreatePipelineState(e,a,o,t,s),l=a.descriptorSet;n.bindPipelineState(c),n.bindDescriptorSet($l.MATERIAL,l),n.bindDescriptorSet($l.LOCAL,r.descriptorSet),n.bindInputAssembler(s),n.draw(s)}},t._updateUBOs=function(e){var t=0,n=0,i=0;switch(e.type){case ud.DIRECTIONAL:if(e.update(),this._shadowInfo.autoAdapt){var r=e.node;r&&(Dx=yg(this._pipeline,r.getWorldRotation(),e.direction,Mx));var o=this._shadowInfo.sphere.radius;t=o*this._shadowInfo.aspect,n=o;var a=Fn.distance(this._shadowInfo.sphere.center,Mx);i=Math.min(a*mp.COEFFICIENT_OF_EXPANSION,mp.MAX_FAR)}else Dx=e.node.getWorldMatrix(),t=this._shadowInfo.orthoSize*this._shadowInfo.aspect,n=this._shadowInfo.orthoSize,i=this._shadowInfo.far;Zn.invert(Ox,Dx),Zn.ortho(Nx,-t,t,-n,n,this._shadowInfo.near,i,this._device.clipSpaceMinZ,this._device.screenSpaceSignY*this._device.UVSpaceSignY);break;case ud.SPOT:Zn.invert(Ox,e.node.getWorldMatrix()),Zn.perspective(Nx,e.spotAngle,e.aspect,.001,e.range)}Zn.multiply(Nx,Nx,Ox),Zn.toArray(this._shadowUBO,Nx,ou.MAT_LIGHT_VIEW_PROJ_OFFSET),Dn.toArray(this._shadowUBO,this._shadowInfo.shadowColor,ou.SHADOW_COLOR_OFFSET),Px.set(this._shadowInfo.size.x,this._shadowInfo.size.y,this._shadowInfo.pcf,this._shadowInfo.bias),oi.toArray(this._shadowUBO,Px,ou.SHADOW_INFO_OFFSET),this._descriptorSet.getBuffer(ou.BINDING).update(this._shadowUBO)},e}(),tE=[new as(1,1,1,1)],nE=e("ff",mh("ShadowStage")((Gx=Ux=function(e){function t(){for(var t,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return(t=e.call.apply(e,[this].concat(i))||this)._shadowFrameBuffer=null,t._renderArea=new rs,t._light=null,t}$(t,e);var n=t.prototype;return n.setUsage=function(e,t){this._light=e,this._shadowFrameBuffer=t},n.destroy=function(){this._additiveShadowQueue.clear()},n.clearFramebuffer=function(e){if(this._light&&this._shadowFrameBuffer){tE[0].w=e.clearColor.w;var t=this._pipeline.commandBuffers[0],n=this._shadowFrameBuffer.renderPass;t.beginRenderPass(n,this._shadowFrameBuffer,this._renderArea,tE,e.clearDepth,e.clearStencil),t.endRenderPass()}},n.render=function(e){var t=this._pipeline,n=t.shadows,i=t.commandBuffers[0];if(this._light&&this._shadowFrameBuffer){this._additiveShadowQueue.gatherLightPasses(this._light,i);var r=e.viewport,o=n.size;this._renderArea.x=r.x*o.x,this._renderArea.y=r.y*o.y,this._renderArea.width=r.width*o.x*t.shadingScale,this._renderArea.height=r.height*o.y*t.shadingScale;var a=t.device,s=this._shadowFrameBuffer.renderPass;i.beginRenderPass(s,this._shadowFrameBuffer,this._renderArea,tE,e.clearDepth,e.clearStencil),i.bindDescriptorSet($l.GLOBAL,t.descriptorSet),this._additiveShadowQueue.recordCommandBuffer(a,s,i),i.endRenderPass()}},n.activate=function(t,n){e.prototype.activate.call(this,t,n),this._additiveShadowQueue=new eE(t)},t}(Gv),Ux.initInfo={name:"ShadowStage",priority:Zv.FORWARD,tag:0},Bx=Gx))||Bx),iE=e("fe",mh("ShadowFlow")((Vx=kx=function(e){function t(){for(var t,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return(t=e.call.apply(e,[this].concat(i))||this)._shadowRenderPass=null,t}$(t,e);var n=t.prototype;return n.initialize=function(t){if(e.prototype.initialize.call(this,t),0===this._stages.length){var n=new nE;n.initialize(nE.initInfo),this._stages.push(n)}return!0},n.render=function(e){var t=this._pipeline,n=t.shadows;if(n.enabled&&n.type===hp.ShadowMap){var i=function(e,t){fg.length=0;var n=e.scene;fg.push(n.mainLight);for(var i=n.spotLights,r=0;r<i.length;r++){var o=i[r];jo.set(mg,o.position.x,o.position.y,o.position.z,o.range),il.sphereFrustum(mg,e.frustum)&&t>fg.length&&fg.push(o)}return fg}(e,n.maxReceived);if(function(e,t){var n=t.scene,i=e.shadows,r=e.shadowObjects;pg.freeArray(r),r.length=0,_g=!1;for(var o=n.models,a=0;a<o.length;a++){var s=o[a];(s.node&&(t.visibility&s.node.layer)===s.node.layer||t.visibility&s.visFlags)&&s.castShadow&&s.worldBounds&&(_g||(hg.copy(s.worldBounds),_g=!0),dl.merge(hg,hg,s.worldBounds),r.push(gg(s,t)))}hg&&dl.toBoundingSphere(i.sphere,hg)}(t,e),0!==t.shadowObjects.length){for(var r=0;r<i.length;r++){var o=i[r];t.shadowFrameBufferMap.has(o)||this._initShadowFrameBuffer(t,o);var a=t.shadowFrameBufferMap.get(o);n.shadowMapDirty&&this.resizeShadowMap(o,n.size);for(var s=0;s<this._stages.length;s++){var c=this._stages[s];c.setUsage(o,a),c.render(e)}}t.updateShadowUBO(e)}else this.clearShadowMap(i,e)}},n.destroy=function(){e.prototype.destroy.call(this);for(var t=Array.from(this._pipeline.shadowFrameBufferMap.values()),n=0;n<t.length;n++){var i=t[n];if(i){for(var r=i.colorTextures,o=0;o<r.length;o++){var a=r[n];a&&a.destroy()}r.length=0;var s=i.depthStencilTexture;s&&s.destroy(),i.destroy()}}this._pipeline.shadowFrameBufferMap.clear(),this._shadowRenderPass&&this._shadowRenderPass.destroy()},n._initShadowFrameBuffer=function(e,t){var n=e.device,i=e.shadows.size;if(!this._shadowRenderPass){var r=new Es;r.format=Ko.RGBA8,r.loadOp=ga.CLEAR,r.storeOp=ya.STORE,r.sampleCount=1,r.beginLayout=xa.UNDEFINED,r.endLayout=xa.PRESENT_SRC;var o=new Ss;o.format=n.depthStencilFormat,o.depthLoadOp=ga.CLEAR,o.depthStoreOp=ya.DISCARD,o.stencilLoadOp=ga.CLEAR,o.stencilStoreOp=ya.DISCARD,o.sampleCount=1,o.beginLayout=xa.UNDEFINED,o.endLayout=xa.DEPTH_STENCIL_ATTACHMENT_OPTIMAL;var a=new As([r],o);this._shadowRenderPass=n.createRenderPass(a)}var s=[];s.push(n.createTexture(new Ds(ha.TEX2D,_a.COLOR_ATTACHMENT|_a.SAMPLED,Ko.RGBA8,i.x,i.y)));var c=n.createTexture(new Ds(ha.TEX2D,_a.DEPTH_STENCIL_ATTACHMENT,n.depthStencilFormat,i.x,i.y)),l=n.createFramebuffer(new Qa(this._shadowRenderPass,s,c));e.shadowFrameBufferMap.set(t,l)},n.clearShadowMap=function(e,t){for(var n=this._pipeline,i=0;i<e.length;i++){var r=e[i],o=n.shadowFrameBufferMap.get(r);if(n.shadowFrameBufferMap.has(r))for(var a=0;a<this._stages.length;a++){var s=this._stages[a];s.setUsage(r,o),s.clearFramebuffer(t)}}},n.resizeShadowMap=function(e,t){var n=t.x,i=t.y,r=this._pipeline;if(r.shadowFrameBufferMap.has(e)){var o=r.shadowFrameBufferMap.get(e);if(!o)return;var a=o.colorTextures;if(a&&a.length>0)for(var s=0;s<a.length;s++){var c=a[s];c&&c.resize(n,i)}var l=o.depthStencilTexture;l&&l.resize(n,i);var u=o.renderPass;o.destroy(),o.initialize(new Qa(u,a,l))}},t}(Qv),kx.initInfo={name:"ShadowFlow",priority:Jv.SHADOW,tag:ox.SCENE,stages:[]},Hx=Vx))||Hx),rE=vt({LINEAR:0,EXP:1,EXP_SQUARED:2,LAYERED:3}),oE=rE.LAYERED+1,aE=function(){function e(){this._fogColor=new Dn("#C8C8C8"),this._colorArray=new Float32Array([.2,.2,.2,1]),this._handle=Yi,this._handle=Kr.alloc()}Z(e,[{key:"enabled",set:function(e){Kr.set(this._handle,jr.ENABLE,e?1:0),e||Kr.set(this._handle,jr.TYPE,oE),e?this.activate():this._updatePipeline()},get:function(){return Kr.get(this._handle,jr.ENABLE)}},{key:"fogColor",set:function(e){this._fogColor.set(e),Dn.toArray(this._colorArray,this._fogColor),Kr.setVec4(this._handle,jr.COLOR,this._fogColor)},get:function(){return this._fogColor}},{key:"type",get:function(){return Kr.get(this._handle,jr.TYPE)},set:function(e){Kr.set(this._handle,jr.TYPE,this.enabled?e:oE),this.enabled&&this._updatePipeline()}},{key:"fogDensity",get:function(){return Kr.get(this._handle,jr.DENSITY)},set:function(e){Kr.set(this._handle,jr.DENSITY,e)}},{key:"fogStart",get:function(){return Kr.get(this._handle,jr.START)},set:function(e){Kr.set(this._handle,jr.START,e)}},{key:"fogEnd",get:function(){return Kr.get(this._handle,jr.END)},set:function(e){Kr.set(this._handle,jr.END,e)}},{key:"fogAtten",get:function(){return Kr.get(this._handle,jr.ATTEN)},set:function(e){Kr.set(this._handle,jr.ATTEN,e)}},{key:"fogTop",get:function(){return Kr.get(this._handle,jr.TOP)},set:function(e){Kr.set(this._handle,jr.TOP,e)}},{key:"fogRange",get:function(){return Kr.get(this._handle,jr.RANGE)},set:function(e){Kr.set(this._handle,jr.RANGE,e)}},{key:"colorArray",get:function(){return this._colorArray}},{key:"handle",get:function(){return this._handle}}]);var t=e.prototype;return t.initialize=function(e){Kr.set(this._handle,jr.ENABLE,e.enabled?1:0),Kr.set(this._handle,jr.TYPE,e.enabled?e.type:oE),this._fogColor.set(e.fogColor),Dn.toArray(this._colorArray,this._fogColor),Kr.setVec4(this._handle,jr.COLOR,this._fogColor),Kr.set(this._handle,jr.DENSITY,e.fogDensity),Kr.set(this._handle,jr.START,e.fogStart),Kr.set(this._handle,jr.END,e.fogEnd),Kr.set(this._handle,jr.ATTEN,e.fogAtten),Kr.set(this._handle,jr.TOP,e.fogTop),Kr.set(this._handle,jr.RANGE,e.fogRange)},t.activate=function(){this._updatePipeline()},t._updatePipeline=function(){var e=c.director.root,t=this.enabled?this.type:oE,n=e.pipeline;n.macros.CC_USE_FOG!==t&&(n.macros.CC_USE_FOG=t,e.onGlobalPipelineStateChanged())},t.destroy=function(){this._handle&&(Kr.free(this._handle),this._handle=Yi)},e}();c.Fog=aE;var sE=new Zn,cE=new Zn,lE=new Fn,uE=[la.LINEAR,la.LINEAR,la.NONE,ua.CLAMP,ua.CLAMP,ua.CLAMP],hE=e("fb",(jx=mh("ForwardPipeline"),Wx=Vh([cx]),qx=zh(),Yx=Vh([lx]),Xx=zh(),jx(($x=function(e){function t(){for(var t,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return ie(t=e.call.apply(e,[this].concat(i))||this,"renderTextures",Zx,ee(t)),ie(t,"materials",Jx,ee(t)),t.fog=new aE,t.ambient=new So,t.skybox=new yp,t.shadows=new mp,t.renderObjects=[],t.shadowObjects=[],t.shadowFrameBufferMap=new Map,t._isHDR=!1,t._shadingScale=1,t._fpScale=1/1024,t._renderPasses=new Map,t._globalUBO=new Float32Array(iu.COUNT),t._cameraUBO=new Float32Array(ru.COUNT),t._shadowUBO=new Float32Array(ou.COUNT),t}$(t,e);var n=t.prototype;return n.initialize=function(t){if(e.prototype.initialize.call(this,t),0===this._flows.length){var n=new iE;n.initialize(iE.initInfo),this._flows.push(n);var i=new Rx;i.initialize(Rx.initInfo),this._flows.push(i)}return!0},n.activate=function(){return this._macros={},!(!e.prototype.activate.call(this)||!this._activeRenderer()&&(R(2402),1))},n.render=function(e){this._commandBuffers[0].begin(),this.updateGlobalUBO();for(var t=0;t<e.length;t++){var n=e[t];if(n.scene){this.updateCameraUBO(n);for(var i=0;i<this._flows.length;i++)this._flows[i].render(n)}}this._commandBuffers[0].end(),this._device.queue.submit(this._commandBuffers)},n.getRenderPass=function(e){var t=this._renderPasses.get(e);if(t)return t;var n=this.device,i=new Es,r=new Ss;i.format=n.colorFormat,r.format=n.depthStencilFormat,r.stencilStoreOp=ya.DISCARD,r.depthStoreOp=ya.DISCARD,e&Ca.COLOR||(e&ih?i.loadOp=ga.DISCARD:(i.loadOp=ga.LOAD,i.beginLayout=xa.PRESENT_SRC)),(e&Ca.DEPTH_STENCIL)!==Ca.DEPTH_STENCIL&&(e&Ca.DEPTH||(r.depthLoadOp=ga.LOAD),e&Ca.STENCIL||(r.stencilLoadOp=ga.LOAD),r.beginLayout=xa.DEPTH_STENCIL_ATTACHMENT_OPTIMAL);var o=new As([i],r);return t=n.createRenderPass(o),this._renderPasses.set(e,t),t},n.updateGlobalUBO=function(){this._descriptorSet.update();var e=c.director.root,t=this._globalUBO,n=this.device,i=Math.floor(n.width),r=Math.floor(n.height);t[iu.TIME_OFFSET]=e.cumulativeTime,t[iu.TIME_OFFSET+1]=e.frameTime,t[iu.TIME_OFFSET+2]=c.director.getTotalFrames(),t[iu.SCREEN_SIZE_OFFSET]=n.width,t[iu.SCREEN_SIZE_OFFSET+1]=n.height,t[iu.SCREEN_SIZE_OFFSET+2]=1/n.width,t[iu.SCREEN_SIZE_OFFSET+3]=1/n.height,t[iu.NATIVE_SIZE_OFFSET]=i,t[iu.NATIVE_SIZE_OFFSET+1]=r,t[iu.NATIVE_SIZE_OFFSET+2]=1/t[iu.NATIVE_SIZE_OFFSET],t[iu.NATIVE_SIZE_OFFSET+3]=1/t[iu.NATIVE_SIZE_OFFSET+1],this._commandBuffers[0].updateBuffer(this._descriptorSet.getBuffer(iu.BINDING),this._globalUBO)},n._activeRenderer=function(){var e=this.device;this._commandBuffers.push(e.commandBuffer);var t=e.createBuffer(new ka(Qo.UNIFORM|Qo.TRANSFER_DST,Zo.HOST|Zo.DEVICE,iu.SIZE,iu.SIZE));this._descriptorSet.bindBuffer(iu.BINDING,t);var n=e.createBuffer(new ka(Qo.UNIFORM|Qo.TRANSFER_DST,Zo.HOST|Zo.DEVICE,ru.SIZE,ru.SIZE));this._descriptorSet.bindBuffer(ru.BINDING,n);var i=e.createBuffer(new ka(Qo.UNIFORM|Qo.TRANSFER_DST,Zo.HOST|Zo.DEVICE,ou.SIZE,ou.SIZE));this._descriptorSet.bindBuffer(ou.BINDING,i);var r=ef(uE),o=df.getSampler(e,r);return this._descriptorSet.bindSampler(au,o),this._descriptorSet.bindTexture(au,id.get("default-texture").getGFXTexture()),this._descriptorSet.bindSampler(_u,o),this._descriptorSet.bindTexture(_u,id.get("default-texture").getGFXTexture()),this._descriptorSet.update(),this.macros.CC_USE_HDR=this._isHDR,this.macros.CC_SUPPORT_FLOAT_TEXTURE=this.device.hasFeature(Ra.TEXTURE_FLOAT),!0},n.updateShadowUBO=function(e){this._descriptorSet.update();var t=e.scene.mainLight,n=this.device,i=this.shadows;if(i.enabled){if(t&&i.type===hp.ShadowMap){var r;this.shadowFrameBufferMap.has(t)&&this._descriptorSet.bindTexture(au,this.shadowFrameBufferMap.get(t).colorTextures[0]);var o=0,a=0,s=0;if(i.autoAdapt){r=yg(this,t.node.getWorldRotation(),t.direction,lE);var c=i.sphere.radius;o=c*i.aspect,a=c;var l=Fn.distance(i.sphere.center,lE);s=Math.min(l*mp.COEFFICIENT_OF_EXPANSION,mp.MAX_FAR)}else r=t.node.getWorldMatrix(),o=i.orthoSize*i.aspect,a=i.orthoSize,s=i.far;Zn.invert(sE,r);var u=n.screenSpaceSignY*n.UVSpaceSignY;Zn.ortho(cE,-o,o,-a,a,i.near,s,n.clipSpaceMinZ,u),Zn.multiply(cE,cE,sE),Zn.toArray(this._shadowUBO,cE,ou.MAT_LIGHT_VIEW_PROJ_OFFSET),this._shadowUBO[ou.SHADOW_INFO_OFFSET]=i.size.x,this._shadowUBO[ou.SHADOW_INFO_OFFSET+1]=i.size.y,this._shadowUBO[ou.SHADOW_INFO_OFFSET+2]=i.pcf,this._shadowUBO[ou.SHADOW_INFO_OFFSET+3]=i.bias}else t&&i.type===hp.Planar&&xg(i,t,this._shadowUBO);Dn.toArray(this._shadowUBO,i.shadowColor,ou.SHADOW_COLOR_OFFSET),this._commandBuffers[0].updateBuffer(this._descriptorSet.getBuffer(ou.BINDING),this._shadowUBO)}},n.updateCameraUBO=function(e){var t=this.device,n=(e.scene?e.scene:c.director.getScene().renderScene).mainLight,i=this.ambient,r=this.fog,o=Math.floor(t.width),a=Math.floor(t.height),s=this._cameraUBO,l=e.exposure;if(s[ru.SCREEN_SCALE_OFFSET]=e.width/o*this.shadingScale,s[ru.SCREEN_SCALE_OFFSET+1]=e.height/a*this.shadingScale,s[ru.SCREEN_SCALE_OFFSET+2]=1/s[ru.SCREEN_SCALE_OFFSET],s[ru.SCREEN_SCALE_OFFSET+3]=1/s[ru.SCREEN_SCALE_OFFSET+1],s[ru.EXPOSURE_OFFSET]=l,s[ru.EXPOSURE_OFFSET+1]=1/l,s[ru.EXPOSURE_OFFSET+2]=this._isHDR?1:0,s[ru.EXPOSURE_OFFSET+3]=this._fpScale/l,n){if(Fn.toArray(s,n.direction,ru.MAIN_LIT_DIR_OFFSET),Fn.toArray(s,n.color,ru.MAIN_LIT_COLOR_OFFSET),n.useColorTemperature){var u=n.colorTemperatureRGB;s[ru.MAIN_LIT_COLOR_OFFSET]*=u.x,s[ru.MAIN_LIT_COLOR_OFFSET+1]*=u.y,s[ru.MAIN_LIT_COLOR_OFFSET+2]*=u.z}this._isHDR?s[ru.MAIN_LIT_COLOR_OFFSET+3]=n.illuminance*this._fpScale:s[ru.MAIN_LIT_COLOR_OFFSET+3]=n.illuminance*l}else Fn.toArray(s,Fn.UNIT_Z,ru.MAIN_LIT_DIR_OFFSET),oi.toArray(s,oi.ZERO,ru.MAIN_LIT_COLOR_OFFSET);var h=i.colorArray;this._isHDR?h[3]=i.skyIllum*this._fpScale:h[3]=i.skyIllum*l,s.set(h,ru.AMBIENT_SKY_OFFSET),s.set(i.albedoArray,ru.AMBIENT_GROUND_OFFSET),Zn.toArray(s,e.matView,ru.MAT_VIEW_OFFSET),Zn.toArray(s,e.node.worldMatrix,ru.MAT_VIEW_INV_OFFSET),Zn.toArray(s,e.matProj,ru.MAT_PROJ_OFFSET),Zn.toArray(s,e.matProjInv,ru.MAT_PROJ_INV_OFFSET),Zn.toArray(s,e.matViewProj,ru.MAT_VIEW_PROJ_OFFSET),Zn.toArray(s,e.matViewProjInv,ru.MAT_VIEW_PROJ_INV_OFFSET),Fn.toArray(s,e.position,ru.CAMERA_POS_OFFSET);var _=t.screenSpaceSignY;e.window.hasOffScreenAttachments&&(_*=t.UVSpaceSignY),s[ru.CAMERA_POS_OFFSET+3]=_,r.enabled&&(s.set(r.colorArray,ru.GLOBAL_FOG_COLOR_OFFSET),s[ru.GLOBAL_FOG_BASE_OFFSET]=r.fogStart,s[ru.GLOBAL_FOG_BASE_OFFSET+1]=r.fogEnd,s[ru.GLOBAL_FOG_BASE_OFFSET+2]=r.fogDensity,s[ru.GLOBAL_FOG_ADD_OFFSET]=r.fogTop,s[ru.GLOBAL_FOG_ADD_OFFSET+1]=r.fogRange,s[ru.GLOBAL_FOG_ADD_OFFSET+2]=r.fogAtten),this._commandBuffers[0].updateBuffer(this._descriptorSet.getBuffer(ru.BINDING),this._cameraUBO)},n.destroyUBOs=function(){this._descriptorSet&&(this._descriptorSet.getBuffer(iu.BINDING).destroy(),this._descriptorSet.getBuffer(ou.BINDING).destroy(),this._descriptorSet.getBuffer(ru.BINDING).destroy(),this._descriptorSet.getSampler(au).destroy(),this._descriptorSet.getSampler(_u).destroy(),this._descriptorSet.getTexture(au).destroy(),this._descriptorSet.getTexture(_u).destroy())},n.destroy=function(){this.destroyUBOs();for(var t=this._renderPasses.values(),n=t.next();!n.done;)n.value.destroy(),n=t.next();return this._commandBuffers.length=0,this.ambient.destroy(),this.skybox.destroy(),this.fog.destroy(),this.shadows.destroy(),e.prototype.destroy.call(this)},Z(t,[{key:"isHDR",get:function(){return this._isHDR},set:function(e){this._isHDR!==e&&(this._isHDR=e,this._cameraUBO[ru.EXPOSURE_OFFSET+2]=this._isHDR?1:0)}},{key:"shadingScale",get:function(){return this._shadingScale}},{key:"fpScale",get:function(){return this._fpScale}},{key:"shadowUBO",get:function(){return this._shadowUBO}}]),t}($v),Zx=re((Qx=$x).prototype,"renderTextures",[Wx,yh,qx],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),Jx=re(Qx.prototype,"materials",[Yx,yh,Xx],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),Kx=Qx))||Kx));var _E=E_.Flags.Destroyed,fE=E_.Flags.PersistentMask,mE=ln.IDENTIFIER_RE,dE={"cc.ClickEvent":!1,"cc.PrefabInfo":!1},pE=ln.escapeForJS,vE=function(){function e(e,t){this.varName=void 0,this.expression=void 0,this.varName=e,this.expression=t}return e.prototype.toString=function(){return"var "+this.varName+"="+this.expression+";"},e}();function gE(e,t){return t instanceof vE?new vE(t.varName,e+t.expression):e+t}function yE(e,t,n){Array.isArray(n)?(n[0]=gE(t,n[0]),e.push(n)):e.push(gE(t,n)+";")}var xE=function(){function e(e){this._exps=void 0,this._targetExp=void 0,this._exps=[],this._targetExp=e}var t=e.prototype;return t.append=function(e,t){this._exps.push([e,t])},t.writeCode=function(e){var t;if(this._exps.length>1)e.push("t="+this._targetExp+";"),t="t";else{if(1!==this._exps.length)return;t=this._targetExp}for(var n=0;n<this._exps.length;n++){var i=this._exps[n];yE(e,t+EE(i[0])+"=",i[1])}},e}();function EE(e){return mE.test(e)?"."+e:"["+pE(e)+"]"}xE.pool=void 0,xE.pool=new ft((function(e){e._exps.length=0,e._targetExp=null}),1),xE.pool.get=function(e){var t=this._get()||new xE;return t._targetExp=e,t};var SE=function(){function e(e,t){var n;this.parent=void 0,this.objsToClear_iN$t=void 0,this.codeArray=void 0,this.objs=void 0,this.funcs=void 0,this.funcModuleCache=void 0,this.globalVariables=void 0,this.globalVariableId=void 0,this.localVariableId=void 0,this.result=void 0,this.parent=t,this.objsToClear_iN$t=[],this.codeArray=[],this.objs=[],this.funcs=[],this.funcModuleCache=Ue(),Qe(this.funcModuleCache,dE),this.globalVariables=[],this.globalVariableId=0,this.localVariableId=0,this.codeArray.push("var o,t;","if(R){","o=R;","}else{","o=R=new "+this.getFuncModule(e.constructor,!0)+"();","}"),e._iN$t={globalVar:"R"},this.objsToClear_iN$t.push(e),this.enumerateObject(this.codeArray,e),this.globalVariables.length>0&&(n="var "+this.globalVariables.join(",")+";");var i=function(e){var t=[];return function e(t,n){for(var i,r=ne(n);!(i=r()).done;){var o=i.value;Array.isArray(o)?e(t,o):t.push(o)}}(t,e),t.join("")}(["return (function(R){",n||[],this.codeArray,"return o;","})"]);this.result=Function("O","F",i)(this.objs,this.funcs);for(var r=0,o=this.objsToClear_iN$t.length;r<o;++r)this.objsToClear_iN$t[r]._iN$t=null;this.objsToClear_iN$t.length=0}var t=e.prototype;return t.getFuncModule=function(e,t){var n=Ge(e);if(n){var i=this.funcModuleCache[n];if(i)return i;if(void 0===i){var r=-1!==n.indexOf(".");if(r)try{if(r=e===Function("return "+n)())return this.funcModuleCache[n]=n,n}catch(e){}}}var o=this.funcs.indexOf(e);o<0&&(o=this.funcs.length,this.funcs.push(e));var a="F["+o+"]";return t&&(a="("+a+")"),this.funcModuleCache[n]=a,a},t.getObjRef=function(e){var t=this.objs.indexOf(e);return t<0&&(t=this.objs.length,this.objs.push(e)),"O["+t+"]"},t.setValueType=function(e,t,n,i){var r=xE.pool.get(i),o=t.constructor.__props__;o||(o=Object.keys(t));for(var a=0;a<o.length;a++){var s=o[a],c=n[s];if(t[s]!==c){var l=this.enumerateField(n,s,c);r.append(s,l)}}r.writeCode(e),xE.pool.put(r)},t.enumerateCCClass=function(e,t,n){for(var i=n.__values__,r=Gt(n),o=0;o<i.length;o++){var a=i[o],s=t[a],l=r[a+"$_$default"];if(!TE(l,s))if("object"==typeof s&&s instanceof c.ValueType&&(l=ln.getDefault(l))&&l.constructor===s.constructor){var u="o"+EE(a);this.setValueType(e,l,s,u)}else this.setObjProp(e,t,a,s)}},t.instantiateArray=function(e){if(0===e.length)return"[]";var t="a"+ ++this.localVariableId,n=[new vE(t,"new Array("+e.length+")")];e._iN$t={globalVar:"",source:n},this.objsToClear_iN$t.push(e);for(var i=0;i<e.length;++i)yE(n,t+"["+i+"]=",this.enumerateField(e,i,e[i]));return n},t.instantiateTypedArray=function(e){var t=e.constructor.name;if(0===e.length)return"new "+t;var n="a"+ ++this.localVariableId,i=[new vE(n,"new "+t+"("+e.length+")")];e._iN$t={globalVar:"",source:i},this.objsToClear_iN$t.push(e);for(var r=0;r<e.length;++r)0!==e[r]&&yE(i,n+"["+r+"]=",e[r]);return i},t.enumerateField=function(e,t,n){if("object"==typeof n&&n){var i=n._iN$t;if(i){var r=i.globalVar;if(!r){r=i.globalVar="v"+ ++this.globalVariableId,this.globalVariables.push(r);var o=i.source[0];i.source[0]=gE(r+"=",o)}return r}return ArrayBuffer.isView(n)?this.instantiateTypedArray(n):Array.isArray(n)?this.instantiateArray(n):this.instantiateObj(n)}return"function"==typeof n?this.getFuncModule(n):"string"==typeof n?pE(n):("_objFlags"===t&&e instanceof E_&&(n&=fE),n)},t.setObjProp=function(e,t,n,i){yE(e,"o"+EE(n)+"=",this.enumerateField(t,n,i))},t.enumerateObject=function(e,t){var n=t.constructor;if(c.Class._isCCClass(n))this.enumerateCCClass(e,t,n);else for(var i in t)if(t.hasOwnProperty(i)&&(95!==i.charCodeAt(0)||95!==i.charCodeAt(1)||"__type__"===i)){var r=t[i];"object"==typeof r&&r&&r===t._iN$t||this.setObjProp(e,t,i,r)}},t.instantiateObj=function(e){if(e instanceof c.ValueType)return ln.getNewValueTypeCode(e);if(e instanceof c.Asset)return this.getObjRef(e);if(e._objFlags&_E)return null;var t,n=e.constructor;if(c.Class._isCCClass(n)){if(this.parent)if(this.parent instanceof c.Component){if(e instanceof c._BaseNode||e instanceof c.Component)return this.getObjRef(e)}else if(this.parent instanceof c._BaseNode)if(e instanceof c._BaseNode){if(!e.isChildOf(this.parent))return this.getObjRef(e)}else if(e instanceof c.Component&&!e.node.isChildOf(this.parent))return this.getObjRef(e);t=new vE("o","new "+this.getFuncModule(n,!0)+"()")}else if(n===Object)t=new vE("o","{}");else{if(n)return this.getObjRef(e);t=new vE("o","Object.create(null)")}var i=[t];return e._iN$t={globalVar:"",source:i},this.objsToClear_iN$t.push(e),this.enumerateObject(i,e),["(function(){",i,"return o;})();"]},e}();function TE(e,t){if("function"==typeof e)try{e=e()}catch(e){return!1}if(e===t)return!0;if(e&&t&&"object"==typeof e&&"object"==typeof t&&e.constructor===t.constructor)if(e instanceof c.ValueType){if(e.equals(t))return!0}else{if(Array.isArray(e))return 0===e.length&&0===t.length;if(e.constructor===Object)return Me(e)&&Me(t)}return!1}var AE=Object.freeze({__proto__:null,ccclass:mh,property:gh,requireComponent:dh,executionOrder:ph,disallowMultiple:vh,executeInEditMode:Sh,menu:Th,playOnFocus:Ah,inspector:Ch,icon:wh,help:Ih,type:Vh,integer:Uh,float:Gh,boolean:Hh,string:kh});e("e0",AE);var CE,wE,IE,bE,RE,OE,NE,PE,ME,DE,LE,FE=E_.Flags.Destroyed,zE=E_.Flags.PersistentMask,BE=[];function UE(e){var t;if(e instanceof E_){if(e._instantiate)return c.game._isCloning=!0,t=e._instantiate(null,!0),c.game._isCloning=!1,t;if(e instanceof c.Asset)throw new TypeError(M(6903))}return c.game._isCloning=!0,t=GE(e),c.game._isCloning=!1,t}function GE(e,t){var n;HE(e,n=e._iN$t?e._iN$t:e.constructor?new(0,e.constructor):Object.create(null),t);for(var i=0,r=BE.length;i<r;++i)BE[i]._iN$t=null;return BE.length=0,n}function HE(e,t,n){dt.value(e,"_iN$t",t,!0),BE.push(e);var i=e.constructor;if(c.Class._isCCClass(i))!function(e,t,n,i){for(var r=e.__values__,o=0;o<r.length;o++){var a=r[o],s=t[a];if("object"==typeof s&&s){var c=n[a];c instanceof Et&&c.constructor===s.constructor?c.set(s):n[a]=s._iN$t||kE(s,i)}else n[a]=s}}(i,e,t,n);else for(var r in e)if(e.hasOwnProperty(r)&&(95!==r.charCodeAt(0)||95!==r.charCodeAt(1)||"__type__"===r)){var o=e[r];if("object"==typeof o&&o){if(o===t)continue;t[r]=o._iN$t||kE(o,n)}else t[r]=o}e instanceof E_&&(t._objFlags&=zE)}function kE(e,t){if(e instanceof Et)return e.clone();if(e instanceof c.Asset)return e;var n;if(ArrayBuffer.isView(e)){var i=e.length;n=new e.constructor(i),e._iN$t=n,BE.push(e);for(var r=0;r<i;++r)n[r]=e[r];return n}if(Array.isArray(e)){var o=e.length;n=new Array(o),e._iN$t=n,BE.push(e);for(var a=0;a<o;++a){var s=e[a];n[a]="object"==typeof s&&s?s._iN$t||kE(s,t):s}return n}if(e._objFlags&FE)return null;var l=e.constructor;if(c.Class._isCCClass(l)){if(t)if(t instanceof c.Component){if(e instanceof c._BaseNode||e instanceof c.Component)return e}else if(t instanceof c._BaseNode)if(e instanceof c._BaseNode){if(!e.isChildOf(t))return e}else if(e instanceof c.Component&&!e.node.isChildOf(t))return e;n=new l}else if(l===Object)n={};else{if(l)return e;n=Object.create(null)}return HE(e,n,t),n}function VE(e,t){return(t<<3)+e}UE._clone=GE,c.instantiate=UE,function(e){e[e.Uint8=0]="Uint8",e[e.Uint16=1]="Uint16",e[e.Uint32=2]="Uint32",e[e.Int8=3]="Int8",e[e.Int16=4]="Int16",e[e.Int32=5]="Int32",e[e.Float32=6]="Float32",e[e.Float64=7]="Float64"}(DE||(DE={})),function(e){e[e.Scalar=0]="Scalar",e[e.Vec2=1]="Vec2",e[e.Vec3=2]="Vec3",e[e.Vec4=3]="Vec4",e[e.Quat=4]="Quat",e[e.Mat4=5]="Mat4"}(LE||(LE={}));var jE=e("e7",mh("cc.CompactValueTypeArray")((PE=NE=function(){function e(){ie(this,"_byteOffset",IE,this),ie(this,"_unitCount",bE,this),ie(this,"_unitElement",RE,this),ie(this,"_length",OE,this)}return e.lengthFor=function(e,t,n){return WE(t).requiredUnits*e.length*qE(n).BYTES_PER_ELEMENT},e.compress=function(t,n,i,r,o,a){for(var s=WE(n),c=qE(i),l=s.requiredUnits*t.length,u=new c(r,o,l),h=0;h<t.length;++h)s.compress(u,h,t[h]);var _=new e;return _._unitElement=VE(i,n),_._byteOffset=a,_._unitCount=l,_._length=t.length,_},e.prototype.decompress=function(e){for(var t,n={storageUnit:7&(t=this._unitElement),elementType:t>>3},i=n.storageUnit,r=WE(n.elementType),o=new(qE(i))(e,this._byteOffset,this._unitCount),a=new Array(this._length),s=0;s<this._length;++s)a[s]=r.decompress(o,s);return a},e}(),NE.StorageUnit=DE,NE.ElementType=LE,IE=re((wE=PE).prototype,"_byteOffset",[yh],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),bE=re(wE.prototype,"_unitCount",[yh],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),RE=re(wE.prototype,"_unitElement",[yh],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return VE(DE.Uint8,LE.Scalar)}}),OE=re(wE.prototype,"_length",[yh],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),CE=wE))||CE);function WE(e){return KS[e]}function qE(e){switch(e){case DE.Uint8:return Uint8Array;case DE.Uint16:return Uint16Array;case DE.Uint32:return Uint32Array;case DE.Int8:return Int8Array;case DE.Int16:return Int16Array;case DE.Int32:return Int32Array;case DE.Float32:return Float32Array;case DE.Float64:return Float64Array}}var YE,XE,KE,QE,ZE,JE,$E,eS,tS,nS,iS,rS,oS,aS,sS,cS,lS,uS,hS,_S,fS,mS,dS,pS,vS,gS,yS,xS,ES,SS,TS,AS,CS,wS,IS,bS,RS,OS,NS,PS,MS,DS,LS,FS,zS,BS,US,GS,HS,kS,VS,jS,WS,qS,YS,XS,KS=((ME={})[LE.Scalar]={requiredUnits:1,compress:function(e,t,n){e[t]=n},decompress:function(e,t){return e[t]}},ME[LE.Vec2]={requiredUnits:2,compress:function(e,t,n){e[2*t]=n.x,e[2*t+1]=n.y},decompress:function(e,t){return new Fn(e[2*t],e[2*t+1])}},ME[LE.Vec3]={requiredUnits:3,compress:function(e,t,n){e[3*t]=n.x,e[3*t+1]=n.y,e[3*t+2]=n.z},decompress:function(e,t){return new Fn(e[3*t],e[3*t+1],e[3*t+2])}},ME[LE.Vec4]={requiredUnits:4,compress:function(e,t,n){e[4*t]=n.x,e[4*t+1]=n.y,e[4*t+2]=n.z,e[4*t+3]=n.w},decompress:function(e,t){return new oi(e[4*t],e[4*t+1],e[4*t+2],e[4*t+3])}},ME[LE.Quat]={requiredUnits:4,compress:function(e,t,n){e[4*t]=n.x,e[4*t+1]=n.y,e[4*t+2]=n.z,e[4*t+3]=n.w},decompress:function(e,t){return new Vn(e[4*t],e[4*t+1],e[4*t+2],e[4*t+3])}},ME[LE.Mat4]={requiredUnits:16,compress:function(e,t,n){Zn.toArray(e,n,16*t)},decompress:function(e,t){return Zn.fromArray(new Zn,e,16*t)}},ME);c._decorator=AE;var QS=mh("cc.TargetInfo")((KE=re((XE=function(){ie(this,"localID",KE,this)}).prototype,"localID",[yh],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),YE=XE))||YE,ZS=(QE=mh("cc.TargetOverrideInfo"),ZE=Vh(E_),JE=Vh(QS),$E=Vh(c.Node),eS=Vh(QS),QE((iS=re((nS=function(){ie(this,"source",iS,this),ie(this,"sourceInfo",rS,this),ie(this,"propertyPath",oS,this),ie(this,"target",aS,this),ie(this,"targetInfo",sS,this)}).prototype,"source",[yh,ZE],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),rS=re(nS.prototype,"sourceInfo",[yh,JE],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),oS=re(nS.prototype,"propertyPath",[yh],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),aS=re(nS.prototype,"target",[yh,$E],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),sS=re(nS.prototype,"targetInfo",[yh,eS],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),tS=nS))||tS),JS=(cS=mh("cc.PrefabInfo"),lS=Vh([ZS]),cS((_S=re((hS=function(){ie(this,"root",_S,this),ie(this,"asset",fS,this),ie(this,"fileId",mS,this),ie(this,"instance",dS,this),ie(this,"targetOverrides",pS,this)}).prototype,"root",[yh,bh],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),fS=re(hS.prototype,"asset",[yh,bh],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),mS=re(hS.prototype,"fileId",[yh,bh],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),dS=re(hS.prototype,"instance",[yh],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),pS=re(hS.prototype,"targetOverrides",[yh,lS],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),uS=hS))||uS);c._PrefabInfo=JS;var $S=mh("cc.CompPrefabInfo")((yS=re((gS=function(){ie(this,"fileId",yS,this)}).prototype,"fileId",[yh,bh],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),vS=gS))||vS,eT=(xS=mh("CCPropertyOverrideInfo"),ES=Vh(QS),xS((IS=function(){function e(){ie(this,"targetInfo",AS,this),ie(this,"propertyPath",CS,this),ie(this,"value",wS,this)}return e.prototype.isTarget=function(){},e}(),AS=re((TS=IS).prototype,"targetInfo",[yh,ES],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),CS=re(TS.prototype,"propertyPath",[yh],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),wS=re(TS.prototype,"value",[yh],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),SS=TS))||SS),tT=(bS=mh("cc.MountedChildrenInfo"),RS=Vh(QS),OS=Vh([c.Node]),bS((LS=function(){function e(){ie(this,"targetInfo",MS,this),ie(this,"nodes",DS,this)}return e.prototype.isTarget=function(){},e}(),MS=re((PS=LS).prototype,"targetInfo",[yh,RS],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),DS=re(PS.prototype,"nodes",[yh,OS],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),NS=PS))||NS),nT=(FS=mh("cc.PrefabInstance"),zS=Vh(c.Node),BS=Vh([tT]),US=Vh([eT]),GS=Vh([QS]),FS((XS=function(){function e(){ie(this,"fileId",VS,this),ie(this,"prefabRootNode",jS,this),ie(this,"mountedChildren",WS,this),ie(this,"propertyOverrides",qS,this),ie(this,"removedComponents",YS,this),this.targetMap={}}var t=e.prototype;return t.findPropertyOverride=function(){},t.removePropertyOverride=function(){},e}(),VS=re((kS=XS).prototype,"fileId",[yh],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),jS=re(kS.prototype,"prefabRootNode",[yh,zS],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),WS=re(kS.prototype,"mountedChildren",[yh,BS],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),qS=re(kS.prototype,"propertyOverrides",[yh,US],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),YS=re(kS.prototype,"removedComponents",[yh,GS],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),HS=kS))||HS);function iT(e){var t=e._prefab;if(t&&t.instance){if(!t.asset)return R(3701,e.name),void(t.instance=null);var n=e._objFlags,i=e._parent,r=e._id,o=e._prefab;c.game._isCloning=!0,t.asset._doInstantiate(e),c.game._isCloning=!1,e._objFlags=n,e._parent=i,e._id=r,e._prefab&&(e._prefab.instance=null==o?void 0:o.instance)}}function rT(e,t,n){var i,r=t,o=null===(i=e._prefab)||void 0===i?void 0:i.instance;!n&&o&&(t[o.fileId]={},r=t[o.fileId]);var a=e._prefab;a&&(r[a.fileId]=e);for(var s=e.components,c=0;c<s.length;c++){var l=s[c];l.__prefab&&(r[l.__prefab.fileId]=l)}for(var u=0;u<e.children.length;u++)rT(e.children[u],r,!1)}function oT(e,t){if(!e)return null;for(var n=t,i=0;i<e.length;i++){if(!n)return null;n=n[e[i]]}return n}function aT(e,t,n){if(t)for(var i=0;i<t.length;i++){var r=t[i];if(r&&r.targetInfo){var o=oT(r.targetInfo.localID,n);if(!o)continue;if(r.nodes)for(var a=0;a<r.nodes.length;a++){var s=r.nodes[a];o._children.push(s),s._parent=o,s._onBatchCreated(!1)}}}}function sT(e,t,n){if(!(t.length<=0))for(var i=null,r=0;r<t.length;r++){var o=t[r];if(o&&o.targetInfo){if(!(i=oT(o.targetInfo.localID,n)))continue;var a=i,s=o.propertyPath.slice();if(s.length>0){var c=s.pop();if(!c)continue;for(var l=0;l<s.length&&(a=a[s[l]]);l++);if(!a)continue;if(Array.isArray(a))if("length"===c)a[c]=o.value;else{var u=Number.parseInt(c);Number.isInteger(u)&&u<a.length&&(a[c]=o.value)}else a[c]=o.value}}}}function cT(e){var t,n=null===(t=e._prefab)||void 0===t?void 0:t.targetOverrides;if(n)for(var i=0;i<n.length;i++){var r,o,a=n[i],s=a.source,c=a.sourceInfo;if(c){var l,u,h=null===(l=a.source)||void 0===l||null===(u=l._prefab)||void 0===u?void 0:u.instance;if(h&&h.targetMap&&(s=oT(c.localID,h.targetMap)),!s)continue}var _,f=a.targetInfo;if(f){var m=null===(r=a.target)||void 0===r||null===(o=r._prefab)||void 0===o?void 0:o.instance;if(m&&m.targetMap&&(_=oT(f.localID,m.targetMap))){var d=a.propertyPath.slice(),p=s;if(d.length>0){var v=d.pop();if(!v)return;for(var g=0;g<d.length;g++)p=p[d[g]];p[v]=_}}}}}var lT,uT,hT,_T,fT,mT,dT,pT,vT,gT,yT,xT,ET,ST,TT=Object.freeze({__proto__:null,TargetInfo:QS,TargetOverrideInfo:ZS,PrefabInfo:JS,CompPrefabInfo:$S,PropertyOverrideInfo:eT,MountedChildrenInfo:tT,PrefabInstance:nT,createNodeWithPrefab:iT,generateTargetMap:rT,getTarget:oT,applyMountedChildren:aT,applyPropertyOverrides:sT,applyTargetOverrides:cT}),AT=vt({AUTO:0,SINGLE_INSTANCE:1,MULTI_INSTANCE:2}),CT=e("e9",mh("cc.Prefab")((dT=mT=function(e){function t(){var t;return ie(t=e.call(this)||this,"data",hT,ee(t)),ie(t,"optimizationPolicy",_T,ee(t)),ie(t,"asyncLoadAssets",fT,ee(t)),t._createFunction=void 0,t._instantiatedTimes=void 0,t._createFunction=null,t._instantiatedTimes=0,t}$(t,e);var n=t.prototype;return n.createNode=function(e){var t=c.instantiate(this);t.name=this.name,e(null,t)},n.compileCreateFunction=function(){var e,t;this._createFunction=(t=(e=this.data)instanceof c._BaseNode&&e,new SE(e,t).result)},n._doInstantiate=function(e){return this.data._prefab||I(3700),this._createFunction||this.compileCreateFunction(),this._createFunction(e)},n._instantiate=function(){var e;return this.optimizationPolicy!==AT.SINGLE_INSTANCE&&(this.optimizationPolicy===AT.MULTI_INSTANCE||this._instantiatedTimes+1>=t.OptimizationPolicyThreshold)?(e=this._doInstantiate(),this.data._instantiate(e)):e=this.data._instantiate(),++this._instantiatedTimes,e},t}(B_),mT.OptimizationPolicy=AT,mT.OptimizationPolicyThreshold=3,hT=re((uT=dT).prototype,"data",[yh,bh],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),_T=re(uT.prototype,"optimizationPolicy",[yh,bh],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return AT.AUTO}}),fT=re(uT.prototype,"asyncLoadAssets",[yh,bh],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),lT=uT))||lT);dt.value(CT,"_utils",TT),c.Prefab=CT,He(c,"cc._Prefab","Prefab"),e("dW",(pT=mh("cc.PrefabLink"),vT=Vh(CT),gT=Rh(),pT((ST=function(e){function t(){for(var t,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return ie(t=e.call.apply(e,[this].concat(i))||this,"prefab",ET,ee(t)),t}return $(t,e),t}(om),ET=re((xT=ST).prototype,"prefab",[vT,yh,gT],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),yT=xT))||yT));var wT=new Fn;function IT(e,t,n,i){i||(i=new Fn),e.convertToUINode(t,n,i);var r=n.position;return i.add(r),i}function bT(e,t,n){return n||(n=new Fn),e.worldToScreen(t,n),n.x/=c.view.getScaleX(),n.y/=c.view.getScaleY(),n}var RT=e("d$",{WorldNode3DToLocalNodeUI:IT,WorldNode3DToWorldNodeUI:bT});c.pipelineUtils=RT,me(c.pipelineUtils,"cc.pipelineUtils",[{name:"WorldNode3DToLocalNodeUI",newName:"convertToUINode",targetName:"cc.Camera.prototype",customFunction:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];var i=t[0],r=t[3]||wT;return i.convertToUINode(t[1],t[2],r),r.add(t[2].position),t[3]||r.clone()}}]);var OT=new ti,NT=e("et",function(e){function t(n,i,r){var o;return(o=e.call(this,p_.MOUSE,i)||this).movementX=0,o.movementY=0,o.eventType=void 0,o._button=t.BUTTON_MISSING,o._x=0,o._y=0,o._prevX=0,o._prevY=0,o._scrollX=0,o._scrollY=0,o.eventType=n,r&&(o._prevX=r.x,o._prevY=r.y),o}$(t,e);var n=t.prototype;return n.setScrollData=function(e,t){this._scrollX=e,this._scrollY=t},n.getScrollX=function(){return this._scrollX},n.getScrollY=function(){return this._scrollY},n.setLocation=function(e,t){this._x=e,this._y=t},n.getLocation=function(e){return e||(e=new ti),ti.set(e,this._x,this._y),e},n.getLocationInView=function(e){return e||(e=new ti),ti.set(e,this._x,c.view._designResolutionSize.height-this._y),e},n.getUILocation=function(e){return e||(e=new ti),ti.set(e,this._x,this._y),c.view._convertPointWithScale(e),e},n.getPreviousLocation=function(e){return e||(e=new ti),ti.set(e,this._prevX,this._prevY),e},n.getUIPreviousLocation=function(e){return e||(e=new ti),ti.set(e,this._prevX,this._prevY),c.view._convertPointWithScale(e),e},n.getDelta=function(e){return e||(e=new ti),ti.set(e,this._x-this._prevX,this._y-this._prevY),e},n.getDeltaX=function(){return this._x-this._prevX},n.getDeltaY=function(){return this._y-this._prevY},n.getUIDelta=function(e){return e||(e=new ti),ti.set(e,(this._x-this._prevX)/c.view.getScaleX(),(this._y-this._prevY)/c.view.getScaleY()),e},n.getUIDeltaX=function(){return(this._x-this._prevX)/c.view.getScaleX()},n.getUIDeltaY=function(){return(this._y-this._prevY)/c.view.getScaleY()},n.setButton=function(e){this._button=e},n.getButton=function(){return this._button},n.getLocationX=function(){return this._x},n.getLocationY=function(){return this._y},n.getUILocationX=function(){var e=c.view.getViewportRect();return(this._x-e.x)/c.view.getScaleX()},n.getUILocationY=function(){var e=c.view.getViewportRect();return(this._y-e.y)/c.view.getScaleY()},t}(p_));NT.NONE=0,NT.DOWN=1,NT.UP=2,NT.MOVE=3,NT.SCROLL=4,NT.BUTTON_MISSING=-1,NT.BUTTON_LEFT=0,NT.BUTTON_RIGHT=2,NT.BUTTON_MIDDLE=1,NT.BUTTON_4=3,NT.BUTTON_5=4,NT.BUTTON_6=5,NT.BUTTON_7=6,NT.BUTTON_8=7;var PT=e("cN",function(e){function t(t,n,i,r){var o;return(o=e.call(this,p_.TOUCH,n)||this).touch=null,o.simulate=!1,o._eventCode=void 0,o._touches=void 0,o._allTouches=void 0,o._eventCode=i||0,o._touches=t||[],o._allTouches=r||[],o}$(t,e);var n=t.prototype;return n.getEventCode=function(){return this._eventCode},n.getTouches=function(){return this._touches},n.getAllTouches=function(){return this._allTouches},n.setLocation=function(e,t){this.touch&&this.touch.setTouchInfo(this.touch.getID(),e,t)},n.getLocation=function(e){return this.touch?this.touch.getLocation(e):new ti},n.getUILocation=function(e){return this.touch?this.touch.getUILocation(e):new ti},n.getLocationInView=function(e){return this.touch?this.touch.getLocationInView(e):new ti},n.getPreviousLocation=function(e){return this.touch?this.touch.getPreviousLocation(e):new ti},n.getStartLocation=function(e){return this.touch?this.touch.getStartLocation(e):new ti},n.getUIStartLocation=function(e){return this.touch?this.touch.getUIStartLocation(e):new ti},n.getID=function(){return this.touch?this.touch.getID():null},n.getDelta=function(e){return this.touch?this.touch.getDelta(e):new ti},n.getUIDelta=function(e){return this.touch?this.touch.getUIDelta(e):new ti},n.getDeltaX=function(){return this.touch?this.touch.getDelta(OT).x:0},n.getDeltaY=function(){return this.touch?this.touch.getDelta(OT).y:0},n.getLocationX=function(){return this.touch?this.touch.getLocationX():0},n.getLocationY=function(){return this.touch?this.touch.getLocationY():0},t}(p_));PT.MAX_TOUCHES=5,PT.BEGAN=0,PT.MOVED=1,PT.ENDED=2,PT.CANCELLED=3;var MT=e("eu",function(e){function t(t,n){var i;return(i=e.call(this,p_.ACCELERATION,n)||this).acc=void 0,i.acc=t,i}return $(t,e),t}(p_)),DT=e("ev",function(e){function t(t,n,i){var r;return(r=e.call(this,p_.KEYBOARD,i)||this).keyCode=void 0,r.rawEvent=void 0,r.isPressed=void 0,"number"==typeof t?r.keyCode=t:(r.keyCode=t.keyCode,r.rawEvent=t),r.isPressed=n,r}return $(t,e),t}(p_));p_.EventMouse=NT,p_.EventTouch=PT,p_.EventAcceleration=MT,p_.EventKeyboard=DT;var LT=function(){function e(e,t,n){this._cameraPriority=0,this.owner=null,this.mask=null,this._previousIn=!1,this._target=null,this._onEvent=void 0,this._type=void 0,this._listenerID=void 0,this._registered=!1,this._fixedPriority=0,this._node=null,this._paused=!0,this._isEnabled=!0,this._onEvent=n,this._type=e||0,this._listenerID=t||""}e.create=function(e){P(e&&e.event,1900);var t=e.event;delete e.event;var n=null;if(t===c.EventListener.TOUCH_ONE_BY_ONE?n=new BT:t===c.EventListener.TOUCH_ALL_AT_ONCE?n=new UT:t===c.EventListener.MOUSE?n=new zT:t===c.EventListener.KEYBOARD?n=new HT:t===c.EventListener.ACCELERATION&&(n=new GT(e.callback),delete e.callback),n)for(var i=0,r=Object.keys(e);i<r.length;i++){var o=r[i];n[o]=e[o]}return n},Z(e,[{key:"onEvent",get:function(){return this._onEvent}}]);var t=e.prototype;return t._setPaused=function(e){this._paused=e},t._isPaused=function(){return this._paused},t._setRegistered=function(e){this._registered=e},t._isRegistered=function(){return this._registered},t._getType=function(){return this._type},t._getListenerID=function(){return this._listenerID},t._setFixedPriority=function(e){this._fixedPriority=e},t._getFixedPriority=function(){return this._fixedPriority},t._setSceneGraphPriority=function(e){this._target=e,this._node=e},t._getSceneGraphPriority=function(){return this._node},t.checkAvailable=function(){return null!==this._onEvent},t.clone=function(){return null},t.setEnabled=function(e){this._isEnabled=e},t.isEnabled=function(){return this._isEnabled},e}();LT.UNKNOWN=0,LT.TOUCH_ONE_BY_ONE=1,LT.TOUCH_ALL_AT_ONCE=2,LT.KEYBOARD=3,LT.MOUSE=4,LT.ACCELERATION=6,LT.CUSTOM=8,LT.ListenerID={MOUSE:"__cc_mouse",TOUCH_ONE_BY_ONE:"__cc_touch_one_by_one",TOUCH_ALL_AT_ONCE:"__cc_touch_all_at_once",KEYBOARD:"__cc_keyboard",ACCELERATION:"__cc_acceleration"};var FT=LT.ListenerID,zT=function(e){function t(){var t;return(t=e.call(this,LT.MOUSE,FT.MOUSE,null)||this).onMouseDown=null,t.onMouseUp=null,t.onMouseMove=null,t.onMouseScroll=null,t._onEvent=function(e){return t._callback(e)},t}$(t,e);var n=t.prototype;return n._callback=function(e){var t=c.Event.EventMouse;switch(e.eventType){case t.DOWN:this.onMouseDown&&this.onMouseDown(e);break;case t.UP:this.onMouseUp&&this.onMouseUp(e);break;case t.MOVE:this.onMouseMove&&this.onMouseMove(e);break;case t.SCROLL:this.onMouseScroll&&this.onMouseScroll(e)}},n.clone=function(){var e=new t;return e.onMouseDown=this.onMouseDown,e.onMouseUp=this.onMouseUp,e.onMouseMove=this.onMouseMove,e.onMouseScroll=this.onMouseScroll,e},n.checkAvailable=function(){return!0},t}(LT),BT=function(e){function t(){var t;return(t=e.call(this,LT.TOUCH_ONE_BY_ONE,FT.TOUCH_ONE_BY_ONE,null)||this).swallowTouches=!1,t.onTouchBegan=null,t.onTouchMoved=null,t.onTouchEnded=null,t.onTouchCancelled=null,t._claimedTouches=[],t}$(t,e);var n=t.prototype;return n.setSwallowTouches=function(e){this.swallowTouches=e},n.isSwallowTouches=function(){return this.swallowTouches},n.clone=function(){var e=new t;return e.onTouchBegan=this.onTouchBegan,e.onTouchMoved=this.onTouchMoved,e.onTouchEnded=this.onTouchEnded,e.onTouchCancelled=this.onTouchCancelled,e.swallowTouches=this.swallowTouches,e},n.checkAvailable=function(){return!!this.onTouchBegan||(C(1801),!1)},t}(LT),UT=function(e){function t(){var t;return(t=e.call(this,LT.TOUCH_ALL_AT_ONCE,FT.TOUCH_ALL_AT_ONCE,null)||this).onTouchesBegan=null,t.onTouchesMoved=null,t.onTouchesEnded=null,t.onTouchesCancelled=null,t}$(t,e);var n=t.prototype;return n.clone=function(){var e=new t;return e.onTouchesBegan=this.onTouchesBegan,e.onTouchesMoved=this.onTouchesMoved,e.onTouchesEnded=this.onTouchesEnded,e.onTouchesCancelled=this.onTouchesCancelled,e},n.checkAvailable=function(){return null!==this.onTouchesBegan||null!==this.onTouchesMoved||null!==this.onTouchesEnded||null!==this.onTouchesCancelled||(C(1802),!1)},t}(LT),GT=function(e){function t(t){var n;return(n=e.call(this,LT.ACCELERATION,FT.ACCELERATION,null)||this)._onAccelerationEvent=null,n._onEvent=function(e){return n._callback(e)},n._onAccelerationEvent=t,n}$(t,e);var n=t.prototype;return n._callback=function(e){this._onAccelerationEvent&&this._onAccelerationEvent(e.acc,e)},n.checkAvailable=function(){return P(this._onAccelerationEvent,1803),!0},n.clone=function(){return new t(this._onAccelerationEvent)},t}(LT),HT=function(e){function t(){var t;return(t=e.call(this,LT.KEYBOARD,FT.KEYBOARD,null)||this).onKeyPressed=null,t.onKeyReleased=null,t._onEvent=function(e){return t._callback(e)},t}$(t,e);var n=t.prototype;return n._callback=function(e){e.isPressed?this.onKeyPressed&&this.onKeyPressed(e.keyCode,e):this.onKeyReleased&&this.onKeyReleased(e.keyCode,e)},n.clone=function(){var e=new t;return e.onKeyPressed=this.onKeyPressed,e.onKeyReleased=this.onKeyReleased,e},n.checkAvailable=function(){return null!==this.onKeyPressed||null!==this.onKeyReleased||(C(1800),!1)},t}(LT);c.EventListener=LT;var kT=LT.ListenerID,VT=function(){function e(){this.gt0Index=0,this._fixedListeners=[],this._sceneGraphListeners=[]}var t=e.prototype;return t.size=function(){return this._fixedListeners.length+this._sceneGraphListeners.length},t.empty=function(){return 0===this._fixedListeners.length&&0===this._sceneGraphListeners.length},t.push=function(e){0===e._getFixedPriority()?this._sceneGraphListeners.push(e):this._fixedListeners.push(e)},t.clearSceneGraphListeners=function(){this._sceneGraphListeners.length=0},t.clearFixedListeners=function(){this._fixedListeners.length=0},t.clear=function(){this._sceneGraphListeners.length=0,this._fixedListeners.length=0},t.getFixedPriorityListeners=function(){return this._fixedListeners},t.getSceneGraphPriorityListeners=function(){return this._sceneGraphListeners},e}(),jT=function(){function e(){this._listenersMap={},this._priorityDirtyFlagMap={},this._nodeListenersMap={},this._toAddedListeners=[],this._toRemovedListeners=[],this._dirtyListeners={},this._inDispatch=0,this._isEnabled=!1,this._internalCustomListenerIDs=[],this._currentTouch=null,this._currentTouchListener=null}var t=e.prototype;return t.pauseTarget=function(e,t){if(void 0===t&&(t=!1),e instanceof c._BaseNode){var n=this._nodeListenersMap[e.uuid];if(n)for(var i=0;i<n.length;++i)n[i]._setPaused(!0);if(!0===t){var r=e.children;if(r)for(var o=0;o<r.length;++o){var a=r[o];this.pauseTarget(a,!0)}}}else I(3506)},t.resumeTarget=function(e,t){if(void 0===t&&(t=!1),e instanceof c._BaseNode){var n=this._nodeListenersMap[e.uuid];if(n)for(var i=0;i<n.length;++i)n[i]._setPaused(!1);if(this._setDirtyForNode(e),!0===t&&e.children.length>0){var r=e.children;if(r)for(var o=0;o<r.length;++o){var a=r[o];this.resumeTarget(a,!0)}}}else I(3506)},t.frameUpdateListeners=function(){var e=this._listenersMap,t=this._priorityDirtyFlagMap;for(var n in e)e[n].empty()&&(delete t[n],delete e[n]);var i=this._toAddedListeners;if(0!==i.length){for(var r=0,o=i.length;r<o;r++)this._forceAddEventListener(i[r]);i.length=0}0!==this._toRemovedListeners.length&&this._cleanToRemovedListeners()},t.hasEventListener=function(e){return!!this._getListeners(e)},t.addListener=function(e,t){if(P(e&&t,3503),!(c.js.isNumber(t)||t instanceof c._BaseNode))return I(3506),null;if(e instanceof c.EventListener){if(e._isRegistered())return C(3505),null}else P(!c.js.isNumber(t),3504),e=c.EventListener.create(e);if(!e.checkAvailable())return null;if(c.js.isNumber(t)){if(0===t)return C(3500),null;e._setSceneGraphPriority(null),e._setFixedPriority(t),e._setRegistered(!0),e._setPaused(!1),this._addListener(e)}else{if(!(n=t)||!n.getComponent("cc.UITransform"))return C(3512),null;e._setSceneGraphPriority(t),e._setFixedPriority(0),e._setRegistered(!0),this._addListener(e)}var n;return e},t.addCustomListener=function(e,t){var n=LT.create({event:c.EventListener.CUSTOM,eventName:e,callback:t});return this.addListener(n,1),n},t.removeListener=function(e){if(null!=e){var t=!1,n=this._listenersMap;for(var i in n){var r=n[i],o=r.getFixedPriorityListeners(),a=r.getSceneGraphPriorityListeners();if((t=this._removeListenerInVector(a,e))?this._setDirty(e._getListenerID(),2):(t=this._removeListenerInVector(o,e))&&this._setDirty(e._getListenerID(),1),r.empty()&&(delete this._priorityDirtyFlagMap[e._getListenerID()],delete n[i]),t)break}if(!t)for(var s=this._toAddedListeners,l=s.length-1;l>=0;l--){var u=s[l];if(u===e){c.js.array.removeAt(s,l),u._setRegistered(!1);break}}}},t.removeListeners=function(e,t){if(void 0===t&&(t=!1),c.js.isNumber(e)||e instanceof c._BaseNode)if(void 0!==e._id){var n=this._nodeListenersMap[e._id];if(n){for(var i=c.js.array.copy(n),r=0;r<i.length;++r){var o=i[r];this.removeListener(o)}delete this._nodeListenersMap[e._id]}for(var a=this._toAddedListeners,s=0;s<a.length;){var l=a[s];l._getSceneGraphPriority()===e?(l._setSceneGraphPriority(null),l._setRegistered(!1),a.splice(s,1)):++s}if(!0===t)for(var u=e.getChildren(),h=0;h<u.length;++h){var _=u[h];this.removeListeners(_,!0)}}else e===c.EventListener.TOUCH_ONE_BY_ONE?this._removeListenersForListenerID(kT.TOUCH_ONE_BY_ONE):e===c.EventListener.TOUCH_ALL_AT_ONCE?this._removeListenersForListenerID(kT.TOUCH_ALL_AT_ONCE):e===c.EventListener.MOUSE?this._removeListenersForListenerID(kT.MOUSE):e===c.EventListener.ACCELERATION?this._removeListenersForListenerID(kT.ACCELERATION):e===c.EventListener.KEYBOARD?this._removeListenersForListenerID(kT.KEYBOARD):C(3501);else I(3506)},t.removeCustomListeners=function(e){this._removeListenersForListenerID(e)},t.removeAllListeners=function(){var e=this._listenersMap,t=this._internalCustomListenerIDs;for(var n in e)-1===t.indexOf(n)&&this._removeListenersForListenerID(n)},t.setPriority=function(e,t){if(null!=e){var n=this._listenersMap;for(var i in n){var r=n[i].getFixedPriorityListeners();if(r&&-1!==r.indexOf(e))return null!=e._getSceneGraphPriority()&&C(3502),void(e._getFixedPriority()!==t&&(e._setFixedPriority(t),this._setDirty(e._getListenerID(),1)))}}},t.setEnabled=function(e){this._isEnabled=e},t.isEnabled=function(){return this._isEnabled},t.dispatchEvent=function(e){if(this._isEnabled)if(this._updateDirtyFlagForSceneGraph(),this._inDispatch++,e&&e.getType){if(e.getType().startsWith(c.Event.TOUCH))return this._dispatchTouchEvent(e),void this._inDispatch--;var t=function(e){var t=p_,n=e.type;return n===t.ACCELERATION?kT.ACCELERATION:n===t.KEYBOARD?kT.KEYBOARD:n.startsWith(t.MOUSE)?kT.MOUSE:(n.startsWith(t.TOUCH)&&C(2e3),"")}(e);this._sortEventListeners(t);var n=this._listenersMap[t];null!=n&&(this._dispatchEventToListeners(n,this._onListenerCallback,e),this._onUpdateListeners(n)),this._inDispatch--}else R(3511)},t._onListenerCallback=function(e,t){t.currentTarget=e._target;var n=e.onEvent;return n&&n(t),t.isStopped()},t.dispatchCustomEvent=function(e,t){var n=new c.Event.EventCustom(e);n.setUserData(t),this.dispatchEvent(n)},t._setDirtyForNode=function(e){var t=this._nodeListenersMap[e._id];if(void 0!==t)for(var n=0,i=t.length;n<i;n++){var r=t[n]._getListenerID();this._dirtyListeners[r]||(this._dirtyListeners[r]=!0)}if(e.children.length>0)for(var o=e.children,a=0,s=o?o.length:0;a<s;a++)this._setDirtyForNode(o[a])},t._addListener=function(e){0===this._inDispatch?this._forceAddEventListener(e):this._toAddedListeners.push(e)},t._forceAddEventListener=function(e){var t=e._getListenerID(),n=this._listenersMap[t];if(n||(n=new VT,this._listenersMap[t]=n),n.push(e),0===e._getFixedPriority()){this._setDirty(t,2);var i=e._getSceneGraphPriority();null===i&&C(3507),this._associateNodeAndEventListener(i,e),i.activeInHierarchy&&this.resumeTarget(i)}else this._setDirty(t,1)},t._getListeners=function(e){return this._listenersMap[e]},t._updateDirtyFlagForSceneGraph=function(){var e=this._dirtyListeners;for(var t in e)this._setDirty(t,2),e[t]=!1},t._removeAllListenersInVector=function(e){if(e)for(var t,n=e.length-1;n>=0;n--)(t=e[n])._setRegistered(!1),null!=t._getSceneGraphPriority()&&(this._dissociateNodeAndEventListener(t._getSceneGraphPriority(),t),t._setSceneGraphPriority(null)),0===this._inDispatch&&c.js.array.removeAt(e,n)},t._removeListenersForListenerID=function(e){var t=this._listenersMap[e];if(t){var n=t.getFixedPriorityListeners(),i=t.getSceneGraphPriorityListeners();this._removeAllListenersInVector(i),this._removeAllListenersInVector(n),delete this._priorityDirtyFlagMap[e],this._inDispatch||(t.clear(),delete this._listenersMap[e])}for(var r=this._toAddedListeners,o=r.length-1;o>=0;o--){var a=r[o];a&&a._getListenerID()===e&&c.js.array.removeAt(r,o)}},t._sortEventListeners=function(e){var t=0,n=this._priorityDirtyFlagMap;n[e]&&(t=n[e]),0!==t&&(n[e]=0,1&t&&this._sortListenersOfFixedPriority(e),2&t&&c.director.getScene()&&this._sortListenersOfSceneGraphPriority(e))},t._sortListenersOfSceneGraphPriority=function(e){var t=this._getListeners(e);if(t){var n=t.getSceneGraphPriorityListeners();if(n&&0!==n.length){var i=t.getSceneGraphPriorityListeners();i.forEach((function(e){var t=e._getSceneGraphPriority()._uiProps.uiTransformComp;e._cameraPriority=t.cameraPriority})),i.sort(this._sortEventListenersOfSceneGraphPriorityDes)}}},t._sortEventListenersOfSceneGraphPriorityDes=function(e,t){var n=e._getSceneGraphPriority(),i=t._getSceneGraphPriority();if(!(t&&i&&i._activeInHierarchy&&i._uiProps.uiTransformComp))return-1;if(!(e&&n&&n._activeInHierarchy&&n._uiProps.uiTransformComp))return 1;var r=n,o=i,a=!1;if(e._cameraPriority!==t._cameraPriority)return t._cameraPriority-e._cameraPriority;for(;r.parent._id!==o.parent._id;)r=null===r.parent.parent?(a=!0)&&i:r.parent,o=null===o.parent.parent?(a=!0)&&n:o.parent;if(r._id===o._id){if(r._id===i._id)return-1;if(r._id===n._id)return 1}var s=r.getSiblingIndex(),c=o.getSiblingIndex();return a?s-c:c-s},t._sortListenersOfFixedPriority=function(e){var t=this._listenersMap[e];if(t){var n=t.getFixedPriorityListeners();if(n&&0!==n.length){n.sort(this._sortListenersOfFixedPriorityAsc);for(var i=0,r=n.length;i<r&&!(n[i]._getFixedPriority()>=0);)++i;t.gt0Index=i}}},t._sortListenersOfFixedPriorityAsc=function(e,t){return e._getFixedPriority()-t._getFixedPriority()},t._onUpdateListeners=function(e){var t=e.getFixedPriorityListeners(),n=e.getSceneGraphPriorityListeners(),i=this._toRemovedListeners;if(n)for(var r=n.length-1;r>=0;r--){var o=n[r];if(!o._isRegistered()){c.js.array.removeAt(n,r);var a=i.indexOf(o);-1!==a&&i.splice(a,1)}}if(t)for(var s=t.length-1;s>=0;s--){var l=t[s];if(!l._isRegistered()){c.js.array.removeAt(t,s);var u=i.indexOf(l);-1!==u&&i.splice(u,1)}}n&&0===n.length&&e.clearSceneGraphListeners(),t&&0===t.length&&e.clearFixedListeners()},t._updateTouchListeners=function(){var e=this._inDispatch;if(P(e>0,3508),!(e>1)){var t;(t=this._listenersMap[kT.TOUCH_ONE_BY_ONE])&&this._onUpdateListeners(t),(t=this._listenersMap[kT.TOUCH_ALL_AT_ONCE])&&this._onUpdateListeners(t),P(1===e,3509);var n=this._toAddedListeners;if(0!==n.length){for(var i=0,r=n.length;i<r;i++)this._forceAddEventListener(n[i]);this._toAddedListeners.length=0}0!==this._toRemovedListeners.length&&this._cleanToRemovedListeners()}},t._cleanToRemovedListeners=function(){for(var e=this._toRemovedListeners,t=0;t<e.length;++t){var n=e[t],i=this._listenersMap[n._getListenerID()];if(i){var r=i.getFixedPriorityListeners(),o=i.getSceneGraphPriorityListeners();if(o){var a=o.indexOf(n);-1!==a&&o.splice(a,1)}if(r){var s=r.indexOf(n);-1!==s&&r.splice(s,1)}}}e.length=0},t._onTouchEventCallback=function(e,t){if(!e._isRegistered())return!1;var n=t.event,i=n.touch;n.currentTarget=e._getSceneGraphPriority();var r=!1,o=-1,a=n.getEventCode();if(a===PT.BEGAN){if(!St.ENABLE_MULTI_TOUCH&&WT._currentTouch){var s=WT._currentTouchListener._node;if(!s||s.activeInHierarchy)return!1}e.onTouchBegan&&(r=e.onTouchBegan(i,n))&&e._isRegistered()&&(e._claimedTouches.push(i),!St.ENABLE_MULTI_TOUCH&&WT._currentTouch||(WT._currentTouch=i),WT._currentTouchListener=e)}else if(e._claimedTouches.length>0&&-1!==(o=e._claimedTouches.indexOf(i))){if(r=!0,!St.ENABLE_MULTI_TOUCH&&WT._currentTouch&&WT._currentTouch!==i)return!1;a===PT.MOVED&&e.onTouchMoved?e.onTouchMoved(i,n):a===PT.ENDED?(e.onTouchEnded&&e.onTouchEnded(i,n),e._isRegistered()&&e._claimedTouches.splice(o,1),(St.ENABLE_MULTI_TOUCH||WT._currentTouch===i)&&(WT._currentTouch=null),WT._currentTouchListener=null):a===PT.CANCELLED&&(e.onTouchCancelled&&e.onTouchCancelled(i,n),e._isRegistered()&&e._claimedTouches.splice(o,1),(St.ENABLE_MULTI_TOUCH||WT._currentTouch===i)&&(WT._currentTouch=null),WT._currentTouchListener=null)}return n.isStopped()?(WT._updateTouchListeners(n),!0):!!(r&&e._isRegistered()&&e.swallowTouches)&&(t.needsMutableSet&&t.touches.splice(i,1),!0)},t._dispatchTouchEvent=function(e){this._sortEventListeners(kT.TOUCH_ONE_BY_ONE),this._sortEventListeners(kT.TOUCH_ALL_AT_ONCE);var t=this._getListeners(kT.TOUCH_ONE_BY_ONE),n=this._getListeners(kT.TOUCH_ALL_AT_ONCE);if(null!==t||null!==n){var i=e.getTouches(),r=c.js.array.copy(i),o={event:e,needsMutableSet:t&&n,touches:r,selTouch:null};if(t)for(var a=0;a<i.length;++a){var s=i[a];e.touch=s,e.propagationStopped=e.propagationImmediateStopped=!1,this._dispatchEventToListeners(t,this._onTouchEventCallback,o)}n&&r.length>0&&(this._dispatchEventToListeners(n,this._onTouchesEventCallback,{event:e,touches:r}),e.isStopped())||this._updateTouchListeners(e)}},t._onTouchesEventCallback=function(e,t){if(!e._isRegistered())return!1;var n=t.event,i=t.touches,r=n.getEventCode();return n.currentTarget=e._getSceneGraphPriority(),r===PT.BEGAN&&e.onTouchesBegan?e.onTouchesBegan(i,n):r===PT.MOVED&&e.onTouchesMoved?e.onTouchesMoved(i,n):r===PT.ENDED&&e.onTouchesEnded?e.onTouchesEnded(i,n):r===PT.CANCELLED&&e.onTouchesCancelled&&e.onTouchesCancelled(i,n),!!n.isStopped()&&(WT._updateTouchListeners(n),!0)},t._associateNodeAndEventListener=function(e,t){var n=this._nodeListenersMap[e.uuid];n||(n=[],this._nodeListenersMap[e.uuid]=n),n.push(t)},t._dissociateNodeAndEventListener=function(e,t){var n=this._nodeListenersMap[e.uuid];n&&(c.js.array.remove(n,t),0===n.length&&delete this._nodeListenersMap[e.uuid])},t._dispatchEventToListeners=function(e,t,n){var i=!1,r=e.getFixedPriorityListeners(),o=e.getSceneGraphPriorityListeners(),a=0;if(r&&0!==r.length)for(;a<e.gt0Index;++a){var s=r[a];if(s.isEnabled()&&!s._isPaused()&&s._isRegistered()&&t(s,n)){i=!0;break}}if(o&&!i)for(var c=0;c<o.length;++c){var l=o[c];if(l.isEnabled()&&!l._isPaused()&&l._isRegistered()&&t(l,n)){i=!0;break}}if(r&&!i)for(;a<r.length;++a){var u=r[a];if(u.isEnabled()&&!u._isPaused()&&u._isRegistered()&&t(u,n)){i=!0;break}}},t._setDirty=function(e,t){var n=this._priorityDirtyFlagMap;null==n[e]?n[e]=t:n[e]|=t},t._sortNumberAsc=function(e,t){return e-t},t._removeListenerInCallback=function(e,t){if(null==e)return!1;for(var n=e.length-1;n>=0;n--){var i=e[n];if(i._onCustomEvent===t||i.onEvent===t)return i._setRegistered(!1),null!=i._getSceneGraphPriority()&&(this._dissociateNodeAndEventListener(i._getSceneGraphPriority(),i),i._setSceneGraphPriority(null)),0===this._inDispatch?c.js.array.removeAt(e,n):this._toRemovedListeners.push(i),!0}return!1},t._removeListenerInVector=function(e,t){if(null==e)return!1;for(var n=e.length-1;n>=0;n--){var i=e[n];if(i===t)return i._setRegistered(!1),null!=i._getSceneGraphPriority()&&(this._dissociateNodeAndEventListener(i._getSceneGraphPriority(),i),i._setSceneGraphPriority(null)),0===this._inDispatch?c.js.array.removeAt(e,n):this._toRemovedListeners.push(i),!0}return!1},e}(),WT=e("ep",new jT);c.eventManager=WT;var qT=new ti,YT=e("ew",function(){function e(e,t,n){void 0===n&&(n=0),this._point=new ti,this._prevPoint=new ti,this._lastModified=0,this._id=0,this._startPoint=new ti,this._startPointCaptured=!1,this.setTouchInfo(n,e,t)}Z(e,[{key:"lastModified",get:function(){return this._lastModified}}]);var t=e.prototype;return t.getLocation=function(e){return e||(e=new ti),e.set(this._point.x,this._point.y),e},t.getLocationX=function(){return this._point.x},t.getLocationY=function(){return this._point.y},t.getUILocation=function(e){return e||(e=new ti),e.set(this._point.x,this._point.y),c.view._convertPointWithScale(e),e},t.getUILocationX=function(){var e=c.view.getViewportRect();return(this._point.x-e.x)/c.view.getScaleX()},t.getUILocationY=function(){var e=c.view.getViewportRect();return(this._point.y-e.y)/c.view.getScaleY()},t.getPreviousLocation=function(e){return e||(e=new ti),e.set(this._prevPoint.x,this._prevPoint.y),e},t.getUIPreviousLocation=function(e){return e||(e=new ti),e.set(this._prevPoint.x,this._prevPoint.y),c.view._convertPointWithScale(e),e},t.getStartLocation=function(e){return e||(e=new ti),e.set(this._startPoint.x,this._startPoint.y),e},t.getUIStartLocation=function(e){return e||(e=new ti),e.set(this._startPoint.x,this._startPoint.y),c.view._convertPointWithScale(e),e},t.getDelta=function(e){return e||(e=new ti),e.set(this._point),e.subtract(this._prevPoint),e},t.getUIDelta=function(e){return e||(e=new ti),qT.set(this._point),qT.subtract(this._prevPoint),e.set(c.view.getScaleX(),c.view.getScaleY()),ti.divide(e,qT,e),e},t.getLocationInView=function(e){return e||(e=new ti),e.set(this._point.x,c.view._designResolutionSize.height-this._point.y),e},t.getPreviousLocationInView=function(e){return e||(e=new ti),e.set(this._prevPoint.x,c.view._designResolutionSize.height-this._prevPoint.y),e},t.getStartLocationInView=function(e){return e||(e=new ti),e.set(this._startPoint.x,c.view._designResolutionSize.height-this._startPoint.y),e},t.getID=function(){return this._id},t.setTouchInfo=function(e,t,n){void 0===e&&(e=0),this._prevPoint=this._point,this._point=new ti(t||0,n||0),this._id=e,this._startPointCaptured||(this._startPoint=new ti(this._point),this._startPointCaptured=!0)},t.setPoint=function(e,t){"object"==typeof e?(this._point.x=e.x,this._point.y=e.y):(this._point.x=e||0,this._point.y=t||0),this._lastModified=c.director.getCurrentTime()},t.setPrevPoint=function(e,t){this._prevPoint="object"==typeof e?new ti(e.x,e.y):new ti(e||0,t||0),this._lastModified=c.director.getCurrentTime()},e}());c.Touch=YT;var XT,KT=St.TOUCH_TIMEOUT,QT=new ti,ZT=new ti,JT=e("eq",(function(e,t,n,i){void 0===e&&(e=0),void 0===t&&(t=0),void 0===n&&(n=0),void 0===i&&(i=0),this.x=void 0,this.y=void 0,this.z=void 0,this.timestamp=void 0,this.x=e,this.y=t,this.z=n,this.timestamp=i}));c.internal.Acceleration=JT;var $T=new(function(){function e(){this._mousePressed=!1,this._isRegisterEvent=!1,this._preTouchPoint=new ti,this._prevMousePoint=new ti,this._preTouchPool=[],this._preTouchPoolPointer=0,this._touches=[],this._touchesIntegerDict={},this._indexBitsUsed=0,this._maxTouches=8,this._accelEnabled=!1,this._accelInterval=.2,this._accelMinus=1,this._accelCurTime=0,this._acceleration=null,this._accelDeviceEvent=null,this._glView=null,this._pointLocked=!1}var t=e.prototype;return t.handleTouchesBegin=function(e){for(var t=[],n=this._touchesIntegerDict,i=0;i<e.length;++i){var r=e[i],o=r.getID();if(null!==o&&void 0===n[o]){var a=this._getUnUsedIndex();if(-1===a){C(2300,a);continue}r.getLocation(QT);var s=new YT(QT.x,QT.y,o);this._touches[a]=s,r.getPreviousLocation(QT),s.setPrevPoint(QT),n[o]=a,t.push(s)}}if(t.length>0){var c=new PT(t,!1,PT.BEGAN,St.ENABLE_MULTI_TOUCH?this._getUsefulTouches():t);WT.dispatchEvent(c)}},t.handleTouchesMove=function(e){for(var t=[],n=this._touches,i=0;i<e.length;++i){var r=e[i],o=r.getID();if(null!==o){var a=this._touchesIntegerDict[o];void 0!==a&&n[a]&&(r.getLocation(QT),n[a].setPoint(QT),r.getPreviousLocation(QT),n[a].setPrevPoint(QT),t.push(n[a]))}}if(t.length>0){var s=new PT(t,!1,PT.MOVED,St.ENABLE_MULTI_TOUCH?this._getUsefulTouches():t);WT.dispatchEvent(s)}},t.handleTouchesEnd=function(e){var t=this.getSetOfTouchesEndOrCancel(e);if(t.length>0){var n=new PT(t,!1,PT.ENDED,St.ENABLE_MULTI_TOUCH?this._getUsefulTouches():t);WT.dispatchEvent(n)}this._preTouchPool.length=0},t.handleTouchesCancel=function(e){var t=this.getSetOfTouchesEndOrCancel(e);if(t.length>0){var n=new PT(t,!1,PT.CANCELLED,St.ENABLE_MULTI_TOUCH?this._getUsefulTouches():t);WT.dispatchEvent(n)}this._preTouchPool.length=0},t.getSetOfTouchesEndOrCancel=function(e){for(var t=[],n=this._touches,i=this._touchesIntegerDict,r=0;r<e.length;++r){var o=e[r],a=o.getID();if(null!==a){var s=i[a];void 0!==s&&n[s]&&(o.getLocation(QT),n[s].setPoint(QT),o.getPreviousLocation(QT),n[s].setPrevPoint(QT),t.push(n[s]),this._removeUsedIndexBit(s),delete i[a])}}return t},t.getHTMLElementPosition=function(e){var t=document.documentElement,n=wv.os===wv.OS_IOS&&wv.isBrowser?window.screenLeft:window.pageXOffset;n-=t.clientLeft;var i=wv.os===wv.OS_IOS&&wv.isBrowser?window.screenTop:window.pageYOffset;if(i-=t.clientTop,e.getBoundingClientRect){var r=e.getBoundingClientRect();return{left:r.left+n,top:r.top+i,width:r.width,height:r.height}}return e instanceof HTMLCanvasElement?{left:n,top:i,width:e.width,height:e.height}:{left:n,top:i,width:parseInt(e.style.width||"0",void 0),height:parseInt(e.style.height||"0",void 0)}},t.getPreTouch=function(e){for(var t=null,n=this._preTouchPool,i=e.getID(),r=n.length-1;r>=0;r--)if(n[r].getID()===i){t=n[r];break}return t||(t=e),t},t.setPreTouch=function(e){for(var t=!1,n=this._preTouchPool,i=e.getID(),r=n.length-1;r>=0;r--)if(n[r].getID()===i){n[r]=e,t=!0;break}t||(n.length<=50?n.push(e):(n[this._preTouchPoolPointer]=e,this._preTouchPoolPointer=(this._preTouchPoolPointer+1)%50))},t.getTouchByXY=function(e,t,n,i){var r=this._preTouchPoint,o=this._glView.convertToLocationInView(t,n,i);this._pointLocked&&(o.x=r.x+e.movementX,o.y=r.y-e.movementY);var a=new YT(o.x,o.y,0);return a.setPrevPoint(r.x,r.y),r.x=o.x,r.y=o.y,a},t.getMouseEvent=function(e,t,n){var i=this._prevMousePoint,r=new NT(n,!1,i);return i.x=e.x,i.y=e.y,this._glView._convertMouseToLocation(i,t),r.setLocation(i.x,i.y),r},t.getPointByEvent=function(e,t){return null!=e.pageX?{x:e.pageX,y:e.pageY}:(t.left-=document.body.scrollLeft,t.top-=document.body.scrollTop,{x:e.clientX,y:e.clientY})},t.getTouchesByEvent=function(e,t){for(var n=[],i=this._glView,r=this._preTouchPoint,o=e.changedTouches.length,a=0;a<o;a++){var s=e.changedTouches[a];if(s){var c;c=wv.BROWSER_TYPE_FIREFOX===wv.browserType?i.convertToLocationInView(s.pageX,s.pageY,t,QT):i.convertToLocationInView(s.clientX,s.clientY,t,QT);var l=void 0;if(null!=s.identifier?(l=new YT(c.x,c.y,s.identifier),this.getPreTouch(l).getLocation(ZT),l.setPrevPoint(ZT.x,ZT.y),this.setPreTouch(l)):(l=new YT(c.x,c.y)).setPrevPoint(r.x,r.y),r.x=c.x,r.y=c.y,n.push(l),!St.ENABLE_MULTI_TOUCH)break}}return n},t.registerSystemEvent=function(e){if(!this._isRegisterEvent&&e){this._glView=c.view;var t=wv.isMobile,n=wv.capabilities.mouse,i=wv.capabilities.touches;n&&this._registerMouseEvents(e,t),window.navigator.msPointerEnabled&&this._registerMousePointerEvents(e),i&&this._registerTouchEvents(e),this._registerKeyboardEvent(),this._isRegisterEvent=!0}},t.setAccelerometerEnabled=function(e){if(this._accelEnabled!==e){this._accelEnabled=e;var t=c.director.getScheduler();t.enableForTarget(this),this._accelEnabled?(this._registerAccelerometerEvent(),this._accelCurTime=0,t.scheduleUpdate(this)):(this._unregisterAccelerometerEvent(),this._accelCurTime=0,t.unscheduleUpdate(this))}},t.didAccelerate=function(e){if(this._accelEnabled){var t=this._acceleration,n=0,i=0,r=0;if(this._accelDeviceEvent===window.DeviceMotionEvent){var o=e.accelerationIncludingGravity;o&&(n=this._accelMinus*(o.x||0)*.1,i=this._accelMinus*(o.y||0)*.1,r=.1*(o.z||0))}else{var a=e;n=(a.gamma||0)/90*.981,i=-(a.beta||0)/90*.981,r=(a.alpha||0)/90*.981}if(c.view._isRotated){var s=n;n=-i,i=s}t.x=n,t.y=i,t.z=r,t.timestamp=e.timeStamp||Date.now();var l=t.x;90===window.orientation?(t.x=-t.y,t.y=l):-90===window.orientation?(t.x=t.y,t.y=-l):180===window.orientation&&(t.x=-t.x,t.y=-t.y),c.sys.os===c.sys.OS_ANDROID&&c.sys.browserType!==c.sys.BROWSER_TYPE_MOBILE_QQ&&(t.x=-t.x,t.y=-t.y)}},t.update=function(e){this._accelCurTime>this._accelInterval&&(this._accelCurTime-=this._accelInterval,WT.dispatchEvent(new MT(this._acceleration))),this._accelCurTime+=e},t.setAccelerometerInterval=function(e){this._accelInterval!==e&&(this._accelInterval=e)},t._getUnUsedIndex=function(){for(var e=this._indexBitsUsed,t=c.director.getCurrentTime(),n=0;n<this._maxTouches;n++){if(!(1&e))return this._indexBitsUsed|=1<<n,n;var i=this._touches[n];if(t-i.lastModified>KT){this._removeUsedIndexBit(n);var r=i.getID();return null!==r&&delete this._touchesIntegerDict[r],n}e>>=1}return-1},t._removeUsedIndexBit=function(e){if(!(e<0||e>=this._maxTouches)){var t=1<<e;t=~t,this._indexBitsUsed&=t}},t._registerMouseEvents=function(e,t){this._registerPointerLockEvent(),t||this._registerWindowMouseEvents(e),this._registerElementMouseEvents(e,t)},t._registerPointerLockEvent=function(){var e=this,t=function(){var t=c.game.canvas;document.pointerLockElement===t||document.mozPointerLockElement===t?e._pointLocked=!0:e._pointLocked=!1};"onpointerlockchange"in document?document.addEventListener("pointerlockchange",t,!1):"onmozpointerlockchange"in document&&document.addEventListener("mozpointerlockchange",t,!1)},t._registerWindowMouseEvents=function(e){var t=this;window.addEventListener("mousedown",(function(){t._mousePressed=!0}),!1),window.addEventListener("mouseup",(function(n){if(t._mousePressed){t._mousePressed=!1;var i=t.getHTMLElementPosition(e),r=t.getPointByEvent(n,i);if(!hi(i.left,i.top,i.width,i.height).contains(new ti(r.x,r.y))){t.handleTouchesEnd([t.getTouchByXY(n,r.x,r.y,i)]);var o=t.getMouseEvent(r,i,NT.UP);o.setButton(n.button),WT.dispatchEvent(o)}}}),!1)},t._registerElementMouseEvents=function(e,t){var n=this,i=function(t,i,r){e.addEventListener(t,(function(t){var o=n.getHTMLElementPosition(e),a=n.getPointByEvent(t,o),s=n.getMouseEvent(a,o,i);s.setButton(t.button),r(t,s,a,o),WT.dispatchEvent(s),t.stopPropagation(),t.preventDefault()}))};t||(i("mousedown",NT.DOWN,(function(t,i,r,o){n._mousePressed=!0,n.handleTouchesBegin([n.getTouchByXY(t,r.x,r.y,o)]),e.focus()})),i("mouseup",NT.UP,(function(e,t,i,r){n._mousePressed=!1,n.handleTouchesEnd([n.getTouchByXY(e,i.x,i.y,r)])})),i("mousemove",NT.MOVE,(function(e,t,i,r){n.handleTouchesMove([n.getTouchByXY(e,i.x,i.y,r)]),n._mousePressed||t.setButton(NT.BUTTON_MISSING),void 0!==e.movementX&&void 0!==e.movementY&&(t.movementX=e.movementX,t.movementY=e.movementY)}))),i("mousewheel",NT.SCROLL,(function(e,t){t.setScrollData(0,e.wheelDelta)})),i("DOMMouseScroll",NT.SCROLL,(function(e,t){t.setScrollData(0,-120*e.detail)}))},t._registerMousePointerEvents=function(e){var t=this,n={MSPointerDown:this.handleTouchesBegin,MSPointerMove:this.handleTouchesMove,MSPointerUp:this.handleTouchesEnd,MSPointerCancel:this.handleTouchesCancel},i=function(i){var r=n[i];e.addEventListener(i,(function(n){var i=t.getHTMLElementPosition(e);i.left-=document.documentElement.scrollLeft,i.top-=document.documentElement.scrollTop,r.call(t,[t.getTouchByXY(n,n.clientX,n.clientY,i)]),n.stopPropagation()}),!1)};for(var r in n)i(r)},t._registerTouchEvents=function(e){var t=this,n=function(n){return function(i){if(i.changedTouches){var r=t.getHTMLElementPosition(e),o=document.body;r.left-=o.scrollLeft||0,r.top-=o.scrollTop||0,n(t.getTouchesByEvent(i,r)),i.stopPropagation(),i.preventDefault()}}};e.addEventListener("touchstart",n((function(n){t.handleTouchesBegin(n),e.focus()})),!1),e.addEventListener("touchmove",n((function(e){t.handleTouchesMove(e)})),!1),e.addEventListener("touchend",n((function(e){t.handleTouchesEnd(e)})),!1),e.addEventListener("touchcancel",n((function(e){t.handleTouchesCancel(e)})),!1)},t._registerKeyboardEvent=function(){var e=c.game.canvas;e.addEventListener("keydown",(function(e){WT.dispatchEvent(new DT(e,!0)),e.stopPropagation(),e.preventDefault()}),!1),e.addEventListener("keyup",(function(e){WT.dispatchEvent(new DT(e,!1)),e.stopPropagation(),e.preventDefault()}),!1)},t._registerAccelerometerEvent=function(){var e=this;this._acceleration=new JT,this._accelDeviceEvent=window.DeviceMotionEvent||window.DeviceOrientationEvent,c.sys.browserType===c.sys.BROWSER_TYPE_MOBILE_QQ&&(this._accelDeviceEvent=window.DeviceOrientationEvent);var t=this._accelDeviceEvent===window.DeviceMotionEvent?"devicemotion":"deviceorientation";XT=function(){return e.didAccelerate.apply(e,arguments)},window.addEventListener(t,XT,!1)},t._unregisterAccelerometerEvent=function(){var e=this._accelDeviceEvent===window.DeviceMotionEvent?"devicemotion":"deviceorientation";XT&&window.removeEventListener(e,XT,!1)},t._getUsefulTouches=function(){var e=[],t=this._touchesIntegerDict;for(var n in t){var i=t[parseInt(n)];if(null!=i){var r=this._touches[i];e.push(r)}}return e},e}());c.internal.inputManager=$T;var eA=e("ca",function(e){function t(){for(var t,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return(t=e.call.apply(e,[this].concat(i))||this).frame=null,t.container=null,t.canvas=null,t.renderType=-1,t.eventTargetOn=e.prototype.on,t.eventTargetOnce=e.prototype.once,t.config={},t.onStart=null,t.collisionMatrix=[],t.groupList=[],t._persistRootNodes={},t._paused=!0,t._configLoaded=!1,t._isCloning=!1,t._inited=!1,t._engineInited=!1,t._rendererInitialized=!1,t._gfxDevice=null,t._intervalId=null,t}$(t,e);var n=t.prototype;return n.setFrameRate=function(e){var t=this.config;"number"!=typeof e&&(e=parseInt(e,10),Number.isNaN(e)&&(e=60)),t.frameRate=e,this._paused=!0,this._setAnimFrame(),this._runMainLoop()},n.getFrameRate=function(){return this.config.frameRate||0},n.step=function(){c.director.mainLoop()},n.pause=function(){this._paused||(this._paused=!0,this._intervalId&&(window.cAF(this._intervalId),this._intervalId=0))},n.resume=function(){this._paused&&this._runMainLoop()},n.isPaused=function(){return this._paused},n.restart=function(){var e=this;return new Promise((function(e){return c.director.once(c.Director.EVENT_AFTER_DRAW,(function(){return e()}))})).then((function(){for(var n in e._persistRootNodes)e.removePersistRootNode(e._persistRootNodes[n]);return c.director.getScene().destroy(),c.Object._deferredDestroy(),c.director.reset(),e.pause(),e._setRenderPipelineNShowSplash().then((function(){e.resume(),e._safeEmit(t.EVENT_RESTART)}))}))},n.end=function(){this._gfxDevice&&(this._gfxDevice.destroy(),this._gfxDevice=null),window.close()},n.on=function(e,n,i,r){return this._engineInited&&e===t.EVENT_ENGINE_INITED?n.call(i):this.eventTargetOn(e,n,i,r)},n.once=function(e,n,i){return this._engineInited&&e===t.EVENT_ENGINE_INITED?n.call(i):this.eventTargetOnce(e,n,i)},n.init=function(e){var t=this;return this._initConfig(e),this.config.assetOptions&&c.assetManager.init(this.config.assetOptions),this._initEngine().then((function(){return t._initEvents(),c.director.root.dataPoolManager&&c.director.root.dataPoolManager.jointTexturePool.registerCustomTextureLayouts(e.customJointTextureLayouts),t._engineInited}))},n.run=function(e,t){var n,i=this;return"function"!=typeof e&&e?(n=this.init(e),this.onStart=null!=t?t:null):this.onStart=null!=e?e:null,Promise.resolve(n).then((function(){return tA.config.registerSystemEvent&&$T.registerSystemEvent(tA.canvas),i._setRenderPipelineNShowSplash()}))},n.addPersistRootNode=function(e){if(c.Node.isNode(e)&&e.uuid){var t=e.uuid;if(!this._persistRootNodes[t]){var n=c.director._scene;if(c.isValid(n))if(e.parent){if(!(e.parent instanceof c.Scene))return void I(3801);if(e.parent!==n)return void I(3802)}else e.parent=n;this._persistRootNodes[t]=e,e._persistNode=!0,c.assetManager._releaseManager._addPersistNodeRef(e)}}else I(3800)},n.removePersistRootNode=function(e){var t=e.uuid||"";e===this._persistRootNodes[t]&&(delete this._persistRootNodes[t],e._persistNode=!1,c.assetManager._releaseManager._removePersistNodeRef(e))},n.isPersistRootNode=function(e){return!!e._persistNode},n._initEngine=function(){var e=this;return this._initDevice(),Promise.resolve(c.director._init()).then((function(){v("Cocos Creator v"+l),e.emit(t.EVENT_ENGINE_INITED),e._engineInited=!0,c.internal.dynamicAtlasManager.enabled=!St.CLEANUP_IMAGE_CACHE}))},n._setAnimFrame=function(){this._lastTime=performance.now();var e=this.config.frameRate;this._frameTime=1e3/e,this._intervalId&&(window.cAF(this._intervalId),this._intervalId=0);var t=window.requestAnimationFrame=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame;60!==e&&30!==e?(window.rAF=t?this._stTimeWithRAF:this._stTime,window.cAF=this._ctTime):(window.rAF=t||this._stTime,window.cAF=window.cancelAnimationFrame||window.cancelRequestAnimationFrame||window.msCancelRequestAnimationFrame||window.mozCancelRequestAnimationFrame||window.oCancelRequestAnimationFrame||window.webkitCancelRequestAnimationFrame||window.msCancelAnimationFrame||window.mozCancelAnimationFrame||window.webkitCancelAnimationFrame||window.ocancelAnimationFrame||this._ctTime)},n._stTimeWithRAF=function(e){var t=performance.now(),n=Math.max(0,t-tA._lastTime),i=Math.max(0,tA._frameTime-n),r=window.setTimeout((function(){window.requestAnimationFrame(e)}),i);return tA._lastTime=t+i,r},n._stTime=function(e){var t=performance.now(),n=Math.max(0,t-tA._lastTime),i=Math.max(0,tA._frameTime-n),r=window.setTimeout(e,i);return tA._lastTime=t+i,r},n._ctTime=function(e){window.clearTimeout(e)},n._runMainLoop=function(){var e=this;if(this._inited&&!i){var t,n=this.config,r=c.director,o=n.frameRate;if(L(!!n.showFPS),r.startAnimation(),30===o){var a=!0;t=function(n){e._intervalId=window.rAF(t),(a=!a)||r.mainLoop(n)}}else t=function(n){e._intervalId=window.rAF(t),r.mainLoop(n)};this._intervalId&&(window.cAF(this._intervalId),this._intervalId=0),this._intervalId=window.rAF(t),this._paused=!1}},n._initConfig=function(e){"number"!=typeof e.debugMode&&(e.debugMode=O.NONE),e.exposeClassName=!!e.exposeClassName,"number"!=typeof e.frameRate&&(e.frameRate=60);var t=e.renderMode;("number"!=typeof t||t>2||t<0)&&(e.renderMode=0),"boolean"!=typeof e.registerSystemEvent&&(e.registerSystemEvent=!0),e.showFPS=!!e.showFPS,this.collisionMatrix=e.collisionMatrix||[],this.groupList=e.groupList||[],E(e.debugMode),this.config=e,this._configLoaded=!0,this._setAnimFrame()},n._determineRenderType=function(){var e=this.config,n=parseInt(e.renderMode,10);this.renderType=t.RENDER_TYPE_CANVAS;var i=!1;if(0===n?c.sys.capabilities.opengl?(this.renderType=t.RENDER_TYPE_WEBGL,i=!0):c.sys.capabilities.canvas&&(this.renderType=t.RENDER_TYPE_CANVAS,i=!0):1===n&&c.sys.capabilities.canvas?(this.renderType=t.RENDER_TYPE_CANVAS,i=!0):2===n&&c.sys.capabilities.opengl&&(this.renderType=t.RENDER_TYPE_WEBGL,i=!0),!i)throw new Error(M(3820,n))},n._initDevice=function(){if(!this._rendererInitialized){if(this.canvas=this.config.adapter.canvas,this.frame=this.config.adapter.frame,this.container=this.config.adapter.container,this._determineRenderType(),this.renderType===t.RENDER_TYPE_WEBGL){var e=[],n=!!window.WebGL2RenderingContext,i=window.navigator.userAgent.toLowerCase();(-1!==i.indexOf("safari")&&-1===i.indexOf("chrome")||wv.browserType===wv.BROWSER_TYPE_UC)&&(n=!1),n&&c.WebGL2Device&&e.push(c.WebGL2Device),c.WebGLDevice&&e.push(c.WebGLDevice);for(var r=new Xa(this.canvas,St.ENABLE_WEBGL_ANTIALIAS,!1,window.devicePixelRatio,wv.windowPixelResolution.width,wv.windowPixelResolution.height,nu),o=0;o<e.length&&(this._gfxDevice=new e[o],!this._gfxDevice.initialize(r));o++);}if(!this._gfxDevice)return y("can not support canvas rendering in 3D"),void(this.renderType=t.RENDER_TYPE_CANVAS);this.canvas.oncontextmenu=function(){return!1}}},n._initEvents=function(){var e,n=this,i=window;void 0!==document.hidden?e="hidden":void 0!==document.mozHidden?e="mozHidden":void 0!==document.msHidden?e="msHidden":void 0!==document.webkitHidden&&(e="webkitHidden");var r=!1,o=this;function a(){r||(r=!0,o.emit(t.EVENT_HIDE))}function s(e,n,i,a,s){r&&(r=!1,o.emit(t.EVENT_SHOW,e,n,i,a,s))}if(e)for(var c=["visibilitychange","mozvisibilitychange","msvisibilitychange","webkitvisibilitychange","qbrowserVisibilityChange"],l=0;l<c.length;l++)document.addEventListener(c[l],(function(t){var n=document[e];(n=n||t.hidden)?a():s()}));else i.addEventListener("blur",a),i.addEventListener("focus",s);window.navigator.userAgent.indexOf("MicroMessenger")>-1&&(i.onfocus=s),"onpageshow"in window&&"onpagehide"in window&&(i.addEventListener("pagehide",a),i.addEventListener("pageshow",s),document.addEventListener("pagehide",a),document.addEventListener("pageshow",s)),this.on(t.EVENT_HIDE,(function(){n.pause()})),this.on(t.EVENT_SHOW,(function(){n.resume()}))},n._setRenderPipelineNShowSplash=function(){var e=this;return Promise.resolve(this._setupRenderPipeline()).then((function(){return Promise.resolve(e._showSplashScreen()).then((function(){e._inited=!0,e._setAnimFrame(),e._runMainLoop(),e._safeEmit(t.EVENT_GAME_INITED),e.onStart&&e.onStart()}))}))},n._setupRenderPipeline=function(){var e=this,t=this.config.renderPipeline;return t?new Promise((function(e,n){c.assetManager.loadAny(t,(function(t,i){return!t&&i instanceof $v?e(i):n(t)}))})).then((function(t){e._setRenderPipeline(t)})).catch((function(n){g(n),g("Failed load render pipeline: "+t+", engine failed to initialize, will fallback to default pipeline"),e._setRenderPipeline()})):this._setRenderPipeline()},n._showSplashScreen=function(){if(c.internal.SplashScreen){var e=c.internal.SplashScreen.instance;return e.main(c.director.root),new Promise((function(t){e.setOnFinish((function(){return t()})),e.loadFinish=!0}))}return null},n._setRenderPipeline=function(e){c.director.root.setRenderPipeline(e)||this._setRenderPipeline(),this._rendererInitialized=!0,this._safeEmit(t.EVENT_RENDERER_INITED)},n._safeEmit=function(e){this.emit(e)},Z(t,[{key:"inited",get:function(){return this._inited}},{key:"frameTime",get:function(){return this._frameTime}}]),t}(z_));eA.EVENT_HIDE="game_on_hide",eA.EVENT_SHOW="game_on_show",eA.EVENT_LOW_MEMORY="game_on_low_memory",eA.EVENT_GAME_INITED="game_inited",eA.EVENT_ENGINE_INITED="engine_inited",eA.EVENT_RENDERER_INITED="renderer_inited",eA.EVENT_RESTART="game_on_restart",eA.RENDER_TYPE_CANVAS=0,eA.RENDER_TYPE_WEBGL=1,eA.RENDER_TYPE_OPENGL=2,c.Game=eA;var tA=e("cf",c.game=new eA),nA=e("ce",{topLeft:c.v2(0,0),topRight:c.v2(0,0),top:c.v2(0,0),bottomLeft:c.v2(0,0),bottomRight:c.v2(0,0),bottom:c.v2(0,0),center:c.v2(0,0),left:c.v2(0,0),right:c.v2(0,0),width:0,height:0,init:function(e){var t=this.width=e.width,n=this.height=e.height,i=e.x,r=e.y,o=r+n,a=i+t;this.topLeft.x=i,this.topLeft.y=o,this.topRight.x=a,this.topRight.y=o,this.top.x=i+t/2,this.top.y=o,this.bottomLeft.x=i,this.bottomLeft.y=r,this.bottomRight.x=a,this.bottomRight.y=r,this.bottom.x=i+t/2,this.bottom.y=r,this.center.x=i+t/2,this.center.y=r+n/2,this.left.x=i,this.left.y=r+n/2,this.right.x=a,this.right.y=r+n/2}});c.visibleRect=nA;var iA=new(function(){function e(){this.html=void 0,this.meta={width:"device-width"},this.adaptationType=c.sys.browserType}var t=e.prototype;return t.init=function(){this.html=document.getElementsByTagName("html")[0]},t.availWidth=function(e){return c.sys.isMobile||!e||e===this.html?window.innerWidth:e.clientWidth},t.availHeight=function(e){return c.sys.isMobile||!e||e===this.html?window.innerHeight:e.clientHeight},e}());switch(c.sys.os===c.sys.OS_IOS&&(iA.adaptationType=c.sys.BROWSER_TYPE_SAFARI),iA.adaptationType){case c.sys.BROWSER_TYPE_SAFARI:iA.meta["minimal-ui"]="true",iA.availWidth=function(e){return e.clientWidth},iA.availHeight=function(e){return e.clientHeight};break;case c.sys.BROWSER_TYPE_SOUGOU:case c.sys.BROWSER_TYPE_UC:iA.availWidth=function(e){return e.clientWidth},iA.availHeight=function(e){return e.clientHeight}}var rA=e("cS",function(e){function t(){var t;(t=e.call(this)||this)._resizeWithBrowserSize=void 0,t._designResolutionSize=void 0,t._originalDesignResolutionSize=void 0,t._frameSize=void 0,t._scaleX=void 0,t._scaleY=void 0,t._viewportRect=void 0,t._visibleRect=void 0,t._autoFullScreen=void 0,t._devicePixelRatio=void 0,t._maxPixelRatio=void 0,t._retinaEnabled=void 0,t._resizeCallback=void 0,t._resizing=void 0,t._orientationChanging=void 0,t._isRotated=void 0,t._orientation=void 0,t._isAdjustViewport=void 0,t._resolutionPolicy=void 0,t._rpExactFit=void 0,t._rpShowAll=void 0,t._rpNoBorder=void 0,t._rpFixedHeight=void 0,t._rpFixedWidth=void 0;var n=oA,i=aA;return t._frameSize=new ci(0,0),t._designResolutionSize=new ci(0,0),t._originalDesignResolutionSize=new ci(0,0),t._scaleX=1,t._scaleY=1,t._viewportRect=new ui(0,0,0,0),t._visibleRect=new ui(0,0,0,0),t._autoFullScreen=!1,t._devicePixelRatio=1,t._maxPixelRatio=2,t._retinaEnabled=!1,t._resizeCallback=null,t._resizing=!1,t._resizeWithBrowserSize=!1,t._orientationChanging=!0,t._isRotated=!1,t._orientation=c.macro.ORIENTATION_AUTO,t._isAdjustViewport=!0,t._rpExactFit=new sA(n.EQUAL_TO_FRAME,i.EXACT_FIT),t._rpShowAll=new sA(n.EQUAL_TO_FRAME,i.SHOW_ALL),t._rpNoBorder=new sA(n.EQUAL_TO_FRAME,i.NO_BORDER),t._rpFixedHeight=new sA(n.EQUAL_TO_FRAME,i.FIXED_HEIGHT),t._rpFixedWidth=new sA(n.EQUAL_TO_FRAME,i.FIXED_WIDTH),t._resolutionPolicy=t._rpShowAll,c.game.once(c.Game.EVENT_ENGINE_INITED,t.init,ee(t)),t}$(t,e);var n=t.prototype;return n.init=function(){iA.init(),this._initFrameSize();var e=c.game.canvas.width,t=c.game.canvas.height;this._designResolutionSize.width=e,this._designResolutionSize.height=t,this._originalDesignResolutionSize.width=e,this._originalDesignResolutionSize.height=t,this._viewportRect.width=e,this._viewportRect.height=t,this._visibleRect.width=e,this._visibleRect.height=t,c.winSize.width=this._visibleRect.width,c.winSize.height=this._visibleRect.height,c.visibleRect&&c.visibleRect.init(this._visibleRect)},n.resizeWithBrowserSize=function(e){e?this._resizeWithBrowserSize||(this._resizeWithBrowserSize=!0,window.addEventListener("resize",this._resizeEvent),window.addEventListener("orientationchange",this._orientationChange)):this._resizeWithBrowserSize&&(this._resizeWithBrowserSize=!1,window.removeEventListener("resize",this._resizeEvent),window.removeEventListener("orientationchange",this._orientationChange))},n.setResizeCallback=function(e){"function"!=typeof e&&null!=e||(this._resizeCallback=e)},n.setOrientation=function(e){(e&=c.macro.ORIENTATION_AUTO)&&this._orientation!==e&&(this._orientation=e)},n.adjustViewportMeta=function(e){this._isAdjustViewport=e},n.enableRetina=function(e){this._retinaEnabled=!!e},n.isRetinaEnabled=function(){return this._retinaEnabled},n.enableAutoFullScreen=function(e){e&&e!==this._autoFullScreen&&c.sys.isMobile&&c.sys.browserType!==c.sys.BROWSER_TYPE_WECHAT?(this._autoFullScreen=!0,c.screen.autoFullScreen(c.game.frame)):this._autoFullScreen=!1},n.isAutoFullScreenEnabled=function(){return this._autoFullScreen},n.setCanvasSize=function(e,t){var n=c.game.canvas,i=c.game.container;this._devicePixelRatio=window.devicePixelRatio,n.width=wv.windowPixelResolution.width,n.height=wv.windowPixelResolution.height,n.style.width=e+"px",n.style.height=t+"px",i.style.width=e+"px",i.style.height=t+"px",this._resizeEvent()},n.getCanvasSize=function(){return new ci(c.game.canvas.width,c.game.canvas.height)},n.getFrameSize=function(){return new ci(this._frameSize.width,this._frameSize.height)},n.setFrameSize=function(e,t){this._frameSize.width=e,this._frameSize.height=t,c.game.frame.style.width=e+"px",c.game.frame.style.height=t+"px",this._resizeEvent()},n.getVisibleSize=function(){return new ci(this._visibleRect.width,this._visibleRect.height)},n.getVisibleSizeInPixel=function(){return new ci(this._visibleRect.width*this._scaleX,this._visibleRect.height*this._scaleY)},n.getVisibleOrigin=function(){return new ti(this._visibleRect.x,this._visibleRect.y)},n.getVisibleOriginInPixel=function(){return new ti(this._visibleRect.x*this._scaleX,this._visibleRect.y*this._scaleY)},n.getResolutionPolicy=function(){return this._resolutionPolicy},n.setResolutionPolicy=function(e){if(e instanceof sA)this._resolutionPolicy=e;else{var t=sA;e===t.EXACT_FIT&&(this._resolutionPolicy=this._rpExactFit),e===t.SHOW_ALL&&(this._resolutionPolicy=this._rpShowAll),e===t.NO_BORDER&&(this._resolutionPolicy=this._rpNoBorder),e===t.FIXED_HEIGHT&&(this._resolutionPolicy=this._rpFixedHeight),e===t.FIXED_WIDTH&&(this._resolutionPolicy=this._rpFixedWidth)}},n.setDesignResolutionSize=function(e,t,n){if(e>0&&t>0){this.setResolutionPolicy(n);var i=this._resolutionPolicy;if(i&&i.preApply(this),c.sys.isMobile&&this._adjustViewportMeta(),this._orientationChanging=!0,this._resizing||this._initFrameSize(),i){this._originalDesignResolutionSize.width=this._designResolutionSize.width=e,this._originalDesignResolutionSize.height=this._designResolutionSize.height=t;var r=i.apply(this,this._designResolutionSize);if(r.scale&&2===r.scale.length&&(this._scaleX=r.scale[0],this._scaleY=r.scale[1]),r.viewport){var o=this._viewportRect,a=this._visibleRect,s=r.viewport;o.x=s.x,o.y=s.y,o.width=s.width,o.height=s.height,a.x=0,a.y=0,a.width=s.width/this._scaleX,a.height=s.height/this._scaleY}i.postApply(this),c.winSize.width=this._visibleRect.width,c.winSize.height=this._visibleRect.height,nA&&nA.init(this._visibleRect),this.emit("design-resolution-changed")}else C(2201)}else R(2200)},n.getDesignResolutionSize=function(){return new ci(this._designResolutionSize.width,this._designResolutionSize.height)},n.setRealPixelResolution=function(e,t,n){this._setViewportMeta({width:e},!0),document.documentElement.style.width=e+"px",document.body.style.width=e+"px",document.body.style.left="0px",document.body.style.top="0px",this.setDesignResolutionSize(e,t,n)},n.getViewportRect=function(){return this._viewportRect},n.getScaleX=function(){return this._scaleX},n.getScaleY=function(){return this._scaleY},n.getDevicePixelRatio=function(){return this._devicePixelRatio},n.convertToLocationInView=function(e,t,n,i){var r=i||new ti,o=this._devicePixelRatio*(e-n.left),a=this._devicePixelRatio*(n.top+n.height-t);return this._isRotated?(r.x=c.game.canvas.width-a,r.y=o):(r.x=o,r.y=a),c.GAME_VIEW&&(r.x/=c.gameView.canvas.width/c.game.canvas.width,r.y/=c.gameView.canvas.height/c.game.canvas.height),r},n._convertPointWithScale=function(e){var t=this._viewportRect;e.x=(e.x-t.x)/this._scaleX,e.y=(e.y-t.y)/this._scaleY},n._resizeEvent=function(){var e=c.view,t=e._frameSize.width,n=e._frameSize.height,i=e._isRotated;if(c.sys.isMobile){var r=c.game.container.style,o=r.margin;r.margin="0",r.display="none",e._initFrameSize(),r.margin=o,r.display="block"}else e._initFrameSize();if(e._orientationChanging||e._isRotated!==i||e._frameSize.width!==t||e._frameSize.height!==n){var a=e._originalDesignResolutionSize.width,s=e._originalDesignResolutionSize.height;e._resizing=!0,a>0&&e.setDesignResolutionSize(a,s,e._resolutionPolicy),e._resizing=!1,e.emit("canvas-resize"),e._resizeCallback&&e._resizeCallback.call()}},n._orientationChange=function(){c.view._orientationChanging=!0,c.view._resizeEvent()},n._initFrameSize=function(){var e=this._frameSize,t=iA.availWidth(c.game.frame),n=iA.availHeight(c.game.frame),i=t>=n;!c.sys.isMobile||i&&this._orientation&c.macro.ORIENTATION_LANDSCAPE||!i&&this._orientation&c.macro.ORIENTATION_PORTRAIT?(e.width=t,e.height=n,c.game.container.style["-webkit-transform"]="rotate(0deg)",c.game.container.style.transform="rotate(0deg)",this._isRotated=!1):(e.width=n,e.height=t,c.game.container.style["-webkit-transform"]="rotate(90deg)",c.game.container.style.transform="rotate(90deg)",c.game.container.style["-webkit-transform-origin"]="0px 0px 0px",c.game.container.style.transformOrigin="0px 0px 0px",this._isRotated=!0,c.game.canvas.style["-webkit-transform"]="translateZ(0px)",c.game.canvas.style.transform="translateZ(0px)"),this._orientationChanging&&setTimeout((function(){c.view._orientationChanging=!1}),1e3)},n._adjustSizeKeepCanvasSize=function(){var e=this._originalDesignResolutionSize.width,t=this._originalDesignResolutionSize.height;e>0&&this.setDesignResolutionSize(e,t,this._resolutionPolicy)},n._setViewportMeta=function(e,t){var n=document.getElementById("cocosMetaElement");n&&t&&document.head.removeChild(n);var i,r,o,a=document.getElementsByName("viewport"),s=a?a[0]:null;for(r in i=s?s.content:"",(n=n||document.createElement("meta")).id="cocosMetaElement",n.name="viewport",n.content="",e)-1===i.indexOf(r)?i+=","+r+"="+e[r]:t&&(o=new RegExp(r+"s*=s*[^,]+"),i=i.replace(o,r+"="+e[r]));/^,/.test(i)&&(i=i.substr(1)),n.content=i,s&&(s.content=i),document.head.appendChild(n)},n._adjustViewportMeta=function(){!this._isAdjustViewport||a||r||o||(this._setViewportMeta(iA.meta,!1),this._isAdjustViewport=!1)},n._convertMouseToLocation=function(e,t){e.x=this._devicePixelRatio*(e.x-t.left),e.y=this._devicePixelRatio*(t.top+t.height-e.y),c.GAME_VIEW&&(e.x/=c.gameView.canvas.width/c.game.canvas.width,e.y/=c.gameView.canvas.height/c.game.canvas.height)},n._convertTouchWidthScale=function(e){var t=this._viewportRect,n=this._scaleX,i=this._scaleY;e._point.x=(e._point.x-t.x)/n,e._point.y=(e._point.y-t.y)/i,e._prevPoint.x=(e._prevPoint.x-t.x)/n,e._prevPoint.y=(e._prevPoint.y-t.y)/i},n._convertTouchesWithScale=function(e){for(var t,n,i=this._viewportRect,r=this._scaleX,o=this._scaleY,a=0;a<e.length;a++){var s=e[a];t=s._point,n=s._prevPoint,t.x=(t.x-i.x)/r,t.y=(t.y-i.y)/o,n.x=(n.x-i.x)/r,n.y=(n.y-i.y)/o}},t}(z_));rA.instance=void 0;var oA=function(){function e(){this.name="ContainerStrategy"}var t=e.prototype;return t.preApply=function(){},t.apply=function(){},t.postApply=function(){},t._setupContainer=function(e,t,n){var i=c.game.canvas,r=c.game.container;c.sys.os===c.sys.OS_ANDROID&&(document.body.style.width=(e._isRotated?n:t)+"px",document.body.style.height=(e._isRotated?t:n)+"px"),r.style.width=i.style.width=t+"px",r.style.height=i.style.height=n+"px",e._devicePixelRatio=1,e.isRetinaEnabled()&&(e._devicePixelRatio=Math.min(e._maxPixelRatio,window.devicePixelRatio||1)),i.width=t*e._devicePixelRatio,i.height=n*e._devicePixelRatio},t._fixContainer=function(){document.body.insertBefore(c.game.container,document.body.firstChild);var e=document.body.style;e.width=window.innerWidth+"px",e.height=window.innerHeight+"px",e.overflow="hidden";var t=c.game.container.style;t.position="fixed",t.left=t.top="0px",document.body.scrollTop=0},e}();oA.EQUAL_TO_FRAME=void 0,oA.PROPORTION_TO_FRAME=void 0;var aA=function(){function e(){this.name="ContentStrategy",this._result=void 0,this._result={scale:[1,1],viewport:null}}var t=e.prototype;return t.preApply=function(){},t.apply=function(){return{scale:[1,1]}},t.postApply=function(){},t._buildResult=function(e,t,n,i,r,o){Math.abs(e-n)<2&&(n=e),Math.abs(t-i)<2&&(i=t);var a=new ui(Math.round((e-n)/2),Math.round((t-i)/2),n,i);return this._result.scale=[r,o],this._result.viewport=a,this._result},e}();aA.EXACT_FIT=void 0,aA.SHOW_ALL=void 0,aA.NO_BORDER=void 0,aA.FIXED_HEIGHT=void 0,aA.FIXED_WIDTH=void 0,function(){var e=function(e){function t(){for(var t,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return(t=e.call.apply(e,[this].concat(i))||this).name="EqualToFrame",t}return $(t,e),t.prototype.apply=function(e){var t=e._frameSize.height,n=c.game.container.style;this._setupContainer(e,e._frameSize.width,e._frameSize.height),e._isRotated?n.margin="0 0 0 "+t+"px":n.margin="0px",n.padding="0px"},t}(oA),t=function(e){function t(){for(var t,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return(t=e.call.apply(e,[this].concat(i))||this).name="ProportionalToFrame",t}return $(t,e),t.prototype.apply=function(e,t){var n,i,r=e._frameSize.width,o=e._frameSize.height,a=c.game.container.style,s=t.width,l=t.height,u=r/s,h=o/l;u<h?(n=r,i=l*u):(n=s*h,i=o);var _=Math.round((r-n)/2),f=Math.round((o-i)/2);n=r-2*_,i=o-2*f,this._setupContainer(e,n,i),e._isRotated?a.margin="0 0 0 "+o+"px":a.margin="0px",a.paddingLeft=_+"px",a.paddingRight=_+"px",a.paddingTop=f+"px",a.paddingBottom=f+"px"},t}(oA),n=("undefined"==typeof window?global:window).__globalAdapter;n&&(n.adaptContainerStrategy&&n.adaptContainerStrategy(oA.prototype),n.adaptView&&n.adaptView(rA.prototype)),oA.EQUAL_TO_FRAME=new e,oA.PROPORTION_TO_FRAME=new t;var i=function(e){function t(){for(var t,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return(t=e.call.apply(e,[this].concat(i))||this).name="ExactFit",t}return $(t,e),t.prototype.apply=function(e,t){var n=c.game.canvas.width,i=c.game.canvas.height,r=n/t.width,o=i/t.height;return this._buildResult(n,i,n,i,r,o)},t}(aA),r=function(e){function t(){for(var t,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return(t=e.call.apply(e,[this].concat(i))||this).name="ShowAll",t}return $(t,e),t.prototype.apply=function(e,t){var n,i,r=c.game.canvas.width,o=c.game.canvas.height,a=t.width,s=t.height,l=r/a,u=o/s,h=0;return l<u?(n=r,i=s*(h=l)):(n=a*(h=u),i=o),this._buildResult(r,o,n,i,h,h)},t}(aA),o=function(e){function t(){for(var t,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return(t=e.call.apply(e,[this].concat(i))||this).name="NoBorder",t}return $(t,e),t.prototype.apply=function(e,t){var n,i,r,o=c.game.canvas.width,a=c.game.canvas.height,s=t.width,l=t.height,u=o/s,h=a/l;return u<h?(i=s*(n=h),r=a):(i=o,r=l*(n=u)),this._buildResult(o,a,i,r,n,n)},t}(aA),a=function(e){function t(){for(var t,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return(t=e.call.apply(e,[this].concat(i))||this).name="FixedHeight",t}return $(t,e),t.prototype.apply=function(e,t){var n=c.game.canvas.width,i=c.game.canvas.height,r=i/t.height,o=n,a=i;return this._buildResult(n,i,o,a,r,r)},t}(aA),s=function(e){function t(){for(var t,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return(t=e.call.apply(e,[this].concat(i))||this).name="FixedWidth",t}return $(t,e),t.prototype.apply=function(e,t){var n=c.game.canvas.width,i=c.game.canvas.height,r=n/t.width,o=n,a=i;return this._buildResult(n,i,o,a,r,r)},t}(aA);aA.EXACT_FIT=new i,aA.SHOW_ALL=new r,aA.NO_BORDER=new o,aA.FIXED_HEIGHT=new a,aA.FIXED_WIDTH=new s}();var sA=e("eo",function(){function e(e,t){this.name="ResolutionPolicy",this._containerStrategy=void 0,this._contentStrategy=void 0,this._containerStrategy=null,this._contentStrategy=null,this.setContainerStrategy(e),this.setContentStrategy(t)}var t=e.prototype;return t.preApply=function(e){this._containerStrategy.preApply(e),this._contentStrategy.preApply(e)},t.apply=function(e,t){return this._containerStrategy.apply(e,t),this._contentStrategy.apply(e,t)},t.postApply=function(e){this._containerStrategy.postApply(e),this._contentStrategy.postApply(e)},t.setContainerStrategy=function(e){e instanceof oA&&(this._containerStrategy=e)},t.setContentStrategy=function(e){e instanceof aA&&(this._contentStrategy=e)},Z(e,[{key:"canvasSize",get:function(){return new ti(c.game.canvas.width,c.game.canvas.height)}}]),e}());sA.EXACT_FIT=0,sA.NO_BORDER=1,sA.SHOW_ALL=2,sA.FIXED_HEIGHT=3,sA.FIXED_WIDTH=4,sA.UNKNOWN=5,sA.ContainerStrategy=oA,sA.ContentStrategy=aA,c.ResolutionPolicy=sA;var cA,lA=e("cg",rA.instance=c.view=new rA);c.winSize=new ci,de(rA.prototype,"View.prototype",[{name:"isAntiAliasEnabled",suggest:"The API of Texture2d have been largely modified, no alternative"},{name:"enableAntiAlias",suggest:"The API of Texture2d have been largely modified, no alternative"}]),function(e){e.TOUCH_START="touch-start",e.TOUCH_MOVE="touch-move",e.TOUCH_END="touch-end",e.TOUCH_CANCEL="touch-cancel",e.MOUSE_DOWN="mouse-down",e.MOUSE_MOVE="mouse-move",e.MOUSE_UP="mouse-up",e.MOUSE_WHEEL="mouse-wheel",e.MOUSE_ENTER="mouse-enter",e.MOUSE_LEAVE="mouse-leave",e.KEY_DOWN="keydown",e.KEY_UP="keyup",e.DEVICEMOTION="devicemotion",e.TRANSFORM_CHANGED="transform-changed",e.SCENE_CHANGED_FOR_PERSISTS="scene-changed-for-persists",e.SIZE_CHANGED="size-changed",e.ANCHOR_CHANGED="anchor-changed",e.COLOR_CHANGED="color-changed",e.CHILD_ADDED="child-added",e.CHILD_REMOVED="child-removed",e.PARENT_CHANGED="parent-changed",e.NODE_DESTROYED="node-destroyed",e.LAYER_CHANGED="layer-changed",e.SIBLING_ORDER_CHANGED="sibling-order-changed"}(cA||(cA=e("b$",{}))),xt(cA),c.SystemEventType=cA,me(cA,"Node.EventType",[{name:"POSITION_PART",newName:"TRANSFORM_CHANGED"},{name:"ROTATION_PART",newName:"TRANSFORM_CHANGED"},{name:"SCALE_PART",newName:"TRANSFORM_CHANGED"}]);var uA=null,hA=null,_A=null,fA=null,mA=e("er",function(e){function t(){return e.call(this)||this}$(t,e);var n=t.prototype;return n.setAccelerometerEnabled=function(e){e&&window.DeviceMotionEvent&&"function"==typeof DeviceMotionEvent.requestPermission?DeviceMotionEvent.requestPermission().then((function(e){C(3520,e),$T.setAccelerometerEnabled("granted"===e)})).catch((function(e){I(3521,e.message),$T.setAccelerometerEnabled(!1)})):$T.setAccelerometerEnabled(e)},n.setAccelerometerInterval=function(e){$T.setAccelerometerInterval(e)},n.on=function(t,n,i,r){return e.prototype.on.call(this,t,n,i,r),t!==cA.KEY_DOWN&&t!==cA.KEY_UP||uA||(uA=LT.create({event:LT.KEYBOARD,onKeyPressed:function(e,t){t.type=cA.KEY_DOWN,dA.emit(t.type,t)},onKeyReleased:function(e,t){t.type=cA.KEY_UP,dA.emit(t.type,t)}}),WT.addListener(uA,256)),t===cA.DEVICEMOTION&&(hA||(hA=LT.create({event:LT.ACCELERATION,callback:function(e,t){t.type=cA.DEVICEMOTION,c.systemEvent.emit(t.type,t)}}),WT.addListener(hA,256))),t!==cA.TOUCH_START&&t!==cA.TOUCH_MOVE&&t!==cA.TOUCH_END&&t!==cA.TOUCH_CANCEL||_A||(_A=LT.create({event:LT.TOUCH_ONE_BY_ONE,onTouchBegan:function(e,t){return t.type=cA.TOUCH_START,c.systemEvent.emit(t.type,e,t),!0},onTouchMoved:function(e,t){t.type=cA.TOUCH_MOVE,c.systemEvent.emit(t.type,e,t)},onTouchEnded:function(e,t){t.type=cA.TOUCH_END,c.systemEvent.emit(t.type,e,t)},onTouchCancelled:function(e,t){t.type=cA.TOUCH_CANCEL,c.systemEvent.emit(t.type,e,t)}}),WT.addListener(_A,256)),t!==cA.MOUSE_DOWN&&t!==cA.MOUSE_MOVE&&t!==cA.MOUSE_UP&&t!==cA.MOUSE_WHEEL||fA||(fA=LT.create({event:LT.MOUSE,onMouseDown:function(e){e.type=cA.MOUSE_DOWN,c.systemEvent.emit(e.type,e)},onMouseMove:function(e){e.type=cA.MOUSE_MOVE,c.systemEvent.emit(e.type,e)},onMouseUp:function(e){e.type=cA.MOUSE_UP,c.systemEvent.emit(e.type,e)},onMouseScroll:function(e){e.type=cA.MOUSE_WHEEL,c.systemEvent.emit(e.type,e)}}),WT.addListener(fA,256)),n},n.off=function(t,n,i){if(e.prototype.off.call(this,t,n,i),uA&&(t===cA.KEY_DOWN||t===cA.KEY_UP)){var r=this.hasEventListener(cA.KEY_DOWN),o=this.hasEventListener(cA.KEY_UP);r||o||(WT.removeListener(uA),uA=null)}if(hA&&t===cA.DEVICEMOTION&&(WT.removeListener(hA),hA=null),_A&&(t===cA.TOUCH_START||t===cA.TOUCH_MOVE||t===cA.TOUCH_END||t===cA.TOUCH_CANCEL)){var a=this.hasEventListener(cA.TOUCH_START),s=this.hasEventListener(cA.TOUCH_MOVE),c=this.hasEventListener(cA.TOUCH_END),l=this.hasEventListener(cA.TOUCH_CANCEL);a||s||c||l||(WT.removeListener(_A),_A=null)}if(fA&&(t===cA.MOUSE_DOWN||t===cA.MOUSE_MOVE||t===cA.MOUSE_UP||t===cA.MOUSE_WHEEL)){var u=this.hasEventListener(cA.MOUSE_DOWN),h=this.hasEventListener(cA.MOUSE_MOVE),_=this.hasEventListener(cA.MOUSE_UP),f=this.hasEventListener(cA.MOUSE_WHEEL);u||h||_||f||(WT.removeListener(fA),fA=null)}},t}(z_));mA.EventType=cA,c.SystemEvent=mA;var dA=e("es",new mA);c.systemEvent=dA;var pA=e("cI",{_supportsFullScreen:!1,_onfullscreenchange:null,_onfullscreenerror:null,_preOnFullScreenError:null,_preOnTouch:null,_touchEvent:"",_fn:null,_fnMap:[["requestFullscreen","exitFullscreen","fullscreenchange","fullscreenEnabled","fullscreenElement"],["requestFullScreen","exitFullScreen","fullScreenchange","fullScreenEnabled","fullScreenElement"],["webkitRequestFullScreen","webkitCancelFullScreen","webkitfullscreenchange","webkitIsFullScreen","webkitCurrentFullScreenElement"],["mozRequestFullScreen","mozCancelFullScreen","mozfullscreenchange","mozFullScreen","mozFullScreenElement"],["msRequestFullscreen","msExitFullscreen","MSFullscreenChange","msFullscreenEnabled","msFullscreenElement"]],init:function(){var e,t,n;this._fn={};var i,r=this._fnMap;for(e=0,t=r.length;e<t;e++)if((n=r[e])&&void 0!==document[n[1]]){for(e=0,i=n.length;e<i;e++)this._fn[r[0][e]]=n[e];break}this._supportsFullScreen=void 0!==this._fn.requestFullscreen,this._touchEvent="ontouchstart"in window?"touchstart":"mousedown"},get supportsFullScreen(){return this._supportsFullScreen},fullScreen:function(){return!!this._supportsFullScreen&&void 0!==document[this._fn.fullscreenElement]&&null!==document[this._fn.fullscreenElement]},requestFullScreen:function(e,t,n){if(this._supportsFullScreen){if(e=e||document.documentElement,t){var i=this._fn.fullscreenchange;this._onfullscreenchange&&document.removeEventListener(i,this._onfullscreenchange),this._onfullscreenchange=t,document.addEventListener(i,t,!1)}if(n){var r=this._fn.fullscreenerror;this._onfullscreenerror&&document.removeEventListener(r,this._onfullscreenerror),this._onfullscreenerror=n,document.addEventListener(r,n,{once:!0})}var o=e[this._fn.requestFullscreen]();return window.Promise&&o instanceof Promise&&o.catch((function(){})),o}},exitFullScreen:function(){var e;return this.fullScreen()&&(e=document[this._fn.exitFullscreen]()).catch((function(){})),e},autoFullScreen:function(e,t){e=e||document.body,this._ensureFullScreen(e,t),this.requestFullScreen(e,t)},disableAutoFullScreen:function(e){if(this._preOnTouch){var t=c.game.canvas||e,n=this._touchEvent;t.removeEventListener(n,this._preOnTouch),this._preOnTouch=null}},_ensureFullScreen:function(e,t){var n=this,i=c.game.canvas||e,r=this._fn.fullscreenerror,o=this._touchEvent,a=function(){n._preOnFullScreenError=null,n._preOnTouch&&i.removeEventListener(o,n._preOnTouch),n._preOnTouch=function(){n._preOnTouch=null,n.requestFullScreen(e,t)},i.addEventListener(o,n._preOnTouch,{once:!0})};this._preOnFullScreenError&&e.removeEventListener(r,this._preOnFullScreenError),this._preOnFullScreenError=a,e.addEventListener(r,a,{once:!0})}});pA.init(),c.screen=pA;var vA=function(){var e=t.prototype;function t(){this.handle=0,this.callBack=null,this.cancelAnimate=!1,this.startTime=-1,this._splashFinish=!1,this._loadFinish=!1,this._directCall=!1}return e.main=function(e){if(null!=e){if(window._CCSettings&&window._CCSettings.splashScreen){var t=this.setting=window._CCSettings.splashScreen;t.totalTime=null!=this.setting.totalTime?this.setting.totalTime:3e3,t.base64src=this.setting.base64src||"",t.effect=this.setting.effect||"FADE-INOUT",t.clearColor=this.setting.clearColor||new as(.88,.88,.88,1),t.displayRatio=null!=this.setting.displayRatio?this.setting.displayRatio:.4,t.displayWatermark=null==this.setting.displayWatermark||this.setting.displayWatermark}else this.setting={totalTime:3e3,base64src:"",effect:"FADE-INOUT",clearColor:new as(.88,.88,.88,1),displayRatio:.4,displayWatermark:!0};if(""===this.setting.base64src||this.setting.totalTime<=0)this.callBack&&this.callBack(),this.callBack=null,this.setting=null,this._directCall=!0;else{c.view.enableRetina(!0);var n=window._CCSettings.designResolution;n?c.view.setDesignResolutionSize(n.width,n.height,n.policy):c.view.setDesignResolutionSize(960,640,4),this.root=e,this.device=e.device,c.game.once(c.Game.EVENT_GAME_INITED,(function(){c.director._lateUpdate=performance.now()}),c.director),this.callBack=null,this.cancelAnimate=!1,this.startTime=-1;var i=this.setting.clearColor;this.clearColors=[new as(i.x,i.y,i.z,i.w)];var r=this.device,o=r.width,a=r.height,s=r.surfaceTransform;this.screenWidth=s%2?a:o,this.screenHeight=s%2?o:a,this.image=new Image,this.image.onload=this.init.bind(this),this.image.src=this.setting.base64src}}else y("RENDER ROOT IS NULL.")},e.setOnFinish=function(e){if(this._directCall&&e)return t._ins=void 0,void e();this.callBack=e},e._tryToStart=function(){this._splashFinish&&this._loadFinish&&this.callBack&&(this.callBack(),this.hide(),c.game.resume())},e.init=function(){var e=this;this.initCMD(),this.initIA(),this.initPSO(),this.setting.displayWatermark&&this.initText(),c.game.pause(),this.handle=requestAnimationFrame((function t(n){if(!e.cancelAnimate){e.startTime<0&&(e.startTime=n);var i=n-e.startTime,r=Up(gn(i/e.setting.totalTime));"NONE"===e.setting.effect&&(r=1),e.material.setProperty("u_precent",r),e.material.passes[0].update(),e.setting.displayWatermark&&e.textMaterial&&(e.textMaterial.setProperty("u_precent",r),e.textMaterial.passes[0].update()),e.frame(n),i>e.setting.totalTime&&(e.splashFinish=!0),requestAnimationFrame(t)}}))},e.hide=function(){cancelAnimationFrame(this.handle),this.cancelAnimate=!0,setTimeout(this.destroy.bind(this))},e.frame=function(){if(!this.cancelAnimate){var e=this.device;e.acquire();var t=this.cmdBuff,n=this.framebuffer,i=this.renderArea;i.height=e.height,i.width=e.width,t.begin(),t.beginRenderPass(n.renderPass,n,i,this.clearColors,1,0);var r=this.material.passes[0],o=eg.getOrCreatePipelineState(e,r,this.shader,n.renderPass,this.assmebler);if(t.bindPipelineState(o),t.bindDescriptorSet($l.MATERIAL,r.descriptorSet),t.bindInputAssembler(this.assmebler),t.draw(this.assmebler),this.setting.displayWatermark&&this.textShader&&this.textAssmebler){var a=this.textMaterial.passes[0],s=eg.getOrCreatePipelineState(e,a,this.textShader,n.renderPass,this.textAssmebler);t.bindPipelineState(s),t.bindDescriptorSet($l.MATERIAL,a.descriptorSet),t.bindInputAssembler(this.textAssmebler),t.draw(this.textAssmebler)}t.endRenderPass(),t.end(),e.queue.submit([t]),e.present()}},e.initText=function(){this.textImg=document.createElement("canvas"),this.textImg.width=330,this.textImg.height=30,this.textImg.style.width=""+this.textImg.width,this.textImg.style.height=""+this.textImg.height;var e=this.textImg.getContext("2d");e.font="18px Arial",e.textBaseline="top",e.textAlign="left",e.fillStyle="`#424242`";var t="Powered by Cocos Creator",n=e.measureText(t);e.fillText(t,(330-n.width)/2,6),this.textRegion=new hs,this.textRegion.texExtent.width=this.textImg.width,this.textRegion.texExtent.height=this.textImg.height,this.textRegion.texExtent.depth=1,this.textTexture=this.device.createTexture(new Ds(ha.TEX2D,_a.SAMPLED|_a.TRANSFER_DST,Ko.RGBA8,this.textImg.width,this.textImg.height)),this.device.copyTexImagesToTexture([this.textImg],this.textTexture,[this.textRegion]),this.textMaterial=new up,this.textMaterial.initialize({effectName:"splash-screen"});var i=this.textMaterial.passes[0],r=i.getBinding("mainTexture");i.bindTexture(r,this.textTexture),this.textShader=Xi.get(i.getShaderVariant()),Ki.get(ur.get(i.handle,qi.DESCRIPTOR_SET)).update();var o=4*Float32Array.BYTES_PER_ELEMENT,a=4*o;this.textVB=this.device.createBuffer(new ka(Qo.VERTEX|Qo.TRANSFER_DST,Zo.HOST|Zo.DEVICE,a,o));var s=new Float32Array(16),c=-this.textImg.width/2,l=this.textImg.height;l=this.screenWidth<this.screenHeight?(c=-this.screenWidth/2*.5)/(this.textImg.width/this.textImg.height):(c=-this.screenHeight/2*.5)/(this.textImg.width/this.textImg.height);var u=0;s[u++]=c,s[u++]=l,s[u++]=0,s[u++]=1,s[u++]=-c,s[u++]=l,s[u++]=1,s[u++]=1,s[u++]=c,s[u++]=-l,s[u++]=0,s[u++]=0,s[u++]=-c,s[u++]=-l,s[u++]=1,s[u++]=0;for(var h=0;h<s.length;h+=4)s[h]+=this.screenWidth/2,s[h+1]+=.1*this.screenHeight;for(var _=this.device.screenSpaceSignY,f=Qn[this.device.surfaceTransform],m=0;m<s.length;m+=4){var d=s[m]/this.screenWidth*2-1,p=(s[m+1]/this.screenHeight*2-1)*_;s[m]=f[0]*d+f[2]*p,s[m+1]=f[1]*d+f[3]*p}this.textVB.update(s);var v=Uint16Array.BYTES_PER_ELEMENT,g=6*v;this.textIB=this.device.createBuffer(new ka(Qo.INDEX|Qo.TRANSFER_DST,Zo.HOST|Zo.DEVICE,g,v));var y=new Uint16Array(6);y[0]=0,y[1]=1,y[2]=2,y[3]=1,y[4]=3,y[5]=2,this.textIB.update(y);var x=[new ts("a_position",Ko.RG32F),new ts("a_texCoord",Ko.RG32F)],E=new ns(x,[this.textVB],this.textIB);this.textAssmebler=this.device.createInputAssembler(E)},e.initCMD=function(){var e=this.device;this.renderArea=new rs(0,0,e.width,e.height),this.framebuffer=this.root.mainWindow.framebuffer,this.cmdBuff=e.commandBuffer},e.initIA=function(){var e=this.device,t=4*Float32Array.BYTES_PER_ELEMENT,n=4*t;this.vertexBuffers=e.createBuffer(new ka(Qo.VERTEX|Qo.TRANSFER_DST,Zo.HOST|Zo.DEVICE,n,t));var i=new Float32Array(16),r=-this.image.width/2,o=this.image.height;o=this.screenWidth<this.screenHeight?(r=-this.screenWidth/2*this.setting.displayRatio)/(this.image.width/this.image.height):(r=-this.screenHeight/2*this.setting.displayRatio)/(this.image.width/this.image.height);var a=0;i[a++]=r,i[a++]=o,i[a++]=0,i[a++]=1,i[a++]=-r,i[a++]=o,i[a++]=1,i[a++]=1,i[a++]=r,i[a++]=-o,i[a++]=0,i[a++]=0,i[a++]=-r,i[a++]=-o,i[a++]=1,i[a++]=0;for(var s=0;s<i.length;s+=4)i[s]+=this.screenWidth/2,i[s+1]+=this.screenHeight/2;for(var c=this.device.screenSpaceSignY,l=Qn[this.device.surfaceTransform],u=0;u<i.length;u+=4){var h=i[u]/this.screenWidth*2-1,_=(i[u+1]/this.screenHeight*2-1)*c;i[u]=l[0]*h+l[2]*_,i[u+1]=l[1]*h+l[3]*_}this.vertexBuffers.update(i);var f=Uint16Array.BYTES_PER_ELEMENT,m=6*f;this.indicesBuffers=e.createBuffer(new ka(Qo.INDEX|Qo.TRANSFER_DST,Zo.HOST|Zo.DEVICE,m,f));var d=new Uint16Array(6);d[0]=0,d[1]=1,d[2]=2,d[3]=1,d[4]=3,d[5]=2,this.indicesBuffers.update(d);var p=[new ts("a_position",Ko.RG32F),new ts("a_texCoord",Ko.RG32F)],v=new ns(p,[this.vertexBuffers],this.indicesBuffers);this.assmebler=e.createInputAssembler(v)},e.initPSO=function(){var e=this.device;this.material=new up,this.material.initialize({effectName:"splash-screen"});var t=new ws;t.addressU=ua.CLAMP,t.addressV=ua.CLAMP,this.sampler=e.createSampler(t),this.texture=e.createTexture(new Ds(ha.TEX2D,_a.SAMPLED|_a.TRANSFER_DST,Ko.RGBA8,this.image.width,this.image.height));var n=this.material.passes[0],i=n.getBinding("mainTexture");n.bindTexture(i,this.texture),this.shader=Xi.get(n.getShaderVariant());var r=Ki.get(ur.get(n.handle,qi.DESCRIPTOR_SET));r.bindSampler(i,this.sampler),r.update(),this.region=new hs,this.region.texExtent.width=this.image.width,this.region.texExtent.height=this.image.height,this.region.texExtent.depth=1,e.copyTexImagesToTexture([this.image],this.texture,[this.region])},e.destroy=function(){this.callBack=null,this.clearColors=null,this.device=null,this.image=null,this.framebuffer=null,this.renderArea=null,this.region=null,this.cmdBuff=null,this.shader=null,this.material.destroy(),this.material=null,this.texture.destroy(),this.texture=null,this.assmebler.destroy(),this.assmebler=null,this.vertexBuffers.destroy(),this.vertexBuffers=null,this.indicesBuffers.destroy(),this.indicesBuffers=null,this.sampler.destroy(),this.sampler=null,this.textImg&&(this.textImg=null,this.textRegion=null,this.textShader=null,this.textMaterial.destroy(),this.textMaterial=null,this.textTexture.destroy(),this.textTexture=null,this.textAssmebler.destroy(),this.textAssmebler=null,this.textVB.destroy(),this.textVB=null,this.textIB.destroy(),this.textIB=null),this.setting=null,t._ins=void 0},Z(t,[{key:"splashFinish",set:function(e){this._splashFinish=e,this._tryToStart()}},{key:"loadFinish",set:function(e){this._loadFinish=e,this._tryToStart()}}],[{key:"instance",get:function(){return t._ins||(t._ins=new t),t._ins}}]),t}();vA._ins=void 0,c.internal.SplashScreen=vA;var gA=e("d8",function(){function e(){this._id="",this._priority=0,this._executeInEditMode=!1}e.sortByPriority=function(e,t){return e._priority<t._priority?1:e._priority>t.priority?-1:0};var t=e.prototype;return t.init=function(){},t.update=function(){},t.postUpdate=function(){},Z(e,[{key:"priority",set:function(e){this._priority=e},get:function(){return this._priority}},{key:"id",set:function(e){this._id=e},get:function(){return this._id}}]),e}()),yA=new be("Scheduler"),xA=function(e,t,n,i){this.target=void 0,this.priority=void 0,this.paused=void 0,this.markedForDeletion=void 0,this.target=e,this.priority=t,this.paused=n,this.markedForDeletion=i};xA.get=function(e,t,n,i){var r=xA._listEntries.pop();return r?(r.target=e,r.priority=t,r.paused=n,r.markedForDeletion=i):r=new xA(e,t,n,i),r},xA.put=function(e){xA._listEntries.length<20&&(e.target=null,xA._listEntries.push(e))},xA._listEntries=[];var EA=function(e,t,n,i){this.list=void 0,this.entry=void 0,this.target=void 0,this.callback=void 0,this.list=e,this.entry=t,this.target=n,this.callback=i};EA.get=function(e,t,n,i){var r=EA._hashUpdateEntries.pop();return r?(r.list=e,r.entry=t,r.target=n,r.callback=i):r=new EA(e,t,n,i),r},EA.put=function(e){EA._hashUpdateEntries.length<20&&(e.list=e.entry=e.target=e.callback=null,EA._hashUpdateEntries.push(e))},EA._hashUpdateEntries=[];var SA=function(e,t,n,i,r,o){this.timers=void 0,this.target=void 0,this.timerIndex=void 0,this.currentTimer=void 0,this.currentTimerSalvaged=void 0,this.paused=void 0,this.timers=e,this.target=t,this.timerIndex=n,this.currentTimer=i,this.currentTimerSalvaged=r,this.paused=o};SA.get=function(e,t,n,i,r,o){var a=SA._hashTimerEntries.pop();return a?(a.timers=e,a.target=t,a.timerIndex=n,a.currentTimer=i,a.currentTimerSalvaged=r,a.paused=o):a=new SA(e,t,n,i,r,o),a},SA.put=function(e){SA._hashTimerEntries.length<20&&(e.timers=e.target=e.currentTimer=null,SA._hashTimerEntries.push(e))},SA._hashTimerEntries=[];var TA=function(){function e(){this._lock=void 0,this._scheduler=void 0,this._elapsed=void 0,this._runForever=void 0,this._useDelay=void 0,this._timesExecuted=void 0,this._repeat=void 0,this._delay=void 0,this._interval=void 0,this._target=void 0,this._callback=void 0,this._lock=!1,this._scheduler=null,this._elapsed=-1,this._runForever=!1,this._useDelay=!1,this._timesExecuted=0,this._repeat=0,this._delay=0,this._interval=0,this._target=null,this._callback=null}var t=e.prototype;return t.initWithCallback=function(e,t,n,i,r,o){return this._lock=!1,this._scheduler=e,this._target=n,this._callback=t,this._elapsed=-1,this._interval=i,this._delay=o,this._useDelay=this._delay>0,this._repeat=r,this._runForever=this._repeat===c.macro.REPEAT_FOREVER,!0},t.getInterval=function(){return this._interval},t.setInterval=function(e){this._interval=e},t.update=function(e){-1===this._elapsed?(this._elapsed=0,this._timesExecuted=0):(this._elapsed+=e,this._runForever&&!this._useDelay?this._elapsed>=this._interval&&(this.trigger(),this._elapsed=0):(this._useDelay?this._elapsed>=this._delay&&(this.trigger(),this._elapsed-=this._delay,this._timesExecuted+=1,this._useDelay=!1):this._elapsed>=this._interval&&(this.trigger(),this._elapsed=0,this._timesExecuted+=1),this._callback&&!this._runForever&&this._timesExecuted>this._repeat&&this.cancel()))},t.getCallback=function(){return this._callback},t.trigger=function(){this._target&&this._callback&&(this._lock=!0,this._callback.call(this._target,this._elapsed),this._lock=!1)},t.cancel=function(){this._scheduler.unschedule(this._callback,this._target)},e}();TA._timers=[],TA.get=function(){return TA._timers.pop()||new TA},TA.put=function(e){TA._timers.length<20&&!e._lock&&(e._scheduler=e._target=e._callback=null,TA._timers.push(e))};var AA=e("du",function(e){function t(){var t;return(t=e.call(this)||this)._timeScale=void 0,t._updatesNegList=void 0,t._updates0List=void 0,t._updatesPosList=void 0,t._hashForUpdates=void 0,t._hashForTimers=void 0,t._currentTarget=void 0,t._currentTargetSalvaged=void 0,t._updateHashLocked=void 0,t._arrayForTimers=void 0,t._timeScale=1,t._updatesNegList=[],t._updates0List=[],t._updatesPosList=[],t._hashForUpdates=Ue(!0),t._hashForTimers=Ue(!0),t._currentTarget=null,t._currentTargetSalvaged=!1,t._updateHashLocked=!1,t._arrayForTimers=[],t}$(t,e),t.enableForTarget=function(e){var t=!1;(e.uuid||e.id)&&(t=!0),t||(e.__instanceId?I(1513):e.id=yA.getNewId())};var n=t.prototype;return n.setTimeScale=function(e){this._timeScale=e},n.getTimeScale=function(){return this._timeScale},n.update=function(e){var t,n,i,r,o;for(this._updateHashLocked=!0,1!==this._timeScale&&(e*=this._timeScale),t=0,i=(n=this._updatesNegList).length;t<i;t++)(r=n[t]).paused||r.markedForDeletion||r.target.update(e);for(t=0,i=(n=this._updates0List).length;t<i;t++)(r=n[t]).paused||r.markedForDeletion||r.target.update(e);for(t=0,i=(n=this._updatesPosList).length;t<i;t++)(r=n[t]).paused||r.markedForDeletion||r.target.update(e);var a=this._arrayForTimers;for(t=0;t<a.length;t++){if(o=a[t],this._currentTarget=o,this._currentTargetSalvaged=!1,!o.paused)for(o.timerIndex=0;o.timerIndex<o.timers.length;++o.timerIndex)o.currentTimer=o.timers[o.timerIndex],o.currentTimerSalvaged=!1,o.currentTimer.update(e),o.currentTimer=null;this._currentTargetSalvaged&&0===this._currentTarget.timers.length&&(this._removeHashElement(this._currentTarget),--t)}for(t=0,n=this._updatesNegList;t<n.length;)(r=n[t]).markedForDeletion?this._removeUpdateFromHash(r):t++;for(t=0,n=this._updates0List;t<n.length;)(r=n[t]).markedForDeletion?this._removeUpdateFromHash(r):t++;for(t=0,n=this._updatesPosList;t<n.length;)(r=n[t]).markedForDeletion?this._removeUpdateFromHash(r):t++;this._updateHashLocked=!1,this._currentTarget=null},n.schedule=function(e,t,n,i,r,o){if("function"!=typeof e){var a=e;e=t,t=a}3!==arguments.length&&4!==arguments.length&&5!==arguments.length||(o=!!i,i=c.macro.REPEAT_FOREVER,r=0),P(t,1502);var s=t.uuid||t.id;if(s){var l,u,h=this._hashForTimers[s];if(h?h.paused!==o&&I(1511):(h=SA.get(null,t,0,null,null,o),this._arrayForTimers.push(h),this._hashForTimers[s]=h),null==h.timers)h.timers=[];else for(u=0;u<h.timers.length;++u)if((l=h.timers[u])&&e===l._callback)return C(1507,l.getInterval(),n),void(l._interval=n);(l=TA.get()).initWithCallback(this,e,t,n,i,r),h.timers.push(l),this._currentTarget===h&&this._currentTargetSalvaged&&(this._currentTargetSalvaged=!1)}else R(1510)},n.scheduleUpdate=function(e,t,n){var i=e.uuid||e.id;if(i){var r=this._hashForUpdates[i];if(r&&r.entry){if(r.entry.priority===t)return r.entry.markedForDeletion=!1,void(r.entry.paused=n);if(this._updateHashLocked)return C(1506),r.entry.markedForDeletion=!1,void(r.entry.paused=n);this.unscheduleUpdate(e)}var o,a=xA.get(e,t,n,!1);0===t?(o=this._updates0List,this._appendIn(o,a)):(o=t<0?this._updatesNegList:this._updatesPosList,this._priorityIn(o,a,t)),this._hashForUpdates[i]=EA.get(o,a,e,null)}else R(1510)},n.unschedule=function(e,t){if(t&&e){var n=t.uuid||t.id;if(n){var i=this._hashForTimers[n];if(i)for(var r=i.timers,o=0,a=r.length;o<a;o++){var s=r[o];if(e===s._callback)return s!==i.currentTimer||i.currentTimerSalvaged||(i.currentTimerSalvaged=!0),r.splice(o,1),TA.put(s),i.timerIndex>=o&&i.timerIndex--,void(0===r.length&&(this._currentTarget===i?this._currentTargetSalvaged=!0:this._removeHashElement(i)))}}else R(1510)}},n.unscheduleUpdate=function(e){if(e){var t=e.uuid||e.id;if(t){var n=this._hashForUpdates[t];n&&(this._updateHashLocked?n.entry.markedForDeletion=!0:this._removeUpdateFromHash(n.entry))}else R(1510)}},n.unscheduleAllForTarget=function(e){if(e){var t=e.uuid||e.id;if(t){var n=this._hashForTimers[t];if(n){var i=n.timers;i.indexOf(n.currentTimer)>-1&&!n.currentTimerSalvaged&&(n.currentTimerSalvaged=!0);for(var r=0,o=i.length;r<o;r++)TA.put(i[r]);i.length=0,this._currentTarget===n?this._currentTargetSalvaged=!0:this._removeHashElement(n)}this.unscheduleUpdate(e)}else R(1510)}},n.unscheduleAll=function(){this.unscheduleAllWithMinPriority(c.Scheduler.PRIORITY_SYSTEM)},n.unscheduleAllWithMinPriority=function(e){var t,n,i,r=this._arrayForTimers;for(t=r.length-1;t>=0;t--)n=r[t],this.unscheduleAllForTarget(n.target);var o=0;if(e<0)for(t=0;t<this._updatesNegList.length;)o=this._updatesNegList.length,(i=this._updatesNegList[t])&&i.priority>=e&&this.unscheduleUpdate(i.target),o===this._updatesNegList.length&&t++;if(e<=0)for(t=0;t<this._updates0List.length;)o=this._updates0List.length,(i=this._updates0List[t])&&this.unscheduleUpdate(i.target),o===this._updates0List.length&&t++;for(t=0;t<this._updatesPosList.length;)o=this._updatesPosList.length,(i=this._updatesPosList[t])&&i.priority>=e&&this.unscheduleUpdate(i.target),o===this._updatesPosList.length&&t++},n.isScheduled=function(e,t){P(e,1508),P(t,1509);var n=t.uuid||t.id;if(n){var i=this._hashForTimers[n];if(!i)return!1;if(null==i.timers)return!1;for(var r=i.timers,o=0;o<r.length;++o)if(e===r[o]._callback)return!0;return!1}R(1510)},n.pauseAllTargets=function(){return this.pauseAllTargetsWithMinPriority(c.Scheduler.PRIORITY_SYSTEM)},n.pauseAllTargetsWithMinPriority=function(e){var t,n,i,r,o=[],a=this._arrayForTimers;for(n=0,i=a.length;n<i;n++)(t=a[n])&&(t.paused=!0,o.push(t.target));if(e<0)for(n=0;n<this._updatesNegList.length;n++)(r=this._updatesNegList[n])&&r.priority>=e&&(r.paused=!0,o.push(r.target));if(e<=0)for(n=0;n<this._updates0List.length;n++)(r=this._updates0List[n])&&(r.paused=!0,o.push(r.target));for(n=0;n<this._updatesPosList.length;n++)(r=this._updatesPosList[n])&&r.priority>=e&&(r.paused=!0,o.push(r.target));return o},n.resumeTargets=function(e){if(e)for(var t=0;t<e.length;t++)this.resumeTarget(e[t])},n.pauseTarget=function(e){P(e,1503);var t=e.uuid||e.id;if(t){var n=this._hashForTimers[t];n&&(n.paused=!0);var i=this._hashForUpdates[t];i&&(i.entry.paused=!0)}else R(1510)},n.resumeTarget=function(e){P(e,1504);var t=e.uuid||e.id;if(t){var n=this._hashForTimers[t];n&&(n.paused=!1);var i=this._hashForUpdates[t];i&&(i.entry.paused=!1)}else R(1510)},n.isTargetPaused=function(e){P(e,1505);var t=e.uuid||e.id;if(!t)return R(1510),!1;var n=this._hashForTimers[t];if(n)return n.paused;var i=this._hashForUpdates[t];return!!i&&i.entry.paused},n._removeHashElement=function(e){var t=e.target.uuid||e.target.id;delete this._hashForTimers[t];for(var n=this._arrayForTimers,i=0,r=n.length;i<r;i++)if(n[i]===e){n.splice(i,1);break}SA.put(e)},n._removeUpdateFromHash=function(e){var t=e.target.uuid||e.target.id,n=this._hashForUpdates[t];if(n){for(var i=n.list,r=n.entry,o=0,a=i.length;o<a;o++)if(i[o]===r){i.splice(o,1);break}delete this._hashForUpdates[t],xA.put(r),EA.put(n)}},n._priorityIn=function(e,t,n){for(var i=0;i<e.length;i++)if(n<e[i].priority)return void e.splice(i,0,t);e.push(t)},n._appendIn=function(e,t){e.push(t)},t}(gA));AA.PRIORITY_SYSTEM=1<<31,AA.PRIORITY_NON_SYSTEM=AA.PRIORITY_SYSTEM+1,AA.ID="scheduler",c.Scheduler=AA;var CA=function(){function e(){this._title="",this._width=1,this._height=1,this._nativeWidth=1,this._nativeHeight=1,this._renderPass=null,this._colorTextures=[],this._depthStencilTexture=null,this._swapchainBufferIndices=0,this._shouldSyncSizeWithSwapchain=!1,this._poolHandle=Yi,this._cameras=[]}e.registerCreateFunc=function(t){t._createWindowFun=function(t){return new e(t)}},Z(e,[{key:"width",get:function(){return this._width}},{key:"height",get:function(){return this._height}},{key:"framebuffer",get:function(){return Ji.get(zr.get(this._poolHandle,Pr.FRAMEBUFFER))}},{key:"shouldSyncSizeWithSwapchain",get:function(){return this._shouldSyncSizeWithSwapchain}},{key:"hasOnScreenAttachments",get:function(){return 1===zr.get(this._poolHandle,Pr.HAS_ON_SCREEN_ATTACHMENTS)}},{key:"hasOffScreenAttachments",get:function(){return 1===zr.get(this._poolHandle,Pr.HAS_OFF_SCREEN_ATTACHMENTS)}},{key:"handle",get:function(){return this._poolHandle}},{key:"cameras",get:function(){return this._cameras}}]);var t=e.prototype;return t.initialize=function(e,t){this._poolHandle=zr.alloc(),void 0!==t.title&&(this._title=t.title),void 0!==t.swapchainBufferIndices&&(this._swapchainBufferIndices=t.swapchainBufferIndices),void 0!==t.shouldSyncSizeWithSwapchain&&(this._shouldSyncSizeWithSwapchain=t.shouldSyncSizeWithSwapchain),this._width=t.width,this._height=t.height,this._nativeWidth=this._width,this._nativeHeight=this._height;for(var n=t.renderPassInfo,i=n.colorAttachments,r=n.depthStencilAttachment,o=0;o<i.length;o++)i[o].format===Ko.UNKNOWN&&(i[o].format=e.colorFormat);r&&r.format===Ko.UNKNOWN&&(r.format=e.depthStencilFormat),this._renderPass=e.createRenderPass(t.renderPassInfo);for(var a=0;a<i.length;a++){var s=null;this._swapchainBufferIndices&1<<a?zr.set(this._poolHandle,Pr.HAS_ON_SCREEN_ATTACHMENTS,1):(s=e.createTexture(new Ds(ha.TEX2D,_a.COLOR_ATTACHMENT|_a.SAMPLED,i[a].format,this._width,this._height)),zr.set(this._poolHandle,Pr.HAS_OFF_SCREEN_ATTACHMENTS,1)),this._colorTextures.push(s)}r&&(this._swapchainBufferIndices>=0?(this._depthStencilTexture=e.createTexture(new Ds(ha.TEX2D,_a.DEPTH_STENCIL_ATTACHMENT|_a.SAMPLED,r.format,this._width,this._height)),zr.set(this._poolHandle,Pr.HAS_OFF_SCREEN_ATTACHMENTS,1)):zr.set(this._poolHandle,Pr.HAS_ON_SCREEN_ATTACHMENTS,1));var c=Ji.alloc(e,new Qa(this._renderPass,this._colorTextures,this._depthStencilTexture));return zr.set(this._poolHandle,Pr.FRAMEBUFFER,c),!0},t.destroy=function(){this.clearCameras(),this._depthStencilTexture&&(this._depthStencilTexture.destroy(),this._depthStencilTexture=null);for(var e=0;e<this._colorTextures.length;e++){var t=this._colorTextures[e];t&&t.destroy()}this._colorTextures.length=0,this._poolHandle&&(Ji.get(zr.get(this._poolHandle,Pr.FRAMEBUFFER)).destroy(),this._poolHandle=Yi)},t.resize=function(e,t){if(this._width=e,this._height=t,e>this._nativeWidth||t>this._nativeHeight){this._nativeWidth=e,this._nativeHeight=t;var n=!1;this._depthStencilTexture&&(this._depthStencilTexture.resize(e,t),n=!0);for(var i=0;i<this._colorTextures.length;i++){var r=this._colorTextures[i];r&&(r.resize(e,t),n=!0)}var o=Ji.get(zr.get(this._poolHandle,Pr.FRAMEBUFFER));n&&o&&(o.destroy(),o.initialize(new Qa(this._renderPass,this._colorTextures,this._depthStencilTexture)))}for(var a,s=ne(this._cameras);!(a=s()).done;){var c=a.value;c.isWindowSize&&c.resize(e,t)}},t.extractRenderCameras=function(){for(var e=[],t=0;t<this._cameras.length;t++){var n=this._cameras[t];n.enabled&&(n.update(),e.push(n))}return e},t.attachCamera=function(e){for(var t=0;t<this._cameras.length;t++)if(this._cameras[t]===e)return;this._cameras.push(e),this.sortCameras()},t.detachCamera=function(e){for(var t=0;t<this._cameras.length;++t)if(this._cameras[t]===e)return void this._cameras.splice(t,1)},t.clearCameras=function(){this._cameras.length=0},t.sortCameras=function(){this._cameras.sort((function(e,t){return e.priority-t.priority}))},e}(),wA=function(){function e(e){var t=this;this._createSceneFun=null,this._createWindowFun=null,this._device=void 0,this._windows=[],this._mainWindow=null,this._curWindow=null,this._tempWindow=null,this._pipeline=null,this._batcher=null,this._dataPoolMgr=void 0,this._scenes=[],this._modelPools=new Map,this._cameraPool=null,this._lightPools=new Map,this._fpsTime=0,this._frameCount=0,this._fps=0,this._fixedFPS=0,this._fixedFPSFrameTime=0,this._poolHandle=Yi,this._device=e,this._dataPoolMgr=c.internal.DataPoolManager&&new c.internal.DataPoolManager(e),ah.registerCreateFunc(this),CA.registerCreateFunc(this),this._cameraPool=new v_((function(){return new oh(t._device)}),4)}Z(e,[{key:"device",get:function(){return this._device}},{key:"mainWindow",get:function(){return this._mainWindow}},{key:"curWindow",set:function(e){this._curWindow=e},get:function(){return this._curWindow}},{key:"tempWindow",set:function(e){this._tempWindow=e},get:function(){return this._tempWindow}},{key:"windows",get:function(){return this._windows}},{key:"pipeline",get:function(){return this._pipeline}},{key:"batcher2D",get:function(){return this._batcher}},{key:"scenes",get:function(){return this._scenes}},{key:"cumulativeTime",get:function(){return Dr.get(this._poolHandle,Or.CUMULATIVE_TIME)}},{key:"frameTime",get:function(){return Dr.get(this._poolHandle,Or.FRAME_TIME)}},{key:"frameCount",get:function(){return this._frameCount}},{key:"fps",get:function(){return this._fps}},{key:"fixedFPS",set:function(e){e>0?(this._fixedFPS=e,this._fixedFPSFrameTime=1e3/e):this._fixedFPSFrameTime=0},get:function(){return this._fixedFPS}},{key:"dataPoolManager",get:function(){return this._dataPoolMgr}},{key:"handle",get:function(){return this._poolHandle}}]);var t=e.prototype;return t.initialize=function(){var e=this;this._poolHandle=Dr.alloc();var t=new Es,n=new Ss;n.depthStoreOp=ya.DISCARD,n.stencilStoreOp=ya.DISCARD;var i=new As([t],n);return this._mainWindow=this.createWindow({title:"rootMainWindow",width:this._device.width,height:this._device.height,renderPassInfo:i,swapchainBufferIndices:-1}),this._curWindow=this._mainWindow,Promise.resolve(id.initBuiltinRes(this._device)).then((function(){c.view.on("design-resolution-changed",(function(){var t=c.game.canvas.width,n=c.game.canvas.height;e.resize(t,n)}),e)}))},t.destroy=function(){this.destroyScenes(),this._pipeline&&(this._pipeline.destroy(),this._pipeline=null),this._batcher&&(this._batcher.destroy(),this._batcher=null),this._curWindow=null,this._mainWindow=null,this.dataPoolManager.clear(),this._poolHandle&&(Dr.free(this._poolHandle),this._poolHandle=Yi)},t.resize=function(e,t){this._device.resize(e,t),this._mainWindow.resize(e,t);for(var n,i=ne(this._windows);!(n=i()).done;){var r=n.value;r.shouldSyncSizeWithSwapchain&&r.resize(e,t)}},t.setRenderPipeline=function(e){if(e||(e=this.createDefaultPipeline()),this._pipeline=e,!this._pipeline.activate())return!1;var t=c.director.getScene();return t&&t.globals.activate(),this.onGlobalPipelineStateChanged(),!(!this._batcher&&c.internal.Batcher2D&&(this._batcher=new c.internal.Batcher2D(this),!this._batcher.initialize())&&(this.destroy(),1))},t.createDefaultPipeline=function(){var e=new hE;return e.initialize({flows:[]}),e},t.onGlobalPipelineStateChanged=function(){for(var e=0;e<this._scenes.length;e++)this._scenes[e].onGlobalPipelineStateChanged()},t.activeWindow=function(e){this._curWindow=e},t.resetCumulativeTime=function(){Dr.set(this._poolHandle,Or.CUMULATIVE_TIME,0)},t.frameMove=function(e){var t=this;Dr.set(this._poolHandle,Or.FRAME_TIME,e),++this._frameCount,Dr.set(this._poolHandle,Or.CUMULATIVE_TIME,Dr.get(this._poolHandle,Or.CUMULATIVE_TIME)+e),this._fpsTime+=e,this._fpsTime>1&&(this._fps=this._frameCount,this._frameCount=0,this._fpsTime=0);for(var n=0;n<this._scenes.length;++n)this._scenes[n].removeBatches();this._batcher&&this._batcher.update(),this._pipeline&&function(){t._device.acquire();var e=t._windows,n=t._scenes,i=c.director.getTotalFrames();t._batcher&&t._batcher.uploadBuffers();for(var r=0;r<n.length;r++)n[r].update(i);c.director.emit(c.Director.EVENT_BEFORE_COMMIT);for(var o=[],a=0;a<e.length;a++)e[a].extractRenderCameras().forEach((function(e){o.push(e)}));o.sort((function(e,t){return e.priority-t.priority})),t._pipeline.render(o),t._device.present()}(),this._batcher&&this._batcher.reset()},t.createWindow=function(e){var t=this._createWindowFun(this);return t.initialize(this.device,e),this._windows.push(t),t},t.destroyWindow=function(e){for(var t=0;t<this._windows.length;++t)if(this._windows[t]===e)return e.destroy(),void this._windows.splice(t,1)},t.destroyWindows=function(){for(var e,t=ne(this._windows);!(e=t()).done;)e.value.destroy();this._windows=[]},t.createScene=function(e){var t=this._createSceneFun(this);return t.initialize(e),this._scenes.push(t),t},t.destroyScene=function(e){for(var t=0;t<this._scenes.length;++t)if(this._scenes[t]===e)return e.destroy(),void this._scenes.splice(t,1)},t.destroyScenes=function(){for(var e,t=ne(this._scenes);!(e=t()).done;)e.value.destroy();this._scenes=[]},t.createModel=function(e){var t=this._modelPools.get(e);t||(this._modelPools.set(e,new v_((function(){return new e}),10)),t=this._modelPools.get(e));var n=t.alloc();return n.initialize(),n},t.destroyModel=function(e){var t=this._modelPools.get(e.constructor);t?(t.free(e),e.destroy(),e.scene&&e.scene.removeModel(e)):I(1300,e.constructor.name)},t.createCamera=function(){return this._cameraPool.alloc()},t.createLight=function(e){var t=this._lightPools.get(e);t||(this._lightPools.set(e,new v_((function(){return new e}),4)),t=this._lightPools.get(e));var n=t.alloc();return n.initialize(),n},t.destroyLight=function(e){var t=this._lightPools.get(e.constructor);if(e.destroy(),t&&(t.free(e),e.scene))switch(e.type){case ud.SPHERE:e.scene.removeSphereLight(e);break;case ud.SPOT:e.scene.removeSpotLight(e)}},e}();c.Root=wA;var IA,bA,RA={};me(RA,"vmath",[{name:"vec2",newName:"Vec2",target:_i,targetName:"math"},{name:"vec3",newName:"Vec3",target:_i,targetName:"math"},{name:"vec4",newName:"Vec4",target:_i,targetName:"math"},{name:"quat",newName:"Quat",target:_i,targetName:"math"},{name:"mat3",newName:"Mat3",target:_i,targetName:"math"},{name:"mat4",newName:"Mat4",target:_i,targetName:"math"},{name:"color4",newName:"Color",target:_i,targetName:"math"},{name:"rect",newName:"Rect",target:_i,targetName:"math"},{name:"approx",newName:"approx",target:_i,targetName:"math"},{name:"EPSILON",newName:"EPSILON",target:_i,targetName:"math"},{name:"equals",newName:"equals",target:_i,targetName:"math"},{name:"clamp",newName:"clamp",target:_i,targetName:"math"},{name:"clamp01",newName:"clamp01",target:_i,targetName:"math"},{name:"lerp",newName:"lerp",target:_i,targetName:"math"},{name:"toRadian",newName:"toRadian",target:_i,targetName:"math"},{name:"toDegree",newName:"toDegree",target:_i,targetName:"math"},{name:"random",newName:"random",target:_i,targetName:"math"},{name:"randomRange",newName:"randomRange",target:_i,targetName:"math"},{name:"randomRangeInt",newName:"randomRangeInt",target:_i,targetName:"math"},{name:"pseudoRandom",newName:"pseudoRandom",target:_i,targetName:"math"},{name:"pseudoRandomRangeInt",newName:"pseudoRandomRangeInt",target:_i,targetName:"math"},{name:"nextPow2",newName:"nextPow2",target:_i,targetName:"math"},{name:"repeat",newName:"repeat",target:_i,targetName:"math"},{name:"pingPong",newName:"pingPong",target:_i,targetName:"math"},{name:"inverseLerp",newName:"inverseLerp",target:_i,targetName:"math"}]),c.vmath=RA,me(AA.prototype,"Scheduler.prototype",[{name:"enableForTarget",newName:"enableForTarget",target:AA,targetName:"Scheduler"}]),me(PT.prototype,"EventTouch.prototype",[{name:"getUILocationInView",newName:"getLocationInView",target:PT,targetName:"EventTouch"}]),me(yd.prototype,"SubModel.prototype",[{name:"subMeshData",newName:"subMesh"}]),de(yd.prototype,"SubModel.prototype",[{name:"getSubModel",suggest:"Use `subModels[i]` instead"},{name:"subModelNum",suggest:"Use `subModels.length` instead"}]),me(wA.prototype,"Root.prototype",[{name:"ui",newName:"batcher2D"}]),de(vf.prototype,"TextureBase.prototype",[{name:"hasPremultipliedAlpha"},{name:"setPremultiplyAlpha"},{name:"setFlipY"}]),me(lp.prototype,"RenderTexture.prototype",[{name:"getGFXWindow",customFunction:function(){return this._window}}]);var OA,NA=e("e8",mh("cc.BufferAsset")((re((bA=function(e){function t(){for(var t,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return(t=e.call.apply(e,[this].concat(i))||this)._buffer=null,t}return $(t,e),t.prototype.buffer=function(){return this._buffer},Z(t,[{key:"_nativeAsset",get:function(){return this._buffer},set:function(e){e instanceof ArrayBuffer?this._buffer=e:this._buffer=e.buffer}}]),t}(B_)).prototype,"_nativeAsset",[jh],Object.getOwnPropertyDescriptor(bA.prototype,"_nativeAsset"),bA.prototype),IA=bA))||IA);c.BufferAsset=NA;var PA=((OA={})[wa.UNORM]="Uint",OA[wa.SNORM]="Int",OA[wa.UINT]="Uint",OA[wa.INT]="Int",OA[wa.UFLOAT]="Float",OA[wa.FLOAT]="Float",OA.default="Uint",OA);function MA(e){return(PA[e.type]||PA.default)+e.size/e.count*8}function DA(e,t,n,i,r,o,a){void 0===n&&(n=Ko.R32F),void 0===i&&(i=0),void 0===r&&(r=e.byteLength-i),void 0===o&&(o=0),a||(a=new DataView(e.buffer.slice(e.byteOffset,e.byteOffset+e.byteLength)));var s=Ma[n];o||(o=s.size);for(var c="set"+MA(s),l="get"+MA(s),u=s.size/s.count,h=Math.floor(r/o),_=wv.isLittleEndian,f=0;f<h;++f)for(var m=i+o*f,d=0;d<s.count;++d){var p=m+u*d,v=e[l](p,_);a[c](p,t(v,d,e),_)}return a}e("aS",function(){function e(e,t,n,i,r){void 0===i&&(i=null),void 0===r&&(r=null),this.mesh=void 0,this.subMeshIdx=void 0,this._flatBuffers=[],this._jointMappedBuffers=void 0,this._jointMappedBufferIndices=void 0,this._vertexIdChannel=void 0,this._geometricInfo=void 0,this._vertexBuffers=void 0,this._attributes=void 0,this._indexBuffer=null,this._indirectBuffer=null,this._primitiveMode=void 0,this._iaInfo=void 0,this._handle=Yi,this._attributes=t,this._vertexBuffers=e,this._indexBuffer=i,this._indirectBuffer=r,this._primitiveMode=n,this._iaInfo=new ns(t,e,i,r),this._handle=uo.alloc();var o=nr.alloc();uo.set(this._handle,oo.FLAT_BUFFER_ARRAY,o)}var t=e.prototype;return t.genFlatBuffers=function(){if(!this._flatBuffers.length&&this.mesh&&void 0!==this.subMeshIdx){var e=this.mesh,t=0,n=e.struct.primitives[this.subMeshIdx],i=uo.get(this._handle,oo.FLAT_BUFFER_ARRAY);n.indexView&&(t=n.indexView.count);for(var r=0;r<n.vertexBundelIndices.length;r++){var o=n.vertexBundelIndices[r],a=e.struct.vertexBundles[o],s=n.indexView?n.indexView.count:a.view.count,c=a.view.stride,l=c*s,u=new Uint8Array(e.data.buffer,a.view.offset,a.view.length),h=ar.alloc(n.indexView?l:a.view.length),_=so.alloc();so.set(_,io.STRIDE,c),so.set(_,io.AMOUNT,s),so.set(_,io.BUFFER,h),nr.push(i,_);var f=ar.getBuffer(h),m=new Uint8Array(f);if(n.indexView){for(var d=e.readIndices(this.subMeshIdx),p=0;p<t;++p)for(var v=p*c,g=d[p]*c,y=0;y<c;++y)m[v+y]=u[g+y];this._flatBuffers.push({stride:c,count:s,buffer:m})}else m.set(e.data.subarray(a.view.offset,a.view.offset+a.view.length)),this._flatBuffers.push({stride:c,count:s,buffer:m})}}},t.destroy=function(){for(var e=0;e<this.vertexBuffers.length;e++)this.vertexBuffers[e].destroy();if(this.vertexBuffers.length=0,this._indexBuffer&&(this._indexBuffer.destroy(),this._indexBuffer=null),this._jointMappedBuffers&&this._jointMappedBufferIndices){for(var t=0;t<this._jointMappedBufferIndices.length;t++)this._jointMappedBuffers[this._jointMappedBufferIndices[t]].destroy();this._jointMappedBuffers=void 0,this._jointMappedBufferIndices=void 0}this._indirectBuffer&&(this._indirectBuffer.destroy(),this._indirectBuffer=null),this._handle&&(Wi(uo.get(this._handle,oo.FLAT_BUFFER_ARRAY),nr,so),uo.free(this._handle),this._handle=Yi)},t.enableVertexIdChannel=function(e){if(!this._vertexIdChannel){var t=this.vertexBuffers.length,n=this.attributes.length,i=this._allocVertexIdBuffer(e);this._vertexBuffers.push(i),this._attributes.push(new ts("a_vertexId",Ko.R32F,!1,t)),this._iaInfo.attributes=this._attributes,this._iaInfo.vertexBuffers=this._vertexBuffers,this._vertexIdChannel={stream:t,index:n}}},t._allocVertexIdBuffer=function(e){for(var t=0===this.vertexBuffers.length||0===this.vertexBuffers[0].stride?0:this.vertexBuffers[0].size/this.vertexBuffers[0].stride,n=new Float32Array(t),i=0;i<t;++i)n[i]=i+.5;var r=e.createBuffer(new ka(Qo.VERTEX|Qo.TRANSFER_DST,Zo.DEVICE,n.byteLength,n.BYTES_PER_ELEMENT));return r.update(n),r},Z(e,[{key:"attributes",get:function(){return this._attributes}},{key:"vertexBuffers",get:function(){return this._vertexBuffers}},{key:"indexBuffer",get:function(){return this._indexBuffer}},{key:"indirectBuffer",get:function(){return this._indirectBuffer}},{key:"primitiveMode",get:function(){return this._primitiveMode}},{key:"geometricInfo",get:function(){if(this._geometricInfo)return this._geometricInfo;if(void 0===this.mesh)return{positions:new Float32Array,indices:new Uint8Array,boundingBox:{min:Fn.ZERO,max:Fn.ZERO}};if(void 0===this.subMeshIdx)return{positions:new Float32Array,indices:new Uint8Array,boundingBox:{min:Fn.ZERO,max:Fn.ZERO}};var e=this.mesh,t=this.subMeshIdx,n=e.readAttribute(t,Yo.ATTR_POSITION),i=e.readIndices(t),r=new Fn,o=new Fn,a=this.attributes.find((function(e){return e.name===Yo.ATTR_POSITION}));if(a){var s=Ma[a.format].count;2===s?(r.set(n[0],n[1],0),o.set(n[0],n[1],0)):(r.set(n[0],n[1],n[2]),o.set(n[0],n[1],n[2]));for(var c=0;c<n.length;c+=s)2===s?(r.x=n[c]>r.x?n[c]:r.x,r.y=n[c+1]>r.y?n[c+1]:r.y,o.x=n[c]<o.x?n[c]:o.x,o.y=n[c+1]<o.y?n[c+1]:o.y):(r.x=n[c]>r.x?n[c]:r.x,r.y=n[c+1]>r.y?n[c+1]:r.y,r.z=n[c+2]>r.z?n[c+2]:r.z,o.x=n[c]<o.x?n[c]:o.x,o.y=n[c+1]<o.y?n[c+1]:o.y,o.z=n[c+2]<o.z?n[c+2]:o.z)}return this._geometricInfo={positions:n,indices:i,boundingBox:{max:r,min:o}},this._geometricInfo}},{key:"flatBuffers",get:function(){return this._flatBuffers}},{key:"jointMappedBuffers",get:function(){var e=this;if(this._jointMappedBuffers)return this._jointMappedBuffers;var t=this._jointMappedBuffers=[],n=this._jointMappedBufferIndices=[];if(!this.mesh||void 0===this.subMeshIdx)return this._jointMappedBuffers=this.vertexBuffers;var i,r,o=this.mesh.struct,a=o.primitives[this.subMeshIdx];if(!o.jointMaps||void 0===a.jointMapIndex||!o.jointMaps[a.jointMapIndex])return this._jointMappedBuffers=this.vertexBuffers;for(var s=c.director.root.device,l=0;l<a.vertexBundelIndices.length;l++){var u=o.vertexBundles[a.vertexBundelIndices[l]];r=0,i=Ko.UNKNOWN;for(var h=0;h<u.attributes.length;h++){var _=u.attributes[h];if(_.name===Yo.ATTR_JOINTS){i=_.format;break}r+=Ma[_.format].size}i?function(){var c=new Uint8Array(e.mesh.data.buffer,u.view.offset,u.view.length),h=new DataView(c.slice().buffer),_=o.jointMaps[a.jointMapIndex];DA(h,(function(e){return _.indexOf(e)}),i,r,u.view.length,u.view.stride,h);var f=s.createBuffer(new ka(Qo.VERTEX|Qo.TRANSFER_DST,Zo.DEVICE,u.view.length,u.view.stride));f.update(h.buffer),t.push(f),n.push(l)}():t.push(this.vertexBuffers[a.vertexBundelIndices[l]])}return this._vertexIdChannel&&t.push(this._allocVertexIdBuffer(s)),t}},{key:"iaInfo",get:function(){return this._iaInfo}},{key:"handle",get:function(){return this._handle}}]),e}());var LA,FA,zA,BA,UA,GA,HA,kA,VA,jA=e("ea",mh("cc.SceneAsset")((UA=function(e){function t(){for(var t,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return ie(t=e.call.apply(e,[this].concat(i))||this,"scene",zA,ee(t)),ie(t,"asyncLoadAssets",BA,ee(t)),t}return $(t,e),t}(B_),zA=re((FA=UA).prototype,"scene",[bh,yh],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),BA=re(FA.prototype,"asyncLoadAssets",[bh,yh],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),LA=FA))||LA);c.SceneAsset=jA;var WA,qA,YA,XA,KA=e("eb",mh("cc.TextAsset")((VA=function(e){function t(){for(var t,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return ie(t=e.call.apply(e,[this].concat(i))||this,"text",kA,ee(t)),t}return $(t,e),t.prototype.toString=function(){return this.text},t}(B_),kA=re((HA=VA).prototype,"text",[yh,bh],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),GA=HA))||GA);c.TextAsset=KA;var QA=e("ec",mh("cc.JsonAsset")((XA=function(e){function t(){for(var t,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return ie(t=e.call.apply(e,[this].concat(i))||this,"json",YA,ee(t)),t}return $(t,e),t}(B_),YA=re((qA=XA).prototype,"json",[yh,bh],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),WA=qA))||WA);c.JsonAsset=QA;var ZA,JA,$A,eC,tC,nC,iC,rC,oC,aC=function(){function e(e){this._uiComp=null,this.opacity=1,this._uiTransformComp=null,this._node=void 0,this._node=e}return Z(e,[{key:"uiTransformComp",get:function(){return this._uiTransformComp||(this._uiTransformComp=this._node.getComponent("cc.UITransform")),this._uiTransformComp},set:function(e){this._uiTransformComp=e}},{key:"uiComp",get:function(){return this._uiComp},set:function(e){this._uiComp&&e?I(12002):this._uiComp=e}}]),e}(),sC=(E_.Flags.Destroying,E_.Flags.Destroying),cC=E_.Flags.DontDestroy,lC=E_.Flags.Deactivating,uC=new be("Node");function hC(e){return e?"string"==typeof e?ht(e):e:(R(3804),null)}var _C,fC,mC,dC,pC,vC,gC,yC,xC,EC,SC,TC=e("fp",mh("cc.BaseNode")((oC=rC=function(e){$(n,e),n._setScene=function(e){e._updateScene()},n._findComponent=function(e,t){var n=t,i=e._components;if(n._sealed)for(var r=0;r<i.length;++r){var o=i[r];if(o.constructor===t)return o}else for(var a=0;a<i.length;++a){var s=i[a];if(s instanceof t)return s}return null},n._findComponents=function(e,t,n){var i=t,r=e._components;if(i._sealed)for(var o=0;o<r.length;++o){var a=r[o];a.constructor===t&&n.push(a)}else for(var s=0;s<r.length;++s){var c=r[s];c instanceof t&&n.push(c)}},n._findChildComponent=function(e,t){for(var i=0;i<e.length;++i){var r=e[i],o=n._findComponent(r,t);if(o)return o;if(r._children.length>0&&(o=n._findChildComponent(r._children,t)))return o}return null},n._findChildComponents=function(e,t,i){for(var r=0;r<e.length;++r){var o=e[r];n._findComponents(o,t,i),o._children.length>0&&n._findChildComponents(o._children,t,i)}};var t=n.prototype;function n(t){var n;return ie(n=e.call(this,t)||this,"_parent",$A,ee(n)),ie(n,"_children",eC,ee(n)),ie(n,"_active",tC,ee(n)),ie(n,"_components",nC,ee(n)),ie(n,"_prefab",iC,ee(n)),n._scene=null,n._activeInHierarchy=!1,n._id=uC.getNewId(),n._name=void 0,n._eventProcessor=new c.NodeEventProcessor(ee(n)),n._eventMask=0,n._siblingIndex=0,n._registerIfAttached=void 0,n._name=void 0!==t?t:"New Node",n}return t._updateScene=function(){null==this._parent?y("Node %s(%s) has not attached to a scene.",this.name,this.uuid):this._scene=this._parent._scene},Z(n,[{key:"components",get:function(){return this._components}},{key:"_persistNode",get:function(){return(this._objFlags&cC)>0},set:function(e){e?this._objFlags|=cC:this._objFlags&=~cC}},{key:"name",get:function(){return this._name},set:function(e){this._name=e}},{key:"uuid",get:function(){return this._id}},{key:"children",get:function(){return this._children}},{key:"active",get:function(){return this._active},set:function(e){if(this._active!==e){this._active=e;var t=this._parent;t&&t._activeInHierarchy&&c.director._nodeActivator.activateNode(this,e)}}},{key:"activeInHierarchy",get:function(){return this._activeInHierarchy}},{key:"parent",get:function(){return this._parent},set:function(e){this.setParent(e)}},{key:"scene",get:function(){return this._scene}},{key:"eventProcessor",get:function(){return this._eventProcessor}}]),t.attr=function(e){Qe(this,e)},t.getParent=function(){return this._parent},t.setParent=function(e,t){if(void 0===t&&(t=!1),this._parent!==e){var n=this._parent,i=e;if(this._parent=i,this._siblingIndex=0,this._onSetParent(n,t),this.emit&&this.emit(cA.PARENT_CHANGED,n),n&&!(n._objFlags&sC)){var r=n._children.indexOf(this);n._children.splice(r,1),n._updateSiblingIndex(),n.emit&&n.emit(cA.CHILD_REMOVED,this)}i&&(i._children.push(this),this._siblingIndex=i._children.length-1,i.emit&&i.emit(cA.CHILD_ADDED,this)),this._onHierarchyChanged(n)}},t.getChildByUuid=function(e){if(!e)return v("Invalid uuid"),null;for(var t=this._children,n=0,i=t.length;n<i;n++)if(t[n]._id===e)return t[n];return null},t.getChildByName=function(e){if(!e)return v("Invalid name"),null;for(var t=this._children,n=0,i=t.length;n<i;n++)if(t[n]._name===e)return t[n];return null},t.getChildByPath=function(e){for(var t=e.split("/"),n=this,i=function(e){var i=t[e];if(0===i.length)return"continue";var r=n.children.find((function(e){return e.name===i}));if(!r)return{v:null};n=r},r=0;r<t.length;++r){var o=i(r);switch(o){case"continue":continue;default:if("object"==typeof o)return o.v}}return n},t.addChild=function(e){e.setParent(this)},t.insertChild=function(e,t){e.parent=this,e.setSiblingIndex(t)},t.getSiblingIndex=function(){return this._siblingIndex},t.setSiblingIndex=function(e){if(this._parent)if(this._parent._objFlags&lC)R(3821);else{var t=this._parent._children;e=-1!==e?e:t.length-1;var n=t.indexOf(this);e!==n&&(t.splice(n,1),e<t.length?t.splice(e,0,this):t.push(this),this._parent._updateSiblingIndex(),this._onSiblingIndexChanged&&this._onSiblingIndexChanged(e))}},t.walk=function(e,t){var i=1,r=null,o=null,a=0,s=n._stacks[n._stackId];s||(s=[],n._stacks.push(s)),n._stackId++,s.length=0,s[0]=this;for(var c=null,l=!1;i;)if(o=s[--i])if(!l&&e?e(o):l&&t&&t(o),s[i]=null,l){if(c===this._parent)break;if(l=!1,r)if(r[++a])s[i]=r[a],i++;else if(c&&(s[i]=c,i++,l=!0,c._parent?(a=(r=c._parent._children).indexOf(c),c=c._parent):(c=null,r=null),a<0))break}else o._children.length>0?(c=o,r=o._children,a=0,s[i]=r[a],i++):(s[i]=o,i++,l=!0);s.length=0,n._stackId--},t.removeFromParent=function(){this._parent&&this._parent.removeChild(this)},t.removeChild=function(e){this._children.indexOf(e)>-1&&(e.parent=null)},t.removeAllChildren=function(){for(var e=this._children,t=e.length-1;t>=0;t--){var n=e[t];n&&(n.parent=null)}this._children.length=0},t.isChildOf=function(e){var t=this;do{if(t===e)return!0;t=t._parent}while(t);return!1},t.getComponent=function(e){var t=hC(e);return t?n._findComponent(this,t):null},t.getComponents=function(e){var t=hC(e),i=[];return t&&n._findComponents(this,t,i),i},t.getComponentInChildren=function(e){var t=hC(e);return t?n._findChildComponent(this._children,t):null},t.getComponentsInChildren=function(e){var t=hC(e),i=[];return t&&(n._findComponents(this,t,i),n._findChildComponents(this._children,t,i)),i},t.addComponent=function(e){var t;if("string"==typeof e){if(!(t=ht(e)))throw c._RF.peek()&&R(3808,e),TypeError(M(3807,e))}else{if(!e)throw TypeError(M(3804));t=e}if("function"!=typeof t)throw TypeError(M(3809));if(!$e(t,c.Component))throw TypeError(M(3810));var n=t._requireComponent;n&&!this.getComponent(n)&&this.addComponent(n);var i=new t;return i.node=this,this._components.push(i),this._activeInHierarchy&&c.director._nodeActivator.activateComp(i),i},t.removeComponent=function(e){if(e){var t=null;(t=e instanceof om?e:this.getComponent(e))&&t.destroy()}else R(3813)},t.on=function(e,t,n,i){switch(void 0===i&&(i=!1),e){case cA.TRANSFORM_CHANGED:this._eventMask|=1}this._eventProcessor.on(e,t,n,i)},t.off=function(e,t,n,i){if(void 0===i&&(i=!1),this._eventProcessor.off(e,t,n,i),!this._eventProcessor.hasEventListener(e))switch(e){case cA.TRANSFORM_CHANGED:this._eventMask&=-2}},t.once=function(e,t,n,i){this._eventProcessor.once(e,t,n,i)},t.emit=function(e,t,n,i,r,o){this._eventProcessor.emit(e,t,n,i,r,o)},t.dispatchEvent=function(e){this._eventProcessor.dispatchEvent(e)},t.hasEventListener=function(e,t,n){return this._eventProcessor.hasEventListener(e,t,n)},t.targetOff=function(e){this._eventProcessor.targetOff(e),1&this._eventMask&&!this._eventProcessor.hasEventListener(cA.TRANSFORM_CHANGED)&&(this._eventMask&=-2)},t.destroy=function(){return!!e.prototype.destroy.call(this)&&(this.active=!1,!0)},t.destroyAllChildren=function(){for(var e=this._children,t=0;t<e.length;++t)e[t].destroy()},t._removeComponent=function(e){if(e){if(!(this._objFlags&sC)){var t=this._components.indexOf(e);-1!==t?this._components.splice(t,1):e.node!==this&&R(3815)}}else R(3814)},t._updateSiblingIndex=function(){for(var e=0;e<this._children.length;++e)this._children[e]._siblingIndex=e;this.emit(cA.SIBLING_ORDER_CHANGED)},t._onSetParent=function(e){this._parent&&(null!=e&&e._scene===this._parent._scene||null==this._parent._scene||this.walk(n._setScene))},t._onPostActivated=function(){},t._onBatchCreated=function(){this._parent&&(this._siblingIndex=this._parent.children.indexOf(this))},t._onPreDestroy=function(){this._onPreDestroyBase()},t._onHierarchyChanged=function(e){return this._onHierarchyChangedBase(e)},t._instantiate=function(e,t){return e||(e=c.instantiate._clone(this,this)),e._prefab,e._parent=null,e._onBatchCreated(t),e},t._onHierarchyChangedBase=function(){var e=this._parent;!this._persistNode||e instanceof c.Scene||c.game.removePersistRootNode(this);var t=this._active&&!(!e||!e._activeInHierarchy);this._activeInHierarchy!==t&&c.director._nodeActivator.activateNode(this,t)},t._onPreDestroyBase=function(){this._objFlags|=sC;var e=this._parent,t=!!e&&0!=(e._objFlags&sC);if(!t&&i&&this._registerIfAttached(!1),this._persistNode&&c.game.removePersistRootNode(this),!t&&e){this.emit(cA.PARENT_CHANGED,this);var n=e._children.indexOf(this);e._children.splice(n,1),this._siblingIndex=0,e._updateSiblingIndex(),e.emit&&e.emit(cA.CHILD_REMOVED,this)}this.emit(cA.NODE_DESTROYED,this),this._eventProcessor.destroy();for(var r=this._children,o=0;o<r.length;++o)r[o]._destroyImmediate();for(var a=this._components,s=0;s<a.length;++s)a[s]._destroyImmediate();return t},n}(E_),rC.idGenerator=uC,rC._stacks=[[]],rC._stackId=0,re((JA=oC).prototype,"_persistNode",[gh],Object.getOwnPropertyDescriptor(JA.prototype,"_persistNode"),JA.prototype),re(JA.prototype,"name",[bh],Object.getOwnPropertyDescriptor(JA.prototype,"name"),JA.prototype),re(JA.prototype,"children",[bh],Object.getOwnPropertyDescriptor(JA.prototype,"children"),JA.prototype),re(JA.prototype,"active",[bh],Object.getOwnPropertyDescriptor(JA.prototype,"active"),JA.prototype),re(JA.prototype,"activeInHierarchy",[bh],Object.getOwnPropertyDescriptor(JA.prototype,"activeInHierarchy"),JA.prototype),re(JA.prototype,"parent",[bh],Object.getOwnPropertyDescriptor(JA.prototype,"parent"),JA.prototype),$A=re(JA.prototype,"_parent",[yh],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),eC=re(JA.prototype,"_children",[yh],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),tC=re(JA.prototype,"_active",[yh],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),nC=re(JA.prototype,"_components",[yh],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),iC=re(JA.prototype,"_prefab",[yh],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),ZA=JA))||ZA);c._BaseNode=TC;var AC=new Fn,CC=new Vn,wC=new Vn,IC=new Array(10),bC=new Vn,RC=new Gn,OC=new Gn,NC=new Zn,PC=new Map,MC=e("bJ",(_C=mh("cc.Node"),fC=Vh(Fn),_C((SC=EC=function(e){function t(t){var n;return(n=e.call(this,t)||this)._uiProps=new aC(ee(n)),n._static=!1,n._pos=new Fn,n._rot=new Vn,n._scale=new Fn(1,1,1),n._mat=new Zn,ie(n,"_lpos",pC,ee(n)),ie(n,"_lrot",vC,ee(n)),ie(n,"_lscale",gC,ee(n)),ie(n,"_layer",yC,ee(n)),ie(n,"_euler",xC,ee(n)),n._dirtyFlags=Qu.NONE,n._eulerDirty=!1,n._poolHandle=Yi,n._poolHandle=Nr.alloc(),Nr.set(n._poolHandle,wr.LAYER,n._layer),n}$(t,e),t.isNode=function(e){return e instanceof t&&(e.constructor===t||!(e instanceof c.Scene))};var n=t.prototype;return n.destroy=function(){return this._poolHandle&&(Nr.free(this._poolHandle),this._poolHandle=Yi),e.prototype.destroy.call(this)},n.setParent=function(t,n){void 0===n&&(n=!1),n&&this.updateWorldTransform(),e.prototype.setParent.call(this,t,n)},n._onSetParent=function(t,n){if(e.prototype._onSetParent.call(this,t,n),n){var i=this._parent;i?(i.updateWorldTransform(),Zn.multiply(NC,Zn.invert(NC,i._mat),this._mat),Zn.toRTS(NC,this._lrot,this._lpos,this._lscale)):(Fn.copy(this._lpos,this._pos),Vn.copy(this._lrot,this._rot),Fn.copy(this._lscale,this._scale)),this._eulerDirty=!0}this.invalidateChildren(Qu.TRS)},n._onBatchCreated=function(t){var n;e.prototype._onBatchCreated.call(this,t),Nr.set(this._poolHandle,wr.LAYER,this._layer),Nr.setVec3(this._poolHandle,wr.WORLD_SCALE,this._scale);var i=null===(n=this._prefab)||void 0===n?void 0:n.instance;!t&&i&&iT(this),this.hasChangedFlags=Qu.TRS,this._dirtyFlags=Qu.TRS;for(var r=this._children.length,o=0;o<r;++o)this._children[o]._onBatchCreated(t);if(!t&&i){var a={};i.targetMap=a,rT(this,a,!0),aT(0,i.mountedChildren,a),sT(0,i.propertyOverrides,a)}cT(this)},n._onBeforeSerialize=function(){this.eulerAngles},n._onPostActivated=function(e){e?(WT.resumeTarget(this),this.eventProcessor.reattach(),this.invalidateChildren(Qu.TRS)):WT.pauseTarget(this)},n.translate=function(e,t){var n=t||Ku.LOCAL;if(n===Ku.LOCAL)Fn.transformQuat(AC,e,this._lrot),this._lpos.x+=AC.x,this._lpos.y+=AC.y,this._lpos.z+=AC.z;else if(n===Ku.WORLD)if(this._parent){Vn.invert(CC,this._parent.worldRotation),Fn.transformQuat(AC,e,CC);var i=this.worldScale;this._lpos.x+=AC.x/i.x,this._lpos.y+=AC.y/i.y,this._lpos.z+=AC.z/i.z}else this._lpos.x+=e.x,this._lpos.y+=e.y,this._lpos.z+=e.z;this.invalidateChildren(Qu.POSITION),1&this._eventMask&&this.emit(cA.TRANSFORM_CHANGED,Qu.POSITION)},n.rotate=function(e,t){var n=t||Ku.LOCAL;if(Vn.normalize(CC,e),n===Ku.LOCAL)Vn.multiply(this._lrot,this._lrot,CC);else if(n===Ku.WORLD){var i=this.worldRotation;Vn.multiply(wC,CC,i),Vn.invert(CC,i),Vn.multiply(wC,CC,wC),Vn.multiply(this._lrot,this._lrot,wC)}this._eulerDirty=!0,this.invalidateChildren(Qu.ROTATION),1&this._eventMask&&this.emit(cA.TRANSFORM_CHANGED,Qu.ROTATION)},n.lookAt=function(e,t){this.getWorldPosition(AC),Fn.subtract(AC,AC,e),Fn.normalize(AC,AC),Vn.fromViewUp(CC,AC,t),this.setWorldRotation(CC)},n.invalidateChildren=function(e){var t=this.hasChangedFlags;if((this._dirtyFlags&t&e)!==e){this._dirtyFlags|=e,this.hasChangedFlags=t|e;for(var n=e|Qu.POSITION,i=this._children.length,r=0;r<i;++r){var o=this._children[r];o.isValid&&o.invalidateChildren(n)}}},n.updateWorldTransform=function(){if(this._dirtyFlags){for(var e,t=this,n=0;t&&t._dirtyFlags;)IC[n++]=t,t=t._parent;for(var i=0;n;)i|=(e=IC[--n])._dirtyFlags,t?(i&Qu.POSITION&&(Fn.transformMat4(e._pos,e._lpos,t._mat),e._mat.m12=e._pos.x,e._mat.m13=e._pos.y,e._mat.m14=e._pos.z,Nr.setVec3(e._poolHandle,wr.WORLD_POSITION,e._pos)),i&Qu.RS&&(Zn.fromRTS(e._mat,e._lrot,e._lpos,e._lscale),Zn.multiply(e._mat,t._mat,e._mat),i&Qu.ROTATION&&(Vn.multiply(e._rot,t._rot,e._lrot),Nr.setVec4(e._poolHandle,wr.WORLD_ROTATION,e._rot)),Gn.fromQuat(RC,Vn.conjugate(bC,e._rot)),Gn.multiplyMat4(RC,RC,e._mat),e._scale.x=RC.m00,e._scale.y=RC.m04,e._scale.z=RC.m08,Nr.setVec3(e._poolHandle,wr.WORLD_SCALE,e._scale))):(i&Qu.POSITION&&(Fn.copy(e._pos,e._lpos),e._mat.m12=e._pos.x,e._mat.m13=e._pos.y,e._mat.m14=e._pos.z,Nr.setVec3(e._poolHandle,wr.WORLD_POSITION,e._pos)),i&Qu.RS&&(i&Qu.ROTATION&&(Vn.copy(e._rot,e._lrot),Nr.setVec4(e._poolHandle,wr.WORLD_ROTATION,e._rot)),i&Qu.SCALE&&(Fn.copy(e._scale,e._lscale),Nr.setVec3(e._poolHandle,wr.WORLD_SCALE,e._scale),Zn.fromRTS(e._mat,e._rot,e._pos,e._scale)))),i!==Qu.NONE&&Nr.setMat4(e._poolHandle,wr.WORLD_MATRIX,e._mat),e._dirtyFlags=Qu.NONE,t=e}},n.setPosition=function(e,t,n){void 0===t&&void 0===n?Fn.copy(this._lpos,e):void 0===n?Fn.set(this._lpos,e,t,this._lpos.z):Fn.set(this._lpos,e,t,n),this.invalidateChildren(Qu.POSITION),1&this._eventMask&&this.emit(cA.TRANSFORM_CHANGED,Qu.POSITION)},n.getPosition=function(e){return e?Fn.set(e,this._lpos.x,this._lpos.y,this._lpos.z):Fn.copy(new Fn,this._lpos)},n.setRotation=function(e,t,n,i){void 0===t||void 0===n||void 0===i?Vn.copy(this._lrot,e):Vn.set(this._lrot,e,t,n,i),this._eulerDirty=!0,this.invalidateChildren(Qu.ROTATION),1&this._eventMask&&this.emit(cA.TRANSFORM_CHANGED,Qu.ROTATION)},n.setRotationFromEuler=function(e,t,n){var i=void 0===n?this._euler.z:n;void 0===t?(Fn.copy(this._euler,e),Vn.fromEuler(this._lrot,e.x,e.y,e.z)):(Fn.set(this._euler,e,t,i),Vn.fromEuler(this._lrot,e,t,i)),this._eulerDirty=!1,this.invalidateChildren(Qu.ROTATION),1&this._eventMask&&this.emit(cA.TRANSFORM_CHANGED,Qu.ROTATION)},n.getRotation=function(e){return e?Vn.set(e,this._lrot.x,this._lrot.y,this._lrot.z,this._lrot.w):Vn.copy(new Vn,this._lrot)},n.setScale=function(e,t,n){void 0===t&&void 0===n?Fn.copy(this._lscale,e):void 0===n?Fn.set(this._lscale,e,t,this._lscale.z):Fn.set(this._lscale,e,t,n),this.invalidateChildren(Qu.SCALE),1&this._eventMask&&this.emit(cA.TRANSFORM_CHANGED,Qu.SCALE)},n.getScale=function(e){return e?Fn.set(e,this._lscale.x,this._lscale.y,this._lscale.z):Fn.copy(new Fn,this._lscale)},n.inverseTransformPoint=function(e,t){Fn.copy(e,t);for(var n=this,i=0;n._parent;)IC[i++]=n,n=n._parent;for(;i>=0;)Fn.transformInverseRTS(e,e,n._lrot,n._lpos,n._lscale),n=IC[--i];return e},n.setWorldPosition=function(e,t,n){void 0===t||void 0===n?Fn.copy(this._pos,e):Fn.set(this._pos,e,t,n),Nr.setVec3(this._poolHandle,wr.WORLD_POSITION,this._pos);var i=this._parent,r=this._lpos;i?(i.updateWorldTransform(),Fn.transformMat4(r,this._pos,Zn.invert(NC,i._mat))):Fn.copy(r,this._pos),this.invalidateChildren(Qu.POSITION),1&this._eventMask&&this.emit(cA.TRANSFORM_CHANGED,Qu.POSITION)},n.getWorldPosition=function(e){return this.updateWorldTransform(),e?Fn.copy(e,this._pos):Fn.copy(new Fn,this._pos)},n.setWorldRotation=function(e,t,n,i){void 0===t||void 0===n||void 0===i?Vn.copy(this._rot,e):Vn.set(this._rot,e,t,n,i),Nr.setVec4(this._poolHandle,wr.WORLD_ROTATION,this._rot),this._parent?(this._parent.updateWorldTransform(),Vn.multiply(this._lrot,Vn.conjugate(this._lrot,this._parent._rot),this._rot)):Vn.copy(this._lrot,this._rot),this._eulerDirty=!0,this.invalidateChildren(Qu.ROTATION),1&this._eventMask&&this.emit(cA.TRANSFORM_CHANGED,Qu.ROTATION)},n.setWorldRotationFromEuler=function(e,t,n){Vn.fromEuler(this._rot,e,t,n),this._parent?(this._parent.updateWorldTransform(),Vn.multiply(this._lrot,Vn.conjugate(this._lrot,this._parent._rot),this._rot)):Vn.copy(this._lrot,this._rot),this._eulerDirty=!0,this.invalidateChildren(Qu.ROTATION),1&this._eventMask&&this.emit(cA.TRANSFORM_CHANGED,Qu.ROTATION)},n.getWorldRotation=function(e){return this.updateWorldTransform(),e?Vn.copy(e,this._rot):Vn.copy(new Vn,this._rot)},n.setWorldScale=function(e,t,n){void 0===t||void 0===n?Fn.copy(this._scale,e):Fn.set(this._scale,e,t,n),Nr.setVec3(this._poolHandle,wr.WORLD_SCALE,this._scale);var i=this._parent;i?(i.updateWorldTransform(),Gn.fromQuat(RC,Vn.conjugate(bC,i._rot)),Gn.multiplyMat4(RC,RC,i._mat),OC.m00=this._scale.x,OC.m04=this._scale.y,OC.m08=this._scale.z,Gn.multiply(RC,OC,Gn.invert(RC,RC)),this._lscale.x=Fn.set(AC,RC.m00,RC.m01,RC.m02).length(),this._lscale.y=Fn.set(AC,RC.m03,RC.m04,RC.m05).length(),this._lscale.z=Fn.set(AC,RC.m06,RC.m07,RC.m08).length()):Fn.copy(this._lscale,this._scale),this.invalidateChildren(Qu.SCALE),1&this._eventMask&&this.emit(cA.TRANSFORM_CHANGED,Qu.SCALE)},n.getWorldScale=function(e){return this.updateWorldTransform(),e?Fn.copy(e,this._scale):Fn.copy(new Fn,this._scale)},n.getWorldMatrix=function(e){this.updateWorldTransform();var t=e||new Zn;return Zn.copy(t,this._mat)},n.getWorldRS=function(e){this.updateWorldTransform();var t=e||new Zn;return Zn.copy(t,this._mat),t.m12=0,t.m13=0,t.m14=0,t},n.getWorldRT=function(e){this.updateWorldTransform();var t=e||new Zn;return Zn.fromRT(t,this._rot,this._pos)},n.setRTS=function(e,t,n){var i=0;e&&(i|=Qu.ROTATION,void 0!==e.w?(Vn.copy(this._lrot,e),this._eulerDirty=!0):(Fn.copy(this._euler,e),Vn.fromEuler(this._lrot,e.x,e.y,e.z),this._eulerDirty=!1)),t&&(Fn.copy(this._lpos,t),i|=Qu.POSITION),n&&(Fn.copy(this._lscale,n),i|=Qu.SCALE),i&&(this.invalidateChildren(i),1&this._eventMask&&this.emit(cA.TRANSFORM_CHANGED,i))},n.pauseSystemEvents=function(e){WT.pauseTarget(this,e)},n.resumeSystemEvents=function(e){WT.resumeTarget(this,e)},Z(t,[{key:"handle",get:function(){return this._poolHandle}},{key:"position",get:function(){return this._lpos},set:function(e){this.setPosition(e)}},{key:"worldPosition",get:function(){return this.updateWorldTransform(),this._pos},set:function(e){this.setWorldPosition(e)}},{key:"rotation",get:function(){return this._lrot},set:function(e){this.setRotation(e)}},{key:"eulerAngles",set:function(e){this.setRotationFromEuler(e.x,e.y,e.z)},get:function(){return this._eulerDirty&&(Vn.toEuler(this._euler,this._lrot),this._eulerDirty=!1),this._euler}},{key:"angle",get:function(){return this._euler.z},set:function(e){Fn.set(this._euler,0,0,e),Vn.fromAngleZ(this._lrot,e),this._eulerDirty=!1,this.invalidateChildren(Qu.ROTATION),1&this._eventMask&&this.emit(cA.TRANSFORM_CHANGED,Qu.ROTATION)}},{key:"worldRotation",get:function(){return this.updateWorldTransform(),this._rot},set:function(e){this.setWorldRotation(e)}},{key:"scale",get:function(){return this._lscale},set:function(e){this.setScale(e)}},{key:"worldScale",get:function(){return this.updateWorldTransform(),this._scale},set:function(e){this.setWorldScale(e)}},{key:"matrix",set:function(e){Zn.toRTS(e,this._lrot,this._lpos,this._lscale),this.invalidateChildren(Qu.TRS),this._eulerDirty=!0,1&this._eventMask&&this.emit(cA.TRANSFORM_CHANGED,Qu.TRS)}},{key:"worldMatrix",get:function(){return this.updateWorldTransform(),this._mat}},{key:"forward",get:function(){return Fn.transformQuat(new Fn,Fn.FORWARD,this.worldRotation)},set:function(e){var t=e.length();Fn.multiplyScalar(AC,e,-1/t),Vn.fromViewUp(CC,AC),this.setWorldRotation(CC)}},{key:"layer",set:function(e){this._layer=e,Nr.set(this._poolHandle,wr.LAYER,this._layer),this.emit(cA.LAYER_CHANGED,this._layer)},get:function(){return this._layer}},{key:"hasChangedFlags",get:function(){return PC.get(this)||0},set:function(e){PC.set(this,e),Nr.set(this._poolHandle,wr.FLAGS_CHANGED,e)}}]),t}(TC),EC.bookOfChange=PC,EC.EventType=cA,EC.NodeSpace=Ku,EC.TransformDirtyBit=Qu,EC.TransformBit=Qu,pC=re((dC=SC).prototype,"_lpos",[yh],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Fn}}),vC=re(dC.prototype,"_lrot",[yh],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Vn}}),gC=re(dC.prototype,"_lscale",[yh],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Fn(1,1,1)}}),yC=re(dC.prototype,"_layer",[yh],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return ql.Enum.DEFAULT}}),xC=re(dC.prototype,"_euler",[yh],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Fn}}),re(dC.prototype,"eulerAngles",[fC],Object.getOwnPropertyDescriptor(dC.prototype,"eulerAngles"),dC.prototype),re(dC.prototype,"angle",[bh],Object.getOwnPropertyDescriptor(dC.prototype,"angle"),dC.prototype),re(dC.prototype,"layer",[bh],Object.getOwnPropertyDescriptor(dC.prototype,"layer"),dC.prototype),mC=dC))||mC));c.Node=MC;var DC=new Array(16),LC=null,FC=new ti,zC=[cA.TOUCH_START.toString(),cA.TOUCH_MOVE.toString(),cA.TOUCH_END.toString(),cA.TOUCH_CANCEL.toString()],BC=[cA.MOUSE_DOWN.toString(),cA.MOUSE_ENTER.toString(),cA.MOUSE_MOVE.toString(),cA.MOUSE_LEAVE.toString(),cA.MOUSE_UP.toString(),cA.MOUSE_WHEEL.toString()];function UC(e,t){var n=this.owner;return!(!n||!n._uiProps.uiTransformComp||(e.getUILocation(FC),!n._uiProps.uiTransformComp.isHit(FC,this)||(t.type=cA.TOUCH_START.toString(),t.touch=e,t.bubbles=!0,n.dispatchEvent(t),0)))}function GC(e,t){var n=this.owner;return!(!n||!n._uiProps.uiTransformComp||(t.type=cA.TOUCH_MOVE.toString(),t.touch=e,t.bubbles=!0,n.dispatchEvent(t),0))}function HC(e,t){var n=this.owner;n&&n._uiProps.uiTransformComp&&(e.getUILocation(FC),n._uiProps.uiTransformComp.isHit(FC,this)?t.type=cA.TOUCH_END.toString():t.type=cA.TOUCH_CANCEL.toString(),t.touch=e,t.bubbles=!0,n.dispatchEvent(t))}function kC(e,t){var n=this.owner;n&&n._uiProps.uiTransformComp&&(t.type=cA.TOUCH_CANCEL.toString(),t.touch=e,t.bubbles=!0,n.dispatchEvent(t))}function VC(e){var t=this.owner;t&&t._uiProps.uiTransformComp&&(FC=e.getUILocation(),t._uiProps.uiTransformComp.isHit(FC,this)&&(e.type=cA.MOUSE_DOWN.toString(),e.bubbles=!0,t.dispatchEvent(e)))}function jC(e){var t=this.owner;if(t&&t._uiProps.uiTransformComp){if(FC=e.getUILocation(),t._uiProps.uiTransformComp.isHit(FC,this))this._previousIn||(LC&&LC.eventProcessor.mouseListener&&(e.type=cA.MOUSE_LEAVE,LC.dispatchEvent(e),LC.eventProcessor.mouseListener&&(LC.eventProcessor.mouseListener._previousIn=!1)),LC=t,e.type=cA.MOUSE_ENTER.toString(),t.dispatchEvent(e),this._previousIn=!0),e.type=cA.MOUSE_MOVE.toString(),e.bubbles=!0,t.dispatchEvent(e);else{if(!this._previousIn)return;e.type=cA.MOUSE_LEAVE.toString(),t.dispatchEvent(e),this._previousIn=!1,LC=null}e.propagationStopped=!0}}function WC(e){var t=this.owner;t&&t._uiProps.uiTransformComp&&(FC=e.getUILocation(),t._uiProps.uiTransformComp.isHit(FC,this)&&(e.type=cA.MOUSE_UP.toString(),e.bubbles=!0,t.dispatchEvent(e),e.propagationStopped=!0))}function qC(e){var t=this.owner;t&&t._uiProps.uiTransformComp&&(FC=e.getUILocation(),t._uiProps.uiTransformComp.isHit(FC,this)&&(e.type=cA.MOUSE_WHEEL.toString(),e.bubbles=!0,t.dispatchEvent(e),e.propagationStopped=!0))}function YC(e,t){if(t){for(var n=0,i=[],r=e;r&&MC.isNode(r);r=r.parent,++n){var o=r.getComponent(t);if(o){var a={index:n,comp:o};i?i.push(a):i=[a]}}return i.length>0?i:null}return null}function XC(e,t){if(!e._persistNode){if(e.eventProcessor.bubblingTargets)for(var n=0;n<t.length;++n)if(e.eventProcessor.bubblingTargets.hasEventListener(t[n]))return!0;if(e.eventProcessor.capturingTargets)for(var i=0;i<t.length;++i)if(e.eventProcessor.capturingTargets.hasEventListener(t[i]))return!0;return!1}return!0}var KC,QC,ZC,JC,$C,ew,tw,nw,iw,rw,ow,aw,sw,cw,lw,uw,hw,_w,fw,mw,dw,pw,vw,gw,yw,xw,Ew,Sw,Tw,Aw,Cw,ww,Iw,bw,Rw,Ow,Nw,Pw,Mw,Dw,Lw,Fw,zw,Bw,Uw,Gw,Hw,kw,Vw,jw,Ww,qw,Yw,Xw,Kw,Qw,Zw,Jw,$w,eI,tI,nI,iI,rI,oI,aI,sI,cI,lI,uI,hI,_I,fI,mI,dI,pI,vI,gI,yI,xI,EI,SI,TI,AI,CI,wI,II,bI,RI,OI,NI,PI,MI,DI,LI,FI,zI,BI,UI,GI,HI,kI,VI,jI,WI,qI,YI,XI=function(){function e(e){this.bubblingTargets=null,this.capturingTargets=null,this.touchListener=null,this.mouseListener=null,this._node=void 0,this._comp=null,this._node=e}Z(e,[{key:"node",get:function(){return this._node}}]);var t=e.prototype;return t.reattach=function(){if(this._comp)if(this.touchListener){var e=this.touchListener.mask=YC(this._node,this._comp);this.mouseListener&&(this.mouseListener.mask=e)}else this.mouseListener&&(this.mouseListener.mask=YC(this._node,this._comp))},t.registerComponentHitList=function(e){this._comp=e},t.destroy=function(){LC===this._node&&(LC=null),(this.touchListener||this.mouseListener)&&(WT.removeListeners(this._node),this.touchListener&&(this.touchListener.owner=null,this.touchListener.mask=null,this.touchListener=null),this.mouseListener&&(this.mouseListener.owner=null,this.mouseListener.mask=null,this.mouseListener=null)),this.capturingTargets&&this.capturingTargets.clear(),this.bubblingTargets&&this.bubblingTargets.clear()},t.on=function(e,t,n,i){return this._checknSetupSysEvent(e)?this._onDispatch(e,t,n,i):(this.bubblingTargets||(this.bubblingTargets=new O_),this.bubblingTargets.on(e,t,n))},t.once=function(e,t,n,i){var r,o=this;(r=this._checknSetupSysEvent(e)&&i?this.capturingTargets=this.capturingTargets||new O_:this.bubblingTargets=this.bubblingTargets||new O_).on(e,t,n,!0),r.on(e,(function(){o.off(e,t,n)}),void 0,!0)},t.off=function(e,t,n,i){var r=-1!==zC.indexOf(e),o=!r&&-1!==BC.indexOf(e);r||o?(this._offDispatch(e,t,n,i),r?this.touchListener&&!XC(this._node,zC)&&(WT.removeListener(this.touchListener),this.touchListener=null):o&&this.mouseListener&&!XC(this._node,BC)&&(WT.removeListener(this.mouseListener),this.mouseListener=null)):this.bubblingTargets&&this.bubblingTargets.off(e,t,n)},t.emit=function(e,t,n,i,r,o){this.bubblingTargets&&this.bubblingTargets.emit(e,t,n,i,r,o)},t.dispatchEvent=function(e){!function(e,t){var n,i=0;for(t.target=e,DC.length=0,e.eventProcessor.getCapturingTargets(t.type,DC),t.eventPhase=1,i=DC.length-1;i>=0;--i)if((n=DC[i]).eventProcessor.capturingTargets&&(t.currentTarget=n,n.eventProcessor.capturingTargets.emit(t.type,t,DC),t.propagationStopped))return void(DC.length=0);if(DC.length=0,t.eventPhase=2,t.currentTarget=e,e.eventProcessor.capturingTargets&&e.eventProcessor.capturingTargets.emit(t.type,t),!t.propagationImmediateStopped&&e.eventProcessor.bubblingTargets&&e.eventProcessor.bubblingTargets.emit(t.type,t),!t.propagationStopped&&t.bubbles)for(e.eventProcessor.getBubblingTargets(t.type,DC),t.eventPhase=3,i=0;i<DC.length;++i)if((n=DC[i]).eventProcessor.bubblingTargets&&(t.currentTarget=n,n.eventProcessor.bubblingTargets.emit(t.type,t),t.propagationStopped))return void(DC.length=0);DC.length=0}(this._node,e),DC.length=0},t.hasEventListener=function(e,t,n){var i=!1;return this.bubblingTargets&&(i=this.bubblingTargets.hasEventListener(e,t,n)),!i&&this.capturingTargets&&(i=this.capturingTargets.hasEventListener(e,t,n)),i},t.targetOff=function(e){this.capturingTargets&&this.capturingTargets.removeAll(e),this.bubblingTargets&&this.bubblingTargets.removeAll(e),this.touchListener&&!XC(this.node,zC)&&(WT.removeListener(this.touchListener),this.touchListener=null),this.mouseListener&&!XC(this.node,BC)&&(WT.removeListener(this.mouseListener),this.mouseListener=null)},t.getCapturingTargets=function(e,t){for(var n=this._node.parent;n;)n.eventProcessor.capturingTargets&&n.eventProcessor.capturingTargets.hasEventListener(e)&&t.push(n),n=n.parent},t.getBubblingTargets=function(e,t){for(var n=this._node.parent;n;)n.eventProcessor.bubblingTargets&&n.eventProcessor.bubblingTargets.hasEventListener(e)&&t.push(n),n=n.parent},t._checknSetupSysEvent=function(e){var t=this,n=!1,i=!1;return-1!==zC.indexOf(e)?(this.touchListener||(this.touchListener=c.EventListener.create({event:c.EventListener.TOUCH_ONE_BY_ONE,swallowTouches:!0,owner:this._node,mask:YC(this._node,this._comp),onTouchBegan:UC,onTouchMoved:GC,onTouchEnded:HC,onTouchCancelled:kC}),WT.addListener(this.touchListener,this._node),n=!0),i=!0):-1!==BC.indexOf(e)&&(this.mouseListener||(this.mouseListener=c.EventListener.create({event:c.EventListener.MOUSE,_previousIn:!1,owner:this._node,mask:YC(this._node,this._comp),onMouseDown:VC,onMouseMove:jC,onMouseUp:WC,onMouseScroll:qC}),WT.addListener(this.mouseListener,this._node),n=!0),i=!0),n&&!this._node.activeInHierarchy&&c.director.getScheduler().schedule((function(){t._node.activeInHierarchy||WT.pauseTarget(t._node)}),this._node,0,0,0,!1),i},t._onDispatch=function(e,t,n,i){if("boolean"==typeof n?(i=n,n=void 0):i=!!i,t){var r=null;return(r=i?this.capturingTargets=this.capturingTargets||new O_:this.bubblingTargets=this.bubblingTargets||new O_).hasEventListener(e,t,n)||r.on(e,t,n),t}R(6800)},t._offDispatch=function(e,t,n,i){if("boolean"==typeof n?(i=n,n=void 0):i=!!i,t){var r=i?this.capturingTargets:this.bubblingTargets;r&&r.off(e,t,n)}else this.capturingTargets&&this.capturingTargets.removeAll(e),this.bubblingTargets&&this.bubblingTargets.removeAll(e)},e}();c.NodeEventProcessor=XI,me(TC.prototype,"BaseNode",[{name:"childrenCount",newName:"children.length",customGetter:function(){return this.children.length}}]),me(MC.prototype,"Node",[{name:"width",targetName:"node.getComponent(UITransform)",customGetter:function(){return this._uiProps.uiTransformComp.width},customSetter:function(e){this._uiProps.uiTransformComp.width=e}},{name:"height",targetName:"node.getComponent(UITransform)",customGetter:function(){return this._uiProps.uiTransformComp.height},customSetter:function(e){this._uiProps.uiTransformComp.height=e}},{name:"anchorX",targetName:"node.getComponent(UITransform)",customGetter:function(){return this._uiProps.uiTransformComp.anchorX},customSetter:function(e){this._uiProps.uiTransformComp.anchorX=e}},{name:"anchorY",targetName:"node.getComponent(UITransform)",customGetter:function(){return this._uiProps.uiTransformComp.anchorY},customSetter:function(e){this._uiProps.uiTransformComp.anchorY=e}},{name:"getAnchorPoint",targetName:"node.getComponent(UITransform)",customFunction:function(e){return e||(e=new ti),e.set(this._uiProps.uiTransformComp.anchorPoint),e}},{name:"setAnchorPoint",targetName:"node.getComponent(UITransform)",customFunction:function(e,t){this._uiProps.uiTransformComp.setAnchorPoint(e,t)}},{name:"getContentSize",targetName:"node.getComponent(UITransform)",customFunction:function(e){return e||(e=new ci),e.set(this._uiProps.uiTransformComp.contentSize),e}},{name:"setContentSize",targetName:"node.getComponent(UITransform)",customFunction:function(e,t){"number"==typeof e?this._uiProps.uiTransformComp.setContentSize(e,t):this._uiProps.uiTransformComp.setContentSize(e)}}]),de(MC.prototype,"Node.prototype",[{name:"addLayer"},{name:"removeLayer"}]),de(ql,"Layers",[{name:"All"},{name:"RaycastMask"},{name:"check"}]),me(ql,"Layers",[{name:"Default",newName:"DEFAULT",target:ql.Enum,targetName:"Layers.Enum"},{name:"Always",newName:"ALWAYS",target:ql.Enum,targetName:"Layers.Enum"},{name:"IgnoreRaycast",newName:"IGNORE_RAYCAST",target:ql.Enum,targetName:"Layers.Enum"},{name:"Gizmos",newName:"GIZMOS",target:ql.Enum,targetName:"Layers.Enum"},{name:"Editor",newName:"EDITOR",target:ql.Enum,targetName:"Layers.Enum"},{name:"UI",newName:"UI_3D",target:ql.Enum,targetName:"Layers.Enum"},{name:"UI2D",newName:"UI_2D",target:ql.Enum,targetName:"Layers.Enum"},{name:"SceneGizmo",newName:"SCENE_GIZMO",target:ql.Enum,targetName:"Layers.Enum"},{name:"makeInclusiveMask",newName:"makeMaskInclude",target:ql,targetName:"Layers"},{name:"makeExclusiveMask",newName:"makeMaskExclude",target:ql,targetName:"Layers"}]),de(ql.Enum,"Layers.Enum",[{name:"ALWAYS"}]),de(ql.BitMask,"Layers.BitMask",[{name:"ALWAYS"}]);var KI=new Fn(0,1,0),QI=new Fn,ZI=new Vn,JI=(KC=mh("cc.AmbientInfo"),QC=Vh(jt),KC((nw=function(){function e(){ie(this,"_skyColor",$C,this),ie(this,"_skyIllum",ew,this),ie(this,"_groundAlbedo",tw,this),this._resource=null}return e.prototype.activate=function(e){this._resource=e,this._resource.initialize(this)},Z(e,[{key:"skyColor",set:function(e){this._skyColor.set(e),this._resource&&(this._resource.skyColor=this._skyColor)},get:function(){return this._skyColor}},{key:"skyIllum",set:function(e){this._skyIllum=e,this._resource&&(this._resource.skyIllum=this.skyIllum)},get:function(){return this._skyIllum}},{key:"groundAlbedo",set:function(e){this._groundAlbedo.set(e),this._resource&&(this._resource.groundAlbedo=this._groundAlbedo)},get:function(){return this._groundAlbedo}}]),e}(),$C=re((JC=nw).prototype,"_skyColor",[yh],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Dn(51,128,204,1)}}),ew=re(JC.prototype,"_skyIllum",[yh],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return So.SKY_ILLUM}}),tw=re(JC.prototype,"_groundAlbedo",[yh],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Dn(51,51,51,255)}}),re(JC.prototype,"skyColor",[bh],Object.getOwnPropertyDescriptor(JC.prototype,"skyColor"),JC.prototype),re(JC.prototype,"skyIllum",[bh,QC],Object.getOwnPropertyDescriptor(JC.prototype,"skyIllum"),JC.prototype),re(JC.prototype,"groundAlbedo",[bh],Object.getOwnPropertyDescriptor(JC.prototype,"groundAlbedo"),JC.prototype),ZC=JC))||ZC);c.AmbientInfo=JI;var $I=(iw=mh("cc.SkyboxInfo"),rw=Vh(Im),ow=Vh(Im),iw((_w=function(){function e(){ie(this,"_envmap",cw,this),ie(this,"_isRGBE",lw,this),ie(this,"_enabled",uw,this),ie(this,"_useIBL",hw,this),this._resource=null}return e.prototype.activate=function(e){this._resource=e,this._resource.initialize(this),this._resource.activate()},Z(e,[{key:"enabled",set:function(e){this._enabled!==e&&(this._enabled=e,this._resource&&(this._resource.enabled=this._enabled))},get:function(){return this._enabled}},{key:"useIBL",set:function(e){this._useIBL=e,this._resource&&(this._resource.useIBL=this._useIBL)},get:function(){return this._useIBL}},{key:"envmap",set:function(e){this._envmap=e,this._resource&&(this._resource.envmap=this._envmap)},get:function(){return this._envmap}},{key:"isRGBE",set:function(e){this._isRGBE=e,this._resource&&(this._resource.isRGBE=this._isRGBE)},get:function(){return this._isRGBE}}]),e}(),cw=re((sw=_w).prototype,"_envmap",[rw],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),lw=re(sw.prototype,"_isRGBE",[yh],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),uw=re(sw.prototype,"_enabled",[yh],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),hw=re(sw.prototype,"_useIBL",[yh],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),re(sw.prototype,"enabled",[bh],Object.getOwnPropertyDescriptor(sw.prototype,"enabled"),sw.prototype),re(sw.prototype,"useIBL",[bh],Object.getOwnPropertyDescriptor(sw.prototype,"useIBL"),sw.prototype),re(sw.prototype,"envmap",[bh,ow],Object.getOwnPropertyDescriptor(sw.prototype,"envmap"),sw.prototype),re(sw.prototype,"isRGBE",[bh],Object.getOwnPropertyDescriptor(sw.prototype,"isRGBE"),sw.prototype),aw=sw))||aw);c.SkyboxInfo=$I;var eb=(fw=mh("cc.FogInfo"),mw=Vh(rE),dw=Rh(),pw=Vh(jt),vw=Ph(),gw=Lh(),yw=zh(),xw=Rh(),Ew=Vh(jt),Sw=Lh(),Tw=zh(),Aw=Rh(),Cw=Vh(jt),ww=Lh(),Iw=zh(),bw=Rh(),Rw=Vh(jt),Ow=Mh(),Nw=Lh(),Pw=zh(),Mw=Rh(),Dw=Vh(jt),Lw=Lh(),Fw=zh(),zw=Rh(),Bw=Vh(jt),Uw=Lh(),Gw=zh(),fw(($w=Jw=function(){function e(){ie(this,"_type",Vw,this),ie(this,"_fogColor",jw,this),ie(this,"_enabled",Ww,this),ie(this,"_fogDensity",qw,this),ie(this,"_fogStart",Yw,this),ie(this,"_fogEnd",Xw,this),ie(this,"_fogAtten",Kw,this),ie(this,"_fogTop",Qw,this),ie(this,"_fogRange",Zw,this),this._resource=null}return e.prototype.activate=function(e){this._resource=e,this._resource.initialize(this),this._resource.activate()},Z(e,[{key:"enabled",set:function(e){this._enabled!==e&&(this._enabled=e,this._resource&&(this._resource.enabled=e,e&&(this._resource.type=this._type)))},get:function(){return this._enabled}},{key:"fogColor",set:function(e){this._fogColor.set(e),this._resource&&(this._resource.fogColor=this._fogColor)},get:function(){return this._fogColor}},{key:"type",get:function(){return this._type},set:function(e){this._type=e,this._resource&&(this._resource.type=e)}},{key:"fogDensity",get:function(){return this._fogDensity},set:function(e){this._fogDensity=e,this._resource&&(this._resource.fogDensity=e)}},{key:"fogStart",get:function(){return this._fogStart},set:function(e){this._fogStart=e,this._resource&&(this._resource.fogStart=e)}},{key:"fogEnd",get:function(){return this._fogEnd},set:function(e){this._fogEnd=e,this._resource&&(this._resource.fogEnd=e)}},{key:"fogAtten",get:function(){return this._fogAtten},set:function(e){this._fogAtten=e,this._resource&&(this._resource.fogAtten=e)}},{key:"fogTop",get:function(){return this._fogTop},set:function(e){this._fogTop=e,this._resource&&(this._resource.fogTop=e)}},{key:"fogRange",get:function(){return this._fogRange},set:function(e){this._fogRange=e,this._resource&&(this._resource.fogRange=e)}}]),e}(),Jw.FogType=rE,Vw=re((kw=$w).prototype,"_type",[yh],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return rE.LINEAR}}),jw=re(kw.prototype,"_fogColor",[yh],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Dn("#C8C8C8")}}),Ww=re(kw.prototype,"_enabled",[yh],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),qw=re(kw.prototype,"_fogDensity",[yh],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.3}}),Yw=re(kw.prototype,"_fogStart",[yh],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.5}}),Xw=re(kw.prototype,"_fogEnd",[yh],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 300}}),Kw=re(kw.prototype,"_fogAtten",[yh],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 5}}),Qw=re(kw.prototype,"_fogTop",[yh],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1.5}}),Zw=re(kw.prototype,"_fogRange",[yh],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1.2}}),re(kw.prototype,"enabled",[bh],Object.getOwnPropertyDescriptor(kw.prototype,"enabled"),kw.prototype),re(kw.prototype,"fogColor",[bh],Object.getOwnPropertyDescriptor(kw.prototype,"fogColor"),kw.prototype),re(kw.prototype,"type",[bh,mw],Object.getOwnPropertyDescriptor(kw.prototype,"type"),kw.prototype),re(kw.prototype,"fogDensity",[dw,pw,vw,gw,Fh,yw],Object.getOwnPropertyDescriptor(kw.prototype,"fogDensity"),kw.prototype),re(kw.prototype,"fogStart",[xw,Ew,Sw,Tw],Object.getOwnPropertyDescriptor(kw.prototype,"fogStart"),kw.prototype),re(kw.prototype,"fogEnd",[Aw,Cw,ww,Iw],Object.getOwnPropertyDescriptor(kw.prototype,"fogEnd"),kw.prototype),re(kw.prototype,"fogAtten",[bw,Rw,Ow,Nw,Pw],Object.getOwnPropertyDescriptor(kw.prototype,"fogAtten"),kw.prototype),re(kw.prototype,"fogTop",[Mw,Dw,Lw,Fw],Object.getOwnPropertyDescriptor(kw.prototype,"fogTop"),kw.prototype),re(kw.prototype,"fogRange",[zw,Bw,Uw,Gw],Object.getOwnPropertyDescriptor(kw.prototype,"fogRange"),kw.prototype),Hw=kw))||Hw),tb=(eI=mh("cc.ShadowsInfo"),tI=Vh(hp),nI=Rh(),iI=Vh(jt),rI=Rh(),oI=Vh(_p),aI=Rh(),sI=Vh(Wt),cI=Rh(),lI=Vh(jt),uI=Rh(),hI=Vh(jt),_I=Rh(),fI=Vh(jt),mI=Rh(),dI=Vh(Vt),pI=Rh(),vI=Rh(),gI=Vh(jt),yI=Rh(),xI=Vh(jt),EI=Rh(),eI((BI=function(){function e(){ie(this,"_type",AI,this),ie(this,"_enabled",CI,this),ie(this,"_normal",wI,this),ie(this,"_distance",II,this),ie(this,"_shadowColor",bI,this),ie(this,"_autoAdapt",RI,this),ie(this,"_pcf",OI,this),ie(this,"_bias",NI,this),ie(this,"_near",PI,this),ie(this,"_far",MI,this),ie(this,"_aspect",DI,this),ie(this,"_orthoSize",LI,this),ie(this,"_maxReceived",FI,this),ie(this,"_size",zI,this),this._resource=null}var t=e.prototype;return t.setPlaneFromNode=function(e){e.getWorldRotation(ZI),this.normal=Fn.transformQuat(QI,KI,ZI),e.getWorldPosition(QI),this.distance=Fn.dot(this._normal,QI)},t.activate=function(e){this._resource=e,this._resource.initialize(this),this._resource.activate()},Z(e,[{key:"enabled",set:function(e){this._enabled!==e&&(this._enabled=e,this._resource&&(this._resource.enabled=e,e&&(this._resource.type=this._type)))},get:function(){return this._enabled}},{key:"type",set:function(e){this._type=e,this._resource&&(this._resource.type=e)},get:function(){return this._type}},{key:"shadowColor",set:function(e){this._shadowColor.set(e),this._resource&&(this._resource.shadowColor=e)},get:function(){return this._shadowColor}},{key:"normal",set:function(e){Fn.copy(this._normal,e),this._resource&&(this._resource.normal=e)},get:function(){return this._normal}},{key:"distance",set:function(e){this._distance=e,this._resource&&(this._resource.distance=e)},get:function(){return this._distance}},{key:"pcf",set:function(e){this._pcf=e,this._resource&&(this._resource.pcf=e)},get:function(){return this._pcf}},{key:"autoAdapt",set:function(e){this._autoAdapt=e,this._resource&&(this._resource.autoAdapt=e)},get:function(){return this._autoAdapt}},{key:"near",set:function(e){this._near=e,this._resource&&(this._resource.near=e)},get:function(){return this._near}},{key:"far",set:function(e){this._far=e,this._resource&&(this._resource.far=e)},get:function(){return this._far}},{key:"orthoSize",set:function(e){this._orthoSize=e,this._resource&&(this._resource.orthoSize=e)},get:function(){return this._orthoSize}},{key:"maxReceived",set:function(e){this._maxReceived=e,this._resource&&(this._resource.maxReceived=e)},get:function(){return this._maxReceived}},{key:"shadowMapSize",set:function(e){this._size.set(e),this._resource&&(this._resource.size=e,this._resource.shadowMapDirty=!0)},get:function(){return this._size}},{key:"aspect",set:function(e){this._aspect=e,this._resource&&(this._resource.aspect=e)},get:function(){return this._aspect}},{key:"bias",set:function(e){this._bias=e,this._resource&&(this._resource.bias=e)},get:function(){return this._bias}}]),e}(),AI=re((TI=BI).prototype,"_type",[yh],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return hp.Planar}}),CI=re(TI.prototype,"_enabled",[yh],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),wI=re(TI.prototype,"_normal",[yh],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Fn(0,1,0)}}),II=re(TI.prototype,"_distance",[yh],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),bI=re(TI.prototype,"_shadowColor",[yh],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Dn(0,0,0,76)}}),RI=re(TI.prototype,"_autoAdapt",[yh],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),OI=re(TI.prototype,"_pcf",[yh],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return _p.HARD}}),NI=re(TI.prototype,"_bias",[yh],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1e-5}}),PI=re(TI.prototype,"_near",[yh],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),MI=re(TI.prototype,"_far",[yh],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 30}}),DI=re(TI.prototype,"_aspect",[yh],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),LI=re(TI.prototype,"_orthoSize",[yh],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 5}}),FI=re(TI.prototype,"_maxReceived",[yh],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 4}}),zI=re(TI.prototype,"_size",[yh],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new ti(512,512)}}),re(TI.prototype,"enabled",[bh],Object.getOwnPropertyDescriptor(TI.prototype,"enabled"),TI.prototype),re(TI.prototype,"type",[bh,tI],Object.getOwnPropertyDescriptor(TI.prototype,"type"),TI.prototype),re(TI.prototype,"shadowColor",[bh],Object.getOwnPropertyDescriptor(TI.prototype,"shadowColor"),TI.prototype),re(TI.prototype,"normal",[nI],Object.getOwnPropertyDescriptor(TI.prototype,"normal"),TI.prototype),re(TI.prototype,"distance",[iI,rI],Object.getOwnPropertyDescriptor(TI.prototype,"distance"),TI.prototype),re(TI.prototype,"pcf",[oI,aI],Object.getOwnPropertyDescriptor(TI.prototype,"pcf"),TI.prototype),re(TI.prototype,"autoAdapt",[sI,cI],Object.getOwnPropertyDescriptor(TI.prototype,"autoAdapt"),TI.prototype),re(TI.prototype,"near",[lI,uI],Object.getOwnPropertyDescriptor(TI.prototype,"near"),TI.prototype),re(TI.prototype,"far",[hI,_I],Object.getOwnPropertyDescriptor(TI.prototype,"far"),TI.prototype),re(TI.prototype,"orthoSize",[fI,mI],Object.getOwnPropertyDescriptor(TI.prototype,"orthoSize"),TI.prototype),re(TI.prototype,"maxReceived",[dI,pI],Object.getOwnPropertyDescriptor(TI.prototype,"maxReceived"),TI.prototype),re(TI.prototype,"shadowMapSize",[vI],Object.getOwnPropertyDescriptor(TI.prototype,"shadowMapSize"),TI.prototype),re(TI.prototype,"aspect",[gI,yI],Object.getOwnPropertyDescriptor(TI.prototype,"aspect"),TI.prototype),re(TI.prototype,"bias",[xI,EI],Object.getOwnPropertyDescriptor(TI.prototype,"bias"),TI.prototype),SI=TI))||SI);c.ShadowsInfo=tb;var nb,ib,rb,ob,ab=(UI=mh("cc.SceneGlobals"),GI=Vh($I),UI((YI=function(){function e(){ie(this,"ambient",VI,this),ie(this,"shadows",jI,this),ie(this,"_skybox",WI,this),ie(this,"fog",qI,this)}return e.prototype.activate=function(){var e=c.director.root.pipeline;this.ambient.activate(e.ambient),this.skybox.activate(e.skybox),this.shadows.activate(e.shadows),this.fog.activate(e.fog)},Z(e,[{key:"skybox",get:function(){return this._skybox},set:function(e){this._skybox=e}}]),e}(),VI=re((kI=YI).prototype,"ambient",[yh,bh],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new JI}}),jI=re(kI.prototype,"shadows",[yh,bh],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new tb}}),WI=re(kI.prototype,"_skybox",[yh],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new $I}}),qI=re(kI.prototype,"fog",[bh,yh],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new eb}}),re(kI.prototype,"skybox",[bh,GI],Object.getOwnPropertyDescriptor(kI.prototype,"skybox"),kI.prototype),HI=kI))||HI);c.SceneGlobals=ab;var sb,cb=e("cP",mh("cc.Scene")((re((ib=function(e){$(n,e);var t=n.prototype;function n(t){var n;return ie(n=e.call(this,t)||this,"autoReleaseAssets",rb,ee(n)),ie(n,"_globals",ob,ee(n)),n._renderScene=null,n.dependAssets=null,n._inited=void 0,n._prefabSyncedInLiveReload=!1,n._pos=Fn.ZERO,n._rot=Vn.IDENTITY,n._scale=Fn.ONE,n._mat=Zn.IDENTITY,n._dirtyFlags=0,n._activeInHierarchy=!1,c.director&&c.director.root&&(n._renderScene=c.director.root.createScene({})),n._inited=!c.game||!c.game._isCloning,n}return t._updateScene=function(){this._scene=this},Z(n,[{key:"renderScene",get:function(){return this._renderScene}},{key:"globals",get:function(){return this._globals}}]),t.destroy=function(){var e=E_.prototype.destroy.call(this);if(e)for(var t=this._children,n=0;n<t.length;++n)t[n].active=!1;return c.director.root.destroyScene(this._renderScene),this._active=!1,this._activeInHierarchy=!1,e},t.addComponent=function(){throw new Error(M(3822))},t._onHierarchyChanged=function(){},t._onBatchCreated=function(t){e.prototype._onBatchCreated.call(this,t);for(var n=this._children.length,i=0;i<n;++i)this._children[i]._onBatchCreated(t);cT(this)},t.getPosition=function(e){return Fn.copy(e||new Fn,Fn.ZERO)},t.getRotation=function(e){return Vn.copy(e||new Vn,Vn.IDENTITY)},t.getScale=function(e){return Fn.copy(e||new Fn,Fn.ONE)},t.getWorldPosition=function(e){return Fn.copy(e||new Fn,Fn.ZERO)},t.getWorldRotation=function(e){return Vn.copy(e||new Vn,Vn.IDENTITY)},t.getWorldScale=function(e){return Fn.copy(e||new Fn,Fn.ONE)},t.getWorldMatrix=function(e){return Zn.copy(e||new Zn,Zn.IDENTITY)},t.getWorldRS=function(e){return Zn.copy(e||new Zn,Zn.IDENTITY)},t.getWorldRT=function(e){return Zn.copy(e||new Zn,Zn.IDENTITY)},t.updateWorldTransform=function(){},t._instantiate=function(){},t._load=function(){this._inited||(this._onBatchCreated(i),this._inited=!0),this.walk(TC._setScene)},t._activate=function(e){e=!1!==e,c.director._nodeActivator.activateNode(this,e),this._globals.activate()},Z(n,[{key:"position",get:function(){return Fn.ZERO}},{key:"worldPosition",get:function(){return Fn.ZERO}},{key:"rotation",get:function(){return Vn.IDENTITY}},{key:"worldRotation",get:function(){return Vn.IDENTITY}},{key:"scale",get:function(){return Fn.ONE}},{key:"worldScale",get:function(){return Fn.ONE}},{key:"eulerAngles",get:function(){return Fn.ZERO}},{key:"worldMatrix",get:function(){return Zn.IDENTITY}}]),n}(TC)).prototype,"globals",[bh],Object.getOwnPropertyDescriptor(ib.prototype,"globals"),ib.prototype),rb=re(ib.prototype,"autoReleaseAssets",[yh,bh],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),ob=re(ib.prototype,"_globals",[yh],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new ab}}),nb=ib))||nb);function lb(e,t){if(!t){var n=c.director.getScene();if(!n)return null;t=n}return t.getChildByPath(e)}c.Scene=cb,c.find=lb,E_.Flags.HideInHierarchy;var ub=e("ci",mh("cc.PrivateNode")(sb=function(e){function t(t){return e.call(this,t)||this}return $(t,e),t}(MC))||sb);c.PrivateNode=ub;var hb=mt.fastRemoveAt,_b=E_.Flags.IsStartCalled,fb=E_.Flags.IsOnEnableCalled;function mb(e,t){for(var n=t.constructor._executionOrder,i=t._id,r=0,o=e.length-1,a=o>>>1;r<=o;a=r+o>>>1){var s=e[a],c=s.constructor._executionOrder;if(c>n)o=a-1;else if(c<n)r=a+1;else{var l=s._id;if(l>i)o=a-1;else{if(!(l<i))return a;r=a+1}}}return~r}function db(e,t){for(var n=e.array,i=e.i+1;i<n.length;){var r=n[i];r._enabled&&r.node._activeInHierarchy?++i:(e.removeAt(i),t&&(r._objFlags&=~t))}}E_.Flags.IsEditorOnEnableCalled;var pb=function(e){this._zero=void 0,this._neg=void 0,this._pos=void 0,this._invoke=void 0;var t=Se;this._zero=new t([]),this._neg=new t([]),this._pos=new t([]),this._invoke=e};function vb(e,t){return e.constructor._executionOrder-t.constructor._executionOrder}pb.stableRemoveInactive=db;var gb=function(e){function t(){return e.apply(this,arguments)||this}$(t,e);var n=t.prototype;return n.add=function(e){var t=e.constructor._executionOrder;(0===t?this._zero:t<0?this._neg:this._pos).array.push(e)},n.remove=function(e){var t=e.constructor._executionOrder;(0===t?this._zero:t<0?this._neg:this._pos).fastRemove(e)},n.cancelInactive=function(e){db(this._zero,e),db(this._neg,e),db(this._pos,e)},n.invoke=function(){var e=this._neg;e.array.length>0&&(e.array.sort(vb),this._invoke(e),e.array.length=0),this._invoke(this._zero),this._zero.array.length=0;var t=this._pos;t.array.length>0&&(t.array.sort(vb),this._invoke(t),t.array.length=0)},t}(pb),yb=function(e){function t(){return e.apply(this,arguments)||this}$(t,e);var n=t.prototype;return n.add=function(e){var t=e.constructor._executionOrder;if(0===t)this._zero.array.push(e);else{var n=t<0?this._neg.array:this._pos.array,i=mb(n,e);i<0&&n.splice(~i,0,e)}},n.remove=function(e){var t=e.constructor._executionOrder;if(0===t)this._zero.fastRemove(e);else{var n=t<0?this._neg:this._pos,i=mb(n.array,e);i>=0&&n.removeAt(i)}},n.invoke=function(e){this._neg.array.length>0&&this._invoke(this._neg,e),this._invoke(this._zero,e),this._pos.array.length>0&&this._invoke(this._pos,e)},t}(pb);function xb(e,t,n){var i="var a=it.array;for(it.i=0;it.i<a.length;++it.i){var c=a[it.i];"+e+"}",r=t?Function("it","dt",i):Function("it",i);return function(e,t,n){return function(i,r){try{t(i,r)}catch(t){c._throw(t);var o=i.array;for(n&&(o[i.i]._objFlags|=n),++i.i;i.i<o.length;++i.i)try{e(o[i.i],r)}catch(e){c._throw(e),n&&(o[i.i]._objFlags|=n)}}}}(Function("c","dt",e),r,n)}var Eb=xb("c.start();c._objFlags|="+_b,!1,_b),Sb=xb("c.update(dt)",!0),Tb=xb("c.lateUpdate(dt)",!0),Ab=function(e){var t=c.director._compScheduler,n=e.array;for(e.i=0;e.i<n.length;++e.i){var i=n[e.i];i._enabled&&(i.onEnable(),!i.node._activeInHierarchy||t._onEnabled(i))}},Cb=function(){function e(){this._deferredComps=[],this.unscheduleAll()}var t=e.prototype;return t.unscheduleAll=function(){this.startInvoker=new gb(Eb),this.updateInvoker=new yb(Sb),this.lateUpdateInvoker=new yb(Tb),this._updating=!1},t._onEnabled=function(e){c.director.getScheduler().resumeTarget(e),e._objFlags|=fb,this._updating?this._deferredComps.push(e):this._scheduleImmediate(e)},t._onDisabled=function(e){c.director.getScheduler().pauseTarget(e),e._objFlags&=~fb;var t=this._deferredComps.indexOf(e);t>=0?hb(this._deferredComps,t):(!e.start||e._objFlags&_b||this.startInvoker.remove(e),e.update&&this.updateInvoker.remove(e),e.lateUpdate&&this.lateUpdateInvoker.remove(e))},t.enableComp=function(e,t){if(!(e._objFlags&fb)){if(e.onEnable){if(t)return void t.add(e);if(e.onEnable(),!e.node._activeInHierarchy)return}this._onEnabled(e)}},t.disableComp=function(e){e._objFlags&fb&&(e.onDisable&&e.onDisable(),this._onDisabled(e))},t.startPhase=function(){this._updating=!0,this.startInvoker.invoke(),this._startForNewComps()},t.updatePhase=function(e){this.updateInvoker.invoke(e)},t.lateUpdatePhase=function(e){this.lateUpdateInvoker.invoke(e),this._updating=!1,this._startForNewComps()},t._startForNewComps=function(){this._deferredComps.length>0&&(this._deferredSchedule(),this.startInvoker.invoke())},t._scheduleImmediate=function(e){"function"!=typeof e.start||e._objFlags&_b||this.startInvoker.add(e),"function"==typeof e.update&&this.updateInvoker.add(e),"function"==typeof e.lateUpdate&&this.lateUpdateInvoker.add(e)},t._deferredSchedule=function(){for(var e=this._deferredComps,t=0,n=e.length;t<n;t++)this._scheduleImmediate(e[t]);e.length=0},e}(),wb=E_.Flags.IsPreloadStarted,Ib=E_.Flags.IsOnLoadStarted,bb=E_.Flags.IsOnLoadCalled,Rb=E_.Flags.Deactivating,Ob=function(e){function t(){return e.apply(this,arguments)||this}$(t,e);var n=t.prototype;return n.add=function(e){this._zero.array.push(e)},n.remove=function(e){this._zero.fastRemove(e)},n.cancelInactive=function(e){pb.stableRemoveInactive(this._zero,e)},n.invoke=function(){this._invoke(this._zero),this._zero.array.length=0},t}(pb),Nb=xb("c.__preload();"),Pb=xb("c.onLoad();c._objFlags|="+bb,!1,bb),Mb=new ft(4);function Db(e,t,n){t?e._removeComponent(t):mt.removeAt(e._components,n)}Mb.get=function(){var e=this._get()||{preload:new Ob(Nb),onLoad:new gb(Pb),onEnable:new gb(Ab)};e.preload._zero.i=-1;var t=e.onLoad;return t._zero.i=-1,t._neg.i=-1,t._pos.i=-1,(t=e.onEnable)._zero.i=-1,t._neg.i=-1,t._pos.i=-1,e};var Lb=e("fq",function(){function e(){this.resetComp=void 0,this.reset()}var t=e.prototype;return t.reset=function(){this._activatingStack=[]},t.activateNode=function(e,t){if(t){var n=Mb.get();this._activatingStack.push(n),this._activateNodeRecursively(e,n.preload,n.onLoad,n.onEnable),n.preload.invoke(),n.onLoad.invoke(),n.onEnable.invoke(),this._activatingStack.pop(),Mb.put(n)}else{this._deactivateNodeRecursively(e);for(var i,r=ne(this._activatingStack);!(i=r()).done;){var o=i.value;o.preload.cancelInactive(wb),o.onLoad.cancelInactive(Ib),o.onEnable.cancelInactive()}}e.emit("active-in-hierarchy-changed",e)},t.activateComp=function(e,t,n,i){if(T_(e,!0)&&(e._objFlags&wb||(e._objFlags|=wb,e.__preload&&(t?t.add(e):e.__preload())),e._objFlags&Ib||(e._objFlags|=Ib,e.onLoad?n?n.add(e):(e.onLoad(),e._objFlags|=bb):e._objFlags|=bb),e._enabled)){if(!e.node._activeInHierarchy)return;c.director._compScheduler.enableComp(e,i)}},t.destroyComp=function(e){c.director._compScheduler.disableComp(e),e.onDestroy&&e._objFlags&bb&&e.onDestroy()},t._activateNodeRecursively=function(e,t,n,i){if(e._objFlags&Rb)R(3816,e.name);else{e._activeInHierarchy=!0;for(var r=e._components.length,o=0;o<r;++o){var a=e._components[o];a instanceof c.Component?this.activateComp(a,t,n,i):(Db(e,a,o),--o,--r)}e._childArrivalOrder=e._children.length;for(var s=0,l=e._children.length;s<l;++s){var u=e._children[s];u._active&&this._activateNodeRecursively(u,t,n,i)}e._onPostActivated(!0)}},t._deactivateNodeRecursively=function(e){e._objFlags|=Rb,e._activeInHierarchy=!1;for(var t=e._components.length,n=0;n<t;++n){var i=e._components[n];if(i._enabled&&(c.director._compScheduler.disableComp(i),e._activeInHierarchy))return void(e._objFlags&=~Rb)}for(var r=0,o=e._children.length;r<o;++r){var a=e._children[r];if(a._activeInHierarchy&&(this._deactivateNodeRecursively(a),e._activeInHierarchy))return void(e._objFlags&=~Rb)}e._onPostActivated(!1),e._objFlags&=~Rb},e}()),Fb=e("bZ",function(e){function t(){var t;return(t=e.call(this)||this)._compScheduler=void 0,t._nodeActivator=void 0,t._invalid=void 0,t._paused=void 0,t._purgeDirectorInNextLoop=void 0,t._root=void 0,t._loadingScene=void 0,t._scene=void 0,t._totalFrames=void 0,t._lastUpdate=void 0,t._deltaTime=void 0,t._startTime=void 0,t._scheduler=void 0,t._systems=void 0,t._invalid=!1,t._paused=!1,t._purgeDirectorInNextLoop=!1,t._root=null,t._loadingScene="",t._scene=null,t._totalFrames=0,t._lastUpdate=0,t._deltaTime=0,t._startTime=0,t._scheduler=new AA,t._compScheduler=new Cb,t._nodeActivator=new Lb,t._systems=[],c.game.once(eA.EVENT_RENDERER_INITED,t._initOnRendererInitialized,ee(t)),t}$(t,e);var n=t.prototype;return n.calculateDeltaTime=function(e){e||(e=performance.now()),this._deltaTime=e>this._lastUpdate?(e-this._lastUpdate)/1e3:0,this._lastUpdate=e},n.convertToGL=function(e){var t=c.game.container,n=c.view,i=t.getBoundingClientRect(),r=i.left+window.pageXOffset-t.clientLeft,o=i.top+window.pageYOffset-t.clientTop,a=n._devicePixelRatio*(e.x-r),s=n._devicePixelRatio*(o+i.height-e.y);return n._isRotated?ri(n._viewportRect.width-s,a):ri(a,s)},n.convertToUI=function(e){var t=c.game.container,n=c.view,i=t.getBoundingClientRect(),r=i.left+window.pageXOffset-t.clientLeft,o=i.top+window.pageYOffset-t.clientTop,a=ri(0,0);return n._isRotated?(a.x=r+e.y/n._devicePixelRatio,a.y=o+i.height-(n._viewportRect.width-e.x)/n._devicePixelRatio):(a.x=r+e.x*n._devicePixelRatio,a.y=o+i.height-e.y*n._devicePixelRatio),a},n.end=function(){this._purgeDirectorInNextLoop=!0},n.getWinSize=function(){return li(c.winSize)},n.getWinSizeInPixels=function(){return li(c.winSize)},n.pause=function(){this._paused||(this._paused=!0)},n.purgeCachedData=function(){c.assetManager.releaseAll()},n.purgeDirector=function(){this._scheduler.unscheduleAll(),this._compScheduler.unscheduleAll(),this._nodeActivator.reset(),WT&&WT.setEnabled(!1),c.isValid(this._scene)&&this._scene.destroy(),this._scene=null,this.stopAnimation(),c.assetManager.releaseAll()},n.reset=function(){this.purgeDirector(),this.emit(t.EVENT_RESET),WT&&WT.setEnabled(!0),this.startAnimation()},n.runSceneImmediate=function(e,t,n){e instanceof jA&&(e=e.scene),P(e instanceof cb,1216),e._load();for(var i=Object.keys(c.game._persistRootNodes).map((function(e){return c.game._persistRootNodes[e]})),r=0;r<i.length;r++){var o=i[r];o.emit(c.Node.SCENE_CHANGED_FOR_PERSISTS,e.renderScene);var a=e.getChildByUuid(o.uuid);if(a){var s=a.getSiblingIndex();a._destroyImmediate(),e.insertChild(o,s)}else o.parent=e}var l=this._scene;c.isValid(l)&&l.destroy(),c.assetManager._releaseManager._autoRelease(l,e,i),this._scene=null,E_._deferredDestroy(),t&&t(),this.emit(c.Director.EVENT_BEFORE_SCENE_LAUNCH,e),this._scene=e,e._activate(),this._root&&this._root.resetCumulativeTime(),this.startAnimation(),n&&n(null,e),this.emit(c.Director.EVENT_AFTER_SCENE_LAUNCH,e)},n.runScene=function(e,t,n){var i=this;e instanceof jA&&(e=e.scene),P(e,1205),P(e instanceof cb,1216),e._load(),this.once(c.Director.EVENT_AFTER_DRAW,(function(){i.runSceneImmediate(e,t,n)}))},n.loadScene=function(e,t,n){var i=this;if(this._loadingScene)return I(1208,e,this._loadingScene),!1;var r=c.assetManager.bundles.find((function(t){return t.getSceneInfo(e)}));return r?(this.emit(c.Director.EVENT_BEFORE_SCENE_LOADING,e),this._loadingScene=e,console.time("LoadScene "+e),r.loadScene(e,(function(r,o){console.timeEnd("LoadScene "+e),i._loadingScene="",r?(y(r),t&&t(r)):i.runSceneImmediate(o,n,t)})),!0):(R(1209,e),!1)},n.preloadScene=function(e,t,n){var i=c.assetManager.bundles.find((function(t){return t.getSceneInfo(e)}));if(i)i.preloadScene(e,null,t,n);else{var r='Can not preload the scene "'+e+'" because it is not in the build settings.';n&&n(new Error(r)),y("preloadScene: "+r)}},n.resume=function(){this._paused&&(this._lastUpdate=performance.now(),this._lastUpdate||C(1200),this._paused=!1,this._deltaTime=0)},n.setDepthTest=function(e){c.Camera.main&&(c.Camera.main.depth=!!e)},n.setClearColor=function(e){c.Camera.main&&(c.Camera.main.backgroundColor=e)},n.getRunningScene=function(){return this._scene},n.getScene=function(){return this._scene},n.getAnimationInterval=function(){return 1e3/c.game.getFrameRate()},n.setAnimationInterval=function(e){c.game.setFrameRate(Math.round(1e3/e))},n.getDeltaTime=function(){return this._deltaTime},n.getTotalTime=function(){return performance.now()-this._startTime},n.getCurrentTime=function(){return this._lastUpdate},n.getTotalFrames=function(){return this._totalFrames},n.isPaused=function(){return this._paused},n.getScheduler=function(){return this._scheduler},n.setScheduler=function(e){this._scheduler!==e&&(this.unregisterSystem(this._scheduler),this._scheduler=e,this.registerSystem(AA.ID,e,200))},n.registerSystem=function(e,t,n){t.id=e,t.priority=n,t.init(),this._systems.push(t),this._systems.sort(gA.sortByPriority)},n.unregisterSystem=function(e){mt.fastRemove(this._systems,e),this._systems.sort(gA.sortByPriority)},n.getSystem=function(e){return this._systems.find((function(t){return t.id===e}))},n.getAnimationManager=function(){return this.getSystem(c.AnimationManager.ID)},n.startAnimation=function(){this._invalid=!1,this._lastUpdate=performance.now()},n.stopAnimation=function(){this._invalid=!0},n.mainLoop=function(e){if(this._purgeDirectorInNextLoop)this._purgeDirectorInNextLoop=!1,this.purgeDirector();else if(!this._invalid){this.calculateDeltaTime(e);var n=this._deltaTime;if(!this._paused){this.emit(t.EVENT_BEFORE_UPDATE),this._compScheduler.startPhase(),this._compScheduler.updatePhase(n);for(var i=0;i<this._systems.length;++i)this._systems[i].update(n);this._compScheduler.lateUpdatePhase(n),this.emit(t.EVENT_AFTER_UPDATE),E_._deferredDestroy();for(var r=0;r<this._systems.length;++r)this._systems[r].postUpdate(n)}this.emit(t.EVENT_BEFORE_DRAW),this._root.frameMove(this._deltaTime),this.emit(t.EVENT_AFTER_DRAW),WT.frameUpdateListeners(),MC.bookOfChange.clear(),this._totalFrames++}},n._initOnRendererInitialized=function(){this._totalFrames=0,this._lastUpdate=performance.now(),this._startTime=this._lastUpdate,this._paused=!1,this._purgeDirectorInNextLoop=!1,WT&&WT.setEnabled(!0),this.registerSystem(AA.ID,this._scheduler,200),this.emit(t.EVENT_INIT)},n._init=function(){return this._root=new wA(c.game._gfxDevice),this._root.initialize({}).catch((function(e){return R(1217),Promise.reject(e)}))},Z(t,[{key:"root",get:function(){return this._root}}]),t}(z_));Fb.EVENT_INIT="director_init",Fb.EVENT_RESET="director_reset",Fb.EVENT_BEFORE_SCENE_LOADING="director_before_scene_loading",Fb.EVENT_BEFORE_SCENE_LAUNCH="director_before_scene_launch",Fb.EVENT_AFTER_SCENE_LAUNCH="director_after_scene_launch",Fb.EVENT_BEFORE_UPDATE="director_before_update",Fb.EVENT_AFTER_UPDATE="director_after_update",Fb.EVENT_BEFORE_DRAW="director_before_draw",Fb.EVENT_AFTER_DRAW="director_after_draw",Fb.EVENT_BEFORE_COMMIT="director_before_commit",Fb.EVENT_BEFORE_PHYSICS="director_before_physics",Fb.EVENT_AFTER_PHYSICS="director_after_physics",Fb.instance=void 0,c.Director=Fb;var zb=e("bY",Fb.instance=c.director=new Fb),Bb=function(){function e(){this.name="",this.base="",this.importBase="",this.nativeBase="",this.deps=null,this.assetInfos=new Wh,this.scenes=new Wh,this.paths=new Wh}var t=e.prototype;return t.init=function(e){!function(e){var t=e.uuids,n=e.paths,i=e.types,r=e.deps,o=e.paths=Object.create(null);if(!1===e.debug){for(var a=0,s=t.length;a<s;a++)t[a]=c_(t[a]);for(var c in n){var l=n[c],u=l[1];l[1]=i[u]}}else{for(var h=Object.create(null),_=0,f=t.length;_<f;_++){var m=t[_];t[_]=h[m]=c_(m)}t=h}for(var d in n){var p=n[d];o[t[d]]=p}var v=e.scenes;for(var g in v){var y=v[g];v[g]=t[y]}var x=e.packs;for(var E in x)for(var S=x[E],T=0;T<S.length;++T)S[T]=t[S[T]];var A=e.versions;if(A)for(var C in A)for(var w=A[C],I=0;I<w.length;I+=2){var b=w[I];w[I]=t[b]||b}var R=e.redirect;if(R)for(var O=0;O<R.length;O+=2)R[O]=t[R[O]],R[O+1]=r[R[O+1]]}(e),this.importBase=e.importBase||"",this.nativeBase=e.nativeBase||"",this.base=e.base||"",this.name=e.name||"",this.deps=e.deps||[],this._initUuid(e.uuids),this._initPath(e.paths),this._initScene(e.scenes),this._initPackage(e.packs),this._initVersion(e.versions),this._initRedirect(e.redirect)},t.getInfoWithPath=function(e,t){if(!e)return null;e=f_(e);var n=this.paths.get(e);if(n){if(!t)return n[0];for(var i=0,r=n.length;i<r;i++){var o=n[i];if(dt.isChildClassOf(o.ctor,t))return o}}return null},t.getDirWithPath=function(e,t,n){"/"===(e=f_(e))[e.length-1]&&(e=e.slice(0,-1));var i=n||[];return this.paths.forEach((function(n,r){if(r.startsWith(e)&&function(e,t){return!(e.length>t.length)||47===e.charCodeAt(t.length)}(r,e)||!e)for(var o=0,a=n.length;o<a;o++){var s=n[o];t&&!dt.isChildClassOf(s.ctor,t)||i.push(s)}})),i},t.getAssetInfo=function(e){return this.assetInfos.get(e)||null},t.getSceneInfo=function(e){return e.endsWith(".scene")||(e+=".scene"),"/"===e[0]||e.startsWith("db://")||(e="/"+e),this.scenes.find((function(t,n){return n.endsWith(e)}))},t.destroy=function(){this.paths.destroy(),this.scenes.destroy(),this.assetInfos.destroy()},t._initUuid=function(e){if(e){this.assetInfos.clear();for(var t=0,n=e.length;t<n;t++){var i=e[t];this.assetInfos.add(i,{uuid:i})}}},t._initPath=function(e){if(e){var t=this.paths;for(var n in t.clear(),e){var i=e[n],r=i[0],o=i[1],a=3===i.length,s=this.assetInfos.get(n);s.path=r,s.ctor=dt._getClassById(o),t.has(r)?a?t.get(r).push(s):t.get(r).splice(0,0,s):t.add(r,[s])}}},t._initScene=function(e){if(e){var t=this.scenes;t.clear();var n=this.assetInfos;for(var i in e){var r=e[i],o=n.get(r);o.url=i,t.add(i,o)}}},t._initPackage=function(e){if(e){var t=this.assetInfos;for(var n in e){var i=e[n],r={uuid:n,packedUuids:i,ext:".json"};t.add(n,r);for(var o=0,a=i.length;o<a;o++){var s=i[o],c=t.get(s),l=c.packs;l?1===a?l.splice(0,0,r):l.push(r):c.packs=[r]}}}},t._initVersion=function(e){if(e){var t=this.assetInfos,n=e.import;if(n)for(var i=0,r=n.length;i<r;i+=2){var o=n[i];t.get(o).ver=n[i+1]}if(n=e.native)for(var a=0,s=n.length;a<s;a+=2){var c=n[a];t.get(c).nativeVer=n[a+1]}}},t._initRedirect=function(e){if(e)for(var t=this.assetInfos,n=0,i=e.length;n<i;n+=2){var r=e[n];t.get(r).redirect=e[n+1]}},e}();function Ub(e,t){e._uuid&&t.push(e._uuid)}function Gb(e,t){for(var n=Object.getOwnPropertyNames(e),i=0;i<n.length;i++){var r=n[i];if("node"!==r&&"__eventTargets"!==r){var o=e[r];if("object"==typeof o&&o)if(Array.isArray(o))for(var a=0;a<o.length;a++){var s=o[a];s instanceof B_&&Ub(s,t)}else if(o.constructor&&o.constructor!==Object)o instanceof B_&&Ub(o,t);else for(var c=Object.getOwnPropertyNames(o),l=0;l<c.length;l++){var u=o[c[l]];u instanceof B_&&Ub(u,t)}}}}function Hb(e,t,n,i){n.push(e._uuid);for(var r=um.getDeps(e._uuid),o=0,a=r.length;o<a;o++){var s=Xh.get(r[o]);if(s){var c=s._uuid;c in t?t[c]+=i:t[c]=s.refCount+i,n.includes(c)||Hb(s,t,n,i)}}}var kb=[],Vb=new(function(){function e(){this._persistNodeDeps=new Wh,this._toDelete=new Wh,this._eventListener=!1}var t=e.prototype;return t.init=function(){this._persistNodeDeps.clear(),this._toDelete.clear()},t._addPersistNodeRef=function(e){var t=[];!function e(t,n){for(var i=0;i<t._components.length;i++)Gb(t._components[i],n);for(var r=0;r<t._children.length;r++)e(t._children[r],n)}(e,t);for(var n=0,i=t.length;n<i;n++){var r=Xh.get(t[n]);r&&r.addRef()}this._persistNodeDeps.add(e.uuid,t)},t._removePersistNodeRef=function(e){if(this._persistNodeDeps.has(e.uuid)){for(var t=this._persistNodeDeps.get(e.uuid),n=0,i=t.length;n<i;n++){var r=Xh.get(t[n]);r&&r.decRef()}this._persistNodeDeps.remove(e.uuid)}},t._autoRelease=function(e,t,n){if(e){for(var i=um.getDeps(e.uuid),r=0,o=i.length;r<o;r++){var a=Xh.get(i[r]);a&&a.decRef(e.autoReleaseAssets)}var s=um._depends.get(e.uuid);if(s&&s.persistDeps)for(var c=s.persistDeps,l=0,u=c.length;l<u;l++){var h=Xh.get(c[l]);h&&h.decRef(e.autoReleaseAssets)}e.uuid!==t.uuid&&um.remove(e.uuid)}var _=um._depends.get(t.uuid);_&&(_.persistDeps=[]);for(var f=0,m=n.length;f<m;f++){for(var d,p,v=n[f],g=this._persistNodeDeps.get(v.uuid),y=ne(g);!(p=y()).done;){var x=p.value,E=Xh.get(x);E&&E.addRef()}_&&(d=_.persistDeps).push.apply(d,g)}},t.tryRelease=function(e,t){void 0===t&&(t=!1),e instanceof B_&&(t?this._free(e,t):(this._toDelete.add(e._uuid,e),this._eventListener||(this._eventListener=!0,Pt(this._freeAssets.bind(this)))))},t._freeAssets=function(){var e=this;this._eventListener=!1,this._toDelete.forEach((function(t){e._free(t)})),this._toDelete.clear()},t._free=function(e,t){void 0===t&&(t=!1);var n=e._uuid;if(this._toDelete.remove(n),T_(e,!0)&&!(!t&&e.refCount>0&&function(e){var t=Object.create(null);if(t[e._uuid]=e.refCount,Hb(e,t,kb,-1),kb.length=0,0!==t[e._uuid])return t[e._uuid];for(var n in t)0!==t[n]&&Hb(Xh.get(n),t,kb,1);return kb.length=0,t[e._uuid]}(e)>0)){Xh.remove(n);for(var i=um.getDeps(n),r=0,o=i.length;r<o;r++){var a=Xh.get(i[r]);a&&(a.decRef(!1),this._free(a,!1))}e.destroy(),um.remove(n)}},e}()),jb=null;function Wb(e,t){for(var n=0,i=e.input.length;n<i;n++){var r=e.input[n];t&&!r.isNative&&r.content instanceof B_&&r.content.decRef(!1),r.recycle()}e.input=null}function qb(e,t){return t?/\?/.test(e)?e+"&_t="+Date.now():e+"?_t="+Date.now():e}function Yb(e,t,n,r,o,a,s){try{var c=um.parse(e,t),l=!0;if(t instanceof B_&&!t.__nativeDepend__&&(l=!1),o){for(var u=0,h=c.deps.length;u<h;u++){var _=c.deps[u];_ in n||(n[_]=!0,r.push({uuid:_,bundle:s&&s.name}))}l&&c.nativeDep&&(s&&(c.nativeDep.bundle=s.name),r.push(J({},c.nativeDep)))}else{a=!i&&(!!t.asyncLoadAssets||a&&!c.preventDeferredLoadDependents);for(var f=0,m=c.deps.length;f<m;f++){var d=c.deps[f];d in n||(n[d]=!0,r.push({uuid:d,__asyncLoadAssets__:a,bundle:s&&s.name}))}l&&!a&&!c.preventPreloadNativeObject&&c.nativeDep&&(s&&(c.nativeDep.bundle=s.name),r.push(J({},c.nativeDep)))}}catch(e){y(e.message,e.stack)}}function Xb(e,t,n){t&&(n=void 0!==n?n:c.assetManager.cacheAsset,!__(t)&&n&&Xh.add(e,t))}function Kb(e,t,n){var i=!1,r=t.__depends__;if(r){for(var o=0,a=r.length;o<a;o++){var s=r[o],c=n[s.uuid+"@import"];c?s.owner[s.prop]=c.addRef():(y("The asset "+s.uuid+" is missing!"),i=!0)}t.__depends__=null}return t.__nativeDepend__&&(n[e+"@native"]?t._nativeAsset=n[e+"@native"]:i=!0,t.__nativeDepend__=!1),i}function Qb(e,t,n){var i=0,r=[],o=e.length;0===o&&n&&n(r);for(var a=function(e){e&&r.push(e),++i===o&&n&&n(r)},s=0;s<o;s++)t(e[s],a)}function Zb(e,t,n){var i=e,r=t,o=n;if(void 0===n){var a="function"==typeof e;t?(o=t,a||(r=null)):void 0===t&&a&&(o=e,i=null,r=null),void 0!==t&&a&&(r=e,i=null)}return{options:i||Object.create(null),onProgress:r,onComplete:o}}function Jb(e,t,n){var i=e,r=t,o=n;if(void 0===n){var a=dt.isChildClassOf(e,B_);t?(o=t,a&&(r=null)):void 0!==t||a||(o=e,r=null,i=null),void 0===t||a||(r=e,i=null)}return{type:i,onProgress:r||jb,onComplete:o}}function $b(e){return function(t,n){if(e){var i=[];Array.isArray(n)?n.forEach((function(e){return e instanceof B_&&i.push(e.addRef())})):n instanceof B_&&i.push(n.addRef()),Pt((function(){i.forEach((function(e){return e.decRef(!1)})),e(t,n)}))}}}var eR=function(){function e(){this._config=new Bb}var t=e.prototype;return t.getInfoWithPath=function(e,t){return this._config.getInfoWithPath(e,t)},t.getDirWithPath=function(e,t,n){return this._config.getDirWithPath(e,t,n)},t.getAssetInfo=function(e){return this._config.getAssetInfo(e)},t.getSceneInfo=function(e){return this._config.getSceneInfo(e)},t.init=function(e){this._config.init(e),Zh.add(e.name,this)},t.load=function(e,t,n,i){var r=Jb(t,n,i),o=r.type,a=r.onProgress,s=r.onComplete,l={__requestType__:Yh.PATH,type:o,bundle:this.name,__outputAsArray__:Array.isArray(e)};c.assetManager.loadAny(e,l,a,s)},t.preload=function(e,t,n,i){var r=Jb(t,n,i),o=r.type,a=r.onProgress,s=r.onComplete;c.assetManager.preloadAny(e,{__requestType__:Yh.PATH,type:o,bundle:this.name},a,s)},t.loadDir=function(e,t,n,i){var r=Jb(t,n,i),o=r.type,a=r.onProgress,s=r.onComplete;c.assetManager.loadAny(e,{__requestType__:Yh.DIR,type:o,bundle:this.name,__outputAsArray__:!0},a,s)},t.preloadDir=function(e,t,n,i){var r=Jb(t,n,i),o=r.type,a=r.onProgress,s=r.onComplete;c.assetManager.preloadAny(e,{__requestType__:Yh.DIR,type:o,bundle:this.name},a,s)},t.loadScene=function(e,t,n,i){var r=Zb(t,n,i),o=r.options,a=r.onProgress,s=r.onComplete;o.preset=o.preset||"scene",o.bundle=this.name,c.assetManager.loadAny({scene:e},o,a,(function(e,t){if(e)y(e.message,e.stack);else if(t instanceof jA&&t.scene){var n=t.scene;n._id=t._uuid,n.name=t.name}else e=new Error("The asset "+t._uuid+" is not a scene");s&&s(e,t)}))},t.preloadScene=function(e,t,n,i){var r=Zb(t,n,i),o=r.options,a=r.onProgress,s=r.onComplete;o.bundle=this.name,c.assetManager.preloadAny({scene:e},o,a,(function(t){t&&R(1210,e,t.message),s&&s(t)}))},t.get=function(e,t){var n=this.getInfoWithPath(e,t);return n&&Xh.get(n.uuid)||null},t.release=function(e,t){var n=this.get(e,t);n&&Vb.tryRelease(n,!0)},t.releaseUnusedAssets=function(){var e=this;Xh.forEach((function(t){var n=e.getAssetInfo(t._uuid);n&&!n.redirect&&Vb.tryRelease(t)}))},t.releaseAll=function(){var e=this;Xh.forEach((function(t){var n=e.getAssetInfo(t._uuid);n&&!n.redirect&&Vb.tryRelease(t,!0)}))},t._destroy=function(){this._config.destroy()},Z(e,[{key:"config",get:function(){return this._config}},{key:"name",get:function(){return this._config.name}},{key:"deps",get:function(){return this._config.deps}},{key:"base",get:function(){return this._config.base}}]),e}(),tR=e("fk",new eR);function nR(e,t,n){var i=new Image;function r(){i.removeEventListener("load",r),i.removeEventListener("error",o),n&&n(null,i)}function o(){i.removeEventListener("load",r),i.removeEventListener("error",o),n&&n(new Error(M(4930,e)))}return"file:"!==window.location.protocol&&(i.crossOrigin="anonymous"),i.addEventListener("load",r),i.addEventListener("error",o),i.src=e,i}function iR(e,t,n,i){var r=new XMLHttpRequest,o="download failed: "+e+", status: ";if(r.open("GET",e,!0),void 0!==t.xhrResponseType&&(r.responseType=t.xhrResponseType),void 0!==t.xhrWithCredentials&&(r.withCredentials=t.xhrWithCredentials),void 0!==t.xhrMimeType&&r.overrideMimeType&&r.overrideMimeType(t.xhrMimeType),void 0!==t.xhrTimeout&&(r.timeout=t.xhrTimeout),t.xhrHeader)for(var a in t.xhrHeader)r.setRequestHeader(a,t.xhrHeader[a]);return r.onload=function(){200===r.status||0===r.status?i&&i(null,r.response):i&&i(new Error(""+o+r.status+"(no response)"))},n&&(r.onprogress=function(e){e.lengthComputable&&n(e.loaded,e.total)}),r.onerror=function(){i&&i(new Error(""+o+r.status+"(error)"))},r.ontimeout=function(){i&&i(new Error(""+o+r.status+"(time out)"))},r.onabort=function(){i&&i(new Error(""+o+r.status+"(abort)"))},r.send(null),r}c.resources=tR;var rR={};function oR(e,t,n){if(rR[e])return n&&n(null),null;var i=document.createElement("script");function r(){i.parentNode.removeChild(i),i.removeEventListener("load",r,!1),i.removeEventListener("error",o,!1),rR[e]=!0,n&&n(null)}function o(){i.parentNode.removeChild(i),i.removeEventListener("load",r,!1),i.removeEventListener("error",o,!1),n&&n(new Error(M(4928,e)))}return"file:"!==window.location.protocol&&(i.crossOrigin="anonymous"),i.async=t.scriptAsyncLoading||!1,i.src=e,i.addEventListener("load",r,!1),i.addEventListener("error",o,!1),document.body.appendChild(i),i}var aR=/^(?:\w+:\/\/|\.+\/).+/,sR=function(e,t,n){(wv.capabilities.imageBitmap&&c.assetManager.allowImageBitmap?cR:nR)(e,t,n)},cR=function(e,t,n){t.xhrResponseType="blob",iR(e,t,t.onFileProgress,n)},lR=function(e,t,n){t.xhrResponseType="json",iR(e,t,t.onFileProgress,n)},uR=function(e,t,n){t.xhrResponseType="arraybuffer",iR(e,t,t.onFileProgress,n)},hR=function(e,t,n){t.xhrResponseType="text",iR(e,t,t.onFileProgress,n)},_R=function(e,t,n){var i=V(e),r=e;aR.test(r)||(r=-1!==mR.remoteBundles.indexOf(i)?mR.remoteServerAddress+"remote/"+i:"assets/"+i);var o=t.version||mR.bundleVers[i],a=0,s=null,c=null;lR(r+"/config."+(o?o+".":"")+"json",t,(function(e,t){e&&(c=e),(s=t)&&(s.base=r+"/"),2==++a&&n(c,s)})),oR(r+"/index."+(o?o+".":"")+"js",t,(function(e){e?(c=e,2==++a&&n(e)):mR.importBundleEntry(i).then((function(){2==++a&&n(c,s)})).catch((function(e){c=e,2==++a&&n(c)}))}))},fR=function(){function e(){this.maxConcurrency=16,this.maxRequestsPerFrame=16,this.maxRetryCount=3,this.appendTimeStamp=!!i,this.limited=!i,this.retryInterval=2e3,this.bundleVers=null,this.remoteBundles=[],this.downloadDomImage=nR,this.downloadDomAudio=null,this.downloadFile=iR,this.downloadScript=oR,this._downloaders={".png":sR,".jpg":sR,".bmp":sR,".jpeg":sR,".gif":sR,".ico":sR,".tiff":sR,".webp":sR,".image":sR,".pvr":uR,".pkm":uR,".astc":uR,".txt":hR,".xml":hR,".vsh":hR,".fsh":hR,".atlas":hR,".tmx":hR,".tsx":hR,".json":lR,".ExportJson":lR,".plist":hR,".fnt":hR,".binary":uR,".bin":uR,".dbbin":uR,".skel":uR,".js":oR,bundle:_R,default:hR},this._downloading=new Wh,this._queue=[],this._queueDirty=!1,this._totalNum=0,this._totalNumThisPeriod=0,this._lastDate=-1,this._checkNextPeriod=!1,this._remoteServerAddress="",this._maxInterval=1/30}var n=e.prototype;return n.init=function(e,t,n){void 0===e&&(e=""),void 0===t&&(t={}),void 0===n&&(n=[]),this._downloading.clear(),this._queue.length=0,this._remoteServerAddress=e,this.bundleVers=t,this.remoteBundles=n},n.register=function(e,t){"object"==typeof e?Qe(this._downloaders,e):this._downloaders[e]=t},n.importBundleEntry=function(e){return t.import("virtual:///prerequisite-imports/"+e)},n.download=function(e,t,n,i,r){var o=this,a=Kh.get(e);if(a)r(null,a);else{var s=this._downloading.get(e);if(s){s.push(r);var c=this._queue.find((function(t){return t.id===e}));if(!c)return;var l=i.priority||0;c.priority<l&&(c.priority=l,this._queueDirty=!0)}else{var u=void 0!==i.maxRetryCount?i.maxRetryCount:this.maxRetryCount,h=void 0!==i.maxConcurrency?i.maxConcurrency:this.maxConcurrency,_=void 0!==i.maxRequestsPerFrame?i.maxRequestsPerFrame:this.maxRequestsPerFrame,f=this._downloaders[n]||this._downloaders.default;!function e(t,n,i,r,o){void 0===o&&(o=0),t(o,(function(a,s){o++,!a||o>n?r&&r(a,s):setTimeout((function(){e(t,n,i,r,o)}),i)}))}((function(n,a){if(0===n&&o._downloading.add(e,[r]),o.limited){o._updateTime();var s=function(e,t){o._totalNum--,o._handleQueueInNextFrame(h,_),a(e,t)};o._totalNum<h&&o._totalNumThisPeriod<_?(f(qb(t,o.appendTimeStamp),i,s),o._totalNum++,o._totalNumThisPeriod++):(o._queue.push({id:e,priority:i.priority||0,url:t,options:i,done:s,handler:f}),o._queueDirty=!0,o._totalNum<h&&o._handleQueueInNextFrame(h,_))}else f(qb(t,o.appendTimeStamp),i,a)}),u,this.retryInterval,(function(t,n){t||Kh.add(e,n);for(var i=o._downloading.remove(e),r=0,a=i.length;r<a;r++)i[r](t,n)}))}}},n.loadSubpackage=function(e,t){c.assetManager.loadBundle(e,null,t)},n._updateTime=function(){var e=Date.now(),t=c.director.getDeltaTime(),n=t>this._maxInterval?this._maxInterval:t;e-this._lastDate>1e3*n&&(this._totalNumThisPeriod=0,this._lastDate=e)},n._handleQueue=function(e,t){for(this._checkNextPeriod=!1,this._updateTime();this._queue.length>0&&this._totalNum<e&&this._totalNumThisPeriod<t;){this._queueDirty&&(this._queue.sort((function(e,t){return e.priority-t.priority})),this._queueDirty=!1);var n=this._queue.pop();if(!n)break;this._totalNum++,this._totalNumThisPeriod++,n.handler(qb(n.url,this.appendTimeStamp),n.options,n.done)}this._handleQueueInNextFrame(e,t)},n._handleQueueInNextFrame=function(e,t){!this._checkNextPeriod&&this._queue.length>0&&(Pt(this._handleQueue.bind(this),e,t),this._checkNextPeriod=!0)},Z(e,[{key:"remoteServerAddress",get:function(){return this._remoteServerAddress}}]),e}(),mR=e("cB",new fR);function dR(e,t,n,i){var r=null,o=null;try{(r=new K_)._nativeUrl=e,r._nativeAsset=t}catch(e){o=e}i(o,r)}function pR(e,t,n,i){var r=new QA;r.json=t,i(null,r)}function vR(e,t,n,i){var r=new KA;r.text=t,i(null,r)}function gR(e,t,n,i){var r=new NA;r._nativeUrl=e,r._nativeAsset=t,i(null,r)}function yR(e,t,n,i){var r=new B_;r._nativeUrl=e,r._nativeAsset=t,i(null,r)}function xR(e,t,n,i){var r=Zh.get(t.name);r||(r=t.name===t_.RESOURCES?tR:new eR,t.base=t.base||e+"/",r.init(t)),i(null,r)}var ER=function(){function e(){this._creating=new Wh,this._producers={".png":dR,".jpg":dR,".bmp":dR,".jpeg":dR,".gif":dR,".ico":dR,".tiff":dR,".webp":dR,".image":dR,".pvr":dR,".pkm":dR,".txt":vR,".xml":vR,".vsh":vR,".fsh":vR,".atlas":vR,".tmx":vR,".tsx":vR,".fnt":vR,".json":pR,".ExportJson":pR,".binary":gR,".bin":gR,".dbbin":gR,".skel":gR,bundle:xR,default:yR}}var t=e.prototype;return t.register=function(e,t){"object"==typeof e?dt.mixin(this._producers,e):this._producers[e]=t},t.create=function(e,t,n,i,r){var o=this,a=this._producers[n]||this._producers.default,s=Xh.get(e);if(i.reloadAsset||!s){var c=this._creating.get(e);c?c.push(r):(this._creating.add(e,[r]),a(e,t,i,(function(t,n){!t&&n instanceof B_&&(n._uuid=e,Xb(e,n,i.cacheAsset));for(var r=o._creating.remove(e),a=0,s=r.length;a<s;a++)r[a](t,n)})))}else r(null,s)},e}(),SR=e("cC",new ER),TR=new(function(){function e(){this._loading=new Wh,this._unpackers={".json":this.unpackJson}}var t=e.prototype;return t.unpackJson=function(e,t,n,i){var r=dt.createMap(!0),o=null;if(Array.isArray(t)){(t=function(e){if(e[0]<1)throw new Error(M(5304,e[0]));Nf(e,!0,void 0),Pf(e);for(var t=new zf(e[0]),n=e[1],i=e[2],r=e[3],o=e[4],a=e[5],s=0;s<a.length;++s)a[s].unshift(t,n,i,r,o);return a}(t)).length!==e.length&&R(4915);for(var a=0;a<e.length;a++)r[e[a]+"@import"]=t[a]}else{var s=dt._getClassId(wm);if(t.type===s&&t.data){var c=t.data;c.length!==e.length&&R(4915);for(var l=0;l<e.length;l++)r[e[l]+"@import"]=Bf(s,{base:c[l][0],mipmaps:c[l][1]})}else o=new Error("unmatched type pack!"),r=null}i(o,r)},t.init=function(){this._loading.clear()},t.register=function(e,t){"object"==typeof e?dt.mixin(this._unpackers,e):this._unpackers[e]=t},t.unpack=function(e,t,n,i,r){t?(0,this._unpackers[n])(e,t,i,r):r(new Error("package data is wrong!"))},t.load=function(e,t,n){var i=this;if(!e.isNative&&e.info&&e.info.packs)if(Kh.has(e.id))n(null,Kh.get(e.id));else{var r=e.info.packs,o=r.find((function(e){return i._loading.has(e.uuid)}));if(o)this._loading.get(o.uuid).push({onComplete:n,id:e.id});else{o=r[0],this._loading.add(o.uuid,[{onComplete:n,id:e.id}]);var a=m_(o.uuid,{ext:o.ext,bundle:e.config.name});mR.download(o.uuid,a,o.ext,e.options,(function(t,n){Kh.remove(o.uuid),t&&y(t.message,t.stack),i.unpack(o.packedUuids,n,o.ext,e.options,(function(e,n){if(!e)for(var r in n)Kh.add(r,n[r]);for(var a=i._loading.remove(o.uuid),s=0,c=a.length;s<c;s++){var l=a[s];if(t||e)l.onComplete(t||e);else{var u=n[l.id];u?l.onComplete(null,u):l.onComplete(new Error("can not retrieve data from package"))}}}))}))}}else mR.download(e.id,e.url,e.ext,e.options,n)},e}());function AR(e,t){var n=!1;e.progress||(e.progress={finish:0,total:e.input.length,canInvoke:!0},n=!0);var i=e.options,r=e.progress,o=[],a=r.total;i.__exclude__=i.__exclude__||Object.create(null),e.output=[],Qb(e.input,(function(i,s){if(!i.isNative&&Xh.has(i.uuid)){var l=Xh.get(i.uuid);return l.addRef(),wR(i,e,l,null,l.__asyncLoadAssets__,o,a),void s()}TR.load(i,e.options,(function(l,u){l?e.isFinish||(!c.assetManager.force||n?(y(l.message,l.stack),r.canInvoke=!1,t(l)):wR(i,e,null,null,!1,o,a)):e.isFinish||wR(i,e,null,u,!i.isNative,o,a),s()}))}),(function(){if(e.isFinish)return Wb(e,!0),void e.dispatch("error");if(o.length>0){var a=i_.create({input:o,progress:r,options:i,onProgress:e.onProgress,onError:i_.prototype.recycle,onComplete:function(i){var r;i||((r=e.output).push.apply(r,a.output),a.recycle()),n&&CR(e),t(i)}});$h.async(a)}else n&&CR(e),t()}))}function CR(e){for(var t=e.output,n=0,i=t.length;n<i;n++)t[n].content&&t[n].content.decRef(!1)}function wR(e,t,n,i,r,o,a){var s=t.options.__exclude__,c=t.progress;e.content=n,e.file=i,t.output.push(e),r&&(s[e.uuid]=!0,Yb(e.uuid,i||n,s,o,!0,!1,e.config),c.total=a+o.length),c.canInvoke&&t.dispatch("progress",++c.finish,c.total,e)}var IR=new(function(e){function t(){return e.apply(this,arguments)||this}$(t,e);var n=t.prototype;return n.parse=function(e){var t=this._parseXML(e).documentElement;if("plist"!==t.tagName)return I(5100),{};for(var n=null,i=0,r=t.childNodes.length;i<r&&1!==(n=t.childNodes[i]).nodeType;i++);return this._parseNode(n)},n._parseNode=function(e){var t=null,n=e.tagName;if("dict"===n)t=this._parseDict(e);else if("array"===n)t=this._parseArray(e);else if("string"===n)if(1===e.childNodes.length)t=e.firstChild.nodeValue;else{t="";for(var i=0;i<e.childNodes.length;i++)t+=e.childNodes[i].nodeValue}else"false"===n?t=!1:"true"===n?t=!0:"real"===n?t=parseFloat(e.firstChild.nodeValue):"integer"===n&&(t=parseInt(e.firstChild.nodeValue,10));return t},n._parseArray=function(e){for(var t=[],n=0,i=e.childNodes.length;n<i;n++){var r=e.childNodes[n];1===r.nodeType&&t.push(this._parseNode(r))}return t},n._parseDict=function(e){for(var t={},n="",i=0,r=e.childNodes.length;i<r;i++){var o=e.childNodes[i];1===o.nodeType&&("key"===o.tagName?n=o.firstChild.nodeValue:t[n]=this._parseNode(o))}return t},t}(function(){function e(){this._parser=null,window.DOMParser&&(this._parser=new DOMParser)}var t=e.prototype;return t.parse=function(e){return this._parseXML(e)},t._parseXML=function(e){if(this._parser)return this._parser.parseFromString(e,"text/xml");throw new Error("Dom parser is not supported in this platform!")},e}()));function bR(e,t){return e[t]<<8|e[t+1]}var RR=new(function(){function e(){this._parsing=new Wh,this._parsers={".png":this.parseImage,".jpg":this.parseImage,".bmp":this.parseImage,".jpeg":this.parseImage,".gif":this.parseImage,".ico":this.parseImage,".tiff":this.parseImage,".webp":this.parseImage,".image":this.parseImage,".pvr":this.parsePVRTex,".pkm":this.parsePKMTex,".astc":this.parseASTCTex,".mp3":this.parseAudio,".ogg":this.parseAudio,".wav":this.parseAudio,".m4a":this.parseAudio,".plist":this.parsePlist,import:this.parseImport}}var t=e.prototype;return t.parseImage=function(e,t,n){e instanceof HTMLImageElement?n(null,e):createImageBitmap(e,{premultiplyAlpha:"none"}).then((function(e){n(null,e)}),(function(e){n(e,null)}))},t.parseAudio=function(e,t,n){e instanceof ArrayBuffer?wv.__audioSupport.context.decodeAudioData(e,(function(e){n(null,e)}),(function(e){n(new Error("Error with decoding audio data"+e.err),null)})):n(null,e)},t.parsePVRTex=function(e,t,n){var i=null,r=null;try{var o=e instanceof ArrayBuffer?e:e.buffer,a=new Int32Array(o,0,13);if(55727696===a[0]){var s=a[7],c=a[6],l=a[12]+52;r={_data:new Uint8Array(o,l),_compressed:!0,width:s,height:c,format:0}}else{if(559044176!==a[11])throw new Error("Invalid magic number in PVR header");var u=a[0],h=a[1],_=a[2];r={_data:new Uint8Array(o,u),_compressed:!0,width:_,height:h,format:0}}}catch(e){i=e}n(i,r)},t.parsePKMTex=function(e,t,n){var i=null,r=null;try{var o=e instanceof ArrayBuffer?e:e.buffer,a=new Uint8Array(o),s=bR(a,6);if(0!==s&&1!==s&&3!==s)throw new Error("Invalid magic number in ETC header");var c=bR(a,12),l=bR(a,14);bR(a,8),bR(a,10),r={_data:new Uint8Array(o,16),_compressed:!0,width:c,height:l,format:0}}catch(e){i=e}n(i,r)},t.parseASTCTex=function(e,t,n){var i=null,r=null;try{var o=e instanceof ArrayBuffer?e:e.buffer,a=new Uint8Array(o);if(1554098963!==a[0]+(a[1]<<8)+(a[2]<<16)+(a[3]<<24))throw new Error("Invalid magic number in ASTC header");var s=a[4],c=a[5],l=a[6];if((s<3||s>6||c<3||c>6||l<3||l>6)&&(s<4||7===s||9===s||11===s||s>12||c<4||7===c||9===c||11===c||c>12||1!==l))throw new Error("Invalid block number in ASTC header");var u=function(e,t){return 4===e?U_.RGBA_ASTC_4x4:5===e?4===t?U_.RGBA_ASTC_5x4:U_.RGBA_ASTC_5x5:6===e?5===t?U_.RGBA_ASTC_6x5:U_.RGBA_ASTC_6x6:8===e?5===t?U_.RGBA_ASTC_8x5:6===t?U_.RGBA_ASTC_8x6:U_.RGBA_ASTC_8x8:10===e?5===t?U_.RGBA_ASTC_10x5:6===t?U_.RGBA_ASTC_10x6:8===t?U_.RGBA_ASTC_10x8:U_.RGBA_ASTC_10x10:10===t?U_.RGBA_ASTC_12x10:U_.RGBA_ASTC_12x12}(s,c),h=a[7]+(a[8]<<8)+(a[9]<<16),_=a[10]+(a[11]<<8)+(a[12]<<16);a[13],a[14],a[15],r={_data:new Uint8Array(o,16),_compressed:!0,width:h,height:_,format:u}}catch(e){i=e}n(i,r)},t.parsePlist=function(e,t,n){var i=null,r=IR.parse(e);r||(i=new Error("parse failed")),n(i,r)},t.parseImport=function(e,t,n){if(e){var i=null,r=null;try{i=cm(e,t)}catch(e){r=e}n(r,i)}else n(new Error("The json file of asset "+t.__uuid__+" is empty or missing"))},t.init=function(){this._parsing.clear()},t.register=function(e,t){"object"==typeof e?Qe(this._parsers,e):this._parsers[e]=t},t.parse=function(e,t,n,i,r){var o=this,a=Qh.get(e);if(a)r(null,a);else{var s=this._parsing.get(e);if(s)s.push(r);else{var c=this._parsers[n];c?(this._parsing.add(e,[r]),c(t,i,(function(t,n){t?Kh.remove(e):__(n)||Qh.add(e,n);for(var i=o._parsing.remove(e),r=0,a=i.length;r<a;r++)i[r](t,n)}))):r(null,t)}}},e}());function OR(e,t){var n=!1;e.progress||(e.progress={finish:0,total:e.input.length,canInvoke:!0},n=!0);var i=e.options,r=e.progress;i.__exclude__=i.__exclude__||Object.create(null),e.output=[],Qb(e.input,(function(o,a){var s=i_.create({input:o,onProgress:e.onProgress,options:i,progress:r,onComplete:function(i,l){i&&!e.isFinish&&(!c.assetManager.force||n?(y(i.message,i.stack),r.canInvoke=!1,t(i)):r.canInvoke&&e.dispatch("progress",++r.finish,r.total,o)),e.output.push(l),s.recycle(),a(null)}});NR.async(s)}),(function(){if(i.__exclude__=null,e.isFinish)return Wb(e,!0),void e.dispatch("error");!function(e){var t=e.source;if(e.options.__outputAsArray__||1!==t.length)for(var n=e.output=[],i=0,r=t.length;i<r;i++)n.push(t[i].content);else e.output=t[0].content}(e),Wb(e,!0),t()}))}var NR=new qh("loadOneAsset",[function(e,t){var n=e.output=e.input,i=n.options,r=n.isNative,o=n.uuid,a=n.file,s=i.reloadAsset;a||!s&&!r&&Xh.has(o)?t():TR.load(n,e.options,(function(e,i){n.file=i,t(e)}))},function(e,t){var n=e.output=e.input,i=e.progress,r=e.options.__exclude__,o=n.id,a=n.file,s=n.options;if(n.isNative)RR.parse(o,a,n.ext,s,(function(r,a){r?t(r):(n.content=a,i.canInvoke&&e.dispatch("progress",++i.finish,i.total,n),Kh.remove(o),Qh.remove(o),t())}));else{var c=n.uuid;if(c in r){var l=r[c],u=l.finish,h=l.content,_=l.err,f=l.callbacks;i.canInvoke&&e.dispatch("progress",++i.finish,i.total,n),u||function e(t,n,i,r){if(void 0===r&&(r={}),!i[n]||r[n])return!1;r[n]=!0;var o=!1,a=um.getDeps(n);if(a)for(var s=0,c=a.length;s<c;s++){var l=a[s];if(l===t||e(t,l,i,r)){o=!0;break}}return o}(c,c,r)?(h&&h.addRef(),n.content=h,t(_)):f.push({done:t,item:n})}else if(!s.reloadAsset&&Xh.has(c)){var m=Xh.get(c);s.__asyncLoadAssets__||!m.__asyncLoadAssets__?(n.content=m.addRef(),i.canInvoke&&e.dispatch("progress",++i.finish,i.total,n),t()):PR(e,m,t,!1)}else s.__uuid__=c,RR.parse(o,a,"import",s,(function(n,i){n?t(n):PR(e,i,t,!0)}))}}]);function PR(e,t,n,i){var r=e.input,o=e.progress,a=r,s=a.uuid,c=a.id,l=a.options,u=a.config,h=l.__asyncLoadAssets__,_=l.cacheAsset,f=[];t.addRef&&t.addRef(),Yb(s,t,Object.create(null),f,!1,h,u),o.canInvoke&&e.dispatch("progress",++o.finish,o.total+=f.length,r);var m=e.options.__exclude__[s]={content:t,finish:!1,callbacks:[{done:n,item:r}]},d=i_.create({input:f,options:e.options,onProgress:e.onProgress,onError:i_.prototype.recycle,progress:o,onComplete:function(e){if(t.decRef&&t.decRef(!1),t.__asyncLoadAssets__=h,m.finish=!0,m.err=e,!e){for(var n,r=Array.isArray(d.output)?d.output:[d.output],o=Object.create(null),a=ne(r);!(n=a()).done;){var l=n.value;l&&(o[l instanceof B_?l._uuid+"@import":s+"@native"]=l)}if(i){Kb(s,t,o);try{!t.onLoaded||t.__onLoadedInvoked__||t.__nativeDepend__||(t.onLoaded(),t.__onLoadedInvoked__=!0)}catch(e){y(e.message,e.stack)}Kh.remove(c),Qh.remove(c),Xb(s,t,_)}else if(t.__nativeDepend__){Kb(s,t,o);try{!t.onLoaded||t.__onLoadedInvoked__||t.__nativeDepend__||(t.onLoaded(),t.__onLoadedInvoked__=!0)}catch(e){y(e.message,e.stack)}}d.recycle()}for(var u=m.callbacks,f=0,p=u.length;f<p;f++){var v=u[f];t.addRef&&t.addRef(),v.item.content=t,v.done(e)}u.length=0}});Jh.async(d)}function MR(e,t){var n=e.options,i=Object.create(null),r=Object.create(null);for(var o in n)switch(o){case Yh.PATH:case Yh.UUID:case Yh.DIR:case Yh.SCENE:case Yh.URL:break;case"__requestType__":case"__isNative__":case"ext":case"type":case"__nativeName__":case"audioLoadMode":case"bundle":i[o]=n[o];break;case"__exclude__":case"__outputAsArray__":r[o]=n[o];break;default:i[o]=n[o],r[o]=n[o]}e.options=r;var a=i_.create({input:e.input,options:i}),s=null;try{e.output=e.source=e_.sync(a)}catch(e){s=e;for(var c=0,l=a.output.length;c<l;c++)a.output[c].recycle()}a.recycle(),t(s)}var DR=function(){function e(){this.uuid="",this.url="",this.ext=".json",this.content=null,this.file=null,this.info=null,this.config=null,this.isNative=!1,this.options=Object.create(null),this._id=""}return e.create=function(){return 0!==e._deadPool.length?e._deadPool.pop():new e},e.prototype.recycle=function(){e._deadPool.length!==e.MAX_DEAD_NUM&&(this._id="",this.uuid="",this.url="",this.ext=".json",this.content=null,this.file=null,this.info=null,this.config=null,this.isNative=!1,this.options=Object.create(null),e._deadPool.push(this))},Z(e,[{key:"id",get:function(){return this._id||(this._id=this.uuid+"@"+(this.isNative?"native":"import")),this._id}}]),e}();DR.MAX_DEAD_NUM=500,DR._deadPool=[];var LR=[];function FR(e){var t=e.options,n=Array.isArray(e.input)?e.input:[e.input];e.output=[];for(var i=function(i){var r=n[i],o=DR.create(),a=null,s=null;if("string"==typeof r&&((r=Object.create(null))[t.__requestType__||Yh.UUID]=n[i]),"object"==typeof r)for(var c in Ke(r,t),r.preset&&Ke(r,n_[r.preset]),r){switch(c){case Yh.UUID:if("break"===function(){var e=o.uuid=c_(r.uuid);if(!r.bundle){var t=Zh.find((function(t){return!!t.getAssetInfo(e)}));r.bundle=t&&t.name}if(Zh.has(r.bundle)){if(a=Zh.get(r.bundle).config,(s=a.getAssetInfo(e))&&s.redirect){if(!Zh.has(s.redirect))throw new Error("Please load bundle "+s.redirect+" first");a=Zh.get(s.redirect).config,s=a.getAssetInfo(e)}o.config=a,o.info=s}return o.ext=r.ext||".json","break"}())break;case"__requestType__":case"ext":case"bundle":case"preset":case"type":break;case Yh.DIR:if(Zh.has(r.bundle)){Zh.get(r.bundle).config.getDirWithPath(r.dir,r.type,LR);for(var l,u=ne(LR);!(l=u()).done;){var h=l.value;n.push({uuid:h.uuid,__isNative__:!1,ext:".json",bundle:r.bundle})}LR.length=0}o.recycle(),o=null;break;case Yh.PATH:if(Zh.has(r.bundle)){if(a=Zh.get(r.bundle).config,(s=a.getInfoWithPath(r.path,r.type))&&s.redirect){if(!Zh.has(s.redirect))throw new Error("you need to load bundle "+s.redirect+" first");a=Zh.get(s.redirect).config,s=a.getAssetInfo(s.uuid)}if(!s)throw o.recycle(),new Error("Bundle "+r.bundle+" doesn't contain "+r.path);o.config=a,o.uuid=s.uuid,o.info=s}o.ext=r.ext||".json";break;case Yh.SCENE:if(!r.bundle){var _=Zh.find((function(e){return!!e.getSceneInfo(r.scene)}));r.bundle=_&&_.name}if(Zh.has(r.bundle)){if(a=Zh.get(r.bundle).config,(s=a.getSceneInfo(r.scene))&&s.redirect){if(!Zh.has(s.redirect))throw new Error("you need to load bundle "+s.redirect+" first");a=Zh.get(s.redirect).config,s=a.getAssetInfo(s.uuid)}if(!s)throw o.recycle(),new Error("Bundle "+a.name+" doesn't contain scene "+r.scene);o.config=a,o.uuid=s.uuid,o.info=s}break;case"__isNative__":o.isNative=r.__isNative__;break;case Yh.URL:o.url=r.url,o.uuid=r.uuid||r.url,o.ext=r.ext||H(r.url),o.isNative=void 0===r.__isNative__||r.__isNative__;break;default:o.options[c]=r[c]}if(!o)break}if(!o)return"continue";if(e.output.push(o),!o.uuid&&!o.url)throw new Error("Can not parse this input:"+JSON.stringify(r))},r=0;r<n.length;r++)i(r);return null}function zR(e){for(var t=e.output=e.input,n=0;n<t.length;n++){var i=t[n];if(!i.url){var r,o,a=i.config;o=i.isNative?a&&a.nativeBase?a.base+a.nativeBase:c.assetManager.generalNativeBase:a&&a.importBase?a.base+a.importBase:c.assetManager.generalImportBase;var s=i.uuid,l="";i.info&&(l=i.isNative?i.info.nativeVer?"."+i.info.nativeVer:"":i.info.ver?"."+i.info.ver:""),r=".ttf"===i.ext?o+"/"+s.slice(0,2)+"/"+s+l+"/"+i.options.__nativeName__:o+"/"+s.slice(0,2)+"/"+s+l+i.ext,i.url=r}}return null}var BR=e("fj",function(){function e(){this.pipeline=Jh.append(MR).append(OR),this.fetchPipeline=$h.append(MR).append(AR),this.transformPipeline=e_.append(FR).append(zR),this.bundles=Zh,this.assets=Xh,this.generalImportBase="",this.generalNativeBase="",this.dependUtil=um,this.force=!!i,this.allowImageBitmap=!wv.isMobile,this.utils=d_,this.downloader=mR,this.parser=RR,this.packManager=TR,this.cacheAsset=!0,this.cacheManager=null,this.presets=n_,this.factory=SR,this.preprocessPipe=MR,this.fetchPipe=AR,this.loadPipe=OR,this.references=null,this._releaseManager=Vb,this._files=Kh,this._parsed=Qh,this._parsePipeline=null}var t=e.prototype;return t.init=function(e){void 0===e&&(e={}),this._files.clear(),this._parsed.clear(),this._releaseManager.init(),this.assets.clear(),this.bundles.clear(),this.packManager.init(),this.downloader.init(e.server,e.bundleVers,e.remoteBundles),this.parser.init(),this.dependUtil.init();var t=e.importBase||"";t&&t.endsWith("/")&&(t=t.substr(0,t.length-1));var n=e.nativeBase||"";n&&n.endsWith("/")&&(n=n.substr(0,n.length-1)),this.generalImportBase=t,this.generalNativeBase=n},t.getBundle=function(e){return Zh.get(e)||null},t.removeBundle=function(e){e._destroy(),Zh.remove(e.name)},t.loadAny=function(e,t,n,i){var r=Zb(t,n,i),o=r.options,a=r.onProgress,s=r.onComplete;o.preset=o.preset||"default",e=Array.isArray(e)?e.slice():e;var c=new i_({input:e,onProgress:a,onComplete:$b(s),options:o});Jh.async(c)},t.preloadAny=function(e,t,n,i){var r=Zb(t,n,i),o=r.options,a=r.onProgress,s=r.onComplete;o.preset=o.preset||"preload",e=Array.isArray(e)?e.slice():e;var c=new i_({input:e,onProgress:a,onComplete:$b(s),options:o});$h.async(c)},t.postLoadNative=function(e,t,n){var i=Zb(t,void 0,n),r=i.options,o=i.onComplete;if(e._native&&e.__nativeDepend__){var a=um.getNativeDep(e._uuid);if(a){if(!Zh.has(a.bundle)){var s=Zh.find((function(t){return!!t.getAssetInfo(e._uuid)}));s&&(a.bundle=s.name)}this.loadAny(a,r,(function(t,n){t?y(t.message,t.stack):e.isValid&&e.__nativeDepend__&&(e._nativeAsset=n,e.__nativeDepend__=!1),o&&o(t)}))}}else $b(o)(null)},t.loadRemote=function(e,t,n){var i=Zb(t,void 0,n),r=i.options,o=i.onComplete;r.reloadAsset||!this.assets.has(e)?(r.__isNative__=!0,r.preset=r.preset||"remote",this.loadAny({url:e},r,null,(function(t,n){t?(y(t.message,t.stack),o&&o(t,n)):SR.create(e,n,r.ext||H(e),r,(function(e,t){o&&o(e,t)}))}))):$b(o)(null,this.assets.get(e))},t.loadBundle=function(e,t,n){var i=Zb(t,void 0,n),r=i.options,o=i.onComplete,a=V(e);this.bundles.has(a)?$b(o)(null,this.getBundle(a)):(r.preset=r.preset||"bundle",r.ext="bundle",r.__isNative__=!0,this.loadAny({url:e},r,null,(function(t,n){t?(y(t.message,t.stack),o&&o(t,n)):SR.create(e,n,"bundle",r,(function(e,t){o&&o(e,t)}))})))},t.releaseAsset=function(e){Vb.tryRelease(e,!0)},t.releaseUnusedAssets=function(){Xh.forEach((function(e){Vb.tryRelease(e)}))},t.releaseAll=function(){Xh.forEach((function(e){Vb.tryRelease(e,!0)}))},t.loadWithJson=function(){throw new Error("Only valid in Editor")},Z(e,[{key:"main",get:function(){return Zh.get(t_.MAIN)||null}},{key:"resources",get:function(){return Zh.get(t_.RESOURCES)||null}}]),e}());BR.Pipeline=qh,BR.Task=i_,BR.Cache=Wh,BR.RequestItem=DR,BR.Bundle=eR,BR.BuiltinBundleName=t_;var UR=e("ch",c.assetManager=new BR);c.AssetManager=BR;var GR=[".png",".jpg",".bmp",".jpeg",".gif",".ico",".tiff",".webp",".image",".pvr",".pkm",".astc"],HR=[".mp3",".ogg",".wav",".m4a"];function kR(){return!0}var VR={transformURL:function(e){var t=u_(e);if(!t)return e;var n=Zh.find((function(e){return!!e.getAssetInfo(t)}));if(!n)return e;var i,r=n.getAssetInfo(t);if(!(i=e.startsWith(n.base+n.config.nativeBase)?r.nativeVer||"":r.ver||"")||-1!==e.indexOf(i))return e;var o=!1;if(".ttf"===H(e)&&(o=!0),o){var a=j(e),s=V(e);e=a+"."+i+"/"+s}else e=e.replace(/.*[/\\][0-9a-fA-F]{2}[/\\]([0-9a-fA-F-@]{8,}).*/,(function(e){return e+"."+i}));return e}},jR=e("fl",function(){function e(){this._autoReleaseSetting=Object.create(null),this._parseLoadResArgs=Jb}var t=e.prototype;return t.load=function(e,t,n){void 0===n&&void 0!==t&&(n=t,t=null);for(var i=Array.isArray(e)?e:[e],r=0;r<i.length;r++){var o=i[r];"string"==typeof o?i[r]={url:o,__isNative__:!0}:(o.type&&(o.ext="."+o.type,o.type=void 0),o.url&&(o.__isNative__=!0))}var a=[],s=[];UR.loadAny(i,null,(function(e,n,i){i.content&&(GR.includes(i.ext)?a.push(i.content):HR.includes(i.ext)&&s.push(i.content)),t&&t(e,n,i)}),(function(e,t){var r=null;if(!e){t=Array.isArray(t)?t:[t];for(var o=function(e){var n=t[e];if(!(n instanceof B_)){var r=n,o=i[e].url;a.includes(r)?SR.create(o,n,".png",{},(function(n,i){r=t[e]=i})):s.includes(r)&&SR.create(o,n,".mp3",{},(function(n,i){r=t[e]=i})),Xh.add(o,r)}},c=0;c<t.length;c++)o(c);if(t.length>1){var l=Object.create(null);t.forEach((function(e){l[e._uuid]=e})),r={isCompleted:kR,_map:l}}else r=t[0]}n&&n(e,r)}))},t.getXMLHttpRequest=function(){return new XMLHttpRequest},t.getItem=function(e){return UR.assets.has(e)?{content:UR.assets.get(e)}:null},t.loadRes=function(e,t,n,i){var r=this._parseLoadResArgs(t,n,i),o=r.type,a=r.onProgress,s=r.onComplete,c=H(e);c&&!tR.getInfoWithPath(e,o)&&(e=e.slice(0,-c.length)),tR.load(e,o,a,s)},t.loadResArray=function(e,t,n,i){var r=this._parseLoadResArgs(t,n,i),o=r.type,a=r.onProgress,s=r.onComplete;e.forEach((function(t,n){var i=H(t);i&&!tR.getInfoWithPath(t,o)&&(e[n]=t.slice(0,-i.length))})),tR.load(e,o,a,s)},t.loadResDir=function(e,t,n,i){var r=this._parseLoadResArgs(t,n,i),o=r.type,a=r.onProgress,s=r.onComplete;tR.loadDir(e,o,a,(function(t,n){var i=[];t||(i=tR.getDirWithPath(e,o).map((function(e){return e.path}))),s&&s(t,n,i)}))},t.getRes=function(e,t){return Xh.has(e)?Xh.get(e):tR.get(e,t)},t.getResCount=function(){return Xh.count},t.getDependsRecursively=function(e){if(!e)return[];var t="string"==typeof e?e:e._uuid;return um.getDepsRecursively(t).concat([t])},t.addDownloadHandlers=function(e){var t=Object.create(null),n=function(n){var i=e[n];t["."+n]=function(e,t,n){i({url:e},n)}};for(var i in e)n(i);mR.register(t)},t.addLoadHandlers=function(e){var t=Object.create(null),n=function(n){var i=e[n];t["."+n]=function(e,t,n){i({content:e},n)}};for(var i in e)n(i);RR.register(t)},t.release=function(e){if(Array.isArray(e))for(var t=0;t<e.length;t++){var n=e[t];"string"==typeof n&&(n=Xh.get(n)),UR.releaseAsset(n)}else e&&("string"==typeof e&&(e=Xh.get(e)),UR.releaseAsset(e))},t.releaseAsset=function(e){UR.releaseAsset(e)},t.releaseRes=function(e,t){tR.release(e,t)},t.releaseAll=function(){UR.releaseAll(),Xh.clear()},t.removeItem=function(e){return!!Xh.remove(e)},t.setAutoRelease=function(e,t){"object"==typeof e&&(e=e._uuid),this._autoReleaseSetting[e]=!!t},t.setAutoReleaseRecursively=function(e,t){"object"==typeof e&&(e=e._uuid),t=!!t,this._autoReleaseSetting[e]=t;for(var n=um.getDepsRecursively(e),i=0;i<n.length;i++)this._autoReleaseSetting[n[i]]=t},t.isAutoRelease=function(e){return"object"==typeof e&&(e=e._uuid),!!this._autoReleaseSetting[e]},Z(e,[{key:"onProgress",set:function(e){jb=e}},{key:"_cache",get:function(){return Xh._map}},{key:"md5Pipe",get:function(){return VR}},{key:"downloader",get:function(){return mR}},{key:"loader",get:function(){return UR.parser}}]),e}()),WR=e("fm",new jR),qR=e("fn",{init:function(e){e.importBase=e.libraryPath,e.nativeBase=e.rawAssetsBase,UR.init(e),e.rawAssets&&tR.init({base:"",deps:[],scenes:{},redirect:[],debug:!0,packs:{},types:[],versions:{import:[],native:[]},name:t_.RESOURCES,importBase:e.importBase,nativeBase:e.nativeBase,paths:e.rawAssets.assets,uuids:Object.keys(e.rawAssets.assets)})},loadAsset:function(e,t){UR.loadAny(e,t)}}),YR=e("fo",{});me(YR,"url",[{name:"normalize",target:UR.utils,targetName:"assetManager.utils",newName:"normalize"},{name:"raw",targetName:"Asset.prototype",newName:"nativeUrl",customFunction:function(e){return e.startsWith("resources/")?m_({path:W(e.substr(10)),bundle:t_.RESOURCES,__isNative__:!0,ext:H(e)}):""}}]),de(qR,"AssetLibrary",[{name:"getLibUrlNoExt",suggest:"AssetLibrary.getLibUrlNoExt was removed, if you want to transform url, please use cc.assetManager.utils.getUrlWithUuid instead"},{name:"queryAssetInfo",suggest:"AssetLibrary.queryAssetInfo was removed"}]),de(WR,"loader",[{name:"releaseResDir",suggest:"loader.releaseResDir was removed, please use assetManager.releaseAsset instead"},{name:"flowInDeps",suggest:"loader.flowInDeps was removed"},{name:"assetLoader",suggest:"cc.loader.assetLoader was removed, assetLoader and md5Pipe were merged into cc.assetManager.transformPipeline"}]),me(c,"cc",[{name:"loader",newName:"assetManager",logTimes:1,customGetter:function(){return WR}},{name:"AssetLibrary",newName:"assetManager",logTimes:1,customGetter:function(){return qR}},{name:"Pipeline",target:BR,targetName:"AssetManager",newName:"Pipeline",logTimes:1},{name:"url",targetName:"assetManager",newName:"utils",logTimes:1,customGetter:function(){return YR}}]),de(c,"cc",[{name:"LoadingItems",suggest:M(1400,"cc.LoadingItems","cc.AssetManager.Task")}]),me(St,"macro",[{name:"DOWNLOAD_MAX_CONCURRENT",target:mR,targetName:"assetManager.downloader",newName:"maxConcurrency"}]),me(zb,"director",[{name:"_getSceneUuid",targetName:"assetManager.main",newName:"getSceneInfo",customFunction:function(e){var t;return UR.main?null===(t=UR.main.getSceneInfo(e))||void 0===t?void 0:t.uuid:""}}]),me(tA,"game",[{name:"_sceneInfos",targetName:"assetManager.main",newName:"getSceneInfo",customGetter:function(){var e=[];return UR.main&&UR.main.config.scenes.forEach((function(t){e.push(t)})),e}}]);var XR,KR,QR,ZR,JR,$R,eO,tO,nO,iO,rO=Vb._autoRelease;Vb._autoRelease=function(e,t,n){rO.call(Vb,e,t,n);for(var i=WR._autoReleaseSetting,r=Object.keys(i),o=0;o<r.length;o++){var a=r[o];if(!0===i[a]){var s=Xh.get(a);s&&Vb.tryRelease(s)}}};var oO,aO,sO,cO,lO,uO,hO,_O,fO,mO,dO,pO,vO,gO,yO,xO,EO,SO,TO,AO,CO,wO,IO,bO,RO,OO,NO,PO,MO,DO,LO,FO,zO,BO,UO,GO,HO,kO,VO,jO,WO,qO,YO,XO,KO,QO,ZO,JO,$O,eN,tN,nN,iN,rN,oN,aN,sN,cN,lN,uN,hN,_N,fN,mN,dN,pN,vN,gN=e("cD",(XR=mh("cc.ClickEvent"),KR=Vh(c.Node),XR((iO=function(){function e(){ie(this,"target",JR,this),ie(this,"component",$R,this),ie(this,"_componentId",eO,this),ie(this,"handler",tO,this),ie(this,"customEventData",nO,this)}e.emitEvents=function(t){for(var n=arguments.length,i=new Array(n>1?n-1:0),r=1;r<n;r++)i[r-1]=arguments[r];for(var o=0,a=t.length;o<a;o++){var s=t[o];s instanceof e&&s.emit(i)}};var t=e.prototype;return t.emit=function(e){var t=this.target;if(c.isValid(t)){this._genCompIdIfNeeded();var n=c.js._getClassById(this._componentId),i=t.getComponent(n);if(c.isValid(i)){var r=i[this.handler];"function"==typeof r&&(null!=this.customEventData&&""!==this.customEventData&&(e=e.slice()).push(this.customEventData),r.apply(i,e))}}},t._compName2Id=function(e){var t=c.js.getClassByName(e);return c.js._getClassId(t)},t._compId2Name=function(e){var t=c.js._getClassById(e);return c.js.getClassName(t)},t._genCompIdIfNeeded=function(){this._componentId||(this._componentName=this.component,this.component="")},Z(e,[{key:"_componentName",get:function(){return this._genCompIdIfNeeded(),this._compId2Name(this._componentId)},set:function(e){this._componentId=this._compName2Id(e)}}]),e}(),JR=re((ZR=iO).prototype,"target",[KR],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),$R=re(ZR.prototype,"component",[yh,bh],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),eO=re(ZR.prototype,"_componentId",[yh],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),tO=re(ZR.prototype,"handler",[yh,bh],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),nO=re(ZR.prototype,"customEventData",[yh,bh],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),QR=ZR))||QR));c.Component.EventHandler=gN;var yN,xN,EN,SN,TN,AN,CN,wN,IN,bN,RN=new Fn,ON=vt(ku),NN=vt(Hu),PN=vt(Vu),MN=vt(Wu),DN=vt(ju),LN=vt({SKYBOX:ih|Ca.DEPTH_STENCIL,SOLID_COLOR:Ca.ALL,DEPTH_ONLY:Ca.DEPTH_STENCIL,DONT_CLEAR:Ca.NONE}),FN=e("cd",(oO=mh("cc.Camera"),aO=Ih(),sO=Th(),cO=zh(),lO=Nh(),uO=Vh(ql.BitMask),hO=zh(),_O=Nh(),fO=Vh(LN),mO=zh(),dO=Nh(),pO=zh(),vO=Nh(),gO=zh(),yO=Nh(),xO=zh(),EO=Nh(),SO=Vh(ON),TO=zh(),AO=Nh(),CO=Vh(NN),wO=zh(),IO=Nh(),bO=zh(),RO=Nh(),OO=zh(),NO=Nh(),PO=zh(),MO=Nh(),DO=zh(),LO=Nh(),FO=Vh(PN),zO=zh(),BO=Nh(),UO=Vh(MN),GO=zh(),HO=Nh(),kO=Vh(DN),VO=zh(),jO=Nh(),WO=zh(),qO=Nh(),YO=Vh(lp),XO=zh(),KO=Nh(),oO(QO=aO(QO=sO(QO=Sh((vN=pN=function(e){function t(){for(var t,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return ie(t=e.call.apply(e,[this].concat(i))||this,"_projection",JO,ee(t)),ie(t,"_priority",$O,ee(t)),ie(t,"_fov",eN,ee(t)),ie(t,"_fovAxis",tN,ee(t)),ie(t,"_orthoHeight",nN,ee(t)),ie(t,"_near",iN,ee(t)),ie(t,"_far",rN,ee(t)),ie(t,"_color",oN,ee(t)),ie(t,"_depth",aN,ee(t)),ie(t,"_stencil",sN,ee(t)),ie(t,"_clearFlags",cN,ee(t)),ie(t,"_rect",lN,ee(t)),ie(t,"_aperture",uN,ee(t)),ie(t,"_shutter",hN,ee(t)),ie(t,"_iso",_N,ee(t)),ie(t,"_screenScale",fN,ee(t)),ie(t,"_visibility",mN,ee(t)),ie(t,"_targetTexture",dN,ee(t)),t._camera=null,t._inEditorMode=!1,t._flows=void 0,t}$(t,e);var n=t.prototype;return n.onLoad=function(){this._createCamera()},n.onEnable=function(){this.node.hasChangedFlags|=Qu.POSITION,this._camera&&this._attachToScene()},n.onDisable=function(){this._camera&&this._detachFromScene()},n.onDestroy=function(){this._camera&&(this._camera.destroy(),this._camera=null),this._targetTexture&&this._targetTexture.off("resize")},n.screenPointToRay=function(e,t,n){return n||(n=zo.create()),this._camera&&this._camera.screenPointToRay(n,e,t),n},n.worldToScreen=function(e,t){return t||(t=new Fn),this._camera&&this._camera.worldToScreen(t,e),t},n.screenToWorld=function(e,t){return t||(t=this.node.getWorldPosition()),this._camera&&this._camera.screenToWorld(t,e),t},n.convertToUINode=function(e,t,n){if(n||(n=new Fn),!this._camera)return n;this.worldToScreen(e,RN);var i=t.getComponent("cc.UITransform"),r=lA.getVisibleSize(),o=RN.x-.5*this._camera.width,a=RN.y-.5*this._camera.height;return RN.x=o/c.view.getScaleX()+.5*r.width,RN.y=a/c.view.getScaleY()+.5*r.height,i&&i.convertToNodeSpaceAR(RN,n),n},n._createCamera=function(){this._camera||(this._camera=c.director.root.createCamera(),this._camera.initialize({name:this.node.name,node:this.node,projection:this._projection,window:this._inEditorMode?c.director.root&&c.director.root.mainWindow:c.director.root&&c.director.root.tempWindow,priority:this._priority}),this._camera.viewport=this._rect,this._camera.fovAxis=this._fovAxis,this._camera.fov=xn(this._fov),this._camera.orthoHeight=this._orthoHeight,this._camera.nearClip=this._near,this._camera.farClip=this._far,this._camera.clearColor=this._color,this._camera.clearDepth=this._depth,this._camera.clearStencil=this._stencil,this._camera.clearFlag=this._clearFlags,this._camera.visibility=this._visibility,this._camera.aperture=this._aperture,this._camera.shutter=this._shutter,this._camera.iso=this._iso),this._updateTargetTexture()},n._attachToScene=function(){this.node.scene&&this._camera&&(this._camera&&this._camera.scene&&this._camera.scene.removeCamera(this._camera),this._getRenderScene().addCamera(this._camera))},n._detachFromScene=function(){this._camera&&this._camera.scene&&this._camera.scene.removeCamera(this._camera)},n._chechTargetTextureEvent=function(e){var t=this;e&&e.off("resize"),this._targetTexture&&this._targetTexture.on("resize",(function(e){t._camera&&t._camera.setFixedSize(e.width,e.height)}),this)},n._updateTargetTexture=function(){if(this._camera&&this._targetTexture){var e=this._targetTexture.window;this._camera.changeTargetWindow(e),this._camera.setFixedSize(e.width,e.height)}},Z(t,[{key:"camera",get:function(){return this._camera}},{key:"priority",get:function(){return this._priority},set:function(e){this._priority=e,this._camera&&(this._camera.priority=e)}},{key:"visibility",get:function(){return this._visibility},set:function(e){this._visibility=e,this._camera&&(this._camera.visibility=e)}},{key:"clearFlags",get:function(){return this._clearFlags},set:function(e){this._clearFlags=e,this._camera&&(this._camera.clearFlag=e)}},{key:"clearColor",get:function(){return this._color},set:function(e){this._color.set(e),this._camera&&(this._camera.clearColor=this._color)}},{key:"clearDepth",get:function(){return this._depth},set:function(e){this._depth=e,this._camera&&(this._camera.clearDepth=e)}},{key:"clearStencil",get:function(){return this._stencil},set:function(e){this._stencil=e,this._camera&&(this._camera.clearStencil=e)}},{key:"projection",get:function(){return this._projection},set:function(e){this._projection=e,this._camera&&(this._camera.projectionType=e)}},{key:"fovAxis",get:function(){return this._fovAxis},set:function(e){e!==this._fovAxis&&(this._fovAxis=e,this._camera&&(this._camera.fovAxis=e,e===Hu.VERTICAL?this.fov=this._fov*this._camera.aspect:this.fov=this._fov/this._camera.aspect))}},{key:"fov",get:function(){return this._fov},set:function(e){this._fov=e,this._camera&&(this._camera.fov=xn(e))}},{key:"orthoHeight",get:function(){return this._orthoHeight},set:function(e){this._orthoHeight=e,this._camera&&(this._camera.orthoHeight=e)}},{key:"near",get:function(){return this._near},set:function(e){this._near=e,this._camera&&(this._camera.nearClip=e)}},{key:"far",get:function(){return this._far},set:function(e){this._far=e,this._camera&&(this._camera.farClip=e)}},{key:"aperture",get:function(){return this._aperture},set:function(e){this._aperture=e,this._camera&&(this._camera.aperture=e)}},{key:"shutter",get:function(){return this._shutter},set:function(e){this._shutter=e,this._camera&&(this._camera.shutter=e)}},{key:"iso",get:function(){return this._iso},set:function(e){this._iso=e,this._camera&&(this._camera.iso=e)}},{key:"rect",get:function(){return this._rect},set:function(e){this._rect=e,this._camera&&(this._camera.viewport=e)}},{key:"targetTexture",get:function(){return this._targetTexture},set:function(e){if(this._targetTexture!==e){var t=this._targetTexture;this._targetTexture=e,this._chechTargetTextureEvent(t),this._updateTargetTexture(),!e&&this._camera&&(this._camera.changeTargetWindow(null),this._camera.isWindowSize=!0)}}},{key:"screenScale",get:function(){return this._screenScale},set:function(e){this._screenScale=e,this._camera&&(this._camera.screenScale=e)}},{key:"inEditorMode",get:function(){return this._inEditorMode},set:function(e){this._inEditorMode=e,this._camera&&this._camera.changeTargetWindow(e?c.director.root&&c.director.root.mainWindow:c.director.root&&c.director.root.tempWindow)}}]),t}(om),pN.ProjectionType=ON,pN.FOVAxis=NN,pN.ClearFlag=LN,pN.Aperture=PN,pN.Shutter=MN,pN.ISO=DN,JO=re((ZO=vN).prototype,"_projection",[yh],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return ON.PERSPECTIVE}}),$O=re(ZO.prototype,"_priority",[yh],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),eN=re(ZO.prototype,"_fov",[yh],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 45}}),tN=re(ZO.prototype,"_fovAxis",[yh],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return NN.VERTICAL}}),nN=re(ZO.prototype,"_orthoHeight",[yh],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 10}}),iN=re(ZO.prototype,"_near",[yh],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),rN=re(ZO.prototype,"_far",[yh],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1e3}}),oN=re(ZO.prototype,"_color",[yh],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Dn("#333333")}}),aN=re(ZO.prototype,"_depth",[yh],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),sN=re(ZO.prototype,"_stencil",[yh],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),cN=re(ZO.prototype,"_clearFlags",[yh],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return LN.SOLID_COLOR}}),lN=re(ZO.prototype,"_rect",[yh],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new ui(0,0,1,1)}}),uN=re(ZO.prototype,"_aperture",[yh],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return PN.F16_0}}),hN=re(ZO.prototype,"_shutter",[yh],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return MN.D125}}),_N=re(ZO.prototype,"_iso",[yh],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return DN.ISO100}}),fN=re(ZO.prototype,"_screenScale",[yh],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),mN=re(ZO.prototype,"_visibility",[yh],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return qu}}),dN=re(ZO.prototype,"_targetTexture",[yh],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),re(ZO.prototype,"priority",[cO,lO],Object.getOwnPropertyDescriptor(ZO.prototype,"priority"),ZO.prototype),re(ZO.prototype,"visibility",[uO,hO,_O],Object.getOwnPropertyDescriptor(ZO.prototype,"visibility"),ZO.prototype),re(ZO.prototype,"clearFlags",[fO,mO,dO],Object.getOwnPropertyDescriptor(ZO.prototype,"clearFlags"),ZO.prototype),re(ZO.prototype,"clearColor",[pO,vO],Object.getOwnPropertyDescriptor(ZO.prototype,"clearColor"),ZO.prototype),re(ZO.prototype,"clearDepth",[gO,yO],Object.getOwnPropertyDescriptor(ZO.prototype,"clearDepth"),ZO.prototype),re(ZO.prototype,"clearStencil",[xO,EO],Object.getOwnPropertyDescriptor(ZO.prototype,"clearStencil"),ZO.prototype),re(ZO.prototype,"projection",[SO,TO,AO],Object.getOwnPropertyDescriptor(ZO.prototype,"projection"),ZO.prototype),re(ZO.prototype,"fovAxis",[CO,wO,IO],Object.getOwnPropertyDescriptor(ZO.prototype,"fovAxis"),ZO.prototype),re(ZO.prototype,"fov",[bO,RO],Object.getOwnPropertyDescriptor(ZO.prototype,"fov"),ZO.prototype),re(ZO.prototype,"orthoHeight",[OO,NO],Object.getOwnPropertyDescriptor(ZO.prototype,"orthoHeight"),ZO.prototype),re(ZO.prototype,"near",[PO,MO],Object.getOwnPropertyDescriptor(ZO.prototype,"near"),ZO.prototype),re(ZO.prototype,"far",[DO,LO],Object.getOwnPropertyDescriptor(ZO.prototype,"far"),ZO.prototype),re(ZO.prototype,"aperture",[FO,zO,BO],Object.getOwnPropertyDescriptor(ZO.prototype,"aperture"),ZO.prototype),re(ZO.prototype,"shutter",[UO,GO,HO],Object.getOwnPropertyDescriptor(ZO.prototype,"shutter"),ZO.prototype),re(ZO.prototype,"iso",[kO,VO,jO],Object.getOwnPropertyDescriptor(ZO.prototype,"iso"),ZO.prototype),re(ZO.prototype,"rect",[WO,qO],Object.getOwnPropertyDescriptor(ZO.prototype,"rect"),ZO.prototype),re(ZO.prototype,"targetTexture",[YO,XO,KO],Object.getOwnPropertyDescriptor(ZO.prototype,"targetTexture"),ZO.prototype),QO=ZO))||QO)||QO)||QO)||QO));c.Camera=FN;var zN,BN,UN,GN,HN,kN,VN,jN,WN={parent:null,owner:null,subModelIdx:0},qN=e("b4",(yN=mh("cc.RenderableComponent"),xN=Vh([up]),EN=Vh(up),SN=zh(),TN=Oh(),yN((bN=function(e){function t(){for(var t,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return ie(t=e.call.apply(e,[this].concat(i))||this,"_materials",wN,ee(t)),ie(t,"_visFlags",IN,ee(t)),t._materialInstances=[],t._models=[],t}$(t,e);var n=t.prototype;return n.getMaterial=function(e){return e<0||e>=this._materials.length?null:this._materials[e]},n.setMaterial=function(e,t){e&&e instanceof pp&&console.error("Can't set a material instance to a sharedMaterial slot"),this._materials[t]=e;var n=this._materialInstances[t];n?n.parent!==this._materials[t]&&(n.destroy(),this._materialInstances[t]=null,this._onMaterialModified(t,this._materials[t])):this._onMaterialModified(t,this._materials[t])},n.getMaterialInstance=function(e){if(!this._materials[e])return null;if(!this._materialInstances[e]){WN.parent=this._materials[e],WN.owner=this,WN.subModelIdx=e;var t=new pp(WN);this.setMaterialInstance(e,t)}return this._materialInstances[e]},n.setMaterialInstance=function(e,t){t&&t.parent?t!==this._materialInstances[e]&&(this._materialInstances[e]=t,this._onMaterialModified(e,t)):t!==this._materials[e]&&this.setMaterial(t,e)},n.getRenderMaterial=function(e){return this._materialInstances[e]||this._materials[e]},n._collectModels=function(){return this._models},n._attachToScene=function(){},n._detachFromScene=function(){},n._onMaterialModified=function(){},n._onRebuildPSO=function(){},n._clearMaterials=function(){},n._onVisibilityChange=function(){},Z(t,[{key:"visibility",get:function(){return this._visFlags},set:function(e){this._visFlags=e,this._onVisibilityChange(e)}},{key:"sharedMaterials",get:function(){return this._materials},set:function(e){for(var t=0;t<e.length;t++)e[t]!==this._materials[t]&&this.setMaterial(e[t],t);if(e.length<this._materials.length){for(var n=e.length;n<this._materials.length;n++)this.setMaterial(null,n);this._materials.splice(e.length)}}},{key:"materials",get:function(){for(var e=0;e<this._materials.length;e++)this._materialInstances[e]=this.getMaterialInstance(e);return this._materialInstances},set:function(e){var t=e.length-this._materials.length;if(t>0)this._materials.length=e.length,this._materialInstances.length=e.length;else if(t<0)for(var n=this._materials.length-t;n<this._materials.length;++n)this.setMaterialInstance(n,null);for(var i=0;i<this._materialInstances.length;i++)this._materialInstances[i]!=e[i]&&this.setMaterialInstance(i,e[i])}},{key:"sharedMaterial",get:function(){return this.getMaterial(0)}},{key:"material",get:function(){return this.getMaterialInstance(0)},set:function(e){1===this._materials.length&&this._materials[0]===e||this.setMaterialInstance(0,e)}}]),t}(om),wN=re((CN=bN).prototype,"_materials",[xN],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),IN=re(CN.prototype,"_visFlags",[yh],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return ql.Enum.NONE}}),re(CN.prototype,"sharedMaterials",[EN,SN,TN],Object.getOwnPropertyDescriptor(CN.prototype,"sharedMaterials"),CN.prototype),AN=CN))||AN));function YN(e){return"string"==typeof e||"number"==typeof e}function XN(e,t){return e instanceof t}c.RenderableComponent=qN,me(FN,"Camera",[{name:"CameraClearFlag",newName:"ClearFlag"}]),me(FN.prototype,"Camera.prototype",[{name:"color",newName:"clearColor"},{name:"depth",newName:"clearDepth"},{name:"stencil",newName:"clearStencil"}]),c.CameraComponent=FN,dt.setClassAlias(FN,"cc.CameraComponent");var KN,QN,ZN,JN,$N,eP,tP=e("H",mh("cc.animation.HierarchyPath")((GN=function(){function e(e){ie(this,"path",UN,this),this.path=e||""}return e.prototype.get=function(e){return e instanceof MC?e.getChildByPath(this.path)||(g('Node "'+e.name+'" has no path "'+this.path+'"'),null):(g("Target of hierarchy path should be of type Node."),null)},e}(),UN=re((BN=GN).prototype,"path",[yh],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),zN=BN))||zN),nP=e("c",mh("cc.animation.ComponentPath")((jN=function(){function e(e){ie(this,"component",VN,this),this.component=e||""}return e.prototype.get=function(e){return e instanceof MC?e.getComponent(this.component)||(g('Node "'+e.name+'" has no component "'+this.component+'"'),null):(g("Target of component path should be of type Node."),null)},e}(),VN=re((kN=jN).prototype,"component",[yh],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),HN=kN))||HN);function iP(e){for(var t=e,n=0;n<(arguments.length<=1?0:arguments.length-1);++n){var i=n+1<1||arguments.length<=n+1?void 0:arguments[n+1];if(YN(i)){if(!(i in t))return g('Target object has no property "'+i+'"'),null;t=t[i]}else t=i.get(t);if(null===t)break}return t}var rP,oP,aP,sP,cP,lP,uP,hP,_P,fP,mP,dP=e("U",mh("cc.animation.UniformProxyFactory")((eP=function(){function e(e,t){ie(this,"passIndex",ZN,this),ie(this,"uniformName",JN,this),ie(this,"channelIndex",$N,this),this.passIndex=t||0,this.uniformName=e||""}return e.prototype.forTarget=function(e){var t=e.passes[this.passIndex],n=t.getHandle(this.uniformName);if(!n)throw new Error('Material "'+e.name+'" has no uniform "'+this.uniformName+'"');var i=cd.getPropertyTypeFromHandle(n);if(i===Nm.UBO){var r=void 0===this.channelIndex?n:t.getHandle(this.uniformName,this.channelIndex,Xo.FLOAT);if(!r)throw new Error('Uniform "'+this.uniformName+" (in material "+e.name+") has no channel "+this.channelIndex+'"');return function(e,t){for(var n,i=ne(e.shaderInfo.blocks);!(n=i()).done;)for(var r,o=ne(n.value.members);!(r=o()).done;){var a=r.value;if(a.name===t)return a.count>1}return!1}(t,this.uniformName)?{set:function(e){t.setUniformArray(r,e)}}:{set:function(e){t.setUniform(r,e)}}}if(i===Nm.SAMPLER){var o=cd.getBindingFromHandle(n),a=t.properties[this.uniformName],s=a&&a.value?a.value+"-texture":km(a.type),l=id.get(s);return l||(g("Illegal texture default value: "+s+"."),l=id.get("default-texture")),{set:function(e){e||(e=l);var n=e.getGFXTexture();n&&n.width&&n.height&&(t.bindTexture(o,n),e instanceof vf&&t.bindSampler(o,df.getSampler(c.game._gfxDevice,e.getSamplerHash())))}}}throw new Error("Animations are not available for uniforms with property type "+i+".")},e}(),ZN=re((QN=eP).prototype,"passIndex",[yh],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),JN=re(QN.prototype,"uniformName",[yh],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),$N=re(QN.prototype,"channelIndex",[Gh],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){}}),KN=QN))||KN);function pP(e,t,n,i){var r,o,a,s,c,l,u=new t,h=new t,_=new t,f=mh(e)((l=function(){function e(e,n,i){ie(this,"dataPoint",a,this),ie(this,"inTangent",s,this),ie(this,"outTangent",c,this),this.dataPoint=e||new t,this.inTangent=n||new t,this.outTangent=i||new t}var r=e.prototype;return r.lerp=function(e,t,r){var o=this.dataPoint,a=e.dataPoint;h=n(h,this.inTangent,r),_=n(_,e.outTangent,r);var s=t*t*t,c=t*t,l=s-2*c+t,f=-2*s+3*c,m=s-c;return u=n(u,o,2*s-3*c+1),u=i(u,u,h,l),u=i(u,u,a,f),u=i(u,u,_,m)},r.getNoLerp=function(){return this.dataPoint},e}(),a=re((o=l).prototype,"dataPoint",[yh],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new t}}),s=re(o.prototype,"inTangent",[yh],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new t}}),c=re(o.prototype,"outTangent",[yh],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new t}}),r=o))||r;if(t===Vn){var m=f.prototype.lerp;f.prototype.lerp=function(e,t,n){var i=m.call(this,e,t,n);return Vn.normalize(i,i),i}}return f}e("M",mh("cc.animation.MorphWeightsValueProxy")((sP=function(){function e(){ie(this,"subMeshIndex",aP,this)}return e.prototype.forTarget=function(e){var t=this;return{set:function(n){e.setWeights(n,t.subMeshIndex)}}},e}(),aP=re((oP=sP).prototype,"subMeshIndex",[yh],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),rP=oP))||rP),e("a",mh("cc.animation.MorphWeightsAllValueProxy")(cP=function(){function e(){}return e.prototype.forTarget=function(e){return{set:function(t){for(var n,i,r=null!==(n=null===(i=e.mesh)||void 0===i?void 0:i.struct.primitives.length)&&void 0!==n?n:0,o=0;o<r;++o)e.setWeights(t,o)}}},e}())||cP);var vP=e("d",pP("cc.CubicSplineVec2Value",ti,ti.multiplyScalar,ti.scaleAndAdd));c.CubicSplineVec2Value=vP;var gP=e("f",pP("cc.CubicSplineVec3Value",Fn,Fn.multiplyScalar,Fn.scaleAndAdd));c.CubicSplineVec3Value=gP;var yP=e("g",pP("cc.CubicSplineVec4Value",oi,oi.multiplyScalar,oi.scaleAndAdd));c.CubicSplineVec4Value=yP;var xP=e("h",pP("cc.CubicSplineQuatValue",Vn,Vn.multiplyScalar,Vn.scaleAndAdd));c.CubicSplineQuatValue=xP;var EP=e("j",mh("cc.CubicSplineNumberValue")((mP=function(){function e(e,t,n){ie(this,"dataPoint",hP,this),ie(this,"inTangent",_P,this),ie(this,"outTangent",fP,this),this.dataPoint=e,this.inTangent=t,this.outTangent=n}var t=e.prototype;return t.lerp=function(e,t,n){var i=this.dataPoint,r=e.dataPoint,o=t*t*t,a=t*t;return i*(2*o-3*a+1)+this.outTangent*n*(o-2*a+t)+r*(-2*o+3*a)+e.inTangent*n*(o-a)},t.getNoLerp=function(){return this.dataPoint},e}(),hP=re((uP=mP).prototype,"dataPoint",[yh],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),_P=re(uP.prototype,"inTangent",[yh],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),fP=re(uP.prototype,"outTangent",[yh],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),lP=uP))||lP);function SP(e,t,n){void 0===n&&(n=1e-6);for(var i=0,r=e.length-1,o=r>>>1;i<=r;o=i+r>>>1){var a=e[o];if(a>t+n)r=o-1;else{if(!(a<t-n))return o;i=o+1}}return~i}function TP(e,t,n,i,r){var o=1-r;return o*(o*(e+(3*t-e)*r)+3*n*r*r)+i*r*r*r}c.CubicSplineNumberValue=EP,c.bezier=TP;var AP=Math.cos,CP=Math.acos,wP=Math.max,IP=2*Math.PI,bP=Math.sqrt;function RP(e){return e<0?-Math.pow(-e,1/3):Math.pow(e,1/3)}function OP(e,t){var n=function(e,t){var n,i,r,o,a=t-0,s=t-e[0],c=3*a,l=3*s,u=3*(t-e[2]),h=1/(-a+l-u+(t-1)),_=(c-6*s+u)*h,f=_*(1/3),m=(-c+l)*h,d=1/3*(3*m-_*_),p=d*(1/3),v=(2*_*_*_-9*_*m+a*h*27)/27,g=v/2,y=g*g+p*p*p;if(y<0){var x=1/3*-d,E=bP(x*x*x),S=-v/(2*E),T=CP(S<-1?-1:S>1?1:S),A=2*RP(E);return i=A*AP(T*(1/3))-f,r=A*AP((T+IP)*(1/3))-f,o=A*AP((T+2*IP)*(1/3))-f,i>=0&&i<=1?r>=0&&r<=1?o>=0&&o<=1?wP(i,r,o):wP(i,r):o>=0&&o<=1?wP(i,o):i:r>=0&&r<=1?o>=0&&o<=1?wP(r,o):r:o}if(0===y)return r=-(n=g<0?RP(-g):-RP(g))-f,(i=2*n-f)>=0&&i<=1?r>=0&&r<=1?wP(i,r):i:r;var C=bP(y);return(n=RP(-g+C))-RP(g+C)-f}(e,t),i=e[1];return((1-n)*(i+(e[3]-i)*n)*3+n*n)*n}c.bezierByTime=OP;var NP=e("fC",function(){function e(e){var t,n;this.ratios=void 0,this._findRatio=void 0,this.ratios=e;for(var i=!0,r=1,o=e.length;r<o;r++)if(t=e[r]-e[r-1],1===r)n=t;else if(Math.abs(t-n)>1e-6){i=!1;break}this._findRatio=i?LP:SP}return e.prototype.sample=function(e){return this._findRatio(this.ratios,e)},e}());c.RatioSampler=NP;var PP=e("fD",function(){function e(t,n){this.types=void 0,this.type=null,this._values=[],this._lerp=void 0,this._duration=void 0,this._array=void 0,this._duration=n,this._values=t.values;var i=function(t){return"string"==typeof t?t:Array.isArray(t)?t[0]===t[1]&&t[2]===t[3]?e.Linear:e.Bezier(t):e.Linear};if(void 0!==t.easingMethod)this.type=i(t.easingMethod);else if(Array.isArray(t.easingMethods))this.types=t.easingMethods.map(i);else if(void 0!==t.easingMethods){this.types=new Array(this._values.length).fill(null);for(var r=0,o=Object.keys(t.easingMethods);r<o.length;r++){var a=o[r];this.types[a]=i(t.easingMethods[a])}}else this.type=null;var s=t.values[0];(void 0===t.interpolate||t.interpolate)&&(this._lerp=QP(s)),void 0!==t._arrayLength&&(this._array=new Array(t._arrayLength))}e.Bezier=function(e){return e};var t=e.prototype;return t.hasLerp=function(){return!!this._lerp},t.valueAt=function(e){if(void 0===this._array){var t=this._values[e];return t&&t.getNoLerp?t.getNoLerp():t}for(var n=0;n<this._array.length;++n)this._array[n]=this._values[this._array.length*e+n];return this._array},t.valueBetween=function(e,t,n,i,r){if(this._lerp){var o=this.types?this.types[t]:this.type,a=r-n,s=(e-n)/a;if(o&&(s=DP(s,o)),void 0===this._array){var c=this._values[t],l=this._values[i];return this._lerp(c,l,s,a*this._duration)}for(var u=0;u<this._array.length;++u){var h=this._values[this._array.length*t+u],_=this._values[this._array.length*i+u];this._array[u]=this._lerp(h,_,s,a*this._duration)}return this._array}if(void 0===this._array)return this.valueAt(t);for(var f=0;f<this._array.length;++f)this._array[f]=this._values[this._array.length*t+f];return this._array},t.empty=function(){return 0===this._values.length},t.constant=function(){return 1===this._values.length},e}());function MP(e,t,n){var i=t.sample(n);if(i<0)if((i=~i)<=0)i=0;else{if(!(i>=t.ratios.length))return e.valueBetween(n,i-1,t.ratios[i-1],i,t.ratios[i]);i=t.ratios.length-1}return e.valueAt(i)}function DP(e,t){if("string"==typeof t){var n=mv[t];n?e=n(e):R(3906,t)}else Array.isArray(t)&&(e=OP(t,e));return e}function LP(e,t){var n=e.length-1;if(0===n)return 0;var i=e[0];if(t<i)return 0;var r=e[n];if(t>r)return n;var o=(t=(t-i)/(r-i))/(1/n),a=0|o;return o-a<1e-6?a:a+1-o<1e-6?a+1:~(a+1)}PP.Linear=null,c.AnimCurve=PP,e("fE",function(){function e(){this.events=[]}return e.prototype.add=function(e,t){this.events.push({func:e||"",params:t||[]})},e}()),c.sampleAnimationCurve=MP;var FP,zP,BP,UP,GP,HP,kP,VP,jP,WP,qP,YP,XP,KP,QP=function(){function e(e,t,n,i){return e.lerp(t,n,i)}return function(t){if(null!==t){if("number"==typeof t)return yn;if("object"==typeof t&&t.constructor){if(t instanceof Vn)return n=new Vn,function(e,t,i){return Vn.slerp(n,e,t,i)};if(t instanceof Et)return function(e){var t=new e;return function(n,i,r){return e.lerp(t,n,i,r),t}}(t.constructor);if(t.constructor===Number)return yn;if("function"==typeof t.lerp)return e}var n}}}(),ZP=e("bx",function(){function e(){}return e.getOrExtract=function(t){var n=e.pool.get(t);return n&&n.info.sample===t.sample||(n&&c.director.root.dataPoolManager.releaseAnimationClip(t),n=function(e){var t={};e.curves.forEach((function(e){if(!e.valueAdapter&&XN(e.modifiers[0],tP)&&YN(e.modifiers[1])){var n=e.modifiers[0].path,i=t[n];i||(i=t[n]={}),i[e.modifiers[1]]={values:e.data.values,keys:e.data.keys}}}));for(var n=Math.ceil(e.sample*e.duration)+1,i=function(){var i=o[r],a=t[i];if(!a)return"continue";Object.defineProperty(a,"worldMatrix",{get:function(){if(!a._worldMatrix){var r=a.position,o=a.rotation,s=a.scale;JP(e,r,n),JP(e,o,n),JP(e,s,n),function(e,t,n){var i=n.position.values,r=n.rotation.values,o=n.scale.values,a=i.map((function(){return new Zn})),s=t.lastIndexOf("/"),c=null;if(s>0){var l=e[t.substring(0,s)];if(!l)return void console.warn("no data for parent bone?");c=l.worldMatrix.values}for(var u=0;u<i.length;u++){var h=i[u],_=r[u],f=o[u],m=a[u];Zn.fromRTS(m,_,h,f),c&&Zn.multiply(m,c[u],m)}Object.keys(n).forEach((function(e){return delete n[e]})),n._worldMatrix={keys:0,interpolate:!1,values:a}}(t,i,a)}return a._worldMatrix}})},r=0,o=Object.keys(t);r<o.length;r++)i();return{info:{frames:n,sample:e.sample},data:t}}(t),e.pool.set(t,n)),n},e.destroy=function(t){e.pool.delete(t)},e}());function JP(e,t,n){var i=e.keys[t.keys],r=[];if(i&&1!==i.length)for(var o=t.values[0]instanceof Vn,a=0,s=0;a<n;a++){for(var c=a/e.sample;i[s]<=c;)s++;s>i.length-1?c=i[s=i.length-1]:0===s&&(s=1);var l=t.values[s-1].clone(),u=i[s]-i[s-1],h=u?gn((c-i[s-1])/u):1;o?l.slerp(t.values[s],h):l.lerp(t.values[s],h),r[a]=l}else for(var _=0;_<n;_++)r[_]=t.values[0].clone();t.values=r}ZP.pool=new Map;var $P=e("fH",mh("cc.AnimationClip")((KP=XP=function(e){function t(){for(var t,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return ie(t=e.call.apply(e,[this].concat(i))||this,"sample",BP,ee(t)),ie(t,"speed",UP,ee(t)),ie(t,"wrapMode",GP,ee(t)),ie(t,"events",HP,ee(t)),ie(t,"_duration",kP,ee(t)),ie(t,"_keys",VP,ee(t)),ie(t,"_stepness",jP,ee(t)),ie(t,"_curves",WP,ee(t)),ie(t,"_commonTargets",qP,ee(t)),ie(t,"_hash",YP,ee(t)),t.frameRate=0,t._ratioSamplers=[],t._runtimeCurves=void 0,t._runtimeEvents=void 0,t._data=null,t}$(t,e),t.createWithSpriteFrames=function(e,n){if(!Array.isArray(e))return R(3905),null;var i=new t;i.sample=n||i.sample,i.duration=e.length/i.sample;for(var r=1/i.sample,o=new Array(e.length),a=new Array(o.length),s=0;s<e.length;s++)o[s]=s*r,a[s]=e[s];return i.keys=[o],i.curves=[{modifiers:[new nP("cc.Sprite"),"spriteFrame"],data:{keys:0,values:a}}],i};var n=t.prototype;return n.onLoaded=function(){this.frameRate=this.sample,this._decodeCVTAs()},n.getPropertyCurves=function(){return this._runtimeCurves||this._createPropertyCurves(),this._runtimeCurves},n.updateEventDatas=function(){delete this._runtimeEvents},n.getEventGroupIndexAtRatio=function(e){return this._runtimeEvents||this._createRuntimeEvents(),SP(this._runtimeEvents.ratios,e)},n.hasEvents=function(){return 0!==this.events.length},n.destroy=function(){return c.director.root.dataPoolManager&&c.director.root.dataPoolManager.releaseAnimationClip(this),ZP.destroy(this),e.prototype.destroy.call(this)},n._createPropertyCurves=function(){var e=this;this._ratioSamplers=this._keys.map((function(t){return new NP(t.map((function(t){return t/e._duration})))})),this._runtimeCurves=this._curves.map((function(t){return{curve:new PP(t.data,e._duration),modifiers:t.modifiers,valueAdapter:t.valueAdapter,sampler:e._ratioSamplers[t.data.keys],commonTarget:t.commonTarget}})),this._applyStepness()},n._createRuntimeEvents=function(){for(var e,t=this,n=[],i=[],r=function(){var r=e.value,o=r.frame/t._duration,a=n.findIndex((function(e){return e===o}));a<0&&(a=n.length,n.push(o),i.push({events:[]})),i[a].events.push({functionName:r.func,parameters:r.params})},o=ne(this.events.sort((function(e,t){return e.frame-t.frame})));!(e=o()).done;)r();this._runtimeEvents={ratios:n,eventGroups:i}},n._applyStepness=function(){},n._decodeCVTAs=function(){var e=ArrayBuffer.isView(this._nativeAsset)?this._nativeAsset.buffer:this._nativeAsset;if(e){for(var t=this._keys,n=0;n<t.length;++n){var i=t[n];i instanceof jE&&(t[n]=i.decompress(e))}for(var r=0;r<this._curves.length;++r){var o=this._curves[r];o.data.values instanceof jE&&(o.data.values=o.data.values.decompress(e))}}},Z(t,[{key:"duration",get:function(){return this._duration},set:function(e){this._duration=e}},{key:"keys",get:function(){return this._keys},set:function(e){this._keys=e}},{key:"eventGroups",get:function(){return this._runtimeEvents||this._createRuntimeEvents(),this._runtimeEvents.eventGroups}},{key:"stepness",get:function(){return this._stepness},set:function(e){this._stepness=e,this._applyStepness()}},{key:"hash",get:function(){if(this._hash)return this._hash;var e=this._nativeAsset,t=new Uint8Array(ArrayBuffer.isView(e)?e.buffer:e);return this._hash=es(t,666)}},{key:"curves",get:function(){return this._curves},set:function(e){this._curves=e,delete this._runtimeCurves}},{key:"data",get:function(){return this._data}},{key:"commonTargets",get:function(){return this._commonTargets},set:function(e){this._commonTargets=e}}]),t}(B_),XP.preventDeferredLoadDependents=!0,XP.WrapMode=Al,BP=re((zP=KP).prototype,"sample",[yh],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 60}}),UP=re(zP.prototype,"speed",[yh],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),GP=re(zP.prototype,"wrapMode",[yh],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return Al.Normal}}),HP=re(zP.prototype,"events",[yh],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),kP=re(zP.prototype,"_duration",[yh],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),VP=re(zP.prototype,"_keys",[yh],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),jP=re(zP.prototype,"_stepness",[yh],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),WP=re(zP.prototype,"_curves",[yh],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),qP=re(zP.prototype,"_commonTargets",[yh],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),YP=re(zP.prototype,"_hash",[yh],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),FP=zP))||FP);function eM(e,t,n){var i,r=t[t.length-1];if(0!==t.length&&YN(r)&&!n){var o=iP.apply(void 0,[e].concat(t.slice(0,t.length-1)));if(null===o)return null;i={isProxy:!1,object:o,property:r}}else{if(!n)return y("Empty animation curve."),null;var a=iP.apply(void 0,[e].concat(t));if(null===a)return null;i={isProxy:!0,proxy:n.forTarget(a)}}return{setValue:function(e){i.isProxy?i.proxy.set(e):i.object[i.property]=e},getValue:function(){return i.isProxy?i.proxy.get?i.proxy.get():(y("Target doesn't provide a get method."),null):i.object[i.property]}}}function tM(e,t,n){var i=eM(e,t,n);if(null===i)return null;var r=i.getValue(),o=iM(r);if(!o)return y("Value is not copyable!"),null;var a=o.createBuffer(),s=o.copy;return Object.assign(i,{peek:function(){return a},pull:function(){var e=i.getValue();s(a,e)},push:function(){i.setValue(a)}})}c.AnimationClip=$P;var nM,iM=((nM=new Map).set(ti,{createBuffer:function(){return new ti},copy:ti.copy}),nM.set(Fn,{createBuffer:function(){return new Fn},copy:Fn.copy}),nM.set(oi,{createBuffer:function(){return new oi},copy:oi.copy}),nM.set(Dn,{createBuffer:function(){return new Dn},copy:Dn.copy}),nM.set(ci,{createBuffer:function(){return new ci},copy:function(e,t){return e.set(t)}}),function(e){return nM.get(null==e?void 0:e.constructor)}),rM=function(){function e(){this._isPlaying=!1,this._isPaused=!1,this._stepOnce=!1}var t=e.prototype;return t.play=function(){this._isPlaying?this._isPaused?(this._isPaused=!1,this.onResume()):this.onError(M(3912)):(this._isPlaying=!0,this.onPlay())},t.stop=function(){this._isPlaying&&(this._isPlaying=!1,this.onStop(),this._isPaused=!1)},t.pause=function(){this._isPlaying&&!this._isPaused&&(this._isPaused=!0,this.onPause())},t.resume=function(){this._isPlaying&&this._isPaused&&(this._isPaused=!1,this.onResume())},t.step=function(){this.pause(),this._stepOnce=!0,this._isPlaying||this.play()},t.update=function(){},t.onPlay=function(){},t.onPause=function(){},t.onResume=function(){},t.onStop=function(){},t.onError=function(){},Z(e,[{key:"isPlaying",get:function(){return this._isPlaying}},{key:"isPaused",get:function(){return this._isPaused}},{key:"isMotionless",get:function(){return!this.isPlaying||this.isPaused}}]),e}(),oM=function(){function e(){this._nodeBlendStates=new Map,this._states=new Set}var t=e.prototype;return t.ref=function(e,t){var n=this._nodeBlendStates.get(e);n||(n={dirty:!1,properties:{}},this._nodeBlendStates.set(e,n));var i=n.properties[t];return i||(i=n.properties[t]=new cM(n,aM(t)?new Fn:new Vn)),++i.refCount,i},t.deRef=function(e,t){var n=this._nodeBlendStates.get(e);if(n){var i=n.properties[t];i&&(--i.refCount,i.refCount>0||(delete n.properties[t],function(e){return!(e.properties.position||e.properties.rotation||e.properties.eulerAngles||e.properties.scale)}(n)&&this._nodeBlendStates.delete(e)))}},t.apply=function(){this._nodeBlendStates.forEach((function(e,t){if(e.dirty){e.dirty=!1;var n,i,r,o=e.properties,a=o.position,s=o.scale,c=o.rotation,l=o.eulerAngles,u=!1;a&&0!==a.weight&&(a.weight=0,n=a.value,u=!0),s&&0!==s.weight&&(s.weight=0,i=s.value,u=!0),c&&0!==c.weight&&(c.weight=0,r=c.value,u=!0),l&&0!==l.weight&&(l.weight=0,r=l.value,u=!0),u&&t.setRTS(r,n,i)}})),this._states.forEach((function(e){e.onBlendFinished()}))},t.bindState=function(e){this._states.add(e)},t.unbindState=function(e){this._states.delete(e)},e}();function aM(e){return!function(e){return"rotation"===e}(e)}var sM,cM=function(){function e(e,t){this.weight=0,this.value=void 0,this.refCount=0,this._node=void 0,this._node=e,this.value=t}return e.prototype.markAsDirty=function(){this._node.dirty=!0},e}();function lM(e,t,n){return 0===n.weight&&Fn.zero(n.value),0===t?n.value:1===t?Fn.copy(n.value,e):Fn.scaleAndAdd(n.value,n.value,e,t)}function uM(e,t,n){if(0===n.weight&&Vn.identity(n.value),0===t)return n.value;if(1===t)return Vn.copy(n.value,e);var i=t/(n.weight+t);return Vn.slerp(n.value,n.value,e,i)}!function(e){e.PLAY="play",e.STOP="stop",e.PAUSE="pause",e.RESUME="resume",e.LASTFRAME="lastframe",e.FINISHED="finished"}(sM||(sM={})),xt(sM);var hM=function(){function e(e,t,n){this.commonTargetIndex=void 0,this._curve=void 0,this._boundTarget=void 0,this._rootTargetProperty=void 0,this._curveDetail=void 0,this._curve=e.curve,this._curveDetail=e,this._boundTarget=n}var t=e.prototype;return t.applySample=function(e,t,n,i,r){var o;this._curve.empty()||(o=this._curve.hasLerp()&&n?this._curve.valueBetween(e,i.from,i.fromRatio,i.to,i.toRatio):this._curve.valueAt(t),this._setValue(o,r))},t._setValue=function(e){this._boundTarget.setValue(e)},Z(e,[{key:"propertyName",get:function(){return this._rootTargetProperty||""}},{key:"curveDetail",get:function(){return this._curveDetail}}]),e}(),_M=e("bP",function(e){function t(t,n){var i;return void 0===n&&(n=""),(i=e.call(this)||this).duration=1,i.speed=1,i.time=0,i.weight=0,i.frameRate=0,i._targetNode=null,i._curveLoaded=!1,i._clip=void 0,i._process=i.process,i._samplerSharedGroups=[],i._target=null,i._ignoreIndex=-1,i._commonTargetStatuses=[],i._wrapMode=Al.Normal,i._repeatCount=1,i._delay=0,i._delayTime=0,i._currentFramePlayed=!1,i._name=void 0,i._lastIterations=void 0,i._lastWrapInfo=null,i._lastWrapInfoEvent=null,i._wrappedInfo=new Il,i._blendStateBuffer=null,i._blendStateWriters=[],i._allowLastFrame=!1,i._blendStateWriterHost={weight:0,enabled:!1},i._clip=t,i._name=n||t&&t.name,i}$(t,e),Z(t,[{key:"clip",get:function(){return this._clip}},{key:"name",get:function(){return this._name}},{key:"length",get:function(){return this.duration}},{key:"wrapMode",get:function(){return this._wrapMode},set:function(e){this._wrapMode=e,this.time=0,e&Tl.Loop?this.repeatCount=1/0:this.repeatCount=1}},{key:"repeatCount",get:function(){return this._repeatCount},set:function(e){this._repeatCount=e;var t=this._wrapMode&Tl.ShouldWrap,n=(this.wrapMode&Tl.Reverse)===Tl.Reverse;this._process=e!==1/0||t||n?this.process:this.simpleProcess}},{key:"delay",get:function(){return this._delay},set:function(e){this._delayTime=this._delay=e}},{key:"current",get:function(){return this.getWrappedInfo(this.time).time}},{key:"ratio",get:function(){return this.current/this.duration}}]);var n=t.prototype;return n.initialize=function(e,t){var n,i,r=this;if(!this._curveLoaded){this._curveLoaded=!0,this._destroyBlendStateWriters(),this._samplerSharedGroups.length=0,this._blendStateBuffer=null!==(n=null===(i=c.director.getAnimationManager())||void 0===i?void 0:i.blendState)&&void 0!==n?n:null,this._blendStateBuffer&&this._blendStateBuffer.bindState(this),this._targetNode=e;var o=this._clip;this.duration=o.duration,this.speed=o.speed,this.wrapMode=o.wrapMode,this.frameRate=o.sample,(this.wrapMode&Tl.Loop)===Tl.Loop?this.repeatCount=1/0:this.repeatCount=1;var a=function(e,t,n,i,o){if(!function(e){var t;if(1===e.length&&"string"==typeof e[0])t=e[0];else if(e.length>1){for(var n=0;n<e.length-1;++n)if(!(e[n]instanceof tP))return!1;t=e[e.length-1]}switch(t){case"position":case"scale":case"rotation":case"eulerAngles":return!0;default:return!1}}(n)||!r._blendStateBuffer)return e(t,n,i);var a=iP.apply(void 0,[t].concat(n.slice(0,n.length-1)));if(null!==a&&a instanceof MC){var s=n[n.length-1],c=function(e,t,n,i,r){var o=aM(n)?lM:uM,a=e.ref(t,n),s=!1,c=-1;return{destroy:function(){a&&(e.deRef(t,n),a=null)},forTarget:function(){return{get:function(){return t[n]},set:function(e){if(a&&i.enabled){var t=i.weight;if(r)if(1!==t||t!==c)s=!1;else if(s)return;o(e,t,a),a.weight+=t,a.markAsDirty(),s=!0,c=t}}}}}}(r._blendStateBuffer,a,s,r._blendStateWriterHost,o);return r._blendStateWriters.push(c),e(t,[],c)}return null};this._commonTargetStatuses=o.commonTargets.map((function(t){var n=a(tM,e,t.modifiers,t.valueAdapter,!1);return null===n?null:{target:n,changed:!1}})),t||(t=o.getPropertyCurves());for(var s=function(n){var i=t[n],o=r._samplerSharedGroups.find((function(e){return e.sampler===i.sampler}));o||(o={sampler:i.sampler,curves:[],samplerResultCache:{from:0,fromRatio:0,to:0,toRatio:0}},r._samplerSharedGroups.push(o));var s=void 0;if(void 0===i.commonTarget)s=e;else{var c=r._commonTargetStatuses[i.commonTarget];if(!c)return"continue";s=c.target.peek()}var l=a(eM,s,i.modifiers,i.valueAdapter,i.curve.constant());if(null===l);else{var u=new hM(i,s,l);u.commonTargetIndex=i.commonTarget,o.curves.push(u)}},l=0;l<t.length;++l)s(l)}},n.destroy=function(){this._destroyBlendStateWriters()},n.onBlendFinished=function(){this._blendStateWriterHost.enabled=!1},n.emit=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];c.director.getAnimationManager().pushDelayEvent(this._emit,this,t)},n.on=function(e,t,n){return this._target&&this._target.isValid?this._target.on(e,t,n):null},n.once=function(e,t,n){return this._target&&this._target.isValid?this._target.once(e,t,n):null},n.off=function(e,t,n){this._target&&this._target.isValid&&this._target.off(e,t,n)},n.allowLastFrameEvent=function(e){this._allowLastFrame=e},n._setEventTarget=function(e){this._target=e},n.setTime=function(e){this._currentFramePlayed=!1,this.time=e||0,this._lastWrapInfoEvent=null,this._ignoreIndex=-1;var t=this.getWrappedInfo(e,this._wrappedInfo),n=t.direction,i=this._clip.getEventGroupIndexAtRatio(t.ratio);i<0&&(i=~i-1,n<0&&(i+=1),this._ignoreIndex=i)},n.update=function(e){this._delayTime>0&&(this._delayTime-=e,this._delayTime>0)||(this._currentFramePlayed?this.time+=e*this.speed:this._currentFramePlayed=!0,this._process())},n.sample=function(){var e=this.getWrappedInfo(this.time,this._wrappedInfo);return this._sampleCurves(e.ratio),this._sampleEvents(e),e},n.onPlay=function(){this.setTime(0),this._delayTime=this._delay,this._onReplayOrResume(),this.emit(sM.PLAY,this)},n.onStop=function(){this.isPaused||this._onPauseOrStop(),this.emit(sM.STOP,this)},n.onResume=function(){this._onReplayOrResume(),this.emit(sM.RESUME,this)},n.onPause=function(){this._onPauseOrStop(),this.emit(sM.PAUSE,this)},n._sampleCurves=function(e){this._blendStateWriterHost.weight=this.weight,this._blendStateWriterHost.enabled=!0;for(var t=0;t<this._commonTargetStatuses.length;++t){var n=this._commonTargetStatuses[t];n&&(n.target.pull(),n.changed=!1)}for(var i=0,r=this._samplerSharedGroups.length;i<r;++i){var o=this._samplerSharedGroups[i],a=o.sampler,s=o.samplerResultCache,c=0,l=!1;a?(c=a.sample(e))<0&&((c=~c)<=0?c=0:c>=a.ratios.length?c=a.ratios.length-1:(l=!0,s.from=c-1,s.fromRatio=a.ratios[s.from],s.to=c,s.toRatio=a.ratios[s.to],c=s.from)):c=0;for(var u=0,h=o.curves.length;u<h;++u){var _=o.curves[u];if(_.applySample(e,c,l,s,this.weight),void 0!==_.commonTargetIndex){var f=this._commonTargetStatuses[_.commonTargetIndex];f&&(f.changed=!0)}}}for(var m=0;m<this._commonTargetStatuses.length;++m){var d=this._commonTargetStatuses[m];d&&d.changed&&d.target.push()}},n.process=function(){var e,t=this.sample();this._allowLastFrame&&(e=this._lastWrapInfo?this._lastWrapInfo:this._lastWrapInfo=new Il(t),this.repeatCount>1&&(0|t.iterations)>(0|e.iterations)&&this.emit(sM.LASTFRAME,this),e.set(t)),t.stopped&&(this.stop(),this.emit(sM.FINISHED,this))},n.simpleProcess=function(){var e=this.duration,t=this.time%e;t<0&&(t+=e);var n=t/e;this._sampleCurves(n),this._clip.hasEvents()&&this._sampleEvents(this.getWrappedInfo(this.time,this._wrappedInfo)),this._allowLastFrame&&(void 0===this._lastIterations&&(this._lastIterations=n),(this.time>0&&this._lastIterations>n||this.time<0&&this._lastIterations<n)&&this.emit(sM.LASTFRAME,this),this._lastIterations=n)},n.cache=function(){},n._needReverse=function(e){var t=this.wrapMode,n=!1;return(t&Tl.PingPong)===Tl.PingPong&&(e-(0|e)==0&&e>0&&(e-=1),1&e&&(n=!n)),(t&Tl.Reverse)===Tl.Reverse&&(n=!n),n},n.getWrappedInfo=function(e,t){t=t||new Il;var n=!1,i=this.duration,r=this.repeatCount,o=e>0?e/i:-e/i;if(o>=r){o=r,n=!0;var a=r-(0|r);0===a&&(a=1),e=a*i*(e>0?1:-1)}if(e>i){var s=e%i;e=0===s?i:s}else e<0&&0!=(e%=i)&&(e+=i);var c=!1,l=this._wrapMode&Tl.ShouldWrap;l&&(c=this._needReverse(o));var u=c?-1:1;return this.speed<0&&(u*=-1),l&&c&&(e=i-e),t.ratio=e/i,t.time=e,t.direction=u,t.stopped=n,t.iterations=o,t},n._sampleEvents=function(e){var t=this._clip.eventGroups.length,n=e.direction,i=this._clip.getEventGroupIndexAtRatio(e.ratio);if(i<0&&(i=~i-1,n<0&&(i+=1)),this._ignoreIndex!==i&&(this._ignoreIndex=-1),e.frameIndex=i,!this._lastWrapInfoEvent)return this._fireEvent(i),void(this._lastWrapInfoEvent=new Il(e));var r=this.wrapMode,o=fM(e.iterations),a=this._lastWrapInfoEvent,s=fM(a.iterations),l=a.frameIndex,u=a.direction,h=-1!==s&&o!==s;if(l===i&&h&&1===t)this._fireEvent(0);else if(l!==i||h){n=u;do{if(l!==i){if(-1===n&&0===l&&i>0?((r&Tl.PingPong)===Tl.PingPong?n*=-1:l=t,s++):1===n&&l===t-1&&i<t-1&&((r&Tl.PingPong)===Tl.PingPong?n*=-1:l=-1,s++),l===i)break;if(s>o)break}l+=n,c.director.getAnimationManager().pushDelayEvent(this._fireEvent,this,[l])}while(l!==i&&l>-1&&l<t)}this._lastWrapInfoEvent.set(e)},n._emit=function(e,t){this._target&&this._target.isValid&&this._target.emit(e,e,t)},n._fireEvent=function(e){if(this._targetNode&&this._targetNode.isValid){var t=this._clip.eventGroups;if(!(e<0||e>=t.length||this._ignoreIndex===e))for(var n,i=t[e],r=this._targetNode.components,o=ne(i.events);!(n=o()).done;)for(var a,s=n.value,c=s.functionName,l=ne(r);!(a=l()).done;){var u=a.value,h=u[c];"function"==typeof h&&h.apply(u,s.parameters)}}},n._onReplayOrResume=function(){c.director.getAnimationManager().addAnimation(this)},n._onPauseOrStop=function(){c.director.getAnimationManager().removeAnimation(this)},n._destroyBlendStateWriters=function(){for(var e=0;e<this._blendStateWriters.length;++e)this._blendStateWriters[e].destroy();this._blendStateWriters.length=0,this._blendStateBuffer&&(this._blendStateBuffer.unbindState(this),this._blendStateBuffer=null),this._blendStateWriterHost.enabled=!1},Z(t,[{key:"curveLoaded",get:function(){return this._curveLoaded}}]),t}(rM));function fM(e){return e-(0|e)==0&&(e-=1),0|e}c.AnimationState=_M;var mM,dM,pM,vM,gM,yM,xM,EM,SM,TM,AM,CM,wM,IM,bM,RM,OM,NM=function(e){function t(){var t;return(t=e.call(this)||this)._managedStates=[],t._fadings=[],t}$(t,e);var n=t.prototype;return n.update=function(e){if(!this.isMotionless){for(var t=0;t<this._managedStates.length;++t){var n=this._managedStates[t].state;n&&(n.weight=0)}for(var i=1,r=this._fadings.length,o=0;o<this._fadings.length;++o){var a=this._fadings[o];a.easeTime+=e;var s=0===a.easeDuration?1:gn(a.easeTime/a.easeDuration),c=s*i;if(i*=1-s,a.target.state&&(a.target.state.weight+=c),a.easeTime>=a.easeDuration){r=o+1,a.easeTime=a.easeDuration;break}}if(r!==this._fadings.length){for(var l=r;l<this._fadings.length;++l){var u=this._fadings[l];--u.target.reference,u.target.reference<=0&&(u.target.state&&u.target.state.stop(),Ce(this._managedStates,u.target))}this._fadings.splice(r)}for(var h=0;h<this._managedStates.length;++h){var _=this._managedStates[h].state;_&&_.isMotionless&&_.sample()}}},n.crossFade=function(e,t){var n;0===this._managedStates.length&&(t=0),0===t&&this.clear();var i=this._managedStates.find((function(t){return t.state===e}));i?(null===(n=i.state)||void 0===n?void 0:n.isMotionless)&&i.state.play():(i={state:e,reference:0},e&&e.play(),this._managedStates.push(i)),++i.reference,this._fadings.unshift({easeDuration:t,easeTime:0,target:i})},n.clear=function(){for(var e=0;e<this._managedStates.length;++e){var t=this._managedStates[e].state;t&&t.stop()}this._managedStates.length=0,this._fadings.length=0},n.onPlay=function(){e.prototype.onPlay.call(this),c.director.getAnimationManager().addCrossFade(this)},n.onPause=function(){e.prototype.onPause.call(this),c.director.getAnimationManager().removeCrossFade(this);for(var t=0;t<this._managedStates.length;++t){var n=this._managedStates[t].state;n&&n.pause()}},n.onResume=function(){e.prototype.onResume.call(this),c.director.getAnimationManager().addCrossFade(this);for(var t=0;t<this._managedStates.length;++t){var n=this._managedStates[t].state;n&&n.resume()}},n.onStop=function(){e.prototype.onStop.call(this),c.director.getAnimationManager().removeCrossFade(this),this.clear()},t}(rM),PM=e("bQ",(mM=mh("cc.Animation"),dM=Ih(),pM=ph(99),vM=Th(),gM=Vh([$P]),yM=Nh(),xM=Vh($P),EM=Nh(),SM=Nh(),TM=Vh([$P]),mM(AM=dM(AM=pM(AM=Sh(AM=vM((OM=RM=function(e){function t(){for(var t,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return ie(t=e.call.apply(e,[this].concat(i))||this,"playOnLoad",wM,ee(t)),t._crossFade=new NM,t._nameToState=Ue(!0),ie(t,"_clips",IM,ee(t)),ie(t,"_defaultClip",bM,ee(t)),t._hasBeenPlayed=!1,t}$(t,e);var n=t.prototype;return n.onLoad=function(){for(var e in this.clips=this._clips,this._nameToState)this._nameToState[e].initialize(this.node)},n.start=function(){this.playOnLoad&&!this._hasBeenPlayed&&this._defaultClip&&this.crossFade(this._defaultClip.name,0)},n.onEnable=function(){this._crossFade.resume()},n.onDisable=function(){this._crossFade.pause()},n.onDestroy=function(){for(var e in this._crossFade.stop(),this._nameToState)this._nameToState[e].destroy();this._nameToState=Ue(!0)},n.play=function(e){if(this._hasBeenPlayed=!0,!e){if(!this._defaultClip)return;e=this._defaultClip.name}this.crossFade(e,0)},n.crossFade=function(e,t){void 0===t&&(t=.3),this._hasBeenPlayed=!0;var n=this._nameToState[e];n&&(this._crossFade.play(),this._crossFade.crossFade(n,t))},n.pause=function(){this._crossFade.pause()},n.resume=function(){this._crossFade.resume()},n.stop=function(){this._crossFade.stop()},n.getAnimationState=function(e){return this.getState(e)},n.getState=function(e){var t=this._nameToState[e];return t&&!t.curveLoaded&&t.initialize(this.node),t||null},n.createState=function(e,t){return t=t||e.name,this.removeState(t),this._doCreateState(e,t)},n.removeState=function(e){var t=this._nameToState[e];t&&(t.allowLastFrameEvent(!1),t.stop(),delete this._nameToState[e])},n.addClip=function(e,t){return we(this._clips,e)||this._clips.push(e),this.createState(e,t)},n.removeClip=function(e,t){var n;for(var i in this._nameToState){var r=this._nameToState[i];if(r.clip===e){n=r;break}}if(e===this._defaultClip){if(!t)return void I(3902);this._defaultClip=null}if(n&&n.isPlaying){if(!t)return void I(3903);n.stop()}this._clips=this._clips.filter((function(t){return t!==e})),n&&delete this._nameToState[n.name]},n.on=function(t,n,i,r){var o=e.prototype.on.call(this,t,n,i,r);return t===sM.LASTFRAME&&this._syncAllowLastFrameEvent(),o},n.once=function(t,n,i){var r=e.prototype.once.call(this,t,n,i);return t===sM.LASTFRAME&&this._syncAllowLastFrameEvent(),r},n.off=function(t,n,i){e.prototype.off.call(this,t,n,i),t===sM.LASTFRAME&&this._syncDisallowLastFrameEvent()},n._createState=function(e,t){return new _M(e,t)},n._doCreateState=function(e,t){var n=this._createState(e,t);return n._setEventTarget(this),n.allowLastFrameEvent(this.hasEventListener(sM.LASTFRAME)),this.node&&n.initialize(this.node),this._nameToState[n.name]=n,n},n._getStateByNameOrDefaultClip=function(e){if(!e){if(!this._defaultClip)return null;e=this._defaultClip.name}return this._nameToState[e]||null},n._removeStateOfAutomaticClip=function(e){for(var t in this._nameToState){var n=this._nameToState[t];MM(e,n.clip)&&(n.stop(),delete this._nameToState[t])}},n._syncAllowLastFrameEvent=function(){if(this.hasEventListener(sM.LASTFRAME))for(var e in this._nameToState)this._nameToState[e].allowLastFrameEvent(!0)},n._syncDisallowLastFrameEvent=function(){if(!this.hasEventListener(sM.LASTFRAME))for(var e in this._nameToState)this._nameToState[e].allowLastFrameEvent(!1)},Z(t,[{key:"clips",get:function(){return this._clips},set:function(e){var t=this;this._crossFade&&this._crossFade.clear();for(var n,i=ne(this._clips);!(n=i()).done;){var r=n.value;r&&this._removeStateOfAutomaticClip(r)}for(var o,a=ne(e);!(o=a()).done;){var s=o.value;s&&this.createState(s)}var c=e.find((function(e){return MM(e,t._defaultClip)}));this._defaultClip=c||null,this._clips=e}},{key:"defaultClip",get:function(){return this._defaultClip},set:function(e){this._defaultClip=e,e&&(this._clips.findIndex((function(t){return MM(t,e)}))>=0||(this._clips.push(e),this.createState(e)))}}]),t}(N_(om)),RM.EventType=sM,re((CM=OM).prototype,"clips",[gM,yM],Object.getOwnPropertyDescriptor(CM.prototype,"clips"),CM.prototype),re(CM.prototype,"defaultClip",[xM,EM],Object.getOwnPropertyDescriptor(CM.prototype,"defaultClip"),CM.prototype),wM=re(CM.prototype,"playOnLoad",[yh,SM],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),IM=re(CM.prototype,"_clips",[TM],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),bM=re(CM.prototype,"_defaultClip",[yh],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),AM=CM))||AM)||AM)||AM)||AM)||AM));function MM(e,t){return e===t||!(!e||!t||e.name!==t.name&&e._uuid!==t._uuid)}me(PM.prototype,"Animation",[{name:"getAnimationState",newName:"getState"},{name:"addClip",newName:"createState"},{name:"removeClip",newName:"removeState",customFunction:function(){var e=arguments.length<=0?void 0:arguments[0];return PM.prototype.removeState.call(this,e.name)}}]),c.AnimationComponent=PM,dt.setClassAlias(PM,"cc.AnimationComponent");var DM,LM,FM,zM=[],BM=new Map;function UM(e,t){for(var n=0,i=Zn.IDENTITY;e;){if(e.stamp===t||e.stamp+1===t&&!e.node.hasChangedFlags){i=e.world,e.stamp=t;break}e.stamp=t,zM[n++]=e,e=e.parent}for(;n>0;){var r=(e=zM[--n]).node;Zn.fromRTS(e.local,r.rotation,r.position,r.scale),i=Zn.multiply(e.world,i,e.local)}return i}function GM(e,t){for(var n,i=null,r=0;e!==t;){var o=e.uuid;if(BM.has(o)){i=BM.get(o);break}i={node:e,local:new Zn,world:new Zn,stamp:-1,parent:null},BM.set(o,i),zM[r++]=i,e=e.parent,i=null}for(;r>0;)(n=zM[--r]).parent=i,i=n;return i}function HM(e){for(var t=BM.get(e.uuid)||null;t;)BM.delete(t.node.uuid),t=t.parent}var kM=e("fI",mh((FM=LM=function(e){function t(){for(var t,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return(t=e.call.apply(e,[this].concat(i))||this)._anims=new Se([]),t._delayEvents=[],t._blendStateBuffer=new oM,t._crossFades=[],t._sockets=[],t}$(t,e);var n=t.prototype;return n.addCrossFade=function(e){this._crossFades.push(e)},n.removeCrossFade=function(e){Ce(this._crossFades,e)},n.update=function(e){for(var t=this._delayEvents,n=this._crossFades,i=this._sockets,r=0,o=n.length;r<o;r++)n[r].update(e);var a=this._anims,s=a.array;for(a.i=0;a.i<s.length;++a.i){var l=s[a.i];l.isMotionless||l.update(e)}this._blendStateBuffer.apply();for(var u=c.director.getTotalFrames(),h=0,_=i.length;h<_;h++){var f=i[h],m=f.target,d=f.transform;m.matrix=UM(d,u)}for(var p=0,v=t.length;p<v;p++){var g=t[p];g.fn.apply(g.thisArg,g.args)}t.length=0},n.destruct=function(){},n.addAnimation=function(e){-1===this._anims.array.indexOf(e)&&this._anims.push(e)},n.removeAnimation=function(e){var t=this._anims.array.indexOf(e);t>=0?this._anims.fastRemoveAt(t):R(3907)},n.pushDelayEvent=function(e,t,n){this._delayEvents.push({fn:e,thisArg:t,args:n})},n.addSockets=function(e,t){for(var n=this,i=function(i){var r=t[i];if(n._sockets.find((function(e){return e.target===r.target})))return"continue";var o=e.getChildByPath(r.path),a=r.target&&o&&GM(o,e);a&&n._sockets.push({target:r.target,transform:a})},r=0;r<t.length;++r)i(r)},n.removeSockets=function(e,t){for(var n=0;n<t.length;++n)for(var i=t[n],r=0;r<this._sockets.length;++r){var o=this._sockets[r];if(o.target===i.target){HM(o.transform.node),this._sockets[r]=this._sockets[this._sockets.length-1],this._sockets.length--;break}}},Z(t,[{key:"blendState",get:function(){return this._blendStateBuffer}}]),t}(gA),LM.ID="animation",DM=FM))||DM);zb.on(Fb.EVENT_INIT,(function(){var e=new kM;zb.registerSystem(kM.ID,e,AA.PRIORITY_SYSTEM)})),c.AnimationManager=kM;var VM,jM,WM,qM,YM=new Zn;c.easing=mv;var XM=e("ft",mh("cc.HierachyModifier")(VM=function(e){function t(){return e.apply(this,arguments)||this}return $(t,e),t}(tP))||VM);c.HierachyModifier=XM;var KM=e("fu",mh("cc.ComponentModifier")(jM=function(e){function t(){return e.apply(this,arguments)||this}return $(t,e),t}(nP))||jM);c.ComponentModifier=KM;var QM=e("fv",mh("cc.CurveValueAdapter")(WM=function(){function e(){}return e.prototype.forTarget=function(){return{set:function(){}}},e}())||WM);c.CurveValueAdapter=QM;var ZM=e("fw",mh("cc.UniformCurveValueAdapter")(qM=function(e){function t(){return e.apply(this,arguments)||this}return $(t,e),t}(dP))||qM);function JM(e){return"string"==typeof e}function $M(e){return"number"==typeof e}function eD(e,t){return e instanceof t}c.UniformCurveValueAdapter=ZM,c.isPropertyModifier=JM,c.isElementModifier=$M,c.isCustomTargetModifier=eD,c.math=_i,c.geometry=kl;var tD=e("fK",function(){function e(e){this.poolHandlerComp=void 0,this._pool=void 0,this.poolHandlerComp=e,this._pool=[]}var t=e.prototype;return t.size=function(){return this._pool.length},t.clear=function(){for(var e=this._pool.length,t=0;t<e;++t)this._pool[t].destroy();this._pool.length=0},t.put=function(e){if(e&&-1===this._pool.indexOf(e)){e.removeFromParent();var t=this.poolHandlerComp?e.getComponent(this.poolHandlerComp):null;t&&t.unuse&&t.unuse(),this._pool.push(e)}},t.get=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];var i=this._pool.length-1;if(i<0)return null;var r=this._pool[i];this._pool.length=i;var o=this.poolHandlerComp?r.getComponent(this.poolHandlerComp):null;return o&&o.reuse&&o.reuse(arguments),r},e}());c.NodePool=tD,c.renderer=Lp;var nD=new URL("assets/ammo.wasm-2f572f72.wasm",t.meta.url).href;let iD,rD=!1;"undefined"==typeof WebAssembly?iD=await t.import("./ammo-682120df.js"):(iD=await t.import("./ammo.wasm-54500ec5.js"),rD=!0);var oD,aD=iD.default,sD=e("d6",{});function cD(e){var t={};return void 0!==e&&(sD.wasmBinary=e),new Promise((function(e){aD.call(t,sD).then((function(){e()}))}))}(oD=cD||(cD=e("fL",{}))).isWasm=rD,oD.wasmBinaryURL=nD}}}));
